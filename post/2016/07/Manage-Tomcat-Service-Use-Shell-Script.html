
<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Blog">
  <head>
    <meta charset="utf-8">
	<link rel="manifest" href="/static/pwa/manifest.json">
	<title> Manage Tomcat Service Use Shell Script | 船长的课记 </title>
    
		
    <meta name="author" content="船长">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="theme-color" content="#2196F3">
	<meta name="google-site-verification" content="puZt0ZyqB-t67BYdYAgLUyIPBeismG68J0dmEc01QeY" />

	
    <script>
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', function () {
				navigator.serviceWorker
										.register('/sw.js')
										.then(function(registration) {
											console.log("Successfully registered service worker", registration.scope);
										}).catch(function(err) {
											console.log("Service worker registration failed: ", err);
										});
				//navigator.serviceWorker.ready always resolve
				navigator.serviceWorker.ready.then(function (registration) {
					console.log('Service worker successfully registered on scope', registration.scope);
				});
			});
		}
    </script>
	<script type="text/javascript" src="/assets/themes/evjekylltheme/jquery-3.6.0.slim.min.js"></script>

	<link href="/assets/themes/evjekylltheme/google-code-prettify/desert.css" type="text/css" rel="stylesheet" />

    <!-- Le styles -->
    <link href="/assets/themes/evjekylltheme/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/evjekylltheme/css/style.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/images/favicon.ico">

    <!-- atom & rss feed -->
    <link href="" type="application/atom+xml" rel="alternate" title="Jekyll auto generate ATOM Feed">
    <link href="" type="application/atom+xml" rel="alternate" title="Site ATOM Feed">
    <link href="" type="application/rss+xml" rel="alternate" title="Site RSS Feed">
	<link rel="stylesheet" href="/assets/themes/evjekylltheme/font-awesome-4.4.0/css/font-awesome.min.css">
  </head>

  <body>
    <div class="navbar navbar-default navbar-fixed-top">
				<div class="container">
          <div class="row mobilepadding">
					<a class="navbar-brand" href="/">SAMZONG</a>
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="collapse navbar-collapse" id="mNavbar">
  					<ul class="nav navbar-nav">
  						
  						
  						


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/friends.html">Friends</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
  



						  <li class="dropdown">
							  <a class="dropdown-toggle" data-toggle="dropdown" href="#">Other</a>
							  <ul class="dropdown-menu">
									<li><a href="/about.html">About</a></li>
									<li><a href="https://yuque.com/samzong/note" target="_blank">船长的课记</a></li>
									<li><a href="https://yuque.com/samzong/ap" target="_blank">果粉日记</a></li>
									<li><a href="https://yuque.com/samzong/code" target="_blank">Code Snippet</a></li>
									<li><a href="https://www.yuque.com/samzong/mcx" target="_blank">集</a></li>
									<li><a href="https://www.yuque.com/zooka" target="_blank">藏金阁</a></li>
								</ul>
						  </li>
  					</ul>
  					<form id="search-form" class="navbar-form navbar-right" role="search">
  						<div class="form-group">
  						<input type="text" class="form-control input-sm" placeholder="Search's Bad" id="query">
  						</div>
  					</form>
  					<div class="nav-icon">
  						<a href="/feed.xml"><i class="fa fa-rss fa-2x"></i></a>
  					</div>
          </div>
				</div>
      </div>
    </div>

    <div class="container">
			<div class="row mobilepadding">
        <div class="row">
					<div class="col-md-12">
						<div class="searchresult">
						</div>
						<div id="search-loader" class="img-wrap">
						</div>
					</div>
        </div>
				
<div class="row" itemscope itemtype="http://schema.org/Article">
    <div class="col-xs-12 col-md-8">
        <div class="page-header" itemprop="name">
            <h1>Manage Tomcat Service Use Shell Script 
            </h1>
        </div>
        <div class="post-meta">
            
            <span class="entry-date" itemprop="datePublished">Posted on 07/26/2016</span>
            
            
            <span class="entry-author" itemprop="author">by 船长</span>
            | <a class="revision-histroy" href="https://github.com/samzong/samzong.me/commits/main/_posts/2016-07-27-Manage-Tomcat-Service-Use-Shell-Script.md"
                 target="_blank">View revision history</a>
        </div>
        <div class="post-content" itemprop="articleBody">
            <h4 id="tomcat-项目管理交互式脚本">Tomcat 项目管理交互式脚本</h4>

<ul>
  <li>Install pssh</li>
  <li>Use Key Login Server Hosts</li>
  <li>~/.ssh/config 配置使用 host 名登录服务</li>
  <li>指定 Server Group Files 存放位置</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="c"># Author Alex LU</span>
<span class="c"># Date 2016-07-20</span>
<span class="c"># Version 1.0</span>

<span class="c"># HostFile</span>
<span class="nv">HostDIR</span><span class="o">=</span>~/.ssh/host/

<span class="c"># war包上传到该目录</span>
<span class="c"># /warfolder</span>

:<span class="s1">'
jobs_select (){
    STRING=``cat $vmname | grep group
    if [ -z "$STRING" ]
    then
        job_tomcat
    else
        job2_tomcat
    fi
}
'</span>

<span class="k">function </span>HOST<span class="o">()</span>
<span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">""</span>
    <span class="nb">echo</span> <span class="s2">"############ Host List ###############"</span>
    <span class="nb">echo</span> <span class="s2">"ckgroup:ck01,ck02,ck03,ck04"</span>
    <span class="nb">echo</span> <span class="s2">"sjgroup:sj01,sj02,sj03,sj04"</span>
    <span class="nb">echo</span> <span class="s2">"ddgroup:dd01,dd02,dd03,dd04"</span>
    <span class="nb">echo</span> <span class="s2">"htgroup:ht01,ht02"</span>
    <span class="nb">echo</span> <span class="s2">"othergroup:report,tg"</span>
    <span class="nb">echo</span> <span class="s2">"######################################"</span>
    <span class="nb">echo</span> <span class="s2">""</span>
    <span class="nb">echo</span> <span class="s2">" Tips: 如果要选择ck01，则输入ck01即可，如果输入ck组，输入ckgroup即可,如果要退出当前脚本输入exit"</span>
    <span class="nb">echo</span> <span class="s2">" Tips: 退回上一步请输入back"</span>
    <span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"请输入你的选择:"</span> vmname

    <span class="k">case</span> <span class="s2">"</span><span class="nv">$vmname</span><span class="s2">"</span> <span class="k">in
        </span>ck01|ck02|ck03|ck04|sj01|sj02|sj03|sj04|dd01|dd02|dd03|dd04|report|tg|ht01|ht02<span class="p">)</span>
            job_tomcat <span class="nv">$vmname</span>
            <span class="p">;;</span>
        ckgroup|sjgroup|htgroup|ddgroup|othergroup<span class="p">)</span>
            job2_tomcat <span class="nv">$vmname</span>
            <span class="p">;;</span>
        <span class="nb">exit</span><span class="p">)</span>
            <span class="nb">exit </span>0<span class="p">;</span>
            <span class="p">;;</span>
        back<span class="p">)</span>
            clear
            <span class="nb">echo</span> <span class="s2">""</span>
            <span class="nb">echo</span> <span class="s2">"Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器"</span>
            main
            <span class="p">;;</span>
        <span class="k">*</span><span class="p">)</span>
            <span class="nb">echo</span> <span class="s2">"请输入的选择!"</span>
            HOST
            <span class="p">;;</span>
    <span class="k">esac</span>
<span class="o">}</span>

<span class="k">function </span>job_tomcat <span class="o">()</span>
<span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">""</span>
    <span class="nb">echo</span> <span class="s2">"############ 动作 ###############"</span>
    <span class="nb">echo</span> <span class="s2">"  1. 查看当前tomcat7状态"</span>
    <span class="nb">echo</span> <span class="s2">"  2. 关闭tomcat7"</span>
    <span class="nb">echo</span> <span class="s2">"  3. 启动tomcat7"</span>
    <span class="nb">echo</span> <span class="s2">"  4. 重启tomcat7"</span>
    <span class="nb">echo</span> <span class="s2">"  5. 获取最近200行日志"</span>
    <span class="nb">echo</span> <span class="s2">"  6. 重新选择主机"</span>
    <span class="nb">echo</span> <span class="s2">"  7. 回到顶层目录"</span>
    <span class="nb">echo</span> <span class="s2">""</span>
    <span class="nb">echo</span> <span class="s2">"#################################"</span>

    <span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"请输入你的选择:"</span> service_tomcat

    <span class="k">case</span> <span class="nv">$service_tomcat</span> <span class="k">in
        </span>1<span class="p">)</span>
        pssh <span class="nt">-H</span> <span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"ps aux | grep tomcat"</span>
        job_tomcat
        <span class="p">;;</span>
        2<span class="p">)</span>
        pssh <span class="nt">-H</span> <span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"service tomcat7 stop"</span>
        <span class="c"># tips： 下面grep的字符串要和你的tomcat项目名称契合</span>
        pssh <span class="nt">-H</span> <span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"ps aux | grep tomcat7 | awk '{print </span><span class="nv">$2</span><span class="s2">}' | xargs kill -9 "</span>
        <span class="c"># tips: 下面用到的路径为绝对路径，请更改为自己tomcat的目录，也可以在前面增加自定义变量</span>
        pssh <span class="nt">-H</span> <span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"rm -rf /tomcat7/work/*"</span>
        pssh <span class="nt">-H</span> <span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"rm -rf /tomcat7/logs/*"</span>
        pssh <span class="nt">-H</span> <span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"rm -rf /tomcat7/temp/*"</span>
        job_tomcat
        <span class="p">;;</span>
        3<span class="p">)</span>
        pssh <span class="nt">-H</span> <span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"service tomcat7 start"</span>
        job_tomcat
        <span class="p">;;</span>
        4<span class="p">)</span>
        pssh <span class="nt">-H</span> <span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"service tomcat7 stop"</span>
        <span class="c"># tips： 下面grep的字符串要和你的tomcat项目名称契合</span>
        pssh <span class="nt">-H</span> <span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"ps aux | grep tomcat7 | awk '{print </span><span class="nv">$2</span><span class="s2">}' | xargs kill -9 "</span>
        <span class="c"># tips: 下面用到的路径为绝对路径，请更改为自己tomcat的目录，也可以在前面增加自定义变量</span>
        pssh <span class="nt">-H</span> <span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"rm -rf /tomcat7/work/*"</span>
        pssh <span class="nt">-H</span> <span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"rm -rf /tomcat7/logs/*"</span>
        pssh <span class="nt">-H</span> <span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"rm -rf /tomcat7/temp/*"</span>
        <span class="nb">sleep </span>1
        pssh <span class="nt">-H</span> <span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"service tomcat7 start"</span>
        job_tomcat
        <span class="p">;;</span>
        5<span class="p">)</span>
        pssh <span class="nt">-H</span> <span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"tail -n 200 /tomcat7/logs/catalina.out"</span>
        job_tomcat
        <span class="p">;;</span>
        6<span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        HOST
        <span class="p">;;</span>
        7<span class="p">)</span>
        clear
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器"</span>
        main
        <span class="p">;;</span>
        <span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"请输入正确的选项！"</span>
        job_tomcat
        <span class="p">;;</span>
    <span class="k">esac</span>
<span class="o">}</span>

<span class="k">function </span>job2_tomcat <span class="o">()</span>
<span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">""</span>
    <span class="nb">echo</span> <span class="s2">"############ 动作 ###############"</span>
    <span class="nb">echo</span> <span class="s2">"  1. 查看当前tomcat7状态"</span>
    <span class="nb">echo</span> <span class="s2">"  2. 关闭tomcat7"</span>
    <span class="nb">echo</span> <span class="s2">"  3. 启动tomcat7"</span>
    <span class="nb">echo</span> <span class="s2">"  4. 重启tomcat7"</span>
    <span class="nb">echo</span> <span class="s2">"  5. 获取最近200行日志"</span>
    <span class="nb">echo</span> <span class="s2">"  6. 重新选择主机"</span>
    <span class="nb">echo</span> <span class="s2">"  7. 回到顶层目录"</span>
    <span class="nb">echo</span> <span class="s2">""</span>
    <span class="nb">echo</span> <span class="s2">"################################"</span>

    <span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"请输入你的选择:"</span> service_tomcat

    <span class="k">case</span> <span class="nv">$service_tomcat</span> <span class="k">in
        </span>1<span class="p">)</span>
        pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"ps aux | grep tomcat"</span>
        job2_tomcat
        <span class="p">;;</span>
        2<span class="p">)</span>
        pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"service tomcat7 stop"</span>
        <span class="c"># tips： 下面grep的字符串要和你的tomcat项目名称契合</span>
        pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"ps aux | grep tomcat7 | awk '{print </span><span class="nv">$2</span><span class="s2">}' | xargs kill -9 "</span>
        <span class="c"># tips: 下面用到的路径为绝对路径，请更改为自己tomcat的目录，也可以在前面增加自定义变量</span>
        pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"rm -rf /tomcat7/work/*"</span>
        pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"rm -rf /tomcat7/logs/*"</span>
        pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"rm -rf /tomcat7/temp/*"</span>
        job2_tomcat
        <span class="p">;;</span>
        3<span class="p">)</span>
        pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"service tomcat7 start"</span>
        job2_tomcat
        <span class="p">;;</span>
        4<span class="p">)</span>
        pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"service tomcat7 stop"</span>
        <span class="c"># tips： 下面grep的字符串要和你的tomcat项目名称契合</span>
        pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"ps aux | grep tomcat7 | awk '{print </span><span class="nv">$2</span><span class="s2">}' | xargs kill -9 "</span>
        <span class="c"># tips: 下面用到的路径为绝对路径，请更改为自己tomcat的目录，也可以在前面增加自定义变量</span>
        pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"rm -rf /tomcat7/work/*"</span>
        pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"rm -rf /tomcat7/logs/*"</span>
        pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"rm -rf /tomcat7/temp/*"</span>
        <span class="nb">sleep </span>1
        pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"service tomcat7 start"</span>
        job2_tomcat
        <span class="p">;;</span>
        5<span class="p">)</span>
        pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"tail -n 200 /tomcat7/logs/catalina.out"</span>
        job2_tomcat
        <span class="p">;;</span>
        6<span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">""</span>
        HOST
        <span class="p">;;</span>
        7<span class="p">)</span>
        clear
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器"</span>
        main
        <span class="p">;;</span>
        <span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"请输入正确的选项！"</span>
        job_tomcat
        <span class="p">;;</span>
    <span class="k">esac</span>
<span class="o">}</span>

<span class="k">function </span>HOST2<span class="o">()</span>
<span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">""</span>
    <span class="nb">echo</span> <span class="s2">"############ Host List ###############"</span>
    <span class="nb">echo</span> <span class="s2">"ckgroup:ck01,ck02,ck03,ck04"</span>
    <span class="nb">echo</span> <span class="s2">"sjgroup:sj01,sj02,sj03,sj04"</span>
    <span class="nb">echo</span> <span class="s2">"ddgroup:dd01,dd02,dd03,dd04"</span>
    <span class="nb">echo</span> <span class="s2">"htgroup:ht01,ht02"</span>
    <span class="nb">echo</span> <span class="s2">"othergroup:report,tg"</span>
    <span class="nb">echo</span> <span class="s2">"######################################"</span>
    <span class="nb">echo</span> <span class="s2">""</span>
<span class="c"># 确认是否所有项目包发布后立即启动</span>
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\0</span><span class="s2">33[7m 更新订单服务器的war包时，会自动启动tomcat程序，为了释放war包，修改order.no，请设置war包内order.no＝0 ,其它服务器tomcat不会自启动，请使用命令操作 </span><span class="se">\0</span><span class="s2">33[0m"</span>
    <span class="nb">echo</span> <span class="s2">" Tips: 如果要选择ck01，则输入ck01即可，如果输入ck组，输入ckgroup即可,如果要退出当前脚本输入exit"</span>
    <span class="nb">echo</span> <span class="s2">" Tips: 退回上一步请输入back"</span>
    <span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"请输入你的选择:"</span> vmname
    <span class="k">case</span> <span class="s2">"</span><span class="nv">$vmname</span><span class="s2">"</span> <span class="k">in
        </span>ck01|ck02|ck03|ck04|sj01|sj02|sj03|sj04|dd01|dd02|dd03|dd04|report|tg|ht01|ht02<span class="p">)</span>
            <span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"请输入war包的名称,例如:dzcx_ck.war :"</span> warname
            pscp_tomcat <span class="nv">$vmname</span> <span class="nv">$warname</span>
            <span class="p">;;</span>
        ckgroup|sjgroup|htgroup|othergroup<span class="p">)</span>
            <span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"请输入war包的名称,例如:dzcx_ck.war :"</span> warname
            pscp2_tomcat <span class="nv">$vmname</span> <span class="nv">$warname</span>
            <span class="p">;;</span>
        ddgroup<span class="p">)</span>
            <span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"请输入war包的名称,例如:dzcx_ck.war :"</span> warname
            pscp3_tomcat <span class="nv">$vmname</span> <span class="nv">$warname</span>
            <span class="p">;;</span>
        <span class="nb">exit</span><span class="p">)</span>
            <span class="nb">exit </span>0<span class="p">;</span>
            <span class="p">;;</span>
        back<span class="p">)</span>
            clear
            <span class="nb">echo</span> <span class="s2">""</span>
            <span class="nb">echo</span> <span class="s2">"Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器"</span>
            main
            <span class="p">;;</span>
        <span class="k">*</span><span class="p">)</span>
            <span class="nb">echo</span> <span class="s2">"请输入的选择!"</span>
            HOST
            <span class="p">;;</span>
    <span class="k">esac</span>
<span class="o">}</span>

<span class="k">function </span>pscp_tomcat <span class="o">()</span>
<span class="o">{</span>
    <span class="c"># single host</span>
    pscp.pssh <span class="nt">-H</span> <span class="nv">$vmname</span> /warfolder/<span class="s2">"</span><span class="nv">$warname</span><span class="s2">"</span> /tomcat7/webapps/
    HOST2
<span class="o">}</span>

<span class="k">function </span>pscp2_tomcat <span class="o">()</span>
<span class="o">{</span>
    <span class="c"># group</span>
    pscp.pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> /warfolder/<span class="s2">"</span><span class="nv">$warname</span><span class="s2">"</span> /tomcat7/webapps/
    HOST2
<span class="o">}</span>

<span class="k">function </span>pscp3_tomcat <span class="o">()</span>
<span class="o">{</span>
    <span class="c"># group dd 因为订单需要修改服务器编号</span>
    pscp.pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/<span class="nv">$vmname</span> /warfolder/<span class="s2">"</span><span class="nv">$warname</span><span class="s2">"</span> /tomcat7/webapps/
    pssh <span class="nt">-h</span> <span class="nv">$vmname</span> <span class="nt">-i</span> <span class="s2">"service tomcat7 start"</span>
    <span class="nb">sleep </span>10
    pssh <span class="nt">-H</span> dd02 <span class="s2">"sed -i 's/order.no=0/order.no=1/g' /tomcat7/webapps/dzcx_socket/WEB-INF/classes/base.properties"</span>
    pssh <span class="nt">-H</span> dd03 <span class="s2">"sed -i 's/order.no=0/order.no=2/g' /tomcat7/webapps/dzcx_socket/WEB-INF/classes/base.properties"</span>
    pssh <span class="nt">-H</span> dd04 <span class="s2">"sed -i 's/order.no=0/order.no=3/g' /tomcat7/webapps/dzcx_socket/WEB-INF/classes/base.properties"</span>
    HOST2
<span class="o">}</span>

<span class="k">function </span>main <span class="o">()</span>
<span class="o">{</span>
<span class="nb">echo</span> <span class="s2">""</span>
<span class="nb">echo</span> <span class="s2">"######################################"</span>
<span class="nb">echo</span> <span class="s2">""</span>
<span class="nb">echo</span> <span class="s2">"#  1. 更新war包"</span>
<span class="nb">echo</span> <span class="s2">"#  2. 管理tomcat7"</span>
<span class="nb">echo</span> <span class="s2">"#  3. 管理mysql"</span>
<span class="nb">echo</span> <span class="s2">"#  4. 管理redis"</span>
<span class="nb">echo</span> <span class="s2">"#  5. 同步服务器时间"</span>
<span class="nb">echo</span> <span class="s2">"#  6. 清理当前屏幕"</span>
<span class="nb">echo</span> <span class="s2">"#  7. 退出"</span>
<span class="nb">echo</span> <span class="s2">""</span>
<span class="nb">echo</span> <span class="s2">"######################################"</span>

<span class="nb">read</span> <span class="nt">-p</span> <span class="s2">"请输入你的选择:"</span> num

<span class="k">case</span> <span class="s2">"</span><span class="nv">$num</span><span class="s2">"</span> <span class="k">in
    </span>1<span class="p">)</span>
        HOST2
        <span class="p">;;</span>
    2<span class="p">)</span>
        HOST
        <span class="p">;;</span>
    3<span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"该功能暂未开放"</span>
        <span class="p">;;</span>
    4<span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"该功能暂未开放"</span>
        <span class="p">;;</span>
    5<span class="p">)</span>
        pssh <span class="nt">-h</span> <span class="nv">$HostDIR</span>/allhost <span class="nt">-i</span> <span class="s2">"service ntpd restart"</span>
        <span class="p">;;</span>
    6<span class="p">)</span>
        clear
        <span class="nb">echo</span> <span class="s2">""</span>
        <span class="nb">echo</span> <span class="s2">"Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器"</span>
        main
        <span class="p">;;</span>
    7<span class="p">)</span>
        <span class="nb">exit </span>0
        <span class="p">;;</span>
    <span class="k">*</span><span class="p">)</span>
        <span class="nb">echo</span> <span class="s2">"请输入正确的数值！"</span>
        main
    <span class="p">;;</span>
<span class="k">esac</span>

<span class="o">}</span>

<span class="c"># --------------------------------- main -------------------------------------------------</span>

clear

<span class="nb">echo</span> <span class="s2">""</span>
<span class="nb">echo</span> <span class="s2">"Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器"</span>
<span class="nb">command</span> <span class="nt">-v</span> pssh <span class="o">&gt;</span> /dev/null 2&gt;&amp;1

<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span>
<span class="k">then
    </span>main
<span class="k">else
    </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\0</span><span class="s2">33[07m"</span>
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"系统检测到您还没安装pssh，请预先安装pssh"</span>
    <span class="nb">echo</span> <span class="s2">"yum install -y epel-release"</span>
    <span class="nb">echo</span> <span class="s2">"yum install -y pssh"</span>
    <span class="nb">echo</span> <span class="s2">"安装成功请重新运行此脚本"</span>
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\0</span><span class="s2">33[0m"</span>

<span class="k">fi</span>


</code></pre></div></div>

        </div>

        <!-- <div id="related">
            <h2>Related Posts</h2>
            <ul class="posts"> 当一篇文章有两个 tag 一样时显示
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li><a href="/post/2017/04/HowTo-set-Tomcat-7-automatic-startup-with-CentOS-7.html">HowTo set Tomcat 7 automatic startup with CentOS 7</a> - <span>04/05/2017</span></li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li><a href="/post/2016/08/Script-Install-LNMP.html">Use Script Install LNMP</a> - <span>08/13/2016</span></li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li><a href="/post/2016/07/Manage-Tomcat-Service-Use-Shell-Script.html">Manage Tomcat Service Use Shell Script</a> - <span>07/26/2016</span></li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li><a href="/post/2016/03/MySQL-6-%E5%88%A9%E7%94%A8Linux%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E5%AE%9A%E6%97%B6%E5%90%8C%E6%AD%A5MySQL.html">利用 Linux 计划任务定时同步 MySQL</a> - <span>03/24/2016</span></li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
            </ul>
        </div> -->

        <hr>
        <nav>
            <ul class="pager">
                
                <li class="previous"><a href="/post/2016/07/HowTo-Play-Pokemon-GO-in-China.html" title="HowTo Play Pokemon GO in China">&larr;
                    Previous（前一篇）</a></li>
                
                <!-- <li><a href="/static/archive.html">Archive（目录）</a></li> -->
                <li><a href="/archive.html">Archive（目录）</a></li>
                
                <li class="next"><a href="/post/2016/07/Yum%E4%B8%AD-releasever%E5%92%8C-basearch%E7%9A%84%E5%8F%96%E5%80%BC.html" title="Yum 中$releasever 和$basearch 的取值">Next（后一篇） &rarr;</a></li>
                
            </ul>
        </nav>
    </div>

    <div class="col-xs-12 col-md-4">
        
        <ul class="tag_box">
            <li><span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span></li>
            
            


  
     
    	
      <li><a href="/categories.html#Linux">
    		Linux <span>22</span>
    	</a></li>
    
  



        </ul>
        

        
        <ul class="tag_box">
            <li><span class="glyphicon glyphicon-tag" aria-hidden="true"></span></li>
            
            


  
     
    	
    	<li><a href="/tags.html#Shell">Shell <span>4</span></a></li>
     
    	
    	<li><a href="/tags.html#CentOS">CentOS <span>23</span></a></li>
     
    	
    	<li><a href="/tags.html#Tomcat">Tomcat <span>7</span></a></li>
    
  



        </ul>
        
        <div id="floatbox">
            <div id="post-directory-module">
                <div id="toc"></div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="/assets/themes/evjekylltheme/toc.js"></script>
<script>!function(e,n){for(var o=0;o<e.length;o++){var r=n.createElement("script"),c=".js",d=n.head||n.body;"noModule"in r?(r.type="module",c=".mjs"):r.async=!0,r.defer=!0,r.src=remark_config.host+"/web/"+e[o]+c,d.appendChild(r)}}(remark_config.components||["embed"],document);</script>


			</div>

		</div>

    <footer>
      <div class="container">
        <div class="row mobilepadding">
          			<hr>
      &copy; 2023 船长. Powered by <a href="http://jekyllrb.com" target="_blank" title="The simple, blog-aware, static site generator.">Jekyll</a>. Theme Creator <a href="https://github.com/einverne" target="_blank" title="Ein Verne's GitHub Repos">Ein Verne</a> . Host on <a href="https://github.com/samzong/samzong.me" target="_blank" title="Samzong's GitHub Repos">Github</a> .
      <br><br>
      </div>
    </div>
    </footer>

    




	<script async type="text/javascript" src="/assets/themes/evjekylltheme/bootstrap-3.3.5/js/bootstrap.min.js"></script>
	<script async type="text/javascript" src="/assets/themes/evjekylltheme/webcore.js"></script>

 </body>
</html>

