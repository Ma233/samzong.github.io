
<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Blog">
  <head>
    <meta charset="utf-8">
	<link rel="manifest" href="/static/pwa/manifest.json">
	<title> Home | 船长的课记 </title>
    
		
    <meta name="author" content="船长">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="theme-color" content="#2196F3">
	<meta name="google-site-verification" content="puZt0ZyqB-t67BYdYAgLUyIPBeismG68J0dmEc01QeY" />

	
    <script>
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', function () {
				navigator.serviceWorker
										.register('/sw.js')
										.then(function(registration) {
											console.log("Successfully registered service worker", registration.scope);
										}).catch(function(err) {
											console.log("Service worker registration failed: ", err);
										});
				//navigator.serviceWorker.ready always resolve
				navigator.serviceWorker.ready.then(function (registration) {
					console.log('Service worker successfully registered on scope', registration.scope);
				});
			});
		}
    </script>
	<script type="text/javascript" src="/assets/themes/evjekylltheme/jquery-3.6.0.slim.min.js"></script>

	<link href="/assets/themes/evjekylltheme/google-code-prettify/desert.css" type="text/css" rel="stylesheet" />

    <!-- Le styles -->
    <link href="/assets/themes/evjekylltheme/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/evjekylltheme/css/style.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/images/favicon.ico">

    <!-- atom & rss feed -->
    <link href="" type="application/atom+xml" rel="alternate" title="Jekyll auto generate ATOM Feed">
    <link href="" type="application/atom+xml" rel="alternate" title="Site ATOM Feed">
    <link href="" type="application/rss+xml" rel="alternate" title="Site RSS Feed">
	<link rel="stylesheet" href="/assets/themes/evjekylltheme/font-awesome-4.4.0/css/font-awesome.min.css">
	<!-- <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-W2LDG64');</script> -->
		<!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8529425670069509"
						crossorigin="anonymous"></script> -->
	<!-- <script async src="https://cdn.splitbee.io/sb.js"></script> -->
  </head>

  <body>
	<!-- <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W2LDG64"
	height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> -->
    <div class="navbar navbar-default navbar-fixed-top">
				<div class="container">
          <div class="row mobilepadding">
					<!-- <a class="navbar-brand" href="/">船长的课记</a> -->
					<a class="navbar-brand" href="/">SAMZONG</a>
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="collapse navbar-collapse" id="mNavbar">
  					<ul class="nav navbar-nav">
  						
  						
  						


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/friends.html">Friends</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  



						  <li class="dropdown">
							  <a class="dropdown-toggle" data-toggle="dropdown" href="#">Other</a>
							  <ul class="dropdown-menu">
									<li><a href="/about.html">About</a></li>
									<li><a href="https://yuque.com/samzong/note" target="_blank">船长的课记</a></li>
									<li><a href="https://yuque.com/samzong/ap" target="_blank">果粉日记</a></li>
									<li><a href="https://yuque.com/samzong/code" target="_blank">Code Snippet</a></li>
									<li><a href="https://www.yuque.com/samzong/mcx" target="_blank">集</a></li>
									<li><a href="https://www.yuque.com/zooka" target="_blank">藏金阁</a></li>
								</ul>
						  </li>
  					</ul>
  					<form id="search-form" class="navbar-form navbar-right" role="search">
  						<div class="form-group">
  						<input type="text" class="form-control input-sm" placeholder="Search's Bad" id="query">
  						</div>
  					</form>
  					<div class="nav-icon">
  						<a href="/feed.xml"><i class="fa fa-rss fa-2x"></i></a>
  					</div>
          </div>
				</div>
      </div>
    </div>

    <div class="container">
			<div class="row mobilepadding">
        <div class="row">
					<div class="col-md-12">
						<div class="searchresult">
						</div>
						<div id="search-loader" class="img-wrap">
						</div>
					</div>
        </div>
				<meta itemprop="image" content="https://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com/uPic/telegram-cloud-photo-size-4-5971176114485308439-x.jpg">
<div class="row">
  <div class="col-xs-12 col-md-8">
    
    
    <h1><a class="title" href="/post/2017/04/CentOS%E5%A2%9E%E5%8A%A0%E6%96%B0%E7%A1%AC%E7%9B%98%E7%BB%99%E6%A0%B9%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%AE%B9.html">CentOS 增加新硬盘给根文件系统扩容</a></h1>
    <div class="post_at_index">
      <p>由于刚开始做磁盘空间规划时，失误给根分区分配磁盘较小，导致后续实验环境无法进行，所以在经过研究后，决定尝试增加根分区的磁盘空间，注意这仅适用于创建在 LVM 上的文件系统。</p>

<h2 id="实验环境">实验环境</h2>

<ul>
  <li>Parallels Desktop 12</li>
  <li>CentOS 6.9</li>
  <li>根分区空间 6.5GB</li>
  <li>已使用 5.8GB</li>
  <li>预计 增加 12G 磁盘空间</li>
</ul>

<!-- more -->

<h2 id="增加一块物理磁盘">增加一块物理磁盘</h2>

<p>Parallels Desktop 不能在线增加磁盘，所以要先将 VM 关闭，然后添加：
<img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/m5e1d.jpg" alt="image" />
增加 12G 的磁盘
<img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/prgyd.jpg" alt="image" /></p>

<p>然后启动 VM，这时可以通过<code class="language-plaintext highlighter-rouge">fdisk -l</code>查看当前已经增加了一块 12G 的磁盘</p>

<p><img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/tat9r.jpg" alt="image" /></p>

<h2 id="格式化磁盘并加入到-vgroup-组内">格式化磁盘并加入到 VGroup 组内</h2>

<h3 id="查看当前pvdisplay磁盘列表将devsdb创建-pv-块">查看当前<code class="language-plaintext highlighter-rouge">pvdisplay</code>磁盘列表，将<code class="language-plaintext highlighter-rouge">/dev/sdb</code>创建 pv 块</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@centos ~]# pvdisplay
  <span class="nt">---</span> Physical volume <span class="nt">---</span>
  PV Name               /dev/sda2
  VG Name               vg_hadoop01
  PV Size               7.51 GiB / not usable 3.00 MiB
  Allocatable           <span class="nb">yes</span> <span class="o">(</span>but full<span class="o">)</span>
  PE Size               4.00 MiB
  Total PE              1922
  Free PE               0
  Allocated PE          1922
  PV UUID               MUCrDa-eJpZ-EXwE-YwwM-S2Az-p2m7-K9q3Fo

<span class="o">[</span>root@centos ~]# pvcreate /dev/sdb
  Physical volume <span class="s2">"/dev/sdb"</span> successfully created
<span class="o">[</span>root@centos ~]# pvdisplay
  <span class="nt">---</span> Physical volume <span class="nt">---</span>
  PV Name               /dev/sda2
  VG Name               vg_hadoop01
  PV Size               7.51 GiB / not usable 3.00 MiB
  Allocatable           <span class="nb">yes</span> <span class="o">(</span>but full<span class="o">)</span>
  PE Size               4.00 MiB
  Total PE              1922
  Free PE               0
  Allocated PE          1922
  PV UUID               MUCrDa-eJpZ-EXwE-YwwM-S2Az-p2m7-K9q3Fo

  <span class="nt">---</span> Physical volume <span class="nt">---</span>
  PV Name               /dev/sdb
  VG Name               vg_hadoop01
  PV Size               12.00 GiB / not usable 4.00 MiB
  Allocatable           <span class="nb">yes
  </span>PE Size               4.00 MiB
  Total PE              3071
  Free PE               3071
  Allocated PE          0
  PV UUID               XTpaBR-512W-vQIV-fwwz-So7L-ZCa3-yjDccQ
</code></pre></div></div>

<h3 id="查看当前vgdisplayvgroup-组将devsdb加入根目录所在-vgroup">查看当前<code class="language-plaintext highlighter-rouge">vgdisplay</code>VGroup 组，将<code class="language-plaintext highlighter-rouge">/dev/sdb</code>加入根目录所在 VGroup</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@centos ~]# vgdisplay
  <span class="nt">---</span> Volume group <span class="nt">---</span>
  VG Name               vg_hadoop01
  System ID
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  3
  VG Access             <span class="nb">read</span>/write
  VG Status             resizable
  MAX LV                0
  Cur LV                2
  Open LV               2
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               7.51 GiB
  PE Size               4.00 MiB
  Total PE              1922
  Alloc PE / Size       1922 / 7.51 GiB
  Free  PE / Size       0 / 0
  VG UUID               szQ4fH-Sr1Z-V6c2-KVMp-ZUik-oUDP-rU8dQS

<span class="o">[</span>root@centos ~]# vgextend vg_hadoop01 /dev/sdb
  Volume group <span class="s2">"vg_hadoop01"</span> successfully extended
<span class="o">[</span>root@centos ~]# vgdisplay
  <span class="nt">---</span> Volume group <span class="nt">---</span>
  VG Name               vg_hadoop01
  System ID
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  4
  VG Access             <span class="nb">read</span>/write
  VG Status             resizable
  MAX LV                0
  Cur LV                2
  Open LV               2
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               19.50 GiB
  PE Size               4.00 MiB
  Total PE              4993
  Alloc PE / Size       1922 / 7.51 GiB
  Free  PE / Size       3071 / 12.00 GiB
  VG UUID               szQ4fH-Sr1Z-V6c2-KVMp-ZUik-oUDP-rU8dQS
</code></pre></div></div>

<h3 id="查看lvdisplay根卷的名称将磁盘加入根卷的-lv">查看<code class="language-plaintext highlighter-rouge">lvdisplay</code>根卷的名称，将磁盘加入根卷的 LV</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@centos ~]# lvdisplay
  <span class="nt">---</span> Logical volume <span class="nt">---</span>
  LV Path                /dev/vg_hadoop01/lv_root
  LV Name                lv_root
  VG Name                vg_hadoop01
  LV UUID                tJDetu-Theq-BQ5g-3ZFe-Gan7-1SSv-OHeYrH
  LV Write Access        <span class="nb">read</span>/write
  LV Creation host, <span class="nb">time </span>hadoop01, 2017-04-18 07:09:58 +0800
  LV Status              available
  <span class="c"># open                 1</span>
  LV Size                6.71 GiB
  Current LE             1718
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="nb">set </span>to     256
  Block device           253:0

  <span class="nt">---</span> Logical volume <span class="nt">---</span>
  LV Path                /dev/vg_hadoop01/lv_swap
  LV Name                lv_swap
  VG Name                vg_hadoop01
  LV UUID                D4K7I6-tPO0-HMbC-VWkR-2HV4-WjAe-M82wYq
  LV Write Access        <span class="nb">read</span>/write
  LV Creation host, <span class="nb">time </span>hadoop01, 2017-04-18 07:09:59 +0800
  LV Status              available
  <span class="c"># open                 1</span>
  LV Size                816.00 MiB
  Current LE             204
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="nb">set </span>to     256
  Block device           253:1

<span class="o">[</span>root@centos ~]# lvextend <span class="nt">-l</span> +100%FREE /dev/vg_hadoop01/lv_root
  Size of logical volume vg_hadoop01/lv_root changed from 6.71 GiB <span class="o">(</span>1718 extents<span class="o">)</span> to 18.71 GiB <span class="o">(</span>4789 extents<span class="o">)</span><span class="nb">.</span>
  Logical volume lv_root successfully resized.
<span class="o">[</span>root@centos ~]# lvdisplay
  <span class="nt">---</span> Logical volume <span class="nt">---</span>
  LV Path                /dev/vg_hadoop01/lv_root
  LV Name                lv_root
  VG Name                vg_hadoop01
  LV UUID                tJDetu-Theq-BQ5g-3ZFe-Gan7-1SSv-OHeYrH
  LV Write Access        <span class="nb">read</span>/write
  LV Creation host, <span class="nb">time </span>hadoop01, 2017-04-18 07:09:58 +0800
  LV Status              available
  <span class="c"># open                 1</span>
  LV Size                18.71 GiB
  Current LE             4789
  Segments               2
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="nb">set </span>to     256
  Block device           253:0

  <span class="nt">---</span> Logical volume <span class="nt">---</span>
  LV Path                /dev/vg_hadoop01/lv_swap
  LV Name                lv_swap
  VG Name                vg_hadoop01
  LV UUID                D4K7I6-tPO0-HMbC-VWkR-2HV4-WjAe-M82wYq
  LV Write Access        <span class="nb">read</span>/write
  LV Creation host, <span class="nb">time </span>hadoop01, 2017-04-18 07:09:59 +0800
  LV Status              available
  <span class="c"># open                 1</span>
  LV Size                816.00 MiB
  Current LE             204
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span class="nb">set </span>to     256
  Block device           253:1
</code></pre></div></div>

<h2 id="更新磁盘分区表">更新磁盘分区表</h2>

<p>当你增加完成之后，这时使用<code class="language-plaintext highlighter-rouge">df -h</code>查看的磁盘空间仍然没有变化，因为我们还需要将根卷的分区表刷新。</p>

<h3 id="使用resize2fs刷新根卷信息">使用<code class="language-plaintext highlighter-rouge">resize2fs</code>刷新根卷信息</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@centos ~]# resize2fs /dev/vg_hadoop01/lv_root
resize2fs 1.41.12 <span class="o">(</span>17-May-2010<span class="o">)</span>
Filesystem at /dev/vg_hadoop01/lv_root is mounted on /<span class="p">;</span> on-line resizing required
old desc_blocks <span class="o">=</span> 1, new_desc_blocks <span class="o">=</span> 2
Performing an on-line resize of /dev/vg_hadoop01/lv_root to 4903936 <span class="o">(</span>4k<span class="o">)</span> blocks.
The filesystem on /dev/vg_hadoop01/lv_root is now 4903936 blocks long.

<span class="o">[</span>root@centos ~]# <span class="nb">df</span> <span class="nt">-h</span>
Filesystem            Size  Used Avail Use% Mounted on
/dev/mapper/vg_hadoop01-lv_root
                       19G  5.8G   12G  33% /
tmpfs                 244M     0  244M   0% /dev/shm
/dev/sda1             477M   52M  400M  12% /boot
</code></pre></div></div>

      
    </div>
    <br/>
    <div>
      <cite>2017-04-18</cite> <i class="icon-tag"></i>
      <a href="/tags.html#LVM">LVM</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/04/HowTo-Install-GitLab.html">HowTo Install GitLab</a></h1>
    <div class="post_at_index">
      <p>目前最为主流的在线 Git 版本控制系统可以说是非 GitHub 莫属，对于个人开发者和开源项目可以直接选择 GitHub 作为 Git 版本控制系统即可，但是，对于企业内部开发管理的 Git 版本控制系统，在对保密性有高要求时 GitHub 就不合适了，这时 GitLab 作为一个可以完全搭建在企业内部的 Git 版本控制系统，而且基本囊括了 GitHub 的所有功能。</p>

<h2 id="目前-gitlab-已经整合的功能">目前 GitLab 已经整合的功能</h2>

<ol>
  <li>Repository access</li>
  <li>Administration</li>
  <li>Issues</li>
  <li>Forks</li>
  <li>Code review</li>
  <li>Wiki</li>
  <li>Merge Requests</li>
  <li>Web Editor</li>
</ol>

<h2 id="测试环境">测试环境</h2>

<ul>
  <li>2 core 4GB</li>
  <li>50GB HDD</li>
  <li>CentOS 6.8</li>
  <li>Gitlab</li>
</ul>

<h2 id="安装需求">安装需求</h2>

<p>关于 GitLab 的安装需求，主要是针对用户量然后评估出服务器及相关资源的配置，<a href="https://docs.gitlab.com.cn/ce/install/requirements.html">查看</a></p>

<h3 id="gitlab-安装">GitLab 安装</h3>

<h2 id="安装配置依赖项">安装配置依赖项</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>yum <span class="nb">install </span>curl openssh-server openssh-clients postfix cronie
<span class="nb">sudo </span>service postfix start
<span class="nb">sudo </span>chkconfig postfix on
<span class="nb">sudo </span>lokkit <span class="nt">-s</span> http <span class="nt">-s</span> ssh
</code></pre></div></div>

<h2 id="添加-gitlab-仓库并安装到服务器上">添加 GitLab 仓库，并安装到服务器上</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-sS</span> http://packages.gitlab.cc/install/gitlab-ce/script.rpm.sh | <span class="nb">sudo </span>bash
<span class="nb">sudo </span>yum <span class="nb">install </span>gitlab-ce
</code></pre></div></div>

<h2 id="启动-gitlab-并初始化">启动 GitLab 并初始化</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>gitlab-ctl reconfigure
</code></pre></div></div>

<p>默认登录账号是：root，你可以在首次打开时设置密码。</p>

<h3 id="gitlab-初始化">GitLab 初始化</h3>

<h2 id="开机自启动">开机自启动</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> vi /etc/rc.local
 /opt/gitlab/bin/gitlab-ctl start
</code></pre></div></div>

<h2 id="gitlab-配置文件">GitLab 配置文件</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/gitlab/gitlab.rb
</code></pre></div></div>

<h2 id="smtp-邮箱配置">SMTP 邮箱配置</h2>

<p>如果想使用 SMTP 代替 sendmail 来发送邮件，应该在 gitlab.rb 中启用对应的配置，然后运行<code class="language-plaintext highlighter-rouge">gitlab-ctl reconfigure</code>使修改生效。</p>

<h3 id="qq-企业邮箱配置示例">QQ 企业邮箱配置示例</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gitlab_rails[<span class="s1">'smtp_enable'</span><span class="o">]</span> <span class="o">=</span> <span class="nb">true
</span>gitlab_rails[<span class="s1">'smtp_address'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"smtp.exmail.qq.com"</span>
gitlab_rails[<span class="s1">'smtp_port'</span><span class="o">]</span> <span class="o">=</span> 465
gitlab_rails[<span class="s1">'smtp_user_name'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"xxxx@xx.com"</span>
gitlab_rails[<span class="s1">'smtp_password'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"password"</span>
gitlab_rails[<span class="s1">'smtp_authentication'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"login"</span>
gitlab_rails[<span class="s1">'smtp_enable_starttls_auto'</span><span class="o">]</span> <span class="o">=</span> <span class="nb">true
</span>gitlab_rails[<span class="s1">'smtp_tls'</span><span class="o">]</span> <span class="o">=</span> <span class="nb">true
</span>gitlab_rails[<span class="s1">'gitlab_email_from'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'xxxx@xx.com'</span>
</code></pre></div></div>

<h3 id="gmail-邮箱配置示例">Gmail 邮箱配置示例</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gitlab_rails[<span class="s1">'smtp_enable'</span><span class="o">]</span> <span class="o">=</span> <span class="nb">true
</span>gitlab_rails[<span class="s1">'smtp_address'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"smtp.gmail.com"</span>
gitlab_rails[<span class="s1">'smtp_port'</span><span class="o">]</span> <span class="o">=</span> 587
gitlab_rails[<span class="s1">'smtp_user_name'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"my.email@gmail.com"</span>
gitlab_rails[<span class="s1">'smtp_password'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"my-gmail-password"</span>
gitlab_rails[<span class="s1">'smtp_domain'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"smtp.gmail.com"</span>
gitlab_rails[<span class="s1">'smtp_authentication'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"login"</span>
gitlab_rails[<span class="s1">'smtp_enable_starttls_auto'</span><span class="o">]</span> <span class="o">=</span> <span class="nb">true
</span>gitlab_rails[<span class="s1">'smtp_tls'</span><span class="o">]</span> <span class="o">=</span> <span class="nb">false
</span>gitlab_rails[<span class="s1">'smtp_openssl_verify_mode'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'peer'</span>
</code></pre></div></div>

<h3 id="outlook-邮箱配置示例">Outlook 邮箱配置示例</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gitlab_rails[<span class="s1">'smtp_enable'</span><span class="o">]</span> <span class="o">=</span> <span class="nb">true
</span>gitlab_rails[<span class="s1">'smtp_address'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"smtp-mail.outlook.com"</span>
gitlab_rails[<span class="s1">'smtp_port'</span><span class="o">]</span> <span class="o">=</span> 587
gitlab_rails[<span class="s1">'smtp_user_name'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"username@outlook.com"</span>
gitlab_rails[<span class="s1">'smtp_password'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"password"</span>
gitlab_rails[<span class="s1">'smtp_domain'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"smtp-mail.outlook.com"</span>
gitlab_rails[<span class="s1">'smtp_authentication'</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"login"</span>
gitlab_rails[<span class="s1">'smtp_enable_starttls_auto'</span><span class="o">]</span> <span class="o">=</span> <span class="nb">true
</span>gitlab_rails[<span class="s1">'smtp_openssl_verify_mode'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'peer'</span>
</code></pre></div></div>

<blockquote>
  <p>​:warning: ‘smtp_password’字段不应包含任何 Ruby或者YAML语法中的分隔符 (如<code class="language-plaintext highlighter-rouge">'</code>),以避免处理配置文件的过程中发生不必要的意外。</p>
</blockquote>

<h2 id="gitlab-日常维护">GitLab 日常维护</h2>

<h3 id="1-查看服务状态">1. 查看服务状态</h3>

<p>使用 gitlab-ctl status 查看服务状态</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@6 ~]# <span class="nb">sudo </span>gitlab-ctl status
run: gitaly: <span class="o">(</span>pid 15055<span class="o">)</span> 23089s<span class="p">;</span> run: log: <span class="o">(</span>pid 3142<span class="o">)</span> 55379s
run: gitlab-monitor: <span class="o">(</span>pid 15060<span class="o">)</span> 23088s<span class="p">;</span> run: log: <span class="o">(</span>pid 3325<span class="o">)</span> 55357s
run: gitlab-workhorse: <span class="o">(</span>pid 15063<span class="o">)</span> 23088s<span class="p">;</span> run: log: <span class="o">(</span>pid 3156<span class="o">)</span> 55377s
run: logrotate: <span class="o">(</span>pid 17867<span class="o">)</span> 1487s<span class="p">;</span> run: log: <span class="o">(</span>pid 3197<span class="o">)</span> 55369s
run: nginx: <span class="o">(</span>pid 15077<span class="o">)</span> 23087s<span class="p">;</span> run: log: <span class="o">(</span>pid 3169<span class="o">)</span> 55375s
run: node-exporter: <span class="o">(</span>pid 15083<span class="o">)</span> 23087s<span class="p">;</span> run: log: <span class="o">(</span>pid 3247<span class="o">)</span> 55366s
run: postgres-exporter: <span class="o">(</span>pid 15088<span class="o">)</span> 23086s<span class="p">;</span> run: log: <span class="o">(</span>pid 3311<span class="o">)</span> 55358s
run: postgresql: <span class="o">(</span>pid 15093<span class="o">)</span> 23086s<span class="p">;</span> run: log: <span class="o">(</span>pid 2988<span class="o">)</span> 55412s
run: prometheus: <span class="o">(</span>pid 15101<span class="o">)</span> 23085s<span class="p">;</span> run: log: <span class="o">(</span>pid 3230<span class="o">)</span> 55368s
run: redis: <span class="o">(</span>pid 15109<span class="o">)</span> 23085s<span class="p">;</span> run: log: <span class="o">(</span>pid 2931<span class="o">)</span> 55419s
run: redis-exporter: <span class="o">(</span>pid 15113<span class="o">)</span> 23085s<span class="p">;</span> run: log: <span class="o">(</span>pid 3290<span class="o">)</span> 55364s
run: sidekiq: <span class="o">(</span>pid 17029<span class="o">)</span> 22450s<span class="p">;</span> run: log: <span class="o">(</span>pid 3131<span class="o">)</span> 55380s
run: unicorn: <span class="o">(</span>pid 17001<span class="o">)</span> 22460s<span class="p">;</span> run: log: <span class="o">(</span>pid 3100<span class="o">)</span> 55386s
</code></pre></div></div>

<h3 id="2-启动关闭重启">2. 启动、关闭、重启</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 启动Gitlab所有组件</span>
<span class="nb">sudo </span>gitlab-ctl start

<span class="c"># 停止Gitlab所有组件</span>
<span class="nb">sudo </span>gitlab-ctl stop

<span class="c"># 重启Gitlab所有组件</span>
<span class="nb">sudo </span>gitlab-ctl restart

<span class="c"># 重启单个组件</span>
<span class="nb">sudo </span>gitlab-ctl restart sidekiq
</code></pre></div></div>

<h3 id="3-控制台实时查看日志">3. 控制台实时查看日志</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 查看所有的logs; 按 Ctrl-C 退出</span>
<span class="nb">sudo </span>gitlab-ctl <span class="nb">tail</span>

<span class="c"># 拉取/var/log/gitlab下子目录的日志</span>
<span class="nb">sudo </span>gitlab-ctl <span class="nb">tail </span>gitlab-rails

<span class="c"># 拉取某个指定的日志文件</span>
<span class="nb">sudo </span>gitlab-ctl <span class="nb">tail </span>nginx/gitlab_error.log
</code></pre></div></div>

<h3 id="gitlab-安装后优化">GitLab 安装后优化</h3>

<h2 id="启用-https">启用 HTTPS</h2>

<p>首先，你需要提供一个有可信任 CA 证书，默认情况下 GitLab 是没有启用 HTTPS 的，如果要启用 HTTPS 时，首先要修改<code class="language-plaintext highlighter-rouge">/etc/gitlab/gitlab.rb</code>中的<code class="language-plaintext highlighter-rouge">external_url</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 修改为https</span>
external_url <span class="s2">"https://git.ultraera.org"</span>

<span class="c"># 设置默认将http重定向到https</span>
nginx[<span class="s1">'redirect_http_to_https'</span><span class="o">]</span> <span class="o">=</span> <span class="nb">true</span>
</code></pre></div></div>

<p>如果你暂时没有 https 证书，那么你可以临时自己颁发一个证书，注意这个证书是不受信任的。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> /etc/nginx/ssl/
<span class="nb">cd</span> /etc/nginx/ssl/
<span class="nb">sudo </span>openssl req <span class="nt">-newkey</span> rsa:2048 <span class="nt">-x509</span> <span class="nt">-nodes</span> <span class="nt">-days</span> 3560 <span class="nt">-out</span> gitlab.crt <span class="nt">-keyout</span> gitlab.key
<span class="nb">sudo chmod </span>o-r gitlab.key
<span class="nb">sudo mv </span>gitlab.key gitlab.crt /etc/ssl/
</code></pre></div></div>

<p>另外，还需要在 gitlab-shell 中的 config.yml 中将 self_signed_cert 修改为启用：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>self_signed_cert <span class="o">=</span> <span class="nb">true</span>
</code></pre></div></div>

<h2 id="设置延迟启动">设置延迟启动</h2>

<p>为保证服务质量，我们可以设置让 omnibus-gitlab 的服务 (Nginx, Redis, Unicorn 等) 在指定的文件系统挂载成功后再启动，在<code class="language-plaintext highlighter-rouge">/etc/gitlab/gitlab.rb</code> 文件中添加如下内容：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 等待/var/opt/gitlab 先被挂载</span>
high_availability[<span class="s1">'mountpoint'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'/var/opt/gitlab'</span>
</code></pre></div></div>

<blockquote>
  <p>注意在修改配置之后，要使用重新 reconfigure 配置</p>
</blockquote>

<h2 id="backups-备份还原">Backups 备份还原</h2>

<h3 id="备份">备份</h3>

<p>Gitlab 的配置也非常简单，使用一条命令即可创建完整的 Gitlab 备份：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gitlab-rake gitlab:backup:create
</code></pre></div></div>

<p>该命令会在<code class="language-plaintext highlighter-rouge">/var/opt/gitlab/backups</code>目录下创建一个名称类似为<code class="language-plaintext highlighter-rouge">1491989249_2017_04_12_gitlab_backup.tar</code>的压缩包，这个压缩包就是 Gitlab 整个的完整部分，其中开头的<code class="language-plaintext highlighter-rouge">1491989249_2017_04_12</code>是备份创建的日期，这也是我们等下恢复是要用的字段。</p>

<h3 id="修改默认备份路径">修改默认备份路径</h3>

<p>如果你像我一样，是使用 yum 安装的，那么 GitLab 默认的备份目录应该在<code class="language-plaintext highlighter-rouge">/var/opt/gitlab/backups</code>，我建议将备份目录修改为其他位置，并添加定时自动备份脚本，可以通过修改<code class="language-plaintext highlighter-rouge">/etc/gitlab/gitlab.rb</code>来修改默认位置：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gitlab_rails[<span class="s1">'backup_path'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'/mnt/backups'</span>
</code></pre></div></div>

<h3 id="使用-crontab-添加自动备份">使用 crontab 添加自动备份</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 每天凌晨00:00 自动备份</span>
00 00 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> /opt/gitlab/bin/gitlab-rake gitlab:backup:create
</code></pre></div></div>

<h3 id="备份恢复">备份恢复</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 停止相关数据连接服务</span>
gitlab-ctl stop unicorn
gitlab-ctl stop sidekiq

<span class="c"># 从1491989249_2017_04_12编号备份中恢复</span>
gitlab-rake gitlab:backup:restore <span class="nv">BACKUP</span><span class="o">=</span>1491989249_2017_04_12

<span class="c"># 启动Gitlab</span>
<span class="nb">sudo </span>gitlab-ctl start unicorn
<span class="nb">sudo </span>gitlab-ctl start sidekiq
</code></pre></div></div>

<h3 id="gitlab-迁移">GitLab 迁移</h3>

<p>只需将原服务器<code class="language-plaintext highlighter-rouge">/var/opt/gitlab/backups</code>目录下的备份文件拷贝到新服务器上的<code class="language-plaintext highlighter-rouge">/var/opt/gitlab/backups</code>上即可 (如果你没修改过默认备份目录的话)，但是需要注意的是新服务器上的 Gitlab 的版本必须与创建备份时的 Gitlab 版本号相同，比如新服务器安装的是最新的 9.0.5 版本的 Gitlab, 那么迁移之前，最好将老服务器的 Gitlab 升级为 9.0.5 在进行备份。</p>

<p>/Users/Alex/Documents/Hexo/source/_posts/</p>

      
    </div>
    <br/>
    <div>
      <cite>2017-04-13</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Gitlab">Gitlab</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/04/%E5%85%B3%E4%BA%8E%E8%80%83%E8%AF%95.html">关于考试</a></h1>
    <div class="post_at_index">
      <blockquote>
  <p>时光飞逝，那大概是世界上最糟糕的一种感觉了吧。</p>
</blockquote>

<p>有点记不大清楚，上一次为了考试是什么时间了。</p>

<p>我说的考试不是各种面试等无形的考试，而是，你坐在四四方方的台子前，给你纸笔，限定时间，那种紧张的感觉，那种备考的心态。</p>

<p>所以时光会消磨人的斗志，让你不大能聚精会神的准备考试，让你变得懒散，让你变得不再有血性；所以，时间这种东西，不仅会在你的身上刻下斑驳印记，还会磨去你内心的棱角，一旦这样，你就会停下了脚步，大家的生活成了日复一日的重复，日子也过得索然无味，好像很多很多你想做的事，最后都是选择 plan B。</p>

<p>促使我写这篇的动力来自于，最近 AWS 助理级系统架构师的考试，而就在年前的时候，第一次去参加考试，没有通过，而且我一直在想到底是哪里出了问题，尽管我不愿意承认，问题根本是，我根本没有静下心来去准备考试，其实是，现在真的很难去静下心来去做考试这种事情，心气浮躁，要做的事情很多堆积在面前，你可能会被这些事情唬到，所以你很焦虑，光顾着去焦虑了，却没想着去解决这些问题，所以难道你的不是这些看起来很困难的问题，而是，你丧失了解决这些问题的勇气很血性；一方面反映在这里，另一方面也反映在你生活的各个方面，你好像没有动力去处理这些事情，总是在最后关头，勉勉强强叫上一份拼拼凑凑的答卷，这不会是你想要的样子，这是一种病，拖延。</p>

<p><a href="https://www.youtube.com/watch?v=Q6ZgU7KyQsM">每個人的遺憾，都大抵相似</a></p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/Q6ZgU7KyQsM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>

<p>之前看到过的一个视频，讲述的是在 New York 的街头方一块黑板，让你写下最后悔的事，很多都是自己真正想要做的，却未曾努力去做的事，“最后总是选择 plan B”，“未曾跳出自己的舒适圈”，人生总是带有遗憾，总是想象着自己会多么的闪耀，却没有勇气付出真心努力，对我是这样，学习，考试，减肥，很多自己想做的事，如果不能够鼓足勇气去做，人生过着便没有意义。</p>

<p>所以，很多事情，并非要你一定做到，而是，你是否真的努力去付出过，还是假意的敷衍，拖延妥协，这种感觉只有你自己真的知道，最后的遗憾，也只有自己知道，为什么要放手自己想要的。</p>

<p>不要怀疑，不要犹豫，努力去做自己想做的事，努力成为那个，你想要成为的人，永远怀揣着梦想，永远热泪盈眶。</p>

      
    </div>
    <br/>
    <div>
      <cite>2017-04-11</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Zero">Zero</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/04/HowTo-set-Tomcat-7-automatic-startup-with-CentOS-7.html">HowTo set Tomcat 7 automatic startup with CentOS 7</a></h1>
    <div class="post_at_index">
      <p>因 CentOS7 与 6 在系统上，变化较大，所以在之前的文章中讲到的使用 Tomcat7 开机自启动的方式在 CentOS7 是是无法使用的，所以这篇文章的目的是如何在 CentOS7 上将 Tomcat7 设置为开机自启动。</p>

<h2 id="安装-java-环境">安装 JAVA 环境</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">[</span>root@7 ~]# curl <span class="nt">-LO</span> <span class="nt">-H</span> <span class="s2">"Cookie: oraclelicense=accept-securebackup-cookie"</span> <span class="se">\</span>
<span class="s2">"http://download.oracle.com/otn-pub/java/jdk/7u75-b13/jdk-7u75-linux-x64.rpm"</span>

<span class="o">[</span>root@7 ~]# rpm <span class="nt">-Uvh</span> jdk-7u75-linux-x64.rpm
Preparing...                <span class="c">####################### [100%]</span>
   1:jdk                    <span class="c">####################### [100%]</span>
Unpacking JAR files...
        rt.jar...
        jsse.jar...
        charsets.jar...
        tools.jar...
        localedata.jar...
        jfxrt.jar...

<span class="o">[</span>root@7 ~]# vi /etc/profile
<span class="c"># add follows to the end</span>
<span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/java/default
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$JAVA_HOME</span>/bin
<span class="nb">export </span><span class="nv">CLASSPATH</span><span class="o">=</span>.:<span class="nv">$JAVA_HOME</span>/jre/lib:<span class="nv">$JAVA_HOME</span>/lib:<span class="nv">$JAVA_HOME</span>/lib/tools.jar
<span class="o">[</span>root@7 ~]# <span class="nb">source</span> /etc/profile
</code></pre></div></div>

<h2 id="安装-tomcat7">安装 Tomcat7</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">[</span>root@7 ~]# wget http://ftp.riken.jp/net/apache/tomcat/tomcat-7/v7.0.77/bin/apache-tomcat-7.0.77.tar.gz
<span class="o">[</span>root@7 ~]# <span class="nb">tar </span>zxvf apache-tomcat-7.0.77.tar.gz
<span class="o">[</span>root@7 ~]# <span class="nb">mv </span>apache-tomcat-7.0.77 /usr/tomcat7
<span class="o">[</span>root@7 ~]# useradd <span class="nt">-M</span> <span class="nt">-d</span> /usr/tomcat7 tomcat7
<span class="o">[</span>root@7 ~]# <span class="nb">chown</span> <span class="nt">-R</span> tomcat7. /usr/tomcat7
</code></pre></div></div>

<h2 id="创建开机自启动脚本">创建开机自启动脚本</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@7 ~]# <span class="nb">cat</span> /usr/lib/systemd/system/tomcat7.service
<span class="c"># create new</span>
 <span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>Apache Tomcat 7
<span class="nv">After</span><span class="o">=</span>network.target

<span class="o">[</span>Service]
<span class="nv">Type</span><span class="o">=</span>oneshot
<span class="nv">ExecStart</span><span class="o">=</span>/usr/tomcat7/bin/startup.sh
<span class="nv">ExecStop</span><span class="o">=</span>/usr/tomcat7/bin/shutdown.sh
<span class="nv">RemainAfterExit</span><span class="o">=</span><span class="nb">yes
</span><span class="nv">User</span><span class="o">=</span>tomcat7
<span class="nv">Group</span><span class="o">=</span>tomcat7

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div></div>

<h2 id="启动-tomcat7">启动 Tomcat7</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@7 ~]# systemctl start tomcat7.service
<span class="o">[</span>root@7 ~]# systemctl <span class="nb">enable </span>tomcat7.service
</code></pre></div></div>

      
    </div>
    <br/>
    <div>
      <cite>2017-04-05</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Tomcat">Tomcat</a>
      , 
      <a href="/tags.html#CentOS">CentOS</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/03/%E5%9C%A8Linux%E7%BB%88%E7%AB%AF%E4%BD%BF%E7%94%A8SSR%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91.html">在 Linux 终端使用 SSR 服务实现科学上网</a></h1>
    <div class="post_at_index">
      <p>昨天在群内看到有朋友在询问如何在 Linux 终端内使用 SSR 来实现科学上网，所以抽空研究了下在 Linux 中如何使用，本文参考了<a href="https://www.zfl9.com/">Otokaze</a> 和 <a href="https://www.djangoz.com">Django</a> 两位的博客，文章链接在博文最后；SSR 服务提供商依然采用了<a href="http://ssglobal.co/wp">ssGlobal</a>，在 Google 的过程中，找了不少解决方案，这里仅做一种简单整理，实验操作系统有 CentOS 7.4 &amp; Ubuntu 16.04.3。</p>

<h2 id="ssr-代理服务">ssr 代理服务</h2>

<h3 id="下载">下载</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 需要本地git 环境</span>
yum <span class="nb">install</span> <span class="nt">-y</span> git
git clone https://github.com/SAMZONG/gfwlist2privoxy.git
<span class="nb">cd </span>gfwlist2privoxy/
<span class="nb">mv </span>ssr /usr/local/bin
<span class="nb">chmod</span> +x /usr/local/bin/ssr
</code></pre></div></div>

<h3 id="安装配置">安装配置</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost ~]# ssr <span class="nb">install
</span>Cloning into <span class="s1">'/usr/local/share/shadowsocksr'</span>...
remote: Counting objects: 5490, <span class="k">done</span><span class="nb">.</span>
remote: Total 5490 <span class="o">(</span>delta 0<span class="o">)</span>, reused 0 <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused 5490
Receiving objects: 100% <span class="o">(</span>5490/5490<span class="o">)</span>, 1.71 MiB | 410.00 KiB/s, <span class="k">done</span><span class="nb">.</span>
Resolving deltas: 100% <span class="o">(</span>3799/3799<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>

<span class="o">[</span>root@localhost ~]# ssr config   <span class="c"># 配置文件路径 /usr/local/share/shadowsocksr/config.json</span>
<span class="o">{</span>
    <span class="s2">"server"</span>: <span class="s2">"0..0.0.0"</span>, // ssr服务器ip
    <span class="s2">"server_ipv6"</span>: <span class="s2">"::"</span>,
    <span class="s2">"server_port"</span>: 8080, // ssr服务器端口
    <span class="s2">"local_address"</span>: <span class="s2">"127.0.0.1"</span>,
    <span class="s2">"local_port"</span>: 1080,

    <span class="s2">"password"</span>: <span class="s2">"123456"</span>,  // 对应password
    <span class="s2">"method"</span>: <span class="s2">"none"</span>,   // 这里对应SSGlobal配置中的Encryption
    <span class="s2">"protocol"</span>: <span class="s2">"auth_chain_a"</span>,  //对应protocl
    <span class="s2">"protocol_param"</span>: <span class="s2">""</span>,
    <span class="s2">"obfs"</span>: <span class="s2">"http_simple"</span>,  //对应obfs
    <span class="s2">"obfs_param"</span>: <span class="s2">"hello.world"</span>, //对应obfs_param
    <span class="s2">"speed_limit_per_con"</span>: 0,
    <span class="s2">"speed_limit_per_user"</span>: 0,

    <span class="s2">"additional_ports"</span> : <span class="o">{}</span>, // only works under multi-user mode
    <span class="s2">"additional_ports_only"</span> : <span class="nb">false</span>, // only works under multi-user mode
    <span class="s2">"timeout"</span>: 120,
    <span class="s2">"udp_timeout"</span>: 60,
    <span class="s2">"dns_ipv6"</span>: <span class="nb">false</span>,
    <span class="s2">"connect_verbose_info"</span>: 0,
    <span class="s2">"redirect"</span>: <span class="s2">""</span>,
    <span class="s2">"fast_open"</span>: <span class="nb">false</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="启动关闭">启动/关闭</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssr start
ssr stop 
</code></pre></div></div>

<h3 id="卸载">卸载</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssr uninstall <span class="c"># 这里操作会删除/usr/local/share/shadowsocksr</span>
</code></pre></div></div>

<p>以上，本地监听服务已经配置完成了，在填写的过程中，要注意你的本地监听地址和监听端口，默认是 127.0.0.1:1080，如果你修改了设置，那么在后续配置中也要配合修改。</p>

<h2 id="privoxy-配置">Privoxy 配置</h2>

<p>首先，需要安装 privoxy</p>

<h3 id="centos-74">CentOS 7.4</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum <span class="nb">install</span> <span class="nt">-y</span> epel-release
yum <span class="nb">install</span> <span class="nt">-y</span> privoxy
</code></pre></div></div>

<h3 id="ubuntu-1604">Ubuntu 16.04</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt <span class="nb">install</span> <span class="nt">-y</span> privoxy
</code></pre></div></div>

<h3 id="全局模式">全局模式</h3>

<p>代理模式同其他平台上方式，将所有 http/https 请求走代理服务，如果需要全局代理的话按照如下操作即可，如果要使用 PAC 模式，请跳过此部分。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 添加本地ssr服务到配置文件</span>
<span class="nb">echo</span> <span class="s1">'forward-socks5 / 127.0.0.1:1080 .'</span> <span class="o">&gt;&gt;</span> /etc/privoxy/config

<span class="c"># Privoxy 默认监听端口是是8118</span>
<span class="nb">export </span><span class="nv">http_proxy</span><span class="o">=</span>http://127.0.0.1:8118
<span class="nb">export </span><span class="nv">https_proxy</span><span class="o">=</span>http://127.0.0.1:8118
<span class="nb">export </span><span class="nv">no_proxy</span><span class="o">=</span>localhost

<span class="c"># 启动服务</span>
systemctl start privoxy.service
</code></pre></div></div>

<h3 id="pac-模式">PAC 模式</h3>

<p>使用 GFWList 是由 AutoProxy 官方维护，由众多网民收集整理的一个中国大陆防火长城的屏蔽列表，这里感谢<a href="https://www.zfl9.com/">@Otokaze</a> 为我们提供了转换 shell 自动转换脚本，为了方便修改，我 fork 了这个项目，将这篇教程所用到的资源进行了汇总，你可以在最开始<code class="language-plaintext highlighter-rouge">git clone</code>的目录中找到执行脚本。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@localhost ~]# <span class="nb">cd </span>gfwlist2privoxy/
<span class="o">[</span>root@localhost gfwlist2privoxy]# <span class="nb">ls
</span>gfw.action  gfwlist2privoxy  README.md  ssr
<span class="o">[</span>root@localhost gfwlist2privoxy]# bash gfwlist2privoxy
proxy<span class="o">(</span>socks5<span class="o">)</span>: 127.0.0.1:1080  <span class="c"># 注意，如果你修改了ssr本地监听端口是需要设置对应的</span>
<span class="o">{</span>+forward-override<span class="o">{</span>forward-socks5 127.0.0.1:1080 .<span class="o">}}</span>

<span class="o">=================================================================</span>

<span class="s2">"cp -af /root/gfwlist2privoxy/gfw.action /etc/privoxy/"</span>

<span class="o">[</span>root@localhost ~]# <span class="nb">cp</span> <span class="nt">-af</span> gfw.action /etc/privoxy/
<span class="o">[</span>root@localhost ~]# <span class="nb">echo</span> <span class="s1">'actionsfile gfw.action'</span> <span class="o">&gt;&gt;</span> /etc/privoxy/config

<span class="c"># Privoxy 默认监听端口是是8118</span>
<span class="nb">export </span><span class="nv">http_proxy</span><span class="o">=</span>http://127.0.0.1:8118
<span class="nb">export </span><span class="nv">https_proxy</span><span class="o">=</span>http://127.0.0.1:8118
<span class="nb">export </span><span class="nv">no_proxy</span><span class="o">=</span>localhost

<span class="c"># 启动服务</span>
systemctl start privoxy.service
</code></pre></div></div>

<h3 id="proxy-环境变量">proxy 环境变量</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># privoxy默认监听端口为8118</span>
<span class="nb">export </span><span class="nv">http_proxy</span><span class="o">=</span>http://127.0.0.1:8118
<span class="nb">export </span><span class="nv">https_proxy</span><span class="o">=</span>http://127.0.0.1:8118
<span class="nb">export </span><span class="nv">no_proxy</span><span class="o">=</span>localhost

<span class="c"># no_proxy是不经过privoxy代理的地址</span>
<span class="c"># 只能填写具体的ip、域名后缀，多个条目之间使用','逗号隔开</span>
<span class="c"># 比如: export no_proxy="localhost, 192.168.1.1, ip.cn, chinaz.com"</span>
<span class="c"># 访问 localhost、192.168.1.1、ip.cn、*.ip.cn、chinaz.com、*.chinaz.com 将不使用代理</span>
</code></pre></div></div>

<h2 id="代理测试">代理测试</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 访问各大网站，如果都有网页源码输出说明代理没问题</span>
curl <span class="nt">-sL</span> www.baidu.com
curl <span class="nt">-sL</span> www.google.com
curl <span class="nt">-sL</span> www.google.com.hk
curl <span class="nt">-sL</span> www.google.co.jp
curl <span class="nt">-sL</span> www.youtube.com
curl <span class="nt">-sL</span> mail.google.com
curl <span class="nt">-sL</span> facebook.com
curl <span class="nt">-sL</span> twitter.com
curl <span class="nt">-sL</span> www.wikipedia.org

<span class="c"># 获取当前 IP 地址</span>
<span class="c"># 如果使用 privoxy 全局模式，则应该显示 ss 服务器的 IP</span>
<span class="c"># 如果使用 privoxy gfwlist模式，则应该显示本地公网 IP</span>
curl <span class="nt">-sL</span> ip.chinaz.com/getip.aspx
</code></pre></div></div>

<h3 id="管理脚本">管理脚本</h3>

<p>在以上部署操作完成后，应该已经可以正常科学上网了，但是如果需要进行管理时，需要分别管理 ssr 和 privoxy，为了方便管理，这里写了一个 shell 脚本方便管理：ssr_manager</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># Author Samzong.lu</span>

<span class="k">case</span> <span class="nv">$1</span> <span class="k">in
 </span>start<span class="p">)</span>
  ssr start &amp;&gt; /var/log/ssr-local.log
  systemctl start privoxy.service
  <span class="nb">export </span><span class="nv">http_proxy</span><span class="o">=</span>http://127.0.0.1:8118
  <span class="nb">export </span><span class="nv">https_proxy</span><span class="o">=</span>http://127.0.0.1:8118
  <span class="nb">export </span><span class="nv">no_proxy</span><span class="o">=</span><span class="s2">"localhost, ip.cn, chinaz.com"</span>
  <span class="p">;;</span>
 stop<span class="p">)</span>
  <span class="nb">unset </span>http_proxy https_proxy no_proxy
  systemctl stop privoxy.service
  ssr stop &amp;&gt; /var/log/ssr-log.log
  <span class="p">;;</span>
 autostart<span class="p">)</span>
  <span class="nb">echo</span> <span class="s2">"ssr start"</span> <span class="o">&gt;&gt;</span> /etc/rc.local
  systemctl <span class="nb">enable </span>privoxy.service
  <span class="nb">echo</span> <span class="s2">"http_proxy=http://127.0.0.1:8118"</span> <span class="o">&gt;&gt;</span> /etc/bashrc
  <span class="nb">echo</span> <span class="s2">"https_proxy=http://127.0.0.1:8118"</span> <span class="o">&gt;&gt;</span> /etc/bashrc
  <span class="nb">echo</span> <span class="s2">"no_proxy='localhost, ip.cn, chinaz.com'"</span> <span class="o">&gt;&gt;</span> /etc/bashrc
  <span class="p">;;</span>
 <span class="k">*</span><span class="p">)</span>
  <span class="nb">echo</span> <span class="s2">"usage: source </span><span class="nv">$0</span><span class="s2"> start|stop|autostart"</span>
  <span class="nb">exit </span>1
  <span class="p">;;</span>
<span class="k">esac</span>
</code></pre></div></div>

<h3 id="使用">使用</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mv </span>gfwlist2privoxy/ssr_manager /usr/local/bin
<span class="nb">chmod</span> +x ssr_manager

<span class="c"># 启动服务</span>
ssr_manager start

<span class="c"># 关闭服务</span>
ssr_manager stop 

<span class="c"># 添加开机自启动</span>
ssr_manager autostart
</code></pre></div></div>

<h2 id="参考链接">参考链接</h2>

<ul>
  <li><a href="https://www.zfl9.com/ss-local.html">https://www.zfl9.com/ss-local.html</a></li>
  <li><a href="https://www.djangoz.com/2017/08/16/linux_setup_ssr/">https://www.djangoz.com/2017/08/16/linux_setup_ssr/</a></li>
</ul>

      
    </div>
    <br/>
    <div>
      <cite>2017-03-23</cite> <i class="icon-tag"></i>
      <a href="/tags.html#VPN">VPN</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/03/HowTo-install-Zoomdata.html">HowTo install Zoomdata</a></h1>
    <div class="post_at_index">
      <p>Zoomdata 是一个大数据可视化展示的工具，由 ZoomData 企业创建，是为数不多的同时支持移动端的数据分析公司，Zoomdata 的可视化可将大数据流转化为触屏友好的，艺术感十足的三维形态，Zoomdata 的定位是非 ETL(传统的提取、转换和加载的数据处理过程) 工具，Zoomdata 支持多种数据源，包括社交媒体等，其中应用最主流是大数据平台的展示工具，并且 Zoomdata 对 Cloudera Impala 做了很好的支持，所以我们做了 Zoomdata+Cloudera 技术实施。<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup></p>

<h4 id="系统要求"><strong>系统要求</strong></h4>

<p>Zoomdata 最新版是 v2.4，支持常见主流的操作系统，并且有非常友好的安装帮助，但是 Zoomdata 不支持安装在 32 位的操作系统之上</p>

<table>
  <thead>
    <tr>
      <th>biaoti</th>
      <th>biaoti</th>
      <th>baiiti</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>list</td>
      <td>file</td>
      <td>china</td>
    </tr>
    <tr>
      <td>letian</td>
      <td>zhong</td>
      <td>hongkong</td>
    </tr>
  </tbody>
</table>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>这是一个示意的文档 <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

      
    </div>
    <br/>
    <div>
      <cite>2017-03-06</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Zoomdata">Zoomdata</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/03/%E5%9B%9B%E9%98%B6%E9%AD%94%E6%96%B9%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5%E4%B9%8B%E5%A4%84%E7%90%86.html">四阶魔方特殊情况之处理</a></h1>
    <div class="post_at_index">
      <p>在还原高阶魔方 (四阶及以上) 时，采用的处理方法是，将魔方降级为三阶魔方，然后按照三阶魔方的技巧进行还原即可，但是在还原四阶魔方时会遇到 2 个不可能出现在三阶魔方的特殊情况，下面是针对这两个特殊情况的公式。</p>

<blockquote>
  <p>注意，本文不是四阶魔方的还原教程。</p>
</blockquote>

<h4 id="特殊情况顶层黄色无法形成十或l">特殊情况：顶层黄色无法形成“十”或“L”</h4>

<p>1.手势：黄色面朝上
2.右边两层旋转 180’（这时应该黄色面有右面两层为白色）
3.后面一层旋转 180’
4.上面一层旋转 180’
5.左边两层靠近你身体旋转 90’
6.上面一层旋转 180’
7.右面两层靠近你身体旋转 90’
8.上面一层旋转 180’
9.右面两层远离你身体旋转 90’
10.上面一层旋转 180’
11.前面一层旋转 180’
12.右面两层远离你身体旋转 90’
13.前面一层旋转 180’
14.左边两层远离你身体旋转 90’
15.后面一层旋转 180’
16.右边两层旋转 180’</p>

<h4 id="特殊情况最后四对棱角只有两对还原">特殊情况：最后四对棱角只有两对还原</h4>

<p>1.黄色面已经还原的情况下，黄色面朝上
2.右面夹层旋转 180’
3.上面一层旋转 180‘
4.右面夹层旋转 180’
5.上面两层旋转 180’
6.右面夹层旋转 180’
7.上面两层旋转 180’</p>

      
    </div>
    <br/>
    <div>
      <cite>2017-03-04</cite> <i class="icon-tag"></i>
      <a href="/tags.html#随笔">随笔</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/02/MacTips-%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E5%85%B3%E9%97%AD%E5%92%8C%E5%90%AF%E5%8A%A8AirPort.html">MacTips 使用命令关闭和启动 AirPort</a></h1>
    <div class="post_at_index">
      <p>今天在给妹妹调试新的 MacBookAir 13’时遇到一个问题，无法检测到她家的 WiFi，一开始怀疑是不是无线路由器长时间未重启导致，所以重启了路由器，但是问题依然没有解决，于是我们将问题转向排查设备，因我们基本正好有 iPad，iPhone，MacBook 这些设备，发现唯独他的这个 Macbook 无法识别 WiFi，后来在 Google 的帮助下，发现多个版本的 Mac OS X 都出现了类似的问题，可以通过重启 AirPort 解决问题，但是 AirPort 在 System Preferences 找不到选项，所以需要使用命令行来重启。</p>

<h2 id="查看网络接口">查看网络接口</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ifconfig
en0: <span class="nv">flags</span><span class="o">=</span>8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
 ether 60:f8:1d:ad:85:76
 inet6 fe80::18a9:fa23:b02f:5d8a%en0 prefixlen 64 secured scopeid 0x4
 inet 192.168.199.200 netmask 0xffffff00 broadcast 192.168.199.255
 nd6 <span class="nv">options</span><span class="o">=</span>201&lt;PERFORMNUD,DAD&gt;
 media: autoselect
 status: active
</code></pre></div></div>

<h2 id="关闭-airport">关闭 AirPort</h2>

<p>有时候设备的名称是 en0、en1 这样，所以，可以用过设备名称来重启 airport，例如 en0</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>networksetup <span class="nt">-setairportpower</span> en0 off
</code></pre></div></div>

<h2 id="查看状态">查看状态</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>networksetup <span class="nt">-getairportpower</span> en0
</code></pre></div></div>

<h2 id="关闭-airport-networksetup">关闭 AirPort networksetup</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>networksetup <span class="nt">-setairportpower</span> en0 on
</code></pre></div></div>

      
    </div>
    <br/>
    <div>
      <cite>2017-02-27</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Mac">Mac</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/02/HowTo-Install-NextCloud.html">HowTo Install NextCloud</a></h1>
    <div class="post_at_index">
      <p>随着最近一个云盘厂家不再提供个人服务，或者开始各种收费限速，自己存放在第三方云盘厂商的数据被盗取，数据的安全性和数据的稳定性都得不到保证，而且随着智能终端的普及，我也有一些更加高质量的图片文件需要大量储存，所以我想到了自建存储服务的方式，在甄别了 OwnCloud，Seafiles 和 NextCloud，最后选择了 NextCloud 作为自己今后数据存储节点，NextCloud 源自 OwnCloud，但是近些年来 OwnCloud 的发展进度几乎停滞，多数开发者也转战 NextCloud，当然 NextCloud 也继承了搭建简单，依赖于 PHP 环境的特性。</p>

<h2 id="运行环境">运行环境</h2>

<ul>
  <li>阿里云 ECS CentOS 6.x</li>
  <li>免费 SSL 证书 (腾讯云申请)</li>
</ul>

<h2 id="搭建-lnmp-环境">搭建 LNMP 环境</h2>

<h3 id="软件版本">软件版本</h3>

<ul>
  <li>PHP 5.6.30   <a href="https://samzong.me/php54-centos6/">安装教程</a></li>
  <li>MySQL 5.6.35  <a href="https://samzong.me/how-to-install-mysql-5-6-on-centos/">安装教程</a></li>
  <li>Nginx 1.10.2</li>
</ul>

<h3 id="基础环境安装">基础环境安装</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# yum update <span class="nt">-y</span>
<span class="o">[</span>root@ultraera ~]# yum groupinstall <span class="nt">-y</span> <span class="s2">"Base"</span>
<span class="o">[</span>root@ultraera ~]# yum groupinstall <span class="nt">-y</span> <span class="s2">"Development tools"</span>

<span class="c"># Install epel</span>
<span class="o">[</span>root@ultraera ~]# yum <span class="nb">install</span> <span class="nt">-y</span> epel-release

<span class="c"># Install remi</span>
<span class="o">[</span>root@ultraera ~]# yum <span class="nb">install </span>http://rpms.famillecollet.com/enterprise/remi-release-6.rpm

<span class="c"># Install mysql-community</span>
<span class="o">[</span>root@ultraera ~]# yum <span class="nb">install </span>http://repo.mysql.com/yum/mysql-5.6-community/el/6/x86_64/mysql-community-release-el6-7.noarch.rpm
</code></pre></div></div>

<h3 id="install-lnmp">Install LNMP</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install MySQL</span>
<span class="o">[</span>root@ultraera ~]# yum <span class="nt">--enablerepo</span><span class="o">=</span>mysql-community <span class="nb">install</span> <span class="nt">-y</span> mysql-server mysql-libs mysql-devel
<span class="o">[</span>root@ultraera ~]# service mysqld start
<span class="o">[</span>root@ultraera ~]# mysql_secure_installation
<span class="o">[</span>root@ultraera ~]# chkconfig mysqld on

<span class="c"># Install Nginx</span>
<span class="o">[</span>root@ultraera ~]# yum <span class="nt">--enablerepo</span><span class="o">=</span>epel <span class="nb">install</span> <span class="nt">-y</span> nginx
<span class="o">[</span>root@ultraera ~]# service nginx start
<span class="o">[</span>root@ultraera ~]# chkconfig nginx on

<span class="c"># Install PHP and php-fpm</span>
<span class="o">[</span>root@ultraera ~]# yum <span class="nt">--enablerepo</span><span class="o">=</span>remi-php56 <span class="nb">install </span>php php-fpm php-mysql php-gd php-xml php-redis php-libs php-devel php-zlib
<span class="o">[</span>root@ultraera ~]# service php-fpm start
<span class="o">[</span>root@ultraera ~]# chkconfig php-fpm on
<span class="o">[</span>root@ultraera ~]# service nginx restart
</code></pre></div></div>

<h3 id="下载-nextcloud">下载 NextCloud</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# wget https://download.nextcloud.com/server/releases/nextcloud-11.0.1.tar.bz2
<span class="o">[</span>root@ultraera ~]# <span class="nb">tar </span>xf nextcloud-11.0.1.tar.bz2
<span class="o">[</span>root@ultraera ~]# <span class="nb">mv </span>nextcloud-11.0.1 /opt/nextcloud
</code></pre></div></div>

<h3 id="配置-nginx-和-php-fpm">配置 Nginx 和 php-fpm</h3>

<p>因为 php-fpm 默认运行的用户身份是 apache，我们这里使用的环境是 nginx，所有要修改 php-fpm 配置文件的用户和组，注意不要为了省事直接改为 root，这在 php-fpm 中是不允许的</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# vim /etc/php-fpm.d/www.conf
<span class="nv">user</span><span class="o">=</span>nginx
<span class="nv">group</span><span class="o">=</span>nginx
<span class="o">[</span>root@ultraera ~]# service php-fpm restart
</code></pre></div></div>

<p>因为 NextCloud 默认是以 Apache 的身份运行的，所以我们需要单独配置 NextCloud 的 Nginx 配置文件，以下配置文件，你可以直接拿去用，注意在文件中说明了，需要修改的地方：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# vim /etc/nginx/conf.d/nextcloud.conf
 upstream php-handler <span class="o">{</span>
   <span class="c"># 这里是你php-fpm的服务端口，默认是9000</span>
    server 127.0.0.1:9000<span class="p">;</span>
    <span class="c">#server unix:/var/run/php5-fpm.sock;</span>
<span class="o">}</span>

server <span class="o">{</span>
   <span class="c"># 你的域名</span>
    listen pan.ultraera.org:80<span class="p">;</span>
    server_name pan.ultraera.org<span class="p">;</span>
    <span class="c"># enforce https</span>
    <span class="k">return </span>301 https://<span class="nv">$server_name$request_uri</span><span class="p">;</span>
<span class="o">}</span>

server <span class="o">{</span>
    <span class="c"># 你的域名</span>
    listen pan.ultraera.org:443 ssl<span class="p">;</span>
    server_name pan.ultraera.org<span class="p">;</span>

   <span class="c"># 以下是你的ssl证书文件存放路径</span>
    ssl_certificate /etc/nginx/ssl/1_pan.ultraera.org_bundle.crt<span class="p">;</span>
    ssl_certificate_key /etc/nginx/ssl/2_pan.ultraera.org.key<span class="p">;</span>

    <span class="c"># Add headers to serve security related headers</span>
    <span class="c"># Before enabling Strict-Transport-Security headers please read into this</span>
    <span class="c"># topic first.</span>
    <span class="c"># add_header Strict-Transport-Security "max-age=15768000;</span>
    <span class="c"># includeSubDomains; preload;";</span>
    add_header X-Content-Type-Options nosniff<span class="p">;</span>
    add_header X-Frame-Options <span class="s2">"SAMEORIGIN"</span><span class="p">;</span>
    add_header X-XSS-Protection <span class="s2">"1; mode=block"</span><span class="p">;</span>
    add_header X-Robots-Tag none<span class="p">;</span>
    add_header X-Download-Options noopen<span class="p">;</span>
    add_header X-Permitted-Cross-Domain-Policies none<span class="p">;</span>
 add_header Strict-Transport-Security <span class="s2">"max-age=15552000; includeSubdomains; "</span><span class="p">;</span>

    <span class="c"># 设定你的NextCloud的根目录，请根据实际修改</span>
    root /opt/nextcloud/<span class="p">;</span>

    location <span class="o">=</span> /robots.txt <span class="o">{</span>
        allow all<span class="p">;</span>
        log_not_found off<span class="p">;</span>
        access_log off<span class="p">;</span>
    <span class="o">}</span>

    <span class="c"># The following 2 rules are only needed for the user_webfinger app.</span>
    <span class="c"># Uncomment it if you're planning to use this app.</span>
    <span class="c">#rewrite ^/.well-known/host-meta /public.php?service=host-meta last;</span>
    <span class="c">#rewrite ^/.well-known/host-meta.json /public.php?service=host-meta-json</span>
    <span class="c"># last;</span>

    location <span class="o">=</span> /.well-known/carddav <span class="o">{</span>
      <span class="k">return </span>301 <span class="nv">$scheme</span>://<span class="nv">$host</span>/remote.php/dav<span class="p">;</span>
    <span class="o">}</span>
    location <span class="o">=</span> /.well-known/caldav <span class="o">{</span>
      <span class="k">return </span>301 <span class="nv">$scheme</span>://<span class="nv">$host</span>/remote.php/dav<span class="p">;</span>
    <span class="o">}</span>

    <span class="c"># set max upload size</span>
    client_max_body_size 512M<span class="p">;</span>
    fastcgi_buffers 64 4K<span class="p">;</span>

    <span class="c"># Disable gzip to avoid the removal of the ETag header</span>
    <span class="nb">gzip </span>off<span class="p">;</span>

    <span class="c"># Uncomment if your server is build with the ngx_pagespeed module</span>
    <span class="c"># This module is currently not supported.</span>
    <span class="c">#pagespeed off;</span>

    error_page 403 /core/templates/403.php<span class="p">;</span>
    error_page 404 /core/templates/404.php<span class="p">;</span>

    location / <span class="o">{</span>
        rewrite ^ /index.php<span class="nv">$uri</span><span class="p">;</span>
   <span class="o">}</span>

    location ~ ^/<span class="o">(</span>?:build|tests|config|lib|3rdparty|templates|data<span class="o">)</span>/ <span class="o">{</span>
        deny all<span class="p">;</span>
    <span class="o">}</span>
    location ~ ^/<span class="o">(</span>?:<span class="se">\.</span>|autotest|occ|issue|indie|db_|console<span class="o">)</span> <span class="o">{</span>
        deny all<span class="p">;</span>
    <span class="o">}</span>

    location ~ ^/<span class="o">(</span>?:index|remote|public|cron|core/ajax/update|status|ocs/v[12]|updater/.+|ocs-provider/.+|core/templates/40[34]<span class="o">)</span><span class="se">\.</span>php<span class="o">(</span>?:<span class="nv">$|</span>/<span class="o">)</span> <span class="o">{</span>
        include fastcgi_params<span class="p">;</span>
        fastcgi_split_path_info ^<span class="o">(</span>.+<span class="se">\.</span>php<span class="o">)(</span>/.<span class="k">*</span><span class="o">)</span><span class="nv">$;</span>
        fastcgi_param SCRIPT_FILENAME <span class="nv">$document_root$fastcgi_script_name</span><span class="p">;</span>
        fastcgi_param PATH_INFO <span class="nv">$fastcgi_path_info</span><span class="p">;</span>
        fastcgi_param HTTPS on<span class="p">;</span>
        <span class="c">#Avoid sending the security headers twice</span>
        fastcgi_param modHeadersAvailable <span class="nb">true</span><span class="p">;</span>
        fastcgi_param front_controller_active <span class="nb">true</span><span class="p">;</span>
        fastcgi_pass php-handler<span class="p">;</span>
        fastcgi_intercept_errors on<span class="p">;</span>
        fastcgi_request_buffering off<span class="p">;</span>
    <span class="o">}</span>

    location ~ ^/<span class="o">(</span>?:updater|ocs-provider<span class="o">)(</span>?:<span class="nv">$|</span>/<span class="o">)</span> <span class="o">{</span>
        try_files <span class="nv">$uri</span>/ <span class="o">=</span>404<span class="p">;</span>
        index index.php<span class="p">;</span>
    <span class="o">}</span>

    <span class="c"># Adding the cache control header for js and css files</span>
    <span class="c"># Make sure it is BELOW the PHP block</span>
    location ~<span class="k">*</span> <span class="se">\.</span><span class="o">(</span>?:css|js|woff|svg|gif<span class="o">)</span><span class="nv">$ </span><span class="o">{</span>
        try_files <span class="nv">$uri</span> /index.php<span class="nv">$uri$is_args$args</span><span class="p">;</span>
        add_header Cache-Control <span class="s2">"public, max-age=7200"</span><span class="p">;</span>
        <span class="c"># Add headers to serve security related headers (It is intended to</span>
        <span class="c"># have those duplicated to the ones above)</span>
        <span class="c"># Before enabling Strict-Transport-Security headers please read into</span>
        <span class="c"># this topic first.</span>
        <span class="c"># add_header Strict-Transport-Security "max-age=15768000;</span>
        <span class="c">#  includeSubDomains; preload;";</span>
        add_header X-Content-Type-Options nosniff<span class="p">;</span>
        add_header X-Frame-Options <span class="s2">"SAMEORIGIN"</span><span class="p">;</span>
        add_header X-XSS-Protection <span class="s2">"1; mode=block"</span><span class="p">;</span>
        add_header X-Robots-Tag none<span class="p">;</span>
        add_header X-Download-Options noopen<span class="p">;</span>
        add_header X-Permitted-Cross-Domain-Policies none<span class="p">;</span>
        <span class="c"># Optional: Don't log access to assets</span>
        access_log off<span class="p">;</span>
    <span class="o">}</span>

    location ~<span class="k">*</span> <span class="se">\.</span><span class="o">(</span>?:png|html|ttf|ico|jpg|jpeg<span class="o">)</span><span class="nv">$ </span><span class="o">{</span>
        try_files <span class="nv">$uri</span> /index.php<span class="nv">$uri$is_args$args</span><span class="p">;</span>
        <span class="c"># Optional: Don't log access to other assets</span>
        access_log off<span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="o">[</span>root@ultraera ~]# service nginx restart
</code></pre></div></div>

<h3 id="文件权限调整">文件权限调整</h3>

<p>因为 NextCloud 运行是以 nginx 程序，注意修改目录所属用户和组为 nginx</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# <span class="nb">chown</span> <span class="nt">-R</span> nginx:nginx /opt/nextcloud
</code></pre></div></div>

<h3 id="创建-mysql-数据库">创建 MySQL 数据库</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; CREATE DATABASE nextcloud CHARACTER SET UTF-8<span class="p">;</span>
mysql&gt; GRANT ALL PRIVILEGES ON nextcloud.<span class="k">*</span> TO <span class="s1">'nextcloud'</span>@<span class="s1">'localhost'</span> IDENTIFIED BY <span class="s1">'your_password'</span><span class="p">;</span>
mysql&gt; FLUSH PRIVILEGES<span class="p">;</span>
</code></pre></div></div>

<h2 id="初始化-nextcloud">初始化 NextCloud</h2>

<p>在浏览器打开你在 nginx 中配置的域名，NextCloud 初始化非常简单，设定一个管理员账户和密码，然后设定数据库即可，按照我们上一步针对 MySQL 的设定，你会非常清楚地知道你的数据库信息：</p>

<p><img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/jjkqh.png" alt="image" /></p>

<p>登录之后的界面是这样：</p>

<p><img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7n28v.png" alt="image" /></p>

<p>你可以在登录之后，在你的右上角点击头像选择 Admin 进入管理界面查看和修改你的服务器设置，你还可以在浏览器上方看到你的服务器现有哪些问题，会有对应文档提醒你如何解决这些问题。</p>

<p><img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/yx34e.png" alt="image" /></p>

<h2 id="other">Other</h2>

<h3 id="修改默认-data-目录">修改默认 data 目录</h3>

<p>在我们首次打开 NextCloud 网页时，需要我们设定 datadir 目录，这里有个默认目录在 nextcloud 项目包，这其实是不安全的，我们最后将目录路径修改为其他位置：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# <span class="nb">mkdir</span> /nextcloud_files/
<span class="o">[</span>root@ultraera ~]# <span class="nb">chown</span> <span class="nt">-R</span> nginx:nginx /nextcloud_files/

<span class="c"># 修改datadirectory的路径</span>
<span class="o">[</span>root@ultraera ~]# vim /opt/nextcloud/config/config.php
datadirectory<span class="s1">' =&gt; '</span>/nextcloud/data
</code></pre></div></div>

<h3 id="无法登陆到个人用户界面">无法登陆到个人用户界面</h3>

<p>我在安装时碰到这个问题，折腾了很久才解决，因为我们是使用 nginx 程序，但是 php-fpm 默认用户身份为 apache，所以<code class="language-plaintext highlighter-rouge">/var/lib/php/session</code>目录的所属用户和组都是 apache，导致我们没有权限去写入 session，所以无法登入系统，报错信息可以在 NextCloud 的 log 文件下看到：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# <span class="nb">tail</span> <span class="nt">-n</span> 1 /usr/nextcloud/data/nextcloud.log
<span class="o">{</span><span class="s2">"reqId"</span>:<span class="s2">"NNnIwMCCPDMQtzZW5Ndc"</span>,<span class="s2">"remoteAddr"</span>:<span class="s2">"180.166.66.226"</span>,<span class="s2">"app"</span>:<span class="s2">"PHP"</span>,<span class="s2">"message"</span>:<span class="s2">"session_write_close(): Failed to write session data (files). Please verify that the current setting of session.save_path is correct (</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">lib</span><span class="se">\/</span><span class="s2">php</span><span class="se">\/</span><span class="s2">session) at </span><span class="se">\/</span><span class="s2">usr</span><span class="se">\/</span><span class="s2">nextcloud</span><span class="se">\/</span><span class="s2">lib</span><span class="se">\/</span><span class="s2">private</span><span class="se">\/</span><span class="s2">Session</span><span class="se">\/</span><span class="s2">Internal.php#104"</span>,<span class="s2">"level"</span>:3,<span class="s2">"time"</span>:<span class="s2">"2017-02-24T10:46:13+00:00"</span>,<span class="s2">"method"</span>:<span class="s2">"POST"</span>,<span class="s2">"url"</span>:<span class="s2">"</span><span class="se">\/</span><span class="s2">index.php"</span>,<span class="s2">"user"</span>:<span class="s2">"samzong"</span>,<span class="s2">"version"</span>:<span class="s2">"11.0.0.10"</span><span class="o">}</span>

<span class="c"># 修改/var/lib/php/的属组为nginx即可</span>
<span class="o">[</span>root@ultraera ~]# <span class="nb">chgrp</span> <span class="nt">-R</span> nginx /var/lib/php
</code></pre></div></div>

<h3 id="增加-redis-组件提高性能">增加 redis 组件，提高性能</h3>

<p>关于如何安装 redis 我在之前的文章中也有讲到，大家可以去看下 <a href="https://samzong.me/redis01/">安装教程</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# yum <span class="nt">--enablerepo</span><span class="o">=</span>remi <span class="nb">install</span> <span class="nt">-y</span> redis

<span class="c"># 增加php的redis插件</span>
<span class="o">[</span>root@ultraera ~]# yum <span class="nt">--enablerepo</span><span class="o">=</span>remi-php56 <span class="nb">install </span>php-redis

<span class="c"># 配置文件增加redis</span>
  <span class="s1">'memcache.local'</span> <span class="o">=&gt;</span> <span class="s1">'\\OC\\Memcache\\Redis'</span>,
  <span class="s1">'memcache.locking'</span> <span class="o">=&gt;</span> <span class="s1">'\\OC\\Memcache\\Redis'</span>,
  <span class="s1">'redis'</span> <span class="o">=&gt;</span>
   array <span class="o">(</span>
    <span class="s1">'host'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span>,
    <span class="s1">'port'</span> <span class="o">=&gt;</span> 6379,
   <span class="o">)</span>

<span class="c"># 重启令服务生效</span>
<span class="o">[</span>root@ultraera ~]# service php-fpm restart
<span class="o">[</span>root@ultraera ~]# service nginx restart
</code></pre></div></div>

<p>我的 NextCloud 配置如下：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
<span class="nv">$CONFIG</span> <span class="o">=</span> array <span class="o">(</span>
  <span class="s1">'memcache.local'</span> <span class="o">=&gt;</span> <span class="s1">'\\OC\\Memcache\\Redis'</span>,
  <span class="s1">'memcache.locking'</span> <span class="o">=&gt;</span> <span class="s1">'\\OC\\Memcache\\Redis'</span>,
  <span class="s1">'redis'</span> <span class="o">=&gt;</span>
  array <span class="o">(</span>
    <span class="s1">'host'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span>,
    <span class="s1">'port'</span> <span class="o">=&gt;</span> 6379,
  <span class="o">)</span>,
  <span class="s1">'enable_previews'</span> <span class="o">=&gt;</span> <span class="nb">false</span>,
  <span class="s1">'instanceid'</span> <span class="o">=&gt;</span> <span class="s1">'ockhup01dxbf'</span>,
  <span class="s1">'passwordsalt'</span> <span class="o">=&gt;</span> <span class="s1">'TlJgWGrE0N7vOrRfZkOojwdYh/BixL'</span>,
  <span class="s1">'secret'</span> <span class="o">=&gt;</span> <span class="s1">'/IQh0LioZp5eYFQJhicY7n324Q80WQUYOzWL+8OcxcXVw3Ef'</span>,
  <span class="s1">'trusted_domains'</span> <span class="o">=&gt;</span>
  array <span class="o">(</span>
    0 <span class="o">=&gt;</span> <span class="s1">'pan.ultraera.org'</span>,
  <span class="o">)</span>,
  <span class="s1">'datadirectory'</span> <span class="o">=&gt;</span> <span class="s1">'/nextcloud'</span>,
  <span class="s1">'overwrite.cli.url'</span> <span class="o">=&gt;</span> <span class="s1">'https://pan.ultraera.org'</span>,
  <span class="s1">'dbtype'</span> <span class="o">=&gt;</span> <span class="s1">'mysql'</span>,
  <span class="s1">'version'</span> <span class="o">=&gt;</span> <span class="s1">'11.0.0.10'</span>,
  <span class="s1">'dbname'</span> <span class="o">=&gt;</span> <span class="s1">'nextcloud'</span>,
  <span class="s1">'dbhost'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span>,
  <span class="s1">'dbport'</span> <span class="o">=&gt;</span> <span class="s1">''</span>,
  <span class="s1">'dbtableprefix'</span> <span class="o">=&gt;</span> <span class="s1">'oc_'</span>,
  <span class="s1">'dbuser'</span> <span class="o">=&gt;</span> <span class="s1">'nextcloud'</span>,
  <span class="s1">'dbpassword'</span> <span class="o">=&gt;</span> <span class="s1">'nextcloud'</span>,
  <span class="s1">'logtimezone'</span> <span class="o">=&gt;</span> <span class="s1">'CST'</span>,
  <span class="s1">'installed'</span> <span class="o">=&gt;</span> <span class="nb">true</span>,
  <span class="s1">'mail_from_address'</span> <span class="o">=&gt;</span> <span class="s1">'luchuanjia'</span>,
  <span class="s1">'mail_smtpmode'</span> <span class="o">=&gt;</span> <span class="s1">'php'</span>,
  <span class="s1">'mail_domain'</span> <span class="o">=&gt;</span> <span class="s1">'msn.com'</span>,
<span class="o">)</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="ssl-证书">SSL 证书</h3>

<p>现国内提供免费的 SSL 证书的服务商很多，作为个人站点，免费 SSL 证书是个挺不错的选择，我在之前 nginx 配置时将 ssl 的配置方式写在了配置文件中了，注意如果不启用 ssl 时，不要启用 https 的虚拟主机，当然你可以自己生成一个 ssl 证书来提供服务，但这样在别人访问你的网站时，会不提示不受信任的证书，具体如何获取的证书的方式，因各个厂家方式有些区别，这里就不赘述，可以联系对应的厂商的技术人员咨询。</p>

<h2 id="使用现状">使用现状</h2>

<p>在将服务搭建完成之后，对于存储的文件加密，现在通过 jobs，每日凌晨将文件推送到 oss 内，保存 2 天的数据，避免因为服务器宕机导致文件丢失；使用端，自己的电脑和手机，还有家人的手机，都安装了应用，后台自动将拍照图片等自动上传到云盘，使用起来目前很稳定，只是 iOS 应用是收费的，因为 NextCloud 源于 OwnCloud，如果你之前购买了 OwnCloud 的 App 也可以直接使用，当然 NextCloud 也有很多其他功能，可以根据你的实际需求发掘。</p>

      
    </div>
    <br/>
    <div>
      <cite>2017-02-27</cite> <i class="icon-tag"></i>
      <a href="/tags.html#NextCloud">NextCloud</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/02/HowTo-Install-Redmine.html">HowTo Install Redmine</a></h1>
    <div class="post_at_index">
      <h4 id="runtime-environment">Runtime environment</h4>

<ul>
  <li>CentOS 6.x</li>
  <li>Redmine 3.3.2</li>
  <li>Ruby 2.2.6</li>
  <li>rails 4.2</li>
  <li>MySQL 5.1</li>
  <li>Nginx 1.10</li>
</ul>

<h4 id="安装-rvm">安装 rvm</h4>

<h5 id="导入公钥">导入公钥</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# curl -sSL https://rvm.io/mpapis.asc | gpg --import
</code></pre></div></div>

<h5 id="安装">安装</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# curl -L https://get.rvm.io | bash -s stable
</code></pre></div></div>

<h5 id="加载-rvm-环境并安装基础依赖包">加载 rvm 环境并安装基础依赖包</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# source /etc/profile.d/rvm.sh
[root@localhost ~]# rvm requirements
</code></pre></div></div>

<h4 id="安装-ruby">安装 ruby</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# rvm install 2.2.6
...
[root@localhost ~]# rvm use 2.2.6 --default
</code></pre></div></div>

<h4 id="安装-rails">安装 rails</h4>

<h5 id="更换-gem-源">更换 gem 源</h5>

<p>默认 gem 的源站点是<a href="https://rubygems.org">https://rubygems.org</a> 由于国内的网络原因导致无法连接，所以导致无法使用 gem 安装，这里换成国内淘宝的 gem 镜像站点</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# gem sources -l
*** CURRENT SOURCES ***

https://rubygems.org/
[root@localhost ~]# gem sources --remove https://rubygems.org/
[root@localhost ~]# gem sources -a https://ruby.taobao.org/
[root@localhost ~]# gem sources -l
*** CURRENT SOURCES ***

https://ruby.taobao.org/
</code></pre></div></div>

<h5 id="安装-1">安装</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# gem install rails -v=4.2
</code></pre></div></div>

<h4 id="安装-mysql">安装 MySQL</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# yum install -y mysql-server mysql-libs mysql-devel mysql
[root@localhost ~]# service mysqld start
[root@localhost ~]# mysql_secure_installation
</code></pre></div></div>

<h4 id="安装-redmine">安装 redmine</h4>

<h5 id="下载-redmine-332">下载 Redmine 3.3.2</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# wget http://www.redmine.org/releases/redmine-3.3.2.tar.gz
[root@localhost ~]# tar xf redmine-3.3.2.tar.gz
[root@localhost ~]# mv redmine-3.3.2 /opt
</code></pre></div></div>

<h5 id="安装管理-ruby-的包管理工具-bundler">安装管理 ruby 的包管理工具 bundler</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 注意，一定要在redmine目录下操作
[root@localhost ~]# cd /opt/redmine-3.3.2
[root@localhost redmine-3.3.2]# gem install bundler
</code></pre></div></div>

<h5 id="安装-redmine-运行所需要的依赖包">安装 redmine 运行所需要的依赖包</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# bundle install --without development test rmagick
</code></pre></div></div>

<h5 id="为-rails-生产-cookies-秘钥">为 rails 生产 cookies 秘钥</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# rake generate_secret_token
</code></pre></div></div>

<h5 id="创建-redmine-的数据库">创建 redmine 的数据库</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; create database redmine character set utf8;
mysql&gt; grant all privileges on redmine.* to 'redmine'@'localhost' identified by 'redmine_pass';
</code></pre></div></div>

<h5 id="修改-redmine-的-databaseyml">修改 redmine 的 database.yml</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# cp config/database.yml.example config/database.yml
[root@localhost redmine-3.3.2]# vim config/database.yml
production:
  adapter: mysql2
  database: redmine
  host: localhost
  username: redmine
  password: "redmine_pass"
  encoding: utf8
</code></pre></div></div>

<h5 id="创建数据库结构">创建数据库结构</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# RAILS_ENV=production bundle exec rake db:migrate
</code></pre></div></div>

<h5 id="生产缺省数据">生产缺省数据</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# RAILS_ENV=production bundle exec rake redmine:load_default_data
# 选择默认语言，之后可更改，初始为en
</code></pre></div></div>

<h5 id="测试是否安装成功">测试是否安装成功</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# bundle exec rails server webrick -e production -b 0.0.0.0
</code></pre></div></div>

<blockquote>
  <p>默认运行 3000 端口，默认管理员 admin/admin</p>
</blockquote>

<h4 id="配置-redmine-在-nginx-上运行">配置 Redmine 在 Nginx 上运行</h4>

<p>Redmine 常用的解决办法是使用 passenger+nginx，但是 Nginx 不支持装载模块，所以需要重新编译安装 Nginx，安装 Nginx 的 Passenger 有两种方式</p>

<ul>
  <li>采用 Passenger 提供的脚本进行安装，适合新环境</li>
  <li>手动编译安装 Nginx 增加 Passenger 模块，适合已存在 Nginx 环境</li>
</ul>

<h5 id="采用-passenger-提供脚本安装">采用 Passenger 提供脚本安装</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# gem install passenger
[root@localhost redmine-3.3.2]# passenger-install-nginx-module --auto --prefix=/opt/nginx
</code></pre></div></div>

<h5 id="采用重新编译-nginx-增加-passenger-模块">采用重新编译 Nginx 增加 Passenger 模块</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 获取passenger的安装路径
[root@localhost ~]# passenger-config --root
/usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2

# 重新编译Nginx并添加模块
[root@localhost ~]# wget http://nginx.org/download/nginx-1.10.3.tar.gz
[root@localhost ~]# tar xf nginx-1.10.3.tar.gz
[root@localhost ~]# cd nginx-1.10.3
[root@localhost nginx-1.10.3]# ./configure ... -add-module=/usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2
</code></pre></div></div>

<h5 id="增加-http-模块内以下配置">增加 HTTP 模块内以下配置</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>passenger_root /usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2
</code></pre></div></div>

<h5 id="配置-nginxconf-修改-server-模块中-location-的配置">配置 nginx.conf 修改 server 模块中 location 的配置</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ...
server {
  # ...
  passenger_enabled on;
  location / {
    root /opt/redmine-3.3.2/public;
    index index.html index.htm;
  }
}
# ...
</code></pre></div></div>

<h5 id="启动-nginx">启动 Nginx</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# /root/nginx-1.10.3/sbin/nginx -c /root/nginx-1.10.3/conf/nginx.conf
</code></pre></div></div>

<h4 id="其他">其他</h4>

<p>到这里，所有的安装都完成了，过程中我遇到这些问题，你也注意下：</p>

<h5 id="71-could-not-find-gem-mysql2--0311-in-any-of-the-gem-sources-listed-in-your-gemfile">7.1 Could not find gem ‘mysql2 (~&gt; 0.3.11)’ in any of the gem sources listed in your Gemfile</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# rm -f Gemfile.lock
[root@localhost redmine-3.3.2]# bundle install
</code></pre></div></div>

<h5 id="72-curl-tools">7.2 curl-tools</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install libcurl-devel
</code></pre></div></div>

      
    </div>
    <br/>
    <div>
      <cite>2017-02-22</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Redmine">Redmine</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    

    <!-- Pagination links -->
    <nav>
      <ul class="pagination hidden-xs">
        
        
        <li>
          <a href="/page14">&laquo; Previous</a>
        </li>
        
        

        
        <li>
          <a href="/">1</a>
        </li>
        

        
          
            
            <li>
              <a href="/page2">2</a>
            </li>
            
            <li>
              <a href="/page3">3</a>
            </li>
            
            <li>
              <a href="/page4">4</a>
            </li>
            
            <li>
              <a href="/page5">5</a>
            </li>
            
            <li class="disabled"><span>...</span></li>
            <li class="active"><a>15</a></li>
          
          <li class="disabled"><span>...</span></li>
          <li><a href="/page24">24</a></li>
        

        
        

        
        <li>
          <a href="/page16">Next &raquo;</a>
        </li>
        
      </ul>
    </nav>
  </div>
  <div class="col-xs-12 col-md-4">
		<!-- <div>
			<a class="twitter-timeline" data-width="390" data-height="640" data-theme="light" href="https://twitter.com/samzong_lu?ref_src=twsrc%5Etfw">Tweets by SAMZONG</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
		</div> -->
    <div>
      <h2>传送门</h2>
      <ul>
        <li><a href="https://yuque.com/samzong">语雀-花园</a></li>
        <li><a href="https://github.com/samzong">Github</a></li>
      </ul>
    </div>
    <div class="categories">
      <h2>文章分类</h2>
      <ul class="tag_box">
        
        


  
     
    	
      <li><a href="/categories.html#故事汇">
    		故事汇 <span>23</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Linux">
    		Linux <span>22</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#前端">
    		前端 <span>5</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#数据库">
    		数据库 <span>30</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Git">
    		Git <span>6</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Mac">
    		Mac <span>16</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Tools">
    		Tools <span>7</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#OpenSource">
    		OpenSource <span>11</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Python">
    		Python <span>45</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#云平台">
    		云平台 <span>8</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#虚拟化">
    		虚拟化 <span>3</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Java">
    		Java <span>6</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Docker">
    		Docker <span>6</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Blog">
    		Blog <span>7</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#安全">
    		安全 <span>2</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#读书笔记">
    		读书笔记 <span>16</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#微服务">
    		微服务 <span>2</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Kubernetes">
    		Kubernetes <span>14</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#DaoCloud Enterprise">
    		DaoCloud Enterprise <span>2</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#春松客服">
    		春松客服 <span>1</span>
    	</a></li>
    
  



      </ul>
    </div>
    <div>
      <h2>最近文章</h2>
      <ul>
        
        <li>
          <a href="/post/2022/11/cskefu-opensource-project.html">开源项目 - 春松客服</a>
          项目起源


        </li>
        
        <li>
          <a href="/post/2022/11/what-is-hukou.html">What is Hukou</a>
          背景


        </li>
        
        <li>
          <a href="/post/2022/11/Copy-To-Markdwon.html">Copy to Markdown</a>
          背景


        </li>
        
        <li>
          <a href="/post/2022/11/Dubbo-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html">Dubbo 基础知识梳理</a>
          
  参考资料：



        </li>
        
        <li>
          <a href="/post/2022/11/Panads-fill-NaN-value-to-Zero.html">Panads fill NaN value to Zero</a>
          ```python
df = pandas.read_csv(‘somefile.txt’)


        </li>
        
      </ul>
    </div>
  </div>
</div>

			</div>

		</div>

    <footer>
      <div class="container">
        <div class="row mobilepadding">
          			<hr>
      &copy; 2022 船长. Powered by <a href="http://jekyllrb.com" target="_blank" title="The simple, blog-aware, static site generator.">Jekyll</a>. Theme Creator <a href="https://github.com/einverne" target="_blank" title="Ein Verne's GitHub Repos">Ein Verne</a> . Host on <a href="https://github.com/samzong/samzong.me" target="_blank" title="Samzong's GitHub Repos">Github</a> .
      <br><br>
      </div>
    </div>
    </footer>

    




	<script async type="text/javascript" src="/assets/themes/evjekylltheme/bootstrap-3.3.5/js/bootstrap.min.js"></script>
	<script async type="text/javascript" src="/assets/themes/evjekylltheme/webcore.js"></script>

 </body>
</html>

