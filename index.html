
<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Blog">
  <head>
    <meta charset="utf-8">
	<link rel="manifest" href="/static/pwa/manifest.json">
	<title> Home | 船长的课记 </title>
    
		
    <meta name="author" content="船长">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="theme-color" content="#2196F3">
	<meta name="google-site-verification" content="puZt0ZyqB-t67BYdYAgLUyIPBeismG68J0dmEc01QeY" />

	
    <script>
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', function () {
				navigator.serviceWorker
										.register('/sw.js')
										.then(function(registration) {
											console.log("Successfully registered service worker", registration.scope);
										}).catch(function(err) {
											console.log("Service worker registration failed: ", err);
										});
				//navigator.serviceWorker.ready always resolve
				navigator.serviceWorker.ready.then(function (registration) {
					console.log('Service worker successfully registered on scope', registration.scope);
				});
			});
		}
    </script>
	<script type="text/javascript" src="/assets/themes/evjekylltheme/jquery-3.6.0.slim.min.js"></script>

	<link href="/assets/themes/evjekylltheme/google-code-prettify/desert.css" type="text/css" rel="stylesheet" />

    <!-- Le styles -->
    <link href="/assets/themes/evjekylltheme/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/evjekylltheme/css/style.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/images/favicon.ico">

    <!-- atom & rss feed -->
    <link href="" type="application/atom+xml" rel="alternate" title="Jekyll auto generate ATOM Feed">
    <link href="" type="application/atom+xml" rel="alternate" title="Site ATOM Feed">
    <link href="" type="application/rss+xml" rel="alternate" title="Site RSS Feed">
	<link rel="stylesheet" href="/assets/themes/evjekylltheme/font-awesome-4.4.0/css/font-awesome.min.css">
	<!-- <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-W2LDG64');</script> -->
		<!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8529425670069509"
						crossorigin="anonymous"></script> -->
	<!-- <script async src="https://cdn.splitbee.io/sb.js"></script> -->
  </head>

  <body>
	<!-- <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W2LDG64"
	height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> -->
    <div class="navbar navbar-default navbar-fixed-top">
				<div class="container">
          <div class="row mobilepadding">
					<!-- <a class="navbar-brand" href="/">船长的课记</a> -->
					<a class="navbar-brand" href="/">SAMZONG</a>
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="collapse navbar-collapse" id="mNavbar">
  					<ul class="nav navbar-nav">
  						
  						
  						


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/friends.html">Friends</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  



						  <li class="dropdown">
							  <a class="dropdown-toggle" data-toggle="dropdown" href="#">Other</a>
							  <ul class="dropdown-menu">
									<li><a href="/about.html">About</a></li>
									<li><a href="https://yuque.com/samzong/note" target="_blank">船长的课记</a></li>
									<li><a href="https://yuque.com/samzong/ap" target="_blank">果粉日记</a></li>
									<li><a href="https://yuque.com/samzong/code" target="_blank">Code Snippet</a></li>
									<li><a href="https://www.yuque.com/samzong/mcx" target="_blank">集</a></li>
									<li><a href="https://www.yuque.com/zooka" target="_blank">藏金阁</a></li>
								</ul>
						  </li>
  					</ul>
  					<form id="search-form" class="navbar-form navbar-right" role="search">
  						<div class="form-group">
  						<input type="text" class="form-control input-sm" placeholder="Search's Bad" id="query">
  						</div>
  					</form>
  					<div class="nav-icon">
  						<a href="/feed.xml"><i class="fa fa-rss fa-2x"></i></a>
  					</div>
          </div>
				</div>
      </div>
    </div>

    <div class="container">
			<div class="row mobilepadding">
        <div class="row">
					<div class="col-md-12">
						<div class="searchresult">
						</div>
						<div id="search-loader" class="img-wrap">
						</div>
					</div>
        </div>
				<meta itemprop="image" content="https://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com/uPic/telegram-cloud-photo-size-4-5971176114485308439-x.jpg">
<div class="row">
  <div class="col-xs-12 col-md-8">
    
    
    <h1><a class="title" href="/post/2022/12/raycast-01.html">Raycast 你的年度报告已到达</a></h1>
    <div class="post_at_index">
      <p>从 Alfred 切换到 Raycast 也就 2 个多月的时间；使用体验有着比较大的提升。</p>

<p>我觉得的优势提升：
● Raycast 的插件生态目前很火热，自己开发插件也是非常方便
● 颜值很高
● 展示免费可用</p>

<p><img src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/baomNz.jpg?x-oss-process=image/resize,w_960,m_lfit" alt="resize,w_960,m_lfit" /></p>

<p><img src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/LYzycF.jpg?x-oss-process=image/resize,w_960,m_lfit" alt="resize,w_960,m_lfit" /></p>

<p><img src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/aIggtS.jpg?x-oss-process=image/resize,w_960,m_lfit" alt="resize,w_960,m_lfit" /></p>

<p><img src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/kl85Wi.jpg?x-oss-process=image/resize,w_960,m_lfit" alt="resize,w_960,m_lfit" /></p>

      
    </div>
    <br/>
    <div>
      <cite>2022-12-16</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Mac">Mac</a>
      , 
      <a href="/tags.html#Raycast">Raycast</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2022/12/Skoala-Install-Dce5.html">DCE5-Skoala 安装教程</a></h1>
    <div class="post_at_index">
      <h2 id="使用之前的话">使用之前的话</h2>

<p>本教程旨在补充需要手工安装和升级的方式。</p>

<ul>
  <li><strong>优先通过安装器进行安装 <a href="https://docs.daocloud.io/install/intro/">https://docs.daocloud.io/install/intro/</a> ，请以官方教程文档为准。</strong></li>
  <li><strong>优先通过安装器进行安装 <a href="https://docs.daocloud.io/install/intro/">https://docs.daocloud.io/install/intro/</a> ，请以官方教程文档为准。</strong></li>
  <li><strong>优先通过安装器进行安装 <a href="https://docs.daocloud.io/install/intro/">https://docs.daocloud.io/install/intro/</a> ，请以官方教程文档为准。</strong></li>
</ul>

<h3 id="安装器-v0328-及之前">安装器 v0.3.28 及之前</h3>

<p>默认安装不支持；在安装规划时，可以修改 <strong>mainfest.yaml</strong> 开启 Skoala 自动安装</p>

<blockquote>
  <p>检查预装环境</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./dce5-installer install-app <span class="nt">-m</span> /sample/manifest.yaml
</code></pre></div></div>

<h3 id="安装器-v0329">安装器 v0.3.29</h3>

<p>20222.12.15 即将发版）支持默认安装 Skoala；仍旧建议检查<strong>mainfest.yaml</strong> ，确保 Skoala 会被安装器安装。</p>

<blockquote>
  <p>enable 需要为 true，需要指定对应的 helmVersion：</p>
</blockquote>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">...</span>
<span class="na">components</span><span class="pi">:</span>
  <span class="na">skoala</span><span class="pi">:</span>
    <span class="na">enable</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">helmVersion</span><span class="pi">:</span> <span class="s">v0.12.2</span>
    <span class="na">variables</span><span class="pi">:</span>
<span class="nn">...</span>
</code></pre></div></div>

<ul>
  <li><strong>重要的话：默认安装器版本携带的是当时最新经过测试的版本；如无特殊情况，不建议更新默认的 helm 安装版本。</strong></li>
  <li><strong>重要的话：默认安装器版本携带的是当时最新经过测试的版本；如无特殊情况，不建议更新默认的 helm 安装版本。</strong></li>
  <li><strong>重要的话：默认安装器版本携带的是当时最新经过测试的版本；如无特殊情况，不建议更新默认的 helm 安装版本。</strong></li>
</ul>

<h2 id="安装前的检测">安装前的检测</h2>

<h3 id="检测-skoala-安装情况">检测 skoala 安装情况</h3>

<p>查看 命名空间为 skoala-system 的之中是否有以下对应的资源，如果没有任何资源，说明 Skoala 的确没有安装。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ kubectl <span class="nt">-n</span> skoala-system get pods
NAME                                   READY   STATUS    RESTARTS        AGE
hive-8548cd9b59-948j2                  2/2     Running   2 <span class="o">(</span>3h48m ago<span class="o">)</span>   3h48m
sesame-5955c878c6-jz8cd                2/2     Running   0               3h48m
ui-7c9f5b7b67-9rpzc                    2/2     Running   0               3h48m
 
~ helm <span class="nt">-n</span> skoala-system list
NAME        NAMESPACE       REVISION    UPDATED                                 STATUS      CHART               APP VERSION
skoala      skoala-system   3           2022-12-16 11:17:35.187799553 +0800 CST deployed    skoala-0.13.0       0.13.0
</code></pre></div></div>

<h3 id="22-依赖-common-mysql-的安装情况">2.2. 依赖 common-mysql 的安装情况</h3>

<p>skoala 在安装时需要用到 mysql 来存储配置，所以必须要保证数据库存在；另外查看下 common-mysql 是否有 skoala 这个数据库。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ kubectl <span class="nt">-n</span> mcamel-system get statefulset
NAME                                          READY   AGE
mcamel-common-mysql-cluster-mysql             2/2     7d23h
</code></pre></div></div>

<p>建议给到 skoala 用到的数据库信息如下：</p>

<ul>
  <li>host: mcamel-common-mysql-cluster-mysql-master.mcamel-system.svc.cluster.local</li>
  <li>port: 3306</li>
  <li>database : skoala</li>
  <li>user: skoala</li>
  <li>password:</li>
</ul>

<h3 id="关于insight-agent">关于 insight-agent</h3>

<p>Skoala 所有的监控的信息，需要依赖 Insight 的能力，则需要在集群中安装对应的 insight-agent；</p>

<p><img src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/KEjgFX.jpg?x-oss-process=image/resize,w_960,m_lfit" alt="resize,w_960,m_lfit" /></p>

<p>对 Skoala 的影响：</p>

<ul>
  <li>如果 skoala-init 安装时未先安装 insight-agent，不会安装 service-monitor</li>
  <li>如果需要安装 service-monitor，请先安装 insight-agent，再安装 skoala-init</li>
</ul>

<blockquote>
  <p>如果先安装了 skoala-init, <strong>目前需要在安装 insight-agent 后，重装 skoala-init</strong></p>
</blockquote>

<h2 id="手动安装过程">手动安装过程</h2>

<h3 id="初始化-数据库表">初始化 数据库表</h3>

<p>如果在 common-mysql 内的 skoala 数据库为空，请登录到 skoala 数据库后，执行以下 SQL：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`registry`</span> <span class="p">(</span>
    <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="nv">`uid`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`name`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`type`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`addresses`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`namespaces`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`deleted_at`</span> <span class="nb">timestamp</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'Time deteled'</span><span class="p">,</span>
    <span class="nv">`created_at`</span> <span class="nb">timestamp</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">current_timestamp</span><span class="p">(),</span>
    <span class="nv">`updated_at`</span> <span class="nb">timestamp</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">current_timestamp</span><span class="p">()</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">current_timestamp</span><span class="p">(),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
    <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`idx_uid`</span> <span class="p">(</span><span class="nv">`uid`</span><span class="p">),</span>
    <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`idx_name`</span> <span class="p">(</span><span class="nv">`name`</span><span class="p">)</span>
    <span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">1</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span><span class="p">;</span>
 
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`book`</span> <span class="p">(</span>
    <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="nv">`uid`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`name`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`author`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`status`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="mi">1</span> <span class="k">COMMENT</span> <span class="s1">'0:下架，1:上架'</span><span class="p">,</span>
    <span class="nv">`isPublished`</span> <span class="nb">tinyint</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="mi">1</span> <span class="k">COMMENT</span> <span class="s1">'0: unpublished, 1: published'</span><span class="p">,</span>
    <span class="nv">`publishedAt`</span> <span class="nb">timestamp</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'出版时间'</span><span class="p">,</span>
    <span class="nv">`deleted_at`</span> <span class="nb">timestamp</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'Time deteled'</span><span class="p">,</span>
    <span class="nv">`createdAt`</span> <span class="nb">timestamp</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">current_timestamp</span><span class="p">(),</span>
    <span class="nv">`updatedAt`</span> <span class="nb">timestamp</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">current_timestamp</span><span class="p">()</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">current_timestamp</span><span class="p">(),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
    <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`idx_uid`</span> <span class="p">(</span><span class="nv">`uid`</span><span class="p">),</span>
    <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`idx_name`</span> <span class="p">(</span><span class="nv">`name`</span><span class="p">)</span>
    <span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">1</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span><span class="p">;</span>
 
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`api`</span> <span class="p">(</span>
    <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="nv">`is_hosted`</span> <span class="nb">tinyint</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nv">`registry`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`service_name`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`nacos_namespace`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'Nacos namespace id'</span><span class="p">,</span>
    <span class="nv">`nacos_group_name`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`data_type`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'JSON or YAML.'</span><span class="p">,</span>
    <span class="nv">`detail`</span> <span class="nb">mediumtext</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`deleted_at`</span> <span class="nb">timestamp</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'Time deteled'</span><span class="p">,</span>
    <span class="nv">`created_at`</span> <span class="nb">timestamp</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">current_timestamp</span><span class="p">(),</span>
    <span class="nv">`updated_at`</span> <span class="nb">timestamp</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">current_timestamp</span><span class="p">()</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">current_timestamp</span><span class="p">(),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
    <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`idx_registry_and_service_name`</span> <span class="p">(</span><span class="nv">`registry`</span><span class="p">,</span> <span class="nv">`service_name`</span><span class="p">)</span>
    <span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">1</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span><span class="p">;</span>
 
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nv">`book`</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">'book-init'</span><span class="p">,</span><span class="s1">'MicroService Pattern'</span><span class="p">,</span><span class="s1">'daocloud'</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">'2022-03-23 13:50:00'</span><span class="p">,</span><span class="k">null</span><span class="p">,</span><span class="n">now</span><span class="p">(),</span><span class="n">now</span><span class="p">());</span>
 
<span class="k">alter</span> <span class="k">table</span> <span class="n">registry</span> <span class="k">add</span> <span class="n">is_hosted</span> <span class="nb">tinyint</span> <span class="k">default</span> <span class="mi">0</span> <span class="k">not</span> <span class="k">null</span> <span class="k">after</span> <span class="n">namespaces</span><span class="p">;</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">registry</span> <span class="k">add</span> <span class="n">workspace_id</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span> <span class="k">DEFAULT</span> <span class="s1">'default'</span> <span class="k">after</span> <span class="n">uid</span><span class="p">;</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">registry</span> <span class="k">add</span> <span class="n">ext_id</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">null</span> <span class="k">after</span> <span class="n">workspace_id</span><span class="p">;</span>
 
<span class="k">drop</span> <span class="k">index</span> <span class="n">idx_name</span> <span class="k">on</span> <span class="n">registry</span><span class="p">;</span>
<span class="k">create</span> <span class="k">unique</span> <span class="k">index</span> <span class="n">idx_name</span> <span class="k">on</span> <span class="n">registry</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">workspace_id</span><span class="p">);</span>
</code></pre></div></div>

<blockquote>
  <p>完成以上操作，会在 Skoala 数据库内有 3 张表，注意检测对应 SQL 是否全部是生效。</p>
</blockquote>

<h3 id="配置-skoala-helm-repo">配置 skoala helm repo</h3>

<p>配置好 skoala 仓库，即可查看和获取到 skoala 的应用 chart</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ helm repo add skoala-release https://release.daocloud.io/chartrepo/skoala
~ helm repo update
</code></pre></div></div>

<p><img src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/20221216185921.png?x-oss-process=image/resize,w_960,m_lfit" alt="resize,w_960,m_lfit" /></p>

<p>重点内容： ** 增加完成后 Skoala-release 之后，常用需要关注的有 2 个 Chart：</p>

<ul>
  <li>Skoala   是 Skoala 的控制端的服务，
    <ul>
      <li><strong>安装完成后，可以网页看到微服务引擎的入口</strong></li>
      <li>包含 3 个组件 ui、hive、sesame</li>
      <li>需要安装在全局管理集群</li>
    </ul>
  </li>
  <li>Skoala-init 是 Skoala 所有的组件 Operator
    <ul>
      <li><strong>仅安装到指定工作集群即可</strong></li>
      <li>包含组件有：skoala-agent, nacos, contour, sentinel</li>
      <li><strong>未安装时，创建注册中心和网关时会提示缺少组件</strong></li>
    </ul>
  </li>
</ul>

<p>默认情况下，安装完成 skoala 到 kpanda-global-cluster(全局管理集群)，就可以在侧边栏看到对应的微服务引擎的入口了。</p>

<h3 id="查看-skoala-组件-最新版本">查看 skoala 组件 最新版本</h3>

<p>在全局管理集群，查看 Skoala 的最新版本，直接通过 helm repo 来更新获取最新的；</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ helm repo update skoala-release
~ helm search repo skoala-release/skoala <span class="nt">--versions</span>
NAME                        CHART VERSION   APP VERSION DESCRIPTION
skoala-release/skoala       0.13.0          0.13.0      The helm chart <span class="k">for </span>Skoala
skoala-release/skoala       0.12.2          0.12.2      The helm chart <span class="k">for </span>Skoala
skoala-release/skoala       0.12.1          0.12.1      The helm chart <span class="k">for </span>Skoala
skoala-release/skoala       0.12.0          0.12.0      The helm chart <span class="k">for </span>Skoala
......
</code></pre></div></div>

<blockquote>
  <p>在部署 skoala 时，会携带当时最新的前端版本，如果想要指定前端 ui 的版本，
可以去看前端代码仓库获取对应的版本号： <a href="https://gitlab.daocloud.cn/ndx/frontend-engineering/skoala-ui/-/tags">https://gitlab.daocloud.cn/ndx/frontend-engineering/skoala-ui/-/tags</a></p>
</blockquote>

<p>在工作集群，查看 Skoala-init 的最新版本，直接通过 helm repo 来更新获取最新的</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ helm repo update skoala-release
~ helm search repo skoala-release/skoala-init <span class="nt">--versions</span>
NAME                        CHART VERSION   APP VERSION DESCRIPTION
skoala-release/skoala-init  0.13.0          0.13.0      A Helm Chart <span class="k">for </span>Skoala init, it includes Skoal...
skoala-release/skoala-init  0.12.2          0.12.2      A Helm Chart <span class="k">for </span>Skoala init, it includes Skoal...
skoala-release/skoala-init  0.12.1          0.12.1      A Helm Chart <span class="k">for </span>Skoala init, it includes Skoal...
skoala-release/skoala-init  0.12.0          0.12.0      A Helm Chart <span class="k">for </span>Skoala init, it includes Skoal...
......
</code></pre></div></div>

<h3 id="34-执行部署同样适用于升级">3.4. 执行部署（同样适用于升级）</h3>

<p>直接执行命令即可，注意对应的版本号</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ helm upgrade <span class="nt">--install</span> skoala <span class="nt">--create-namespace</span> <span class="nt">-n</span> skoala-system <span class="nt">--cleanup-on-fail</span> <span class="se">\</span>
    <span class="nt">--set</span> ui.image.tag<span class="o">=</span>v0.9.0 <span class="se">\</span>
    <span class="nt">--set</span> sweet.enable<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    <span class="nt">--set</span> hive.configMap.data.database.host<span class="o">=</span>mcamel-common-mysql-cluster-mysql-master.mcamel-system.svc.cluster.local <span class="se">\</span>
    <span class="nt">--set</span> hive.configMap.data.database.port<span class="o">=</span>3306 <span class="se">\</span>
    <span class="nt">--set</span> hive.configMap.data.database.user<span class="o">=</span>root <span class="se">\</span>
    <span class="nt">--set</span> hive.configMap.data.database.password<span class="o">=</span>xxxxxxxx <span class="se">\</span>
    <span class="nt">--set</span> hive.configMap.data.database.database<span class="o">=</span>skoala <span class="se">\</span>
    skoala-release/skoala <span class="se">\</span>
    <span class="nt">--version</span> 0.13.0
</code></pre></div></div>

<blockquote>
  <p>自定义并初始化数据库参数；需要将数据库信息做配置添加进去<br />
–set sweet.enable=true <br />
–set hive.configMap.data.database.host= \<br />
–set hive.configMap.data.database.port= \<br />
–set hive.configMap.data.database.user= <br />
–set hive.configMap.data.database.password= \<br />
–set hive.configMap.data.database.database= \</p>

  <p>自定义前端 ui 版本
ui.image.tag=v0.9.0</p>
</blockquote>

<p>查看部署的 pod 是否启动成功</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ kubectl <span class="nt">-n</span> skoala-system get pods
NAME                                   READY   STATUS    RESTARTS        AGE
hive-8548cd9b59-948j2                  2/2     Running   2 <span class="o">(</span>3h48m ago<span class="o">)</span>   3h48m
sesame-5955c878c6-jz8cd                2/2     Running   0               3h48m
ui-7c9f5b7b67-9rpzc                    2/2     Running   0               3h48m
</code></pre></div></div>

<h3 id="卸载-skoala">卸载 skoala</h3>

<p>这一步骤卸载，会把 skoala 相关的资源删除。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ helm uninstall skoala <span class="nt">-n</span> skoala-system
</code></pre></div></div>

<h3 id="更新-skoala">更新 skoala</h3>

<p>更新操作同 3.4 部署，使用 helm upgrade 指定新版本即可</p>

<h3 id="更多参数的配置">更多参数的配置</h3>

<p>请查看 Skoala 代码仓库 <a href="https://gitlab.daocloud.cn/ndx/skoala/-/tree/main/build/charts/skoala">https://gitlab.daocloud.cn/ndx/skoala/-/tree/main/build/charts/skoala</a></p>

<h3 id="38-安装-skoala-init-到工作集群">3.8.  安装 skoala-init 到工作集群</h3>

<p>由于 Skoala 涉及的组件较多，我们将这些组件打包到同一个 Chart 内，也就是 skoala-init，所以我们应该在用到微服务引擎的工作集群安装好 skoala-init</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~  helm search repo skoala-release/skoala-init <span class="nt">--versions</span>
NAME                        CHART VERSION   APP VERSION DESCRIPTION
skoala-release/skoala-init  0.13.0          0.13.0      A Helm Chart <span class="k">for </span>Skoala init, it includes Skoal...
skoala-release/skoala-init  0.12.2          0.12.2      A Helm Chart <span class="k">for </span>Skoala init, it includes Skoal...
skoala-release/skoala-init  0.12.1          0.12.1      A Helm Chart <span class="k">for </span>Skoala init, it includes Skoal...
skoala-release/skoala-init  0.12.0          0.12.0      A Helm Chart <span class="k">for </span>Skoala init, it includes Skoal...
......
</code></pre></div></div>

<p>安装命令，同更新; 确认需要安装到指定的命名空间，确认看到全部 Pod 启动成功。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ helm upgrade <span class="nt">--install</span> skoala-init <span class="nt">--create-namespace</span> <span class="nt">-n</span> skoala-system <span class="nt">--cleanup-on-fail</span> <span class="se">\</span>
    skoala-release/skoala-init <span class="se">\</span>
    <span class="nt">--version</span> 0.13.0
</code></pre></div></div>

<p><strong>除了通过终端安装，UI 的方式 可以在 Kpanda 集群管理中 Helm 应用内找到 Skoala-init 进行安装。</strong></p>

<p><img src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/5JAl1G.jpg?x-oss-process=image/resize,w_960,m_lfit" alt="resize,w_960,m_lfit" /></p>

<p>卸载命令</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ helm uninstall skoala-init <span class="nt">-n</span> skoala-system
</code></pre></div></div>

      
    </div>
    <br/>
    <div>
      <cite>2022-12-15</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Mac">Mac</a>
      , 
      <a href="/tags.html#Raycast">Raycast</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2022/12/dce50.html">保姆式安装 DCE5.0</a></h1>
    <div class="post_at_index">
      <h2 id="前言">前言</h2>

<p>本文完成了从 0 到 1 的完成 DCE5.0 社区版的安装；其中包含社区版需要一个 K8s 集群、与一些安装细节和注意事项。</p>

<h3 id="集群规划">集群规划</h3>

<p>当前计划使用在 3 台 UCloud 的 VM，配置均为 8 核 16G。</p>

<table>
  <thead>
    <tr>
      <th>角色</th>
      <th>主机名</th>
      <th>操作系统</th>
      <th>IP</th>
      <th>配置</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>master</td>
      <td>master-k8s-com</td>
      <td>CentOS 7.9</td>
      <td>10.23.245.63</td>
      <td>8 核 16G 300GB</td>
    </tr>
    <tr>
      <td>node01</td>
      <td>node01-k8s-com</td>
      <td>CentOS 7.9</td>
      <td>10.23.104.173</td>
      <td>8 核 16G 300GB</td>
    </tr>
    <tr>
      <td>node02</td>
      <td>node02-k8s-com</td>
      <td>CentOS 7.9</td>
      <td>10.23.112.244</td>
      <td>8 核 16G 300GB</td>
    </tr>
  </tbody>
</table>

<h3 id="组件介绍">组件介绍</h3>

<ul>
  <li>Kubernetes  1.24.8</li>
  <li>CRI containerd</li>
  <li>CNI Calico</li>
  <li>StorageClass HwameiStior</li>
</ul>

<h3 id="节点系统优化">节点系统优化</h3>

<h4 id="配置主机名">配置主机名</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hostnamctl set-hostname master-k8s-com
</code></pre></div></div>

<h4 id="添加-etchosts-配置">添加 /etc/hosts 配置</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | tee /etc/hosts
10.23.245.63    master-k8s-com
10.23.104.173   node01-k8s-com
10.23.112.244   node02-k8s-com
</span><span class="no">EOF
</span></code></pre></div></div>

<h4 id="禁用-swap">禁用 Swap</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>swapoff <span class="nt">-a</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'/ swap / s/^/#/'</span> /etc/fstab
</code></pre></div></div>

<h4 id="禁用-selinux">禁用 SElinux</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setenforce 0
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/^SELINUX=enforcing$/SELINUX=permissive/'</span> /etc/selinux/config
</code></pre></div></div>

<h4 id="关闭防火墙">关闭防火墙</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl stop firewalld
systemctl disable firewalld
</code></pre></div></div>

<h4 id="允许-iptables-检查桥接流量">允许 iptables 检查桥接流量</h4>

<p>加载 <code class="language-plaintext highlighter-rouge">br_netfilter</code> 模块</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | tee /etc/modules-load.d/kubernetes.conf
br_netfilter
</span><span class="no">EOF

</span><span class="c"># 加载模块</span>
modprobe br_netfilter
</code></pre></div></div>

<p>修改 <code class="language-plaintext highlighter-rouge">net.bridge.bridge-nf-call-iptables</code> 设置为 1</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | tee /etc/sysctl.d/kubernetes.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
</span><span class="no">EOF

</span><span class="c"># 刷新配置</span>
sysctl <span class="nt">--system</span>
</code></pre></div></div>

<h2 id="k8s-环境安装">K8s 环境安装</h2>

<h3 id="安装-docker">安装 Docker</h3>

<h4 id="安装-docker-的软件源">安装 Docker 的软件源</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> yum-utils
<span class="nb">sudo </span>yum-config-manager <span class="se">\</span>
    <span class="nt">--add-repo</span> <span class="se">\</span>
    https://download.docker.com/linux/centos/docker-ce.repo
</code></pre></div></div>

<h4 id="安装-docker-和-containerdio">安装 Docker 和 Containerd.io</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>yum <span class="nt">-y</span> <span class="nb">install </span>docker-ce docker-ce-cli containerd.io
</code></pre></div></div>

<h4 id="修改-docker-的配置">修改 Docker 的配置</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo touch</span> /etc/docker/daemon.json

<span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | tee /etc/docker/daemon.json
{
  "exec-opts": ["native.cgroupdriver=systemd"]
}
</span><span class="no">EOF
</span></code></pre></div></div>

<h4 id="修改-containerd-的配置">修改 Containerd 的配置</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 清理配置文件</span>
<span class="nb">sudo rm</span> <span class="nt">-f</span> /etc/containerd/config.toml

<span class="c"># 初始化配置</span>
<span class="nb">sudo </span>containerd config default | <span class="nb">sudo tee</span> /etc/containerd/config.toml

<span class="c"># 更新配置文件内容</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/SystemdCgroup\ =\ false/SystemdCgroup\ =\ true/'</span> /etc/containerd/config.toml
<span class="nb">sed</span> <span class="s1">'s/k8s.gcr.io\/pause/registry.cn-hangzhou.aliyuncs.com\/google_containers\/pause/g'</span> /etc/containerd/config.toml
</code></pre></div></div>

<h4 id="启动服务配置">启动服务配置</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl daemon-reload
<span class="nb">sudo </span>systemctl <span class="nb">enable</span> <span class="nt">--now</span> docker
<span class="nb">sudo </span>systemctl <span class="nb">enable</span> <span class="nt">--now</span> containerd
</code></pre></div></div>

<h4 id="检查配置成功">检查配置成功</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl status docker containerd
<span class="nb">sudo </span>docker info
</code></pre></div></div>

<h3 id="安装-kubernetes-系统组件">安装 Kubernetes 系统组件</h3>

<h4 id="安装-kubernetes-软件源">安装 Kubernetes 软件源</h4>

<p>这里采用国内阿里云的源，具有加速效果</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
</span><span class="no">EOF
</span></code></pre></div></div>

<h4 id="安装-kubernetes-组件">安装 Kubernetes 组件</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo </span><span class="nv">K8sVersion</span><span class="o">=</span>1.24.8
<span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> kubelet-1.24.8-<span class="nv">$K8sVersion</span> kubeadm-1.24.8-<span class="nv">$K8sVersion</span>
<span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> kubectl-1.24.8-<span class="nv">$K8sVersion</span>  <span class="c"># 可以仅在 Master 节点安装</span>
</code></pre></div></div>

<h4 id="启动-kubelet系统服务">启动 <code class="language-plaintext highlighter-rouge">kubelet</code>系统服务</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl <span class="nb">enable</span> <span class="nt">--now</span> kubelet
</code></pre></div></div>

<p>此时启动后服务状态异常，会检查集群配置，因为没有配置会不断的重启，不影响后续操作</p>

<h3 id="初始化-master-节点">初始化 Master 节点</h3>

<p>注意规划集群主节点配置，初始化主节点时，规划网络配置</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 指定对应的 kubernetes 的版本，注意与上方配置保持一致</span>
<span class="nv">$ </span>sudokubeadm init <span class="nt">--kubernetes-version</span><span class="o">=</span>v1.24.8 <span class="se">\</span>
 <span class="nt">--image-repository</span><span class="o">=</span>registry.cn-hangzhou.aliyuncs.com/google_containers <span class="se">\</span>
 <span class="nt">--pod-network-cidr</span> 10.11.0.0/16 <span class="se">\</span>

<span class="o">[</span>init] Using Kubernetes version: v1.24.8
<span class="o">[</span>preflight] Running pre-flight checks
<span class="o">[</span>preflight] Pulling images required <span class="k">for </span>setting up a Kubernetes cluster
<span class="o">[</span>preflight] This might take a minute or two, depending on the speed of your internet connection
<span class="o">[</span>preflight] You can also perform this action <span class="k">in </span>beforehand using <span class="s1">'kubeadm config images pull'</span>
<span class="o">[</span>certs] Using certificateDir folder <span class="s2">"/etc/kubernetes/pki"</span>
<span class="o">[</span>certs] Generating <span class="s2">"ca"</span> certificate and key
<span class="o">[</span>certs] Generating <span class="s2">"apiserver"</span> certificate and key
<span class="o">[</span>certs] Generating <span class="s2">"apiserver-kubelet-client"</span> certificate and key
<span class="o">[</span>certs] Generating <span class="s2">"front-proxy-ca"</span> certificate and key
<span class="o">[</span>certs] Generating <span class="s2">"front-proxy-client"</span> certificate and key
<span class="o">[</span>certs] Generating <span class="s2">"etcd/ca"</span> certificate and key
<span class="o">[</span>certs] Generating <span class="s2">"etcd/server"</span> certificate and key
<span class="o">[</span>certs] Generating <span class="s2">"etcd/peer"</span> certificate and key
<span class="o">[</span>certs] Generating <span class="s2">"etcd/healthcheck-client"</span> certificate and key
<span class="o">[</span>certs] Generating <span class="s2">"apiserver-etcd-client"</span> certificate and key
<span class="o">[</span>certs] Generating <span class="s2">"sa"</span> key and public key
<span class="o">[</span>kubeconfig] Using kubeconfig folder <span class="s2">"/etc/kubernetes"</span>
<span class="o">[</span>kubeconfig] Writing <span class="s2">"admin.conf"</span> kubeconfig file
<span class="o">[</span>kubeconfig] Writing <span class="s2">"kubelet.conf"</span> kubeconfig file
<span class="o">[</span>kubeconfig] Writing <span class="s2">"controller-manager.conf"</span> kubeconfig file
<span class="o">[</span>kubeconfig] Writing <span class="s2">"scheduler.conf"</span> kubeconfig file
<span class="o">[</span>kubelet-start] Writing kubelet environment file with flags to file <span class="s2">"/var/lib/kubelet/kubeadm-flags.env"</span>
<span class="o">[</span>kubelet-start] Writing kubelet configuration to file <span class="s2">"/var/lib/kubelet/config.yaml"</span>
<span class="o">[</span>kubelet-start] Starting the kubelet
<span class="o">[</span>control-plane] Using manifest folder <span class="s2">"/etc/kubernetes/manifests"</span>
<span class="o">[</span>control-plane] Creating static Pod manifest <span class="k">for</span> <span class="s2">"kube-apiserver"</span>
<span class="o">[</span>control-plane] Creating static Pod manifest <span class="k">for</span> <span class="s2">"kube-controller-manager"</span>
<span class="o">[</span>control-plane] Creating static Pod manifest <span class="k">for</span> <span class="s2">"kube-scheduler"</span>
<span class="o">[</span>etcd] Creating static Pod manifest <span class="k">for </span><span class="nb">local </span>etcd <span class="k">in</span> <span class="s2">"/etc/kubernetes/manifests"</span>
<span class="o">[</span>wait-control-plane] Waiting <span class="k">for </span>the kubelet to boot up the control plane as static Pods from directory <span class="s2">"/etc/kubernetes/manifests"</span><span class="nb">.</span> This can take up to 4m0s
<span class="o">[</span>apiclient] All control plane components are healthy after 6.503693 seconds
<span class="o">[</span>upload-config] Storing the configuration used <span class="k">in </span>ConfigMap <span class="s2">"kubeadm-config"</span> <span class="k">in </span>the <span class="s2">"kube-system"</span> Namespace
<span class="o">[</span>kubelet] Creating a ConfigMap <span class="s2">"kubelet-config-1.24.8"</span> <span class="k">in </span>namespace kube-system with the configuration <span class="k">for </span>the kubelets <span class="k">in </span>the cluster
NOTE: The <span class="s2">"kubelet-config-1.24.8"</span> naming of the kubelet ConfigMap is deprecated. Once the UnversionedKubeletConfigMap feature gate graduates to Beta the default name will become just <span class="s2">"kubelet-config"</span><span class="nb">.</span> Kubeadm upgrade will handle this transition transparently.
<span class="o">[</span>upload-certs] Skipping phase. Please see <span class="nt">--upload-certs</span>
<span class="o">[</span>mark-control-plane] Marking the node node1.k8s.com as control-plane by adding the labels: <span class="o">[</span>node-role.kubernetes.io/master<span class="o">(</span>deprecated<span class="o">)</span> node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]
<span class="o">[</span>mark-control-plane] Marking the node node1.k8s.com as control-plane by adding the taints <span class="o">[</span>node-role.kubernetes.io/master:NoSchedule]
<span class="o">[</span>bootstrap-token] Using token: c0wcm5.0yu9szfktsxvurza
<span class="o">[</span>bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
<span class="o">[</span>bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes
<span class="o">[</span>bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs <span class="k">in </span>order <span class="k">for </span>nodes to get long term certificate credentials
<span class="o">[</span>bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
<span class="o">[</span>bootstrap-token] configured RBAC rules to allow certificate rotation <span class="k">for </span>all node client certificates <span class="k">in </span>the cluster
<span class="o">[</span>bootstrap-token] Creating the <span class="s2">"cluster-info"</span> ConfigMap <span class="k">in </span>the <span class="s2">"kube-public"</span> namespace
<span class="o">[</span>kubelet-finalize] Updating <span class="s2">"/etc/kubernetes/kubelet.conf"</span> to point to a rotatable kubelet client certificate and key
<span class="o">[</span>addons] Applied essential addon: CoreDNS
<span class="o">[</span>addons] Applied essential addon: kube-proxy

Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$HOME</span>/.kube
  <span class="nb">sudo cp</span> <span class="nt">-i</span> /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
  <span class="nb">sudo chown</span> <span class="si">$(</span><span class="nb">id</span> <span class="nt">-u</span><span class="si">)</span>:<span class="si">$(</span><span class="nb">id</span> <span class="nt">-g</span><span class="si">)</span> <span class="nv">$HOME</span>/.kube/config

Alternatively, <span class="k">if </span>you are the root user, you can run:

  <span class="nb">export </span><span class="nv">KUBECONFIG</span><span class="o">=</span>/etc/kubernetes/admin.conf

You should now deploy a pod network to the cluster.
Run <span class="s2">"kubectl apply -f [podnetwork].yaml"</span> with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can <span class="nb">join </span>any number of worker nodes by running the following on each as root:

kubeadm <span class="nb">join </span>10.23.245.63:6443 <span class="nt">--token</span> djdsj2.sj23js90213j323 <span class="se">\</span>
        <span class="nt">--discovery-token-ca-cert-hash</span> sha256:ewuosdjk2390rjertw32p32j43p25a70298db818ajsdjk1293jk23k23201934h
</code></pre></div></div>

<h3 id="加入工作节点">加入工作节点</h3>

<p>注意需要确保完成了前面的步骤 节点系统优化、安装 Docker、安装 Kubernetes 系统组件，并且成功完成 初始化 Master 节点</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubeadm <span class="nb">join </span>10.23.245.63:6443 <span class="nt">--token</span> djdsj2.sj23js90213j323 <span class="se">\</span>
        <span class="nt">--discovery-token-ca-cert-hash</span> sha256:ewuosdjk2390rjertw32p32j43p25a70298db818ajsdjk1293jk23k23201934h
</code></pre></div></div>

<p>请分别添加 2 个工作节点：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get nodes
NAME               STATUS   ROLES           AGE   VERSION
master01-k8s-com   Ready    control-plane   9h    v1.24.8
node01-k8s-com     Ready    &lt;none&gt;          9h    v1.24.8
node02-k8s-com     Ready    &lt;none&gt;          9h    v1.24.8
</code></pre></div></div>

<h3 id="安装-cni-calico">安装 CNI Calico</h3>

<p>将下发 <code class="language-plaintext highlighter-rouge">yaml</code>保存为 <code class="language-plaintext highlighter-rouge">calico.yaml</code>，或者 到我的 Github 去下载。</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="c1"># Source: calico/templates/calico-config.yaml</span>
<span class="c1"># This ConfigMap is used to configure a self-hosted Calico installation.</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">calico-config</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kube-system</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="c1"># Typha is disabled.</span>
  <span class="na">typha_service_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">none"</span>
  <span class="c1"># Configure the backend to use.</span>
  <span class="na">calico_backend</span><span class="pi">:</span> <span class="s2">"</span><span class="s">bird"</span>

  <span class="c1"># Configure the MTU to use for workload interfaces and tunnels.</span>
  <span class="c1"># By default, MTU is auto-detected, and explicitly setting this field should not be required.</span>
  <span class="c1"># You can override auto-detection by providing a non-zero value.</span>
  <span class="na">veth_mtu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0"</span>

  <span class="c1"># The CNI network configuration to install on each node. The special</span>
  <span class="c1"># values in this config will be automatically populated.</span>
  <span class="na">cni_network_config</span><span class="pi">:</span> <span class="pi">|-</span>
    <span class="s">{</span>
      <span class="s">"name": "k8s-pod-network",</span>
      <span class="s">"cniVersion": "0.3.1",</span>
      <span class="s">"plugins": [</span>
        <span class="s">{</span>
          <span class="s">"type": "calico",</span>
          <span class="s">"log_level": "info",</span>
          <span class="s">"log_file_path": "/var/log/calico/cni/cni.log",</span>
          <span class="s">"datastore_type": "kubernetes",</span>
          <span class="s">"nodename": "__KUBERNETES_NODE_NAME__",</span>
          <span class="s">"mtu": __CNI_MTU__,</span>
          <span class="s">"ipam": {</span>
              <span class="s">"type": "calico-ipam"</span>
          <span class="s">},</span>
          <span class="s">"policy": {</span>
              <span class="s">"type": "k8s"</span>
          <span class="s">},</span>
          <span class="s">"kubernetes": {</span>
              <span class="s">"kubeconfig": "__KUBECONFIG_FILEPATH__"</span>
          <span class="s">}</span>
        <span class="s">},</span>
        <span class="s">{</span>
          <span class="s">"type": "portmap",</span>
          <span class="s">"snat": true,</span>
          <span class="s">"capabilities": {"portMappings": true}</span>
        <span class="s">},</span>
        <span class="s">{</span>
          <span class="s">"type": "bandwidth",</span>
          <span class="s">"capabilities": {"bandwidth": true}</span>
        <span class="s">}</span>
      <span class="s">]</span>
    <span class="s">}</span>

<span class="s">---</span>
<span class="c1"># Source: calico/templates/kdd-crds.yaml</span>

<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apiextensions.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CustomResourceDefinition</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">bgpconfigurations.crd.projectcalico.org</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">crd.projectcalico.org</span>
  <span class="na">names</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">BGPConfiguration</span>
    <span class="na">listKind</span><span class="pi">:</span> <span class="s">BGPConfigurationList</span>
    <span class="na">plural</span><span class="pi">:</span> <span class="s">bgpconfigurations</span>
    <span class="na">singular</span><span class="pi">:</span> <span class="s">bgpconfiguration</span>
  <span class="na">scope</span><span class="pi">:</span> <span class="s">Cluster</span>
  <span class="na">versions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">v1</span>
    <span class="na">schema</span><span class="pi">:</span>
      <span class="na">openAPIV3Schema</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s">BGPConfiguration contains the configuration for any BGP routing.</span>
        <span class="na">properties</span><span class="pi">:</span>
          <span class="na">apiVersion</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">APIVersion</span><span class="nv"> </span><span class="s">defines</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">versioned</span><span class="nv"> </span><span class="s">schema</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">representation</span>
              <span class="s">of</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">object.</span><span class="nv"> </span><span class="s">Servers</span><span class="nv"> </span><span class="s">should</span><span class="nv"> </span><span class="s">convert</span><span class="nv"> </span><span class="s">recognized</span><span class="nv"> </span><span class="s">schemas</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">latest</span>
              <span class="s">internal</span><span class="nv"> </span><span class="s">value,</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">reject</span><span class="nv"> </span><span class="s">unrecognized</span><span class="nv"> </span><span class="s">values.</span><span class="nv"> </span><span class="s">More</span><span class="nv"> </span><span class="s">info:</span><span class="nv"> </span><span class="s">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">kind</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Kind</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">string</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">representing</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">REST</span><span class="nv"> </span><span class="s">resource</span><span class="nv"> </span><span class="s">this</span>
              <span class="s">object</span><span class="nv"> </span><span class="s">represents.</span><span class="nv"> </span><span class="s">Servers</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">infer</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">endpoint</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">client</span>
              <span class="s">submits</span><span class="nv"> </span><span class="s">requests</span><span class="nv"> </span><span class="s">to.</span><span class="nv"> </span><span class="s">Cannot</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">updated.</span><span class="nv"> </span><span class="s">In</span><span class="nv"> </span><span class="s">CamelCase.</span><span class="nv"> </span><span class="s">More</span><span class="nv"> </span><span class="s">info:</span><span class="nv"> </span><span class="s">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">metadata</span><span class="pi">:</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
          <span class="na">spec</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s">BGPConfigurationSpec contains the values of the BGP configuration.</span>
            <span class="na">properties</span><span class="pi">:</span>
              <span class="na">asNumber</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ASNumber</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">default</span><span class="nv"> </span><span class="s">AS</span><span class="nv"> </span><span class="s">number</span><span class="nv"> </span><span class="s">used</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">node.</span><span class="nv"> </span><span class="s">[Default:</span>
                  <span class="s">64512]'</span>
                <span class="na">format</span><span class="pi">:</span> <span class="s">int32</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">communities</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">Communities is a list of BGP community values and their</span>
                  <span class="s">arbitrary names for tagging routes.</span>
                <span class="na">items</span><span class="pi">:</span>
                  <span class="na">description</span><span class="pi">:</span> <span class="s">Community contains standard or large community value</span>
                    <span class="s">and its name.</span>
                  <span class="na">properties</span><span class="pi">:</span>
                    <span class="na">name</span><span class="pi">:</span>
                      <span class="na">description</span><span class="pi">:</span> <span class="s">Name given to community value.</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                    <span class="na">value</span><span class="pi">:</span>
                      <span class="na">description</span><span class="pi">:</span> <span class="s">Value must be of format `aa:nn` or `aa:nn:mm`.</span>
                        <span class="s">For standard community use `aa:nn` format, where `aa` and</span>
                        <span class="s">`nn` are 16 bit number. For large community use `aa:nn:mm`</span>
                        <span class="s">format, where `aa`, `nn` and `mm` are 32 bit number. Where,</span>
                        <span class="s">`aa` is an AS Number, `nn` and `mm` are per-AS identifier.</span>
                      <span class="na">pattern</span><span class="pi">:</span> <span class="s">^(\d+):(\d+)$|^(\d+):(\d+):(\d+)$</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                  <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
              <span class="na">listenPort</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">ListenPort is the port where BGP protocol should listen.</span>
                  <span class="s">Defaults to </span><span class="m">179</span>
                <span class="na">maximum</span><span class="pi">:</span> <span class="m">65535</span>
                <span class="na">minimum</span><span class="pi">:</span> <span class="m">1</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">logSeverityScreen</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">LogSeverityScreen</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">log</span><span class="nv"> </span><span class="s">severity</span><span class="nv"> </span><span class="s">above</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">logs</span>
                  <span class="s">are</span><span class="nv"> </span><span class="s">sent</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">stdout.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">INFO]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">nodeToNodeMeshEnabled</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">NodeToNodeMeshEnabled</span><span class="nv"> </span><span class="s">sets</span><span class="nv"> </span><span class="s">whether</span><span class="nv"> </span><span class="s">full</span><span class="nv"> </span><span class="s">node</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">node</span>
                  <span class="s">BGP</span><span class="nv"> </span><span class="s">mesh</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">enabled.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">true]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">prefixAdvertisements</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">PrefixAdvertisements contains per-prefix advertisement</span>
                  <span class="s">configuration.</span>
                <span class="na">items</span><span class="pi">:</span>
                  <span class="na">description</span><span class="pi">:</span> <span class="s">PrefixAdvertisement configures advertisement properties</span>
                    <span class="s">for the specified CIDR.</span>
                  <span class="na">properties</span><span class="pi">:</span>
                    <span class="na">cidr</span><span class="pi">:</span>
                      <span class="na">description</span><span class="pi">:</span> <span class="s">CIDR for which properties should be advertised.</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                    <span class="na">communities</span><span class="pi">:</span>
                      <span class="na">description</span><span class="pi">:</span> <span class="s">Communities can be list of either community names</span>
                        <span class="s">already defined in `Specs.Communities` or community value</span>
                        <span class="s">of format `aa:nn` or `aa:nn:mm`. For standard community use</span>
                        <span class="s">`aa:nn` format, where `aa` and `nn` are 16 bit number. For</span>
                        <span class="s">large community use `aa:nn:mm` format, where `aa`, `nn` and</span>
                        <span class="s">`mm` are 32 bit number. Where,`aa` is an AS Number, `nn` and</span>
                        <span class="s">`mm` are per-AS identifier.</span>
                      <span class="na">items</span><span class="pi">:</span>
                        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
                  <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
              <span class="na">serviceClusterIPs</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">ServiceClusterIPs are the CIDR blocks from which service</span>
                  <span class="s">cluster IPs are allocated. If specified, Calico will advertise these</span>
                  <span class="s">blocks, as well as any cluster IPs within them.</span>
                <span class="na">items</span><span class="pi">:</span>
                  <span class="na">description</span><span class="pi">:</span> <span class="s">ServiceClusterIPBlock represents a single allowed ClusterIP</span>
                    <span class="s">CIDR block.</span>
                  <span class="na">properties</span><span class="pi">:</span>
                    <span class="na">cidr</span><span class="pi">:</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                  <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
              <span class="na">serviceExternalIPs</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">ServiceExternalIPs are the CIDR blocks for Kubernetes</span>
                  <span class="s">Service External IPs. Kubernetes Service ExternalIPs will only be</span>
                  <span class="s">advertised if they are within one of these blocks.</span>
                <span class="na">items</span><span class="pi">:</span>
                  <span class="na">description</span><span class="pi">:</span> <span class="s">ServiceExternalIPBlock represents a single allowed</span>
                    <span class="s">External IP CIDR block.</span>
                  <span class="na">properties</span><span class="pi">:</span>
                    <span class="na">cidr</span><span class="pi">:</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                  <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
              <span class="na">serviceLoadBalancerIPs</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">ServiceLoadBalancerIPs are the CIDR blocks for Kubernetes</span>
                  <span class="s">Service LoadBalancer IPs. Kubernetes Service status.LoadBalancer.Ingress</span>
                  <span class="s">IPs will only be advertised if they are within one of these blocks.</span>
                <span class="na">items</span><span class="pi">:</span>
                  <span class="na">description</span><span class="pi">:</span> <span class="s">ServiceLoadBalancerIPBlock represents a single allowed</span>
                    <span class="s">LoadBalancer IP CIDR block.</span>
                  <span class="na">properties</span><span class="pi">:</span>
                    <span class="na">cidr</span><span class="pi">:</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                  <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
    <span class="na">served</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">storage</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">status</span><span class="pi">:</span>
  <span class="na">acceptedNames</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">plural</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">conditions</span><span class="pi">:</span> <span class="pi">[]</span>
  <span class="na">storedVersions</span><span class="pi">:</span> <span class="pi">[]</span>

<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apiextensions.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CustomResourceDefinition</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">bgppeers.crd.projectcalico.org</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">crd.projectcalico.org</span>
  <span class="na">names</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">BGPPeer</span>
    <span class="na">listKind</span><span class="pi">:</span> <span class="s">BGPPeerList</span>
    <span class="na">plural</span><span class="pi">:</span> <span class="s">bgppeers</span>
    <span class="na">singular</span><span class="pi">:</span> <span class="s">bgppeer</span>
  <span class="na">scope</span><span class="pi">:</span> <span class="s">Cluster</span>
  <span class="na">versions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">v1</span>
    <span class="na">schema</span><span class="pi">:</span>
      <span class="na">openAPIV3Schema</span><span class="pi">:</span>
        <span class="na">properties</span><span class="pi">:</span>
          <span class="na">apiVersion</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">APIVersion</span><span class="nv"> </span><span class="s">defines</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">versioned</span><span class="nv"> </span><span class="s">schema</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">representation</span>
              <span class="s">of</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">object.</span><span class="nv"> </span><span class="s">Servers</span><span class="nv"> </span><span class="s">should</span><span class="nv"> </span><span class="s">convert</span><span class="nv"> </span><span class="s">recognized</span><span class="nv"> </span><span class="s">schemas</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">latest</span>
              <span class="s">internal</span><span class="nv"> </span><span class="s">value,</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">reject</span><span class="nv"> </span><span class="s">unrecognized</span><span class="nv"> </span><span class="s">values.</span><span class="nv"> </span><span class="s">More</span><span class="nv"> </span><span class="s">info:</span><span class="nv"> </span><span class="s">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">kind</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Kind</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">string</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">representing</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">REST</span><span class="nv"> </span><span class="s">resource</span><span class="nv"> </span><span class="s">this</span>
              <span class="s">object</span><span class="nv"> </span><span class="s">represents.</span><span class="nv"> </span><span class="s">Servers</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">infer</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">endpoint</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">client</span>
              <span class="s">submits</span><span class="nv"> </span><span class="s">requests</span><span class="nv"> </span><span class="s">to.</span><span class="nv"> </span><span class="s">Cannot</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">updated.</span><span class="nv"> </span><span class="s">In</span><span class="nv"> </span><span class="s">CamelCase.</span><span class="nv"> </span><span class="s">More</span><span class="nv"> </span><span class="s">info:</span><span class="nv"> </span><span class="s">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">metadata</span><span class="pi">:</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
          <span class="na">spec</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s">BGPPeerSpec contains the specification for a BGPPeer resource.</span>
            <span class="na">properties</span><span class="pi">:</span>
              <span class="na">asNumber</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">The AS Number of the peer.</span>
                <span class="na">format</span><span class="pi">:</span> <span class="s">int32</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">keepOriginalNextHop</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">Option to keep the original nexthop field when routes</span>
                  <span class="s">are sent to a BGP Peer. Setting "true" configures the selected BGP</span>
                  <span class="s">Peers node to use the "next hop keep;" instead of "next hop self;"(default)</span>
                  <span class="s">in the specific branch of the Node on "bird.cfg".</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">node</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">The node name identifying the Calico node instance that</span>
                  <span class="s">is targeted by this peer. If this is not set, and no nodeSelector</span>
                  <span class="s">is specified, then this BGP peer selects all nodes in the cluster.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">nodeSelector</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">Selector for the nodes that should have this peering.  When</span>
                  <span class="s">this is set, the Node field must be empty.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">password</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">Optional BGP password for the peerings generated by this</span>
                  <span class="s">BGPPeer resource.</span>
                <span class="na">properties</span><span class="pi">:</span>
                  <span class="na">secretKeyRef</span><span class="pi">:</span>
                    <span class="na">description</span><span class="pi">:</span> <span class="s">Selects a key of a secret in the node pod's namespace.</span>
                    <span class="na">properties</span><span class="pi">:</span>
                      <span class="na">key</span><span class="pi">:</span>
                        <span class="na">description</span><span class="pi">:</span> <span class="s">The key of the secret to select from.  Must be</span>
                          <span class="s">a valid secret key.</span>
                        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                      <span class="na">name</span><span class="pi">:</span>
                        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Name</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">referent.</span><span class="nv"> </span><span class="s">More</span><span class="nv"> </span><span class="s">info:</span><span class="nv"> </span><span class="s">https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names</span>
                          <span class="s">TODO:</span><span class="nv"> </span><span class="s">Add</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">useful</span><span class="nv"> </span><span class="s">fields.</span><span class="nv"> </span><span class="s">apiVersion,</span><span class="nv"> </span><span class="s">kind,</span><span class="nv"> </span><span class="s">uid?'</span>
                        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                      <span class="na">optional</span><span class="pi">:</span>
                        <span class="na">description</span><span class="pi">:</span> <span class="s">Specify whether the Secret or its key must be</span>
                          <span class="s">defined</span>
                        <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
                    <span class="na">required</span><span class="pi">:</span>
                    <span class="pi">-</span> <span class="s">key</span>
                    <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
              <span class="na">peerIP</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">The IP address of the peer followed by an optional port</span>
                  <span class="s">number to peer with. If port number is given, format should be `[&lt;IPv6&gt;]:port`</span>
                  <span class="s">or `&lt;IPv4&gt;:&lt;port&gt;` for IPv4. If optional port number is not set,</span>
                  <span class="s">and this peer IP and ASNumber belongs to a calico/node with ListenPort</span>
                  <span class="s">set in BGPConfiguration, then we use that port to peer.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">peerSelector</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">Selector for the remote nodes to peer with.  When this</span>
                  <span class="s">is set, the PeerIP and ASNumber fields must be empty.  For each</span>
                  <span class="s">peering between the local node and selected remote nodes, we configure</span>
                  <span class="s">an IPv4 peering if both ends have NodeBGPSpec.IPv4Address specified,</span>
                  <span class="s">and an IPv6 peering if both ends have NodeBGPSpec.IPv6Address specified.  The</span>
                  <span class="s">remote AS number comes from the remote node's NodeBGPSpec.ASNumber,</span>
                  <span class="s">or the global default if that is not set.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">sourceAddress</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">Specifies whether and how to configure a source address</span>
                  <span class="s">for the peerings generated by this BGPPeer resource.  Default value</span>
                  <span class="s">"UseNodeIP" means to configure the node IP as the source address.  "None"</span>
                  <span class="s">means not to configure a source address.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
    <span class="na">served</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">storage</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">status</span><span class="pi">:</span>
  <span class="na">acceptedNames</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">plural</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">conditions</span><span class="pi">:</span> <span class="pi">[]</span>
  <span class="na">storedVersions</span><span class="pi">:</span> <span class="pi">[]</span>

<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apiextensions.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CustomResourceDefinition</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">blockaffinities.crd.projectcalico.org</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">crd.projectcalico.org</span>
  <span class="na">names</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">BlockAffinity</span>
    <span class="na">listKind</span><span class="pi">:</span> <span class="s">BlockAffinityList</span>
    <span class="na">plural</span><span class="pi">:</span> <span class="s">blockaffinities</span>
    <span class="na">singular</span><span class="pi">:</span> <span class="s">blockaffinity</span>
  <span class="na">scope</span><span class="pi">:</span> <span class="s">Cluster</span>
  <span class="na">versions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">v1</span>
    <span class="na">schema</span><span class="pi">:</span>
      <span class="na">openAPIV3Schema</span><span class="pi">:</span>
        <span class="na">properties</span><span class="pi">:</span>
          <span class="na">apiVersion</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">APIVersion</span><span class="nv"> </span><span class="s">defines</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">versioned</span><span class="nv"> </span><span class="s">schema</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">representation</span>
              <span class="s">of</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">object.</span><span class="nv"> </span><span class="s">Servers</span><span class="nv"> </span><span class="s">should</span><span class="nv"> </span><span class="s">convert</span><span class="nv"> </span><span class="s">recognized</span><span class="nv"> </span><span class="s">schemas</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">latest</span>
              <span class="s">internal</span><span class="nv"> </span><span class="s">value,</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">reject</span><span class="nv"> </span><span class="s">unrecognized</span><span class="nv"> </span><span class="s">values.</span><span class="nv"> </span><span class="s">More</span><span class="nv"> </span><span class="s">info:</span><span class="nv"> </span><span class="s">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">kind</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Kind</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">string</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">representing</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">REST</span><span class="nv"> </span><span class="s">resource</span><span class="nv"> </span><span class="s">this</span>
              <span class="s">object</span><span class="nv"> </span><span class="s">represents.</span><span class="nv"> </span><span class="s">Servers</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">infer</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">endpoint</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">client</span>
              <span class="s">submits</span><span class="nv"> </span><span class="s">requests</span><span class="nv"> </span><span class="s">to.</span><span class="nv"> </span><span class="s">Cannot</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">updated.</span><span class="nv"> </span><span class="s">In</span><span class="nv"> </span><span class="s">CamelCase.</span><span class="nv"> </span><span class="s">More</span><span class="nv"> </span><span class="s">info:</span><span class="nv"> </span><span class="s">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">metadata</span><span class="pi">:</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
          <span class="na">spec</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s">BlockAffinitySpec contains the specification for a BlockAffinity</span>
              <span class="s">resource.</span>
            <span class="na">properties</span><span class="pi">:</span>
              <span class="na">cidr</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">deleted</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">Deleted indicates that this block affinity is being deleted.</span>
                  <span class="s">This field is a string for compatibility with older releases that</span>
                  <span class="s">mistakenly treat this field as a string.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">node</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">state</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
            <span class="na">required</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">cidr</span>
            <span class="pi">-</span> <span class="s">deleted</span>
            <span class="pi">-</span> <span class="s">node</span>
            <span class="pi">-</span> <span class="s">state</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
    <span class="na">served</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">storage</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">status</span><span class="pi">:</span>
  <span class="na">acceptedNames</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">plural</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">conditions</span><span class="pi">:</span> <span class="pi">[]</span>
  <span class="na">storedVersions</span><span class="pi">:</span> <span class="pi">[]</span>

<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apiextensions.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CustomResourceDefinition</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">clusterinformations.crd.projectcalico.org</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">crd.projectcalico.org</span>
  <span class="na">names</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterInformation</span>
    <span class="na">listKind</span><span class="pi">:</span> <span class="s">ClusterInformationList</span>
    <span class="na">plural</span><span class="pi">:</span> <span class="s">clusterinformations</span>
    <span class="na">singular</span><span class="pi">:</span> <span class="s">clusterinformation</span>
  <span class="na">scope</span><span class="pi">:</span> <span class="s">Cluster</span>
  <span class="na">versions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">v1</span>
    <span class="na">schema</span><span class="pi">:</span>
      <span class="na">openAPIV3Schema</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s">ClusterInformation contains the cluster specific information.</span>
        <span class="na">properties</span><span class="pi">:</span>
          <span class="na">apiVersion</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">APIVersion</span><span class="nv"> </span><span class="s">defines</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">versioned</span><span class="nv"> </span><span class="s">schema</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">representation</span>
              <span class="s">of</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">object.</span><span class="nv"> </span><span class="s">Servers</span><span class="nv"> </span><span class="s">should</span><span class="nv"> </span><span class="s">convert</span><span class="nv"> </span><span class="s">recognized</span><span class="nv"> </span><span class="s">schemas</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">latest</span>
              <span class="s">internal</span><span class="nv"> </span><span class="s">value,</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">reject</span><span class="nv"> </span><span class="s">unrecognized</span><span class="nv"> </span><span class="s">values.</span><span class="nv"> </span><span class="s">More</span><span class="nv"> </span><span class="s">info:</span><span class="nv"> </span><span class="s">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">kind</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Kind</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">string</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">representing</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">REST</span><span class="nv"> </span><span class="s">resource</span><span class="nv"> </span><span class="s">this</span>
              <span class="s">object</span><span class="nv"> </span><span class="s">represents.</span><span class="nv"> </span><span class="s">Servers</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">infer</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">endpoint</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">client</span>
              <span class="s">submits</span><span class="nv"> </span><span class="s">requests</span><span class="nv"> </span><span class="s">to.</span><span class="nv"> </span><span class="s">Cannot</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">updated.</span><span class="nv"> </span><span class="s">In</span><span class="nv"> </span><span class="s">CamelCase.</span><span class="nv"> </span><span class="s">More</span><span class="nv"> </span><span class="s">info:</span><span class="nv"> </span><span class="s">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">metadata</span><span class="pi">:</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
          <span class="na">spec</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s">ClusterInformationSpec contains the values of describing</span>
              <span class="s">the cluster.</span>
            <span class="na">properties</span><span class="pi">:</span>
              <span class="na">calicoVersion</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">CalicoVersion is the version of Calico that the cluster</span>
                  <span class="s">is running</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">clusterGUID</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">ClusterGUID is the GUID of the cluster</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">clusterType</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">ClusterType describes the type of the cluster</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">datastoreReady</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">DatastoreReady is used during significant datastore migrations</span>
                  <span class="s">to signal to components such as Felix that it should wait before</span>
                  <span class="s">accessing the datastore.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">variant</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">Variant declares which variant of Calico should be active.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
    <span class="na">served</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">storage</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">status</span><span class="pi">:</span>
  <span class="na">acceptedNames</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">plural</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">conditions</span><span class="pi">:</span> <span class="pi">[]</span>
  <span class="na">storedVersions</span><span class="pi">:</span> <span class="pi">[]</span>

<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apiextensions.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CustomResourceDefinition</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">felixconfigurations.crd.projectcalico.org</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">crd.projectcalico.org</span>
  <span class="na">names</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">FelixConfiguration</span>
    <span class="na">listKind</span><span class="pi">:</span> <span class="s">FelixConfigurationList</span>
    <span class="na">plural</span><span class="pi">:</span> <span class="s">felixconfigurations</span>
    <span class="na">singular</span><span class="pi">:</span> <span class="s">felixconfiguration</span>
  <span class="na">scope</span><span class="pi">:</span> <span class="s">Cluster</span>
  <span class="na">versions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">v1</span>
    <span class="na">schema</span><span class="pi">:</span>
      <span class="na">openAPIV3Schema</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s">Felix Configuration contains the configuration for Felix.</span>
        <span class="na">properties</span><span class="pi">:</span>
          <span class="na">apiVersion</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">APIVersion</span><span class="nv"> </span><span class="s">defines</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">versioned</span><span class="nv"> </span><span class="s">schema</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">representation</span>
              <span class="s">of</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">object.</span><span class="nv"> </span><span class="s">Servers</span><span class="nv"> </span><span class="s">should</span><span class="nv"> </span><span class="s">convert</span><span class="nv"> </span><span class="s">recognized</span><span class="nv"> </span><span class="s">schemas</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">latest</span>
              <span class="s">internal</span><span class="nv"> </span><span class="s">value,</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">reject</span><span class="nv"> </span><span class="s">unrecognized</span><span class="nv"> </span><span class="s">values.</span><span class="nv"> </span><span class="s">More</span><span class="nv"> </span><span class="s">info:</span><span class="nv"> </span><span class="s">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">kind</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Kind</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">string</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">representing</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">REST</span><span class="nv"> </span><span class="s">resource</span><span class="nv"> </span><span class="s">this</span>
              <span class="s">object</span><span class="nv"> </span><span class="s">represents.</span><span class="nv"> </span><span class="s">Servers</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">infer</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">endpoint</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">client</span>
              <span class="s">submits</span><span class="nv"> </span><span class="s">requests</span><span class="nv"> </span><span class="s">to.</span><span class="nv"> </span><span class="s">Cannot</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">updated.</span><span class="nv"> </span><span class="s">In</span><span class="nv"> </span><span class="s">CamelCase.</span><span class="nv"> </span><span class="s">More</span><span class="nv"> </span><span class="s">info:</span><span class="nv"> </span><span class="s">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">metadata</span><span class="pi">:</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
          <span class="na">spec</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s">FelixConfigurationSpec contains the values of the Felix configuration.</span>
            <span class="na">properties</span><span class="pi">:</span>
              <span class="na">allowIPIPPacketsFromWorkloads</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">AllowIPIPPacketsFromWorkloads</span><span class="nv"> </span><span class="s">controls</span><span class="nv"> </span><span class="s">whether</span><span class="nv"> </span><span class="s">Felix</span>
                  <span class="s">will</span><span class="nv"> </span><span class="s">add</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">rule</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">drop</span><span class="nv"> </span><span class="s">IPIP</span><span class="nv"> </span><span class="s">encapsulated</span><span class="nv"> </span><span class="s">traffic</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">workloads</span>
                  <span class="s">[Default:</span><span class="nv"> </span><span class="s">false]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">allowVXLANPacketsFromWorkloads</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">AllowVXLANPacketsFromWorkloads</span><span class="nv"> </span><span class="s">controls</span><span class="nv"> </span><span class="s">whether</span><span class="nv"> </span><span class="s">Felix</span>
                  <span class="s">will</span><span class="nv"> </span><span class="s">add</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">rule</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">drop</span><span class="nv"> </span><span class="s">VXLAN</span><span class="nv"> </span><span class="s">encapsulated</span><span class="nv"> </span><span class="s">traffic</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">workloads</span>
                  <span class="s">[Default:</span><span class="nv"> </span><span class="s">false]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">awsSrcDstCheck</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Set</span><span class="nv"> </span><span class="s">source-destination-check</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">EC2</span><span class="nv"> </span><span class="s">instances.</span><span class="nv"> </span><span class="s">Accepted</span>
                  <span class="s">value</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">one</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">"DoNothing",</span><span class="nv"> </span><span class="s">"Enabled"</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">"Disabled".</span><span class="nv"> </span><span class="s">[Default:</span>
                  <span class="s">DoNothing]'</span>
                <span class="na">enum</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">DoNothing</span>
                <span class="pi">-</span> <span class="s">Enable</span>
                <span class="pi">-</span> <span class="s">Disable</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">bpfConnectTimeLoadBalancingEnabled</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">BPFConnectTimeLoadBalancingEnabled</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">BPF</span><span class="nv"> </span><span class="s">mode,</span>
                  <span class="s">controls</span><span class="nv"> </span><span class="s">whether</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">installs</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">connection-time</span><span class="nv"> </span><span class="s">load</span><span class="nv"> </span><span class="s">balancer.</span><span class="nv">  </span><span class="s">The</span>
                  <span class="s">connect-time</span><span class="nv"> </span><span class="s">load</span><span class="nv"> </span><span class="s">balancer</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">required</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">able</span><span class="nv"> </span><span class="s">to</span>
                  <span class="s">reach</span><span class="nv"> </span><span class="s">Kubernetes</span><span class="nv"> </span><span class="s">services</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">it</span><span class="nv"> </span><span class="s">improves</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">performance</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">pod-to-service</span>
                  <span class="s">connections.</span><span class="nv">  </span><span class="s">The</span><span class="nv"> </span><span class="s">only</span><span class="nv"> </span><span class="s">reason</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">disable</span><span class="nv"> </span><span class="s">it</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">debugging</span><span class="nv"> </span><span class="s">purposes.</span><span class="nv">  </span><span class="s">[Default:</span>
                  <span class="s">true]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">bpfDataIfacePattern</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">BPFDataIfacePattern is a regular expression that controls</span>
                  <span class="s">which interfaces Felix should attach BPF programs to in order to</span>
                  <span class="s">catch traffic to/from the network.  This needs to match the interfaces</span>
                  <span class="s">that Calico workload traffic flows over as well as any interfaces</span>
                  <span class="s">that handle incoming traffic to nodeports and services from outside</span>
                  <span class="s">the cluster.  It should not match the workload interfaces (usually</span>
                  <span class="s">named cali...).</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">bpfDisableUnprivileged</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">BPFDisableUnprivileged,</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">enabled,</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">sets</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">kernel.unprivileged_bpf_disabled</span>
                  <span class="s">sysctl</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">disable</span><span class="nv"> </span><span class="s">unprivileged</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">BPF.</span><span class="nv">  </span><span class="s">This</span><span class="nv"> </span><span class="s">ensures</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">unprivileged</span>
                  <span class="s">users</span><span class="nv"> </span><span class="s">cannot</span><span class="nv"> </span><span class="s">access</span><span class="nv"> </span><span class="s">Calico'</span><span class="s1">'</span><span class="s">s</span><span class="nv"> </span><span class="s">BPF</span><span class="nv"> </span><span class="s">maps</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">cannot</span><span class="nv"> </span><span class="s">insert</span><span class="nv"> </span><span class="s">their</span><span class="nv"> </span><span class="s">own</span>
                  <span class="s">BPF</span><span class="nv"> </span><span class="s">programs</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">interfere</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">Calico'</span><span class="s1">'</span><span class="s">s.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">true]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">bpfEnabled</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">BPFEnabled,</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">enabled</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">BPF</span><span class="nv"> </span><span class="s">dataplane.</span>
                  <span class="s">[Default:</span><span class="nv"> </span><span class="s">false]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">bpfExtToServiceConnmark</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">BPFExtToServiceConnmark</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">BPF</span><span class="nv"> </span><span class="s">mode,</span><span class="nv"> </span><span class="s">control</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">32bit</span>
                  <span class="s">mark</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">connections</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">external</span><span class="nv"> </span><span class="s">client</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">local</span>
                  <span class="s">service.</span><span class="nv"> </span><span class="s">This</span><span class="nv"> </span><span class="s">mark</span><span class="nv"> </span><span class="s">allows</span><span class="nv"> </span><span class="s">us</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">control</span><span class="nv"> </span><span class="s">how</span><span class="nv"> </span><span class="s">packets</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">connection</span>
                  <span class="s">are</span><span class="nv"> </span><span class="s">routed</span><span class="nv"> </span><span class="s">within</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">how</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">routing</span><span class="nv"> </span><span class="s">intepreted</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">RPF</span>
                  <span class="s">check.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">0]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">bpfExternalServiceMode</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">BPFExternalServiceMode</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">BPF</span><span class="nv"> </span><span class="s">mode,</span><span class="nv"> </span><span class="s">controls</span><span class="nv"> </span><span class="s">how</span><span class="nv"> </span><span class="s">connections</span>
                  <span class="s">from</span><span class="nv"> </span><span class="s">outside</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">cluster</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">services</span><span class="nv"> </span><span class="s">(node</span><span class="nv"> </span><span class="s">ports</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">cluster</span><span class="nv"> </span><span class="s">IPs)</span>
                  <span class="s">are</span><span class="nv"> </span><span class="s">forwarded</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">remote</span><span class="nv"> </span><span class="s">workloads.</span><span class="nv">  </span><span class="s">If</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">"Tunnel"</span><span class="nv"> </span><span class="s">then</span><span class="nv"> </span><span class="s">both</span>
                  <span class="s">request</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">response</span><span class="nv"> </span><span class="s">traffic</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">tunneled</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">remote</span><span class="nv"> </span><span class="s">node.</span><span class="nv">  </span><span class="s">If</span>
                  <span class="s">set</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">"DSR",</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">request</span><span class="nv"> </span><span class="s">traffic</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">tunneled</span><span class="nv"> </span><span class="s">but</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">response</span><span class="nv"> </span><span class="s">traffic</span>
                  <span class="s">is</span><span class="nv"> </span><span class="s">sent</span><span class="nv"> </span><span class="s">directly</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">remote</span><span class="nv"> </span><span class="s">node.</span><span class="nv">  </span><span class="s">In</span><span class="nv"> </span><span class="s">"DSR"</span><span class="nv"> </span><span class="s">mode,</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">remote</span>
                  <span class="s">node</span><span class="nv"> </span><span class="s">appears</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">ingress</span><span class="nv"> </span><span class="s">node;</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">requires</span><span class="nv"> </span><span class="s">a</span>
                  <span class="s">permissive</span><span class="nv"> </span><span class="s">L2</span><span class="nv"> </span><span class="s">network.</span><span class="nv">  </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">Tunnel]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">bpfKubeProxyEndpointSlicesEnabled</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">BPFKubeProxyEndpointSlicesEnabled in BPF mode, controls</span>
                  <span class="s">whether Felix's embedded kube-proxy accepts EndpointSlices or not.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">bpfKubeProxyIptablesCleanupEnabled</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">BPFKubeProxyIptablesCleanupEnabled,</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">enabled</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">BPF</span>
                  <span class="s">mode,</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">proactively</span><span class="nv"> </span><span class="s">clean</span><span class="nv"> </span><span class="s">up</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">upstream</span><span class="nv"> </span><span class="s">Kubernetes</span><span class="nv"> </span><span class="s">kube-proxy'</span><span class="s1">'</span><span class="s">s</span>
                  <span class="s">iptables</span><span class="nv"> </span><span class="s">chains.</span><span class="nv">  </span><span class="s">Should</span><span class="nv"> </span><span class="s">only</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">enabled</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">kube-proxy</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">running.</span><span class="nv">  </span><span class="s">[Default:</span>
                  <span class="s">true]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">bpfKubeProxyMinSyncPeriod</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">BPFKubeProxyMinSyncPeriod,</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">BPF</span><span class="nv"> </span><span class="s">mode,</span><span class="nv"> </span><span class="s">controls</span><span class="nv"> </span><span class="s">the</span>
                  <span class="s">minimum</span><span class="nv"> </span><span class="s">time</span><span class="nv"> </span><span class="s">between</span><span class="nv"> </span><span class="s">updates</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">dataplane</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">Felix'</span><span class="s1">'</span><span class="s">s</span><span class="nv"> </span><span class="s">embedded</span>
                  <span class="s">kube-proxy.</span><span class="nv">  </span><span class="s">Lower</span><span class="nv"> </span><span class="s">values</span><span class="nv"> </span><span class="s">give</span><span class="nv"> </span><span class="s">reduced</span><span class="nv"> </span><span class="s">set-up</span><span class="nv"> </span><span class="s">latency.</span><span class="nv">  </span><span class="s">Higher</span><span class="nv"> </span><span class="s">values</span>
                  <span class="s">reduce</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">CPU</span><span class="nv"> </span><span class="s">usage</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">batching</span><span class="nv"> </span><span class="s">up</span><span class="nv"> </span><span class="s">more</span><span class="nv"> </span><span class="s">work.</span><span class="nv">  </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">1s]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">bpfLogLevel</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">BPFLogLevel</span><span class="nv"> </span><span class="s">controls</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">log</span><span class="nv"> </span><span class="s">level</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">BPF</span><span class="nv"> </span><span class="s">programs</span>
                  <span class="s">when</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">BPF</span><span class="nv"> </span><span class="s">dataplane</span><span class="nv"> </span><span class="s">mode.</span><span class="nv">  </span><span class="s">One</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">"Off",</span><span class="nv"> </span><span class="s">"Info",</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">"Debug".</span><span class="nv">  </span><span class="s">The</span>
                  <span class="s">logs</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">emitted</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">BPF</span><span class="nv"> </span><span class="s">trace</span><span class="nv"> </span><span class="s">pipe,</span><span class="nv"> </span><span class="s">accessible</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">command</span>
                  <span class="s">`tc</span><span class="nv"> </span><span class="s">exec</span><span class="nv"> </span><span class="s">bpf</span><span class="nv"> </span><span class="s">debug`.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">Off].'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">chainInsertMode</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ChainInsertMode</span><span class="nv"> </span><span class="s">controls</span><span class="nv"> </span><span class="s">whether</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">hooks</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">kernel'</span><span class="s1">'</span><span class="s">s</span>
                  <span class="s">top-level</span><span class="nv"> </span><span class="s">iptables</span><span class="nv"> </span><span class="s">chains</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">inserting</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">rule</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">top</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span>
                  <span class="s">chain</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">appending</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">rule</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">bottom.</span><span class="nv"> </span><span class="s">insert</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">safe</span><span class="nv"> </span><span class="s">default</span>
                  <span class="s">since</span><span class="nv"> </span><span class="s">it</span><span class="nv"> </span><span class="s">prevents</span><span class="nv"> </span><span class="s">Calico'</span><span class="s1">'</span><span class="s">s</span><span class="nv"> </span><span class="s">rules</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">being</span><span class="nv"> </span><span class="s">bypassed.</span><span class="nv"> </span><span class="s">If</span><span class="nv"> </span><span class="s">you</span><span class="nv"> </span><span class="s">switch</span>
                  <span class="s">to</span><span class="nv"> </span><span class="s">append</span><span class="nv"> </span><span class="s">mode,</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">sure</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">rules</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">chains</span><span class="nv"> </span><span class="s">signal</span>
                  <span class="s">acceptance</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">falling</span><span class="nv"> </span><span class="s">through</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Calico</span><span class="nv"> </span><span class="s">rules,</span><span class="nv"> </span><span class="s">otherwise</span><span class="nv"> </span><span class="s">the</span>
                  <span class="s">Calico</span><span class="nv"> </span><span class="s">policy</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">bypassed.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">insert]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">dataplaneDriver</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">debugDisableLogDropping</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">debugMemoryProfilePath</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">debugSimulateCalcGraphHangAfter</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">debugSimulateDataplaneHangAfter</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">defaultEndpointToHostAction</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">DefaultEndpointToHostAction</span><span class="nv"> </span><span class="s">controls</span><span class="nv"> </span><span class="s">what</span><span class="nv"> </span><span class="s">happens</span><span class="nv"> </span><span class="s">to</span>
                  <span class="s">traffic</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">goes</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">workload</span><span class="nv"> </span><span class="s">endpoint</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">itself</span><span class="nv"> </span><span class="s">(after</span>
                  <span class="s">the</span><span class="nv"> </span><span class="s">traffic</span><span class="nv"> </span><span class="s">hits</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">endpoint</span><span class="nv"> </span><span class="s">egress</span><span class="nv"> </span><span class="s">policy).</span><span class="nv"> </span><span class="s">By</span><span class="nv"> </span><span class="s">default</span><span class="nv"> </span><span class="s">Calico</span>
                  <span class="s">blocks</span><span class="nv"> </span><span class="s">traffic</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">workload</span><span class="nv"> </span><span class="s">endpoints</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">itself</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">an</span>
                  <span class="s">iptables</span><span class="nv"> </span><span class="s">"DROP"</span><span class="nv"> </span><span class="s">action.</span><span class="nv"> </span><span class="s">If</span><span class="nv"> </span><span class="s">you</span><span class="nv"> </span><span class="s">want</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">allow</span><span class="nv"> </span><span class="s">some</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">all</span><span class="nv"> </span><span class="s">traffic</span>
                  <span class="s">from</span><span class="nv"> </span><span class="s">endpoint</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">host,</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">parameter</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">RETURN</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">ACCEPT.</span><span class="nv"> </span><span class="s">Use</span>
                  <span class="s">RETURN</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">you</span><span class="nv"> </span><span class="s">have</span><span class="nv"> </span><span class="s">your</span><span class="nv"> </span><span class="s">own</span><span class="nv"> </span><span class="s">rules</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">iptables</span><span class="nv"> </span><span class="s">"INPUT"</span><span class="nv"> </span><span class="s">chain;</span>
                  <span class="s">Calico</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">insert</span><span class="nv"> </span><span class="s">its</span><span class="nv"> </span><span class="s">rules</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">top</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">chain,</span><span class="nv"> </span><span class="s">then</span><span class="nv"> </span><span class="s">"RETURN"</span>
                  <span class="s">packets</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">"INPUT"</span><span class="nv"> </span><span class="s">chain</span><span class="nv"> </span><span class="s">once</span><span class="nv"> </span><span class="s">it</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">completed</span><span class="nv"> </span><span class="s">processing</span><span class="nv"> </span><span class="s">workload</span>
                  <span class="s">endpoint</span><span class="nv"> </span><span class="s">egress</span><span class="nv"> </span><span class="s">policy.</span><span class="nv"> </span><span class="s">Use</span><span class="nv"> </span><span class="s">ACCEPT</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">unconditionally</span><span class="nv"> </span><span class="s">accept</span><span class="nv"> </span><span class="s">packets</span>
                  <span class="s">from</span><span class="nv"> </span><span class="s">workloads</span><span class="nv"> </span><span class="s">after</span><span class="nv"> </span><span class="s">processing</span><span class="nv"> </span><span class="s">workload</span><span class="nv"> </span><span class="s">endpoint</span><span class="nv"> </span><span class="s">egress</span><span class="nv"> </span><span class="s">policy.</span>
                  <span class="s">[Default:</span><span class="nv"> </span><span class="s">Drop]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">deviceRouteProtocol</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">This defines the route protocol added to programmed device</span>
                  <span class="s">routes, by default this will be RTPROT_BOOT when left blank.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">deviceRouteSourceAddress</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">This is the source address to use on programmed device</span>
                  <span class="s">routes. By default the source address is left blank, leaving the</span>
                  <span class="s">kernel to choose the source address used.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">disableConntrackInvalidCheck</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">endpointReportingDelay</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">endpointReportingEnabled</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">externalNodesList</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">ExternalNodesCIDRList is a list of CIDR's of external-non-calico-nodes</span>
                  <span class="s">which may source tunnel traffic and have the tunneled traffic be</span>
                  <span class="s">accepted at calico nodes.</span>
                <span class="na">items</span><span class="pi">:</span>
                  <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
              <span class="na">failsafeInboundHostPorts</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">FailsafeInboundHostPorts</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">UDP/TCP</span><span class="nv"> </span><span class="s">ports</span>
                  <span class="s">and</span><span class="nv"> </span><span class="s">CIDRs</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">allow</span><span class="nv"> </span><span class="s">incoming</span><span class="nv"> </span><span class="s">traffic</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">endpoints</span>
                  <span class="s">on</span><span class="nv"> </span><span class="s">irrespective</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">security</span><span class="nv"> </span><span class="s">policy.</span><span class="nv"> </span><span class="s">This</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">useful</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">avoid</span>
                  <span class="s">accidentally</span><span class="nv"> </span><span class="s">cutting</span><span class="nv"> </span><span class="s">off</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">incorrect</span><span class="nv"> </span><span class="s">configuration.</span><span class="nv"> </span><span class="s">For</span>
                  <span class="s">back-compatibility,</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">protocol</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">specified,</span><span class="nv"> </span><span class="s">it</span><span class="nv"> </span><span class="s">defaults</span>
                  <span class="s">to</span><span class="nv"> </span><span class="s">"tcp".</span><span class="nv"> </span><span class="s">If</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">CIDR</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">specified,</span><span class="nv"> </span><span class="s">it</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">allow</span><span class="nv"> </span><span class="s">traffic</span><span class="nv"> </span><span class="s">from</span>
                  <span class="s">all</span><span class="nv"> </span><span class="s">addresses.</span><span class="nv"> </span><span class="s">To</span><span class="nv"> </span><span class="s">disable</span><span class="nv"> </span><span class="s">all</span><span class="nv"> </span><span class="s">inbound</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">ports,</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">value</span>
                  <span class="s">none.</span><span class="nv"> </span><span class="s">The</span><span class="nv"> </span><span class="s">default</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">allows</span><span class="nv"> </span><span class="s">ssh</span><span class="nv"> </span><span class="s">access</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">DHCP.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">tcp:22,</span>
                  <span class="s">udp:68,</span><span class="nv"> </span><span class="s">tcp:179,</span><span class="nv"> </span><span class="s">tcp:2379,</span><span class="nv"> </span><span class="s">tcp:2380,</span><span class="nv"> </span><span class="s">tcp:6443,</span><span class="nv"> </span><span class="s">tcp:6666,</span><span class="nv"> </span><span class="s">tcp:6667]'</span>
                <span class="na">items</span><span class="pi">:</span>
                  <span class="na">description</span><span class="pi">:</span> <span class="s">ProtoPort is combination of protocol, port, and CIDR.</span>
                    <span class="s">Protocol and port must be specified.</span>
                  <span class="na">properties</span><span class="pi">:</span>
                    <span class="na">net</span><span class="pi">:</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                    <span class="na">port</span><span class="pi">:</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
                    <span class="na">protocol</span><span class="pi">:</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                  <span class="na">required</span><span class="pi">:</span>
                  <span class="pi">-</span> <span class="s">port</span>
                  <span class="pi">-</span> <span class="s">protocol</span>
                  <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
              <span class="na">failsafeOutboundHostPorts</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">FailsafeOutboundHostPorts</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">UDP/TCP</span><span class="nv"> </span><span class="s">ports</span>
                  <span class="s">and</span><span class="nv"> </span><span class="s">CIDRs</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">allow</span><span class="nv"> </span><span class="s">outgoing</span><span class="nv"> </span><span class="s">traffic</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">endpoints</span>
                  <span class="s">to</span><span class="nv"> </span><span class="s">irrespective</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">security</span><span class="nv"> </span><span class="s">policy.</span><span class="nv"> </span><span class="s">This</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">useful</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">avoid</span>
                  <span class="s">accidentally</span><span class="nv"> </span><span class="s">cutting</span><span class="nv"> </span><span class="s">off</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">incorrect</span><span class="nv"> </span><span class="s">configuration.</span><span class="nv"> </span><span class="s">For</span>
                  <span class="s">back-compatibility,</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">protocol</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">specified,</span><span class="nv"> </span><span class="s">it</span><span class="nv"> </span><span class="s">defaults</span>
                  <span class="s">to</span><span class="nv"> </span><span class="s">"tcp".</span><span class="nv"> </span><span class="s">If</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">CIDR</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">specified,</span><span class="nv"> </span><span class="s">it</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">allow</span><span class="nv"> </span><span class="s">traffic</span><span class="nv"> </span><span class="s">from</span>
                  <span class="s">all</span><span class="nv"> </span><span class="s">addresses.</span><span class="nv"> </span><span class="s">To</span><span class="nv"> </span><span class="s">disable</span><span class="nv"> </span><span class="s">all</span><span class="nv"> </span><span class="s">outbound</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">ports,</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">value</span>
                  <span class="s">none.</span><span class="nv"> </span><span class="s">The</span><span class="nv"> </span><span class="s">default</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">opens</span><span class="nv"> </span><span class="s">etcd'</span><span class="s1">'</span><span class="s">s</span><span class="nv"> </span><span class="s">standard</span><span class="nv"> </span><span class="s">ports</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">ensure</span><span class="nv"> </span><span class="s">that</span>
                  <span class="s">Felix</span><span class="nv"> </span><span class="s">does</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">get</span><span class="nv"> </span><span class="s">cut</span><span class="nv"> </span><span class="s">off</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">etcd</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">well</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">allowing</span><span class="nv"> </span><span class="s">DHCP</span><span class="nv"> </span><span class="s">and</span>
                  <span class="s">DNS.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">tcp:179,</span><span class="nv"> </span><span class="s">tcp:2379,</span><span class="nv"> </span><span class="s">tcp:2380,</span><span class="nv"> </span><span class="s">tcp:6443,</span><span class="nv"> </span><span class="s">tcp:6666,</span>
                  <span class="s">tcp:6667,</span><span class="nv"> </span><span class="s">udp:53,</span><span class="nv"> </span><span class="s">udp:67]'</span>
                <span class="na">items</span><span class="pi">:</span>
                  <span class="na">description</span><span class="pi">:</span> <span class="s">ProtoPort is combination of protocol, port, and CIDR.</span>
                    <span class="s">Protocol and port must be specified.</span>
                  <span class="na">properties</span><span class="pi">:</span>
                    <span class="na">net</span><span class="pi">:</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                    <span class="na">port</span><span class="pi">:</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
                    <span class="na">protocol</span><span class="pi">:</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                  <span class="na">required</span><span class="pi">:</span>
                  <span class="pi">-</span> <span class="s">port</span>
                  <span class="pi">-</span> <span class="s">protocol</span>
                  <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
              <span class="na">featureDetectOverride</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">FeatureDetectOverride is used to override the feature</span>
                  <span class="s">detection. Values are specified in a comma separated list with no</span>
                  <span class="s">spaces, example; "SNATFullyRandom=true,MASQFullyRandom=false,RestoreSupportsLock=".</span>
                  <span class="s">"true" or "false" will force the feature, empty or omitted values</span>
                  <span class="s">are auto-detected.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">genericXDPEnabled</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">GenericXDPEnabled</span><span class="nv"> </span><span class="s">enables</span><span class="nv"> </span><span class="s">Generic</span><span class="nv"> </span><span class="s">XDP</span><span class="nv"> </span><span class="s">so</span><span class="nv"> </span><span class="s">network</span><span class="nv"> </span><span class="s">cards</span>
                  <span class="s">that</span><span class="nv"> </span><span class="s">don'</span><span class="s1">'</span><span class="s">t</span><span class="nv"> </span><span class="s">support</span><span class="nv"> </span><span class="s">XDP</span><span class="nv"> </span><span class="s">offload</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">driver</span><span class="nv"> </span><span class="s">modes</span><span class="nv"> </span><span class="s">can</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">XDP.</span><span class="nv"> </span><span class="s">This</span>
                  <span class="s">is</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">recommended</span><span class="nv"> </span><span class="s">since</span><span class="nv"> </span><span class="s">it</span><span class="nv"> </span><span class="s">doesn'</span><span class="s1">'</span><span class="s">t</span><span class="nv"> </span><span class="s">provide</span><span class="nv"> </span><span class="s">better</span><span class="nv"> </span><span class="s">performance</span>
                  <span class="s">than</span><span class="nv"> </span><span class="s">iptables.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">false]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">healthEnabled</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">healthHost</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">healthPort</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">interfaceExclude</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">InterfaceExclude</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">comma-separated</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">interfaces</span>
                  <span class="s">that</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">should</span><span class="nv"> </span><span class="s">exclude</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">monitoring</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">endpoints.</span><span class="nv"> </span><span class="s">The</span>
                  <span class="s">default</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">ensures</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">ignores</span><span class="nv"> </span><span class="s">Kubernetes'</span><span class="s1">'</span><span class="nv"> </span><span class="s">IPVS</span><span class="nv"> </span><span class="s">dummy</span>
                  <span class="s">interface,</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">used</span><span class="nv"> </span><span class="s">internally</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">kube-proxy.</span><span class="nv"> </span><span class="s">If</span><span class="nv"> </span><span class="s">you</span><span class="nv"> </span><span class="s">want</span><span class="nv"> </span><span class="s">to</span>
                  <span class="s">exclude</span><span class="nv"> </span><span class="s">multiple</span><span class="nv"> </span><span class="s">interface</span><span class="nv"> </span><span class="s">names</span><span class="nv"> </span><span class="s">using</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">single</span><span class="nv"> </span><span class="s">value,</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">list</span>
                  <span class="s">supports</span><span class="nv"> </span><span class="s">regular</span><span class="nv"> </span><span class="s">expressions.</span><span class="nv"> </span><span class="s">For</span><span class="nv"> </span><span class="s">regular</span><span class="nv"> </span><span class="s">expressions</span><span class="nv"> </span><span class="s">you</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">wrap</span>
                  <span class="s">the</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">'</span><span class="s1">'</span><span class="s">/'</span><span class="s1">'</span><span class="s">.</span><span class="nv"> </span><span class="s">For</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">having</span><span class="nv"> </span><span class="s">values</span><span class="nv"> </span><span class="s">'</span><span class="s1">'</span><span class="s">/^kube/,veth1'</span><span class="s1">'</span>
                  <span class="s">will</span><span class="nv"> </span><span class="s">exclude</span><span class="nv"> </span><span class="s">all</span><span class="nv"> </span><span class="s">interfaces</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">begin</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">'</span><span class="s1">'</span><span class="s">kube'</span><span class="s1">'</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">also</span><span class="nv"> </span><span class="s">the</span>
                  <span class="s">interface</span><span class="nv"> </span><span class="s">'</span><span class="s1">'</span><span class="s">veth1'</span><span class="s1">'</span><span class="s">.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">kube-ipvs0]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">interfacePrefix</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">InterfacePrefix</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">interface</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">prefix</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">identifies</span>
                  <span class="s">workload</span><span class="nv"> </span><span class="s">endpoints</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">so</span><span class="nv"> </span><span class="s">distinguishes</span><span class="nv"> </span><span class="s">them</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">endpoint</span>
                  <span class="s">interfaces.</span><span class="nv"> </span><span class="s">Note:</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">environments</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">than</span><span class="nv"> </span><span class="s">bare</span><span class="nv"> </span><span class="s">metal,</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">orchestrators</span>
                  <span class="s">configure</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">appropriately.</span><span class="nv"> </span><span class="s">For</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">our</span><span class="nv"> </span><span class="s">Kubernetes</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">Docker</span>
                  <span class="s">integrations</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">'</span><span class="s1">'</span><span class="s">cali'</span><span class="s1">'</span><span class="nv"> </span><span class="s">value,</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">our</span><span class="nv"> </span><span class="s">OpenStack</span><span class="nv"> </span><span class="s">integration</span>
                  <span class="s">sets</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">'</span><span class="s1">'</span><span class="s">tap'</span><span class="s1">'</span><span class="nv"> </span><span class="s">value.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">cali]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">interfaceRefreshInterval</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">InterfaceRefreshInterval is the period at which Felix</span>
                  <span class="s">rescans local interfaces to verify their state. The rescan can be</span>
                  <span class="s">disabled by setting the interval to 0.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">ipipEnabled</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">ipipMTU</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">IPIPMTU</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">MTU</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">tunnel</span><span class="nv"> </span><span class="s">device.</span><span class="nv"> </span><span class="s">See</span>
                  <span class="s">Configuring</span><span class="nv"> </span><span class="s">MTU</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">1440]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">ipsetsRefreshInterval</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">IpsetsRefreshInterval</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">period</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">re-checks</span>
                  <span class="s">all</span><span class="nv"> </span><span class="s">iptables</span><span class="nv"> </span><span class="s">state</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">ensure</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">no</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">process</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">accidentally</span>
                  <span class="s">broken</span><span class="nv"> </span><span class="s">Calico'</span><span class="s1">'</span><span class="s">s</span><span class="nv"> </span><span class="s">rules.</span><span class="nv"> </span><span class="s">Set</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">disable</span><span class="nv"> </span><span class="s">iptables</span><span class="nv"> </span><span class="s">refresh.</span><span class="nv"> </span><span class="s">[Default:</span>
                  <span class="s">90s]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">iptablesBackend</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">IptablesBackend specifies which backend of iptables will</span>
                  <span class="s">be used. The default is legacy.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">iptablesFilterAllowAction</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">iptablesLockFilePath</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">IptablesLockFilePath</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">location</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">iptables</span>
                  <span class="s">lock</span><span class="nv"> </span><span class="s">file.</span><span class="nv"> </span><span class="s">You</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">need</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">change</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">lock</span><span class="nv"> </span><span class="s">file</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">in</span>
                  <span class="s">its</span><span class="nv"> </span><span class="s">standard</span><span class="nv"> </span><span class="s">location</span><span class="nv"> </span><span class="s">(for</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">you</span><span class="nv"> </span><span class="s">have</span><span class="nv"> </span><span class="s">mapped</span><span class="nv"> </span><span class="s">it</span><span class="nv"> </span><span class="s">into</span><span class="nv"> </span><span class="s">Felix'</span><span class="s1">'</span><span class="s">s</span>
                  <span class="s">container</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">different</span><span class="nv"> </span><span class="s">path).</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">/run/xtables.lock]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">iptablesLockProbeInterval</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">IptablesLockProbeInterval</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">time</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">will</span>
                  <span class="s">wait</span><span class="nv"> </span><span class="s">between</span><span class="nv"> </span><span class="s">attempts</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">acquire</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">iptables</span><span class="nv"> </span><span class="s">lock</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">it</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">not</span>
                  <span class="s">available.</span><span class="nv"> </span><span class="s">Lower</span><span class="nv"> </span><span class="s">values</span><span class="nv"> </span><span class="s">make</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">more</span><span class="nv"> </span><span class="s">responsive</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">lock</span>
                  <span class="s">is</span><span class="nv"> </span><span class="s">contended,</span><span class="nv"> </span><span class="s">but</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">more</span><span class="nv"> </span><span class="s">CPU.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">50ms]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">iptablesLockTimeout</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">IptablesLockTimeout</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">time</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">wait</span>
                  <span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">iptables</span><span class="nv"> </span><span class="s">lock,</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">0,</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">disable.</span><span class="nv"> </span><span class="s">To</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">feature,</span><span class="nv"> </span><span class="s">Felix</span>
                  <span class="s">must</span><span class="nv"> </span><span class="s">share</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">iptables</span><span class="nv"> </span><span class="s">lock</span><span class="nv"> </span><span class="s">file</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">all</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">processes</span><span class="nv"> </span><span class="s">that</span>
                  <span class="s">also</span><span class="nv"> </span><span class="s">take</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">lock.</span><span class="nv"> </span><span class="s">When</span><span class="nv"> </span><span class="s">running</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">inside</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">container,</span><span class="nv"> </span><span class="s">this</span>
                  <span class="s">requires</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">/run</span><span class="nv"> </span><span class="s">directory</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">mounted</span><span class="nv"> </span><span class="s">into</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">calico/node</span>
                  <span class="s">or</span><span class="nv"> </span><span class="s">calico/felix</span><span class="nv"> </span><span class="s">container.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">0s</span><span class="nv"> </span><span class="s">disabled]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">iptablesMangleAllowAction</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">iptablesMarkMask</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">IptablesMarkMask</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">mask</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">selects</span><span class="nv"> </span><span class="s">its</span>
                  <span class="s">IPTables</span><span class="nv"> </span><span class="s">Mark</span><span class="nv"> </span><span class="s">bits</span><span class="nv"> </span><span class="s">from.</span><span class="nv"> </span><span class="s">Should</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">32</span><span class="nv"> </span><span class="s">bit</span><span class="nv"> </span><span class="s">hexadecimal</span><span class="nv"> </span><span class="s">number</span><span class="nv"> </span><span class="s">with</span>
                  <span class="s">at</span><span class="nv"> </span><span class="s">least</span><span class="nv"> </span><span class="s">8</span><span class="nv"> </span><span class="s">bits</span><span class="nv"> </span><span class="s">set,</span><span class="nv"> </span><span class="s">none</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">clash</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">any</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">mark</span><span class="nv"> </span><span class="s">bits</span>
                  <span class="s">in</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">system.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">0xff000000]'</span>
                <span class="na">format</span><span class="pi">:</span> <span class="s">int32</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">iptablesNATOutgoingInterfaceFilter</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">iptablesPostWriteCheckInterval</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">IptablesPostWriteCheckInterval</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">period</span><span class="nv"> </span><span class="s">after</span><span class="nv"> </span><span class="s">Felix</span>
                  <span class="s">has</span><span class="nv"> </span><span class="s">done</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">write</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">dataplane</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">it</span><span class="nv"> </span><span class="s">schedules</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">extra</span><span class="nv"> </span><span class="s">read</span>
                  <span class="s">back</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">order</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">check</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">write</span><span class="nv"> </span><span class="s">was</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">clobbered</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">another</span><span class="nv"> </span><span class="s">process.</span>
                  <span class="s">This</span><span class="nv"> </span><span class="s">should</span><span class="nv"> </span><span class="s">only</span><span class="nv"> </span><span class="s">occur</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">another</span><span class="nv"> </span><span class="s">application</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">system</span><span class="nv"> </span><span class="s">doesn'</span><span class="s1">'</span><span class="s">t</span>
                  <span class="s">respect</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">iptables</span><span class="nv"> </span><span class="s">lock.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">1s]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">iptablesRefreshInterval</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">IptablesRefreshInterval</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">period</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">Felix</span>
                  <span class="s">re-checks</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">sets</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">dataplane</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">ensure</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">no</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">process</span>
                  <span class="s">has</span><span class="nv"> </span><span class="s">accidentally</span><span class="nv"> </span><span class="s">broken</span><span class="nv"> </span><span class="s">Calico'</span><span class="s1">'</span><span class="s">s</span><span class="nv"> </span><span class="s">rules.</span><span class="nv"> </span><span class="s">Set</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">disable</span><span class="nv"> </span><span class="s">IP</span>
                  <span class="s">sets</span><span class="nv"> </span><span class="s">refresh.</span><span class="nv"> </span><span class="s">Note:</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">default</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">lower</span><span class="nv"> </span><span class="s">than</span><span class="nv"> </span><span class="s">the</span>
                  <span class="s">other</span><span class="nv"> </span><span class="s">refresh</span><span class="nv"> </span><span class="s">intervals</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">workaround</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">Linux</span><span class="nv"> </span><span class="s">kernel</span><span class="nv"> </span><span class="s">bug</span><span class="nv"> </span><span class="s">that</span>
                  <span class="s">was</span><span class="nv"> </span><span class="s">fixed</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">kernel</span><span class="nv"> </span><span class="s">version</span><span class="nv"> </span><span class="s">4.11.</span><span class="nv"> </span><span class="s">If</span><span class="nv"> </span><span class="s">you</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">using</span><span class="nv"> </span><span class="s">v4.11</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">greater</span>
                  <span class="s">you</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">want</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">to,</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">higher</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">reduce</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">CPU</span>
                  <span class="s">usage.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">10s]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">ipv6Support</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">kubeNodePortRanges</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">KubeNodePortRanges</span><span class="nv"> </span><span class="s">holds</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">port</span><span class="nv"> </span><span class="s">ranges</span><span class="nv"> </span><span class="s">used</span><span class="nv"> </span><span class="s">for</span>
                  <span class="s">service</span><span class="nv"> </span><span class="s">node</span><span class="nv"> </span><span class="s">ports.</span><span class="nv"> </span><span class="s">Only</span><span class="nv"> </span><span class="s">used</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">felix</span><span class="nv"> </span><span class="s">detects</span><span class="nv"> </span><span class="s">kube-proxy</span><span class="nv"> </span><span class="s">running</span>
                  <span class="s">in</span><span class="nv"> </span><span class="s">ipvs</span><span class="nv"> </span><span class="s">mode.</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">uses</span><span class="nv"> </span><span class="s">these</span><span class="nv"> </span><span class="s">ranges</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">separate</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">workload</span>
                  <span class="s">traffic.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">30000:32767].'</span>
                <span class="na">items</span><span class="pi">:</span>
                  <span class="na">anyOf</span><span class="pi">:</span>
                  <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
                  <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                  <span class="na">pattern</span><span class="pi">:</span> <span class="s">^.*</span>
                  <span class="na">x-kubernetes-int-or-string</span><span class="pi">:</span> <span class="no">true</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
              <span class="na">logFilePath</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">LogFilePath</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">full</span><span class="nv"> </span><span class="s">path</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">log.</span><span class="nv"> </span><span class="s">Set</span><span class="nv"> </span><span class="s">to</span>
                  <span class="s">none</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">disable</span><span class="nv"> </span><span class="s">file</span><span class="nv"> </span><span class="s">logging.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">/var/log/calico/felix.log]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">logPrefix</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">LogPrefix</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">log</span><span class="nv"> </span><span class="s">prefix</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">uses</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">rendering</span>
                  <span class="s">LOG</span><span class="nv"> </span><span class="s">rules.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">calico-packet]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">logSeverityFile</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">LogSeverityFile</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">log</span><span class="nv"> </span><span class="s">severity</span><span class="nv"> </span><span class="s">above</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">logs</span>
                  <span class="s">are</span><span class="nv"> </span><span class="s">sent</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">log</span><span class="nv"> </span><span class="s">file.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">Info]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">logSeverityScreen</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">LogSeverityScreen</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">log</span><span class="nv"> </span><span class="s">severity</span><span class="nv"> </span><span class="s">above</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">logs</span>
                  <span class="s">are</span><span class="nv"> </span><span class="s">sent</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">stdout.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">Info]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">logSeveritySys</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">LogSeveritySys</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">log</span><span class="nv"> </span><span class="s">severity</span><span class="nv"> </span><span class="s">above</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">logs</span>
                  <span class="s">are</span><span class="nv"> </span><span class="s">sent</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">syslog.</span><span class="nv"> </span><span class="s">Set</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">None</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">no</span><span class="nv"> </span><span class="s">logging</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">syslog.</span><span class="nv"> </span><span class="s">[Default:</span>
                  <span class="s">Info]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">maxIpsetSize</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">metadataAddr</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">MetadataAddr</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">address</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">domain</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span>
                  <span class="s">server</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">can</span><span class="nv"> </span><span class="s">answer</span><span class="nv"> </span><span class="s">VM</span><span class="nv"> </span><span class="s">queries</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">cloud-init</span><span class="nv"> </span><span class="s">metadata.</span><span class="nv"> </span><span class="s">In</span><span class="nv"> </span><span class="s">OpenStack,</span>
                  <span class="s">this</span><span class="nv"> </span><span class="s">corresponds</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">machine</span><span class="nv"> </span><span class="s">running</span><span class="nv"> </span><span class="s">nova-api</span><span class="nv"> </span><span class="s">(or</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">Ubuntu,</span>
                  <span class="s">nova-api-metadata).</span><span class="nv"> </span><span class="s">A</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">none</span><span class="nv"> </span><span class="s">(case</span><span class="nv"> </span><span class="s">insensitive)</span><span class="nv"> </span><span class="s">means</span><span class="nv"> </span><span class="s">that</span>
                  <span class="s">Felix</span><span class="nv"> </span><span class="s">should</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">up</span><span class="nv"> </span><span class="s">any</span><span class="nv"> </span><span class="s">NAT</span><span class="nv"> </span><span class="s">rule</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">metadata</span><span class="nv"> </span><span class="s">path.</span><span class="nv"> </span><span class="s">[Default:</span>
                  <span class="s">127.0.0.1]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">metadataPort</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">MetadataPort</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">port</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">metadata</span><span class="nv"> </span><span class="s">server.</span><span class="nv"> </span><span class="s">This,</span>
                  <span class="s">combined</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">global.MetadataAddr</span><span class="nv"> </span><span class="s">(if</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">'</span><span class="s1">'</span><span class="s">None'</span><span class="s1">'</span><span class="s">),</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">used</span><span class="nv"> </span><span class="s">to</span>
                  <span class="s">set</span><span class="nv"> </span><span class="s">up</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">NAT</span><span class="nv"> </span><span class="s">rule,</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">169.254.169.254:80</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">MetadataAddr:MetadataPort.</span>
                  <span class="s">In</span><span class="nv"> </span><span class="s">most</span><span class="nv"> </span><span class="s">cases</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">should</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">need</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">changed</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">8775].'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">mtuIfacePattern</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">MTUIfacePattern is a regular expression that controls</span>
                  <span class="s">which interfaces Felix should scan in order to calculate the host's</span>
                  <span class="s">MTU. This should not match workload interfaces (usually named cali...).</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">natOutgoingAddress</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">NATOutgoingAddress specifies an address to use when performing</span>
                  <span class="s">source NAT for traffic in a natOutgoing pool that is leaving the</span>
                  <span class="s">network. By default the address used is an address on the interface</span>
                  <span class="s">the traffic is leaving on (ie it uses the iptables MASQUERADE target)</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">natPortRange</span><span class="pi">:</span>
                <span class="na">anyOf</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
                <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">NATPortRange specifies the range of ports that is used</span>
                  <span class="s">for port mapping when doing outgoing NAT. When unset the default</span>
                  <span class="s">behavior of the network stack is used.</span>
                <span class="na">pattern</span><span class="pi">:</span> <span class="s">^.*</span>
                <span class="na">x-kubernetes-int-or-string</span><span class="pi">:</span> <span class="no">true</span>
              <span class="na">netlinkTimeout</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">openstackRegion</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">OpenstackRegion</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">region</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">particular</span>
                  <span class="s">Felix</span><span class="nv"> </span><span class="s">belongs</span><span class="nv"> </span><span class="s">to.</span><span class="nv"> </span><span class="s">In</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">multi-region</span><span class="nv"> </span><span class="s">Calico/OpenStack</span><span class="nv"> </span><span class="s">deployment,</span>
                  <span class="s">this</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">configured</span><span class="nv"> </span><span class="s">somehow</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">each</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">(here</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">datamodel,</span>
                  <span class="s">or</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">felix.cfg</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">environment</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">each</span><span class="nv"> </span><span class="s">compute</span><span class="nv"> </span><span class="s">node),</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">must</span>
                  <span class="s">match</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">[calico]</span><span class="nv"> </span><span class="s">openstack_region</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">configured</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">neutron.conf</span>
                  <span class="s">on</span><span class="nv"> </span><span class="s">each</span><span class="nv"> </span><span class="s">node.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">Empty]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">policySyncPathPrefix</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">PolicySyncPathPrefix</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">used</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">communicate</span>
                  <span class="s">policy</span><span class="nv"> </span><span class="s">changes</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">external</span><span class="nv"> </span><span class="s">services,</span><span class="nv"> </span><span class="s">like</span><span class="nv"> </span><span class="s">Application</span><span class="nv"> </span><span class="s">layer</span><span class="nv"> </span><span class="s">policy.</span>
                  <span class="s">[Default:</span><span class="nv"> </span><span class="s">Empty]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">prometheusGoMetricsEnabled</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">PrometheusGoMetricsEnabled</span><span class="nv"> </span><span class="s">disables</span><span class="nv"> </span><span class="s">Go</span><span class="nv"> </span><span class="s">runtime</span><span class="nv"> </span><span class="s">metrics</span>
                  <span class="s">collection,</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Prometheus</span><span class="nv"> </span><span class="s">client</span><span class="nv"> </span><span class="s">does</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">default,</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">set</span>
                  <span class="s">to</span><span class="nv"> </span><span class="s">false.</span><span class="nv"> </span><span class="s">This</span><span class="nv"> </span><span class="s">reduces</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">number</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">metrics</span><span class="nv"> </span><span class="s">reported,</span><span class="nv"> </span><span class="s">reducing</span>
                  <span class="s">Prometheus</span><span class="nv"> </span><span class="s">load.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">true]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">prometheusMetricsEnabled</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">PrometheusMetricsEnabled</span><span class="nv"> </span><span class="s">enables</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Prometheus</span><span class="nv"> </span><span class="s">metrics</span>
                  <span class="s">server</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">true.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">false]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">prometheusMetricsHost</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">PrometheusMetricsHost</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">host</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Prometheus</span>
                  <span class="s">metrics</span><span class="nv"> </span><span class="s">server</span><span class="nv"> </span><span class="s">should</span><span class="nv"> </span><span class="s">bind</span><span class="nv"> </span><span class="s">to.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">empty]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">prometheusMetricsPort</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">PrometheusMetricsPort</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">TCP</span><span class="nv"> </span><span class="s">port</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Prometheus</span>
                  <span class="s">metrics</span><span class="nv"> </span><span class="s">server</span><span class="nv"> </span><span class="s">should</span><span class="nv"> </span><span class="s">bind</span><span class="nv"> </span><span class="s">to.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">9091]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">prometheusProcessMetricsEnabled</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">PrometheusProcessMetricsEnabled</span><span class="nv"> </span><span class="s">disables</span><span class="nv"> </span><span class="s">process</span><span class="nv"> </span><span class="s">metrics</span>
                  <span class="s">collection,</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Prometheus</span><span class="nv"> </span><span class="s">client</span><span class="nv"> </span><span class="s">does</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">default,</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">set</span>
                  <span class="s">to</span><span class="nv"> </span><span class="s">false.</span><span class="nv"> </span><span class="s">This</span><span class="nv"> </span><span class="s">reduces</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">number</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">metrics</span><span class="nv"> </span><span class="s">reported,</span><span class="nv"> </span><span class="s">reducing</span>
                  <span class="s">Prometheus</span><span class="nv"> </span><span class="s">load.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">true]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">removeExternalRoutes</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">Whether or not to remove device routes that have not</span>
                  <span class="s">been programmed by Felix. Disabling this will allow external applications</span>
                  <span class="s">to also add device routes. This is enabled by default which means</span>
                  <span class="s">we will remove externally added routes.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">reportingInterval</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ReportingInterval</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">interval</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">reports</span>
                  <span class="s">its</span><span class="nv"> </span><span class="s">status</span><span class="nv"> </span><span class="s">into</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">datastore</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">disable.</span><span class="nv"> </span><span class="s">Must</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">non-zero</span>
                  <span class="s">in</span><span class="nv"> </span><span class="s">OpenStack</span><span class="nv"> </span><span class="s">deployments.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">30s]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">reportingTTL</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ReportingTTL</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">time-to-live</span><span class="nv"> </span><span class="s">setting</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">process-wide</span>
                  <span class="s">status</span><span class="nv"> </span><span class="s">reports.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">90s]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">routeRefreshInterval</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">RouteRefreshInterval</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">period</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">re-checks</span>
                  <span class="s">the</span><span class="nv"> </span><span class="s">routes</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">dataplane</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">ensure</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">no</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">process</span><span class="nv"> </span><span class="s">has</span>
                  <span class="s">accidentally</span><span class="nv"> </span><span class="s">broken</span><span class="nv"> </span><span class="s">Calico'</span><span class="s1">'</span><span class="s">s</span><span class="nv"> </span><span class="s">rules.</span><span class="nv"> </span><span class="s">Set</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">disable</span><span class="nv"> </span><span class="s">route</span><span class="nv"> </span><span class="s">refresh.</span>
                  <span class="s">[Default:</span><span class="nv"> </span><span class="s">90s]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">routeSource</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">RouteSource</span><span class="nv"> </span><span class="s">configures</span><span class="nv"> </span><span class="s">where</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">gets</span><span class="nv"> </span><span class="s">its</span><span class="nv"> </span><span class="s">routing</span>
                  <span class="s">information.</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">WorkloadIPs:</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">workload</span><span class="nv"> </span><span class="s">endpoints</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">construct</span>
                  <span class="s">routes.</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">CalicoIPAM:</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">default</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">IPAM</span><span class="nv"> </span><span class="s">data</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">construct</span><span class="nv"> </span><span class="s">routes.'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">routeTableRange</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">Calico programs additional Linux route tables for various</span>
                  <span class="s">purposes.  RouteTableRange specifies the indices of the route tables</span>
                  <span class="s">that Calico should use.</span>
                <span class="na">properties</span><span class="pi">:</span>
                  <span class="na">max</span><span class="pi">:</span>
                    <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
                  <span class="na">min</span><span class="pi">:</span>
                    <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
                <span class="na">required</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">max</span>
                <span class="pi">-</span> <span class="s">min</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
              <span class="na">serviceLoopPrevention</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">When</span><span class="nv"> </span><span class="s">service</span><span class="nv"> </span><span class="s">IP</span><span class="nv"> </span><span class="s">advertisement</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">enabled,</span><span class="nv"> </span><span class="s">prevent</span><span class="nv"> </span><span class="s">routing</span>
                  <span class="s">loops</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">service</span><span class="nv"> </span><span class="s">IPs</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">use,</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">dropping</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">rejecting</span>
                  <span class="s">packets</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">get</span><span class="nv"> </span><span class="s">DNAT'</span><span class="s1">'</span><span class="s">d</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">kube-proxy.</span><span class="nv"> </span><span class="s">Unless</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">"Disabled",</span>
                  <span class="s">in</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">case</span><span class="nv"> </span><span class="s">such</span><span class="nv"> </span><span class="s">routing</span><span class="nv"> </span><span class="s">loops</span><span class="nv"> </span><span class="s">continue</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">allowed.</span><span class="nv"> </span><span class="s">[Default:</span>
                  <span class="s">Drop]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">sidecarAccelerationEnabled</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">SidecarAccelerationEnabled</span><span class="nv"> </span><span class="s">enables</span><span class="nv"> </span><span class="s">experimental</span><span class="nv"> </span><span class="s">sidecar</span>
                  <span class="s">acceleration</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">false]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">usageReportingEnabled</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">UsageReportingEnabled</span><span class="nv"> </span><span class="s">reports</span><span class="nv"> </span><span class="s">anonymous</span><span class="nv"> </span><span class="s">Calico</span><span class="nv"> </span><span class="s">version</span>
                  <span class="s">number</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">cluster</span><span class="nv"> </span><span class="s">size</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">projectcalico.org.</span><span class="nv"> </span><span class="s">Logs</span><span class="nv"> </span><span class="s">warnings</span><span class="nv"> </span><span class="s">returned</span>
                  <span class="s">by</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">usage</span><span class="nv"> </span><span class="s">server.</span><span class="nv"> </span><span class="s">For</span><span class="nv"> </span><span class="s">example,</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">significant</span><span class="nv"> </span><span class="s">security</span><span class="nv"> </span><span class="s">vulnerability</span>
                  <span class="s">has</span><span class="nv"> </span><span class="s">been</span><span class="nv"> </span><span class="s">discovered</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">version</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">Calico</span><span class="nv"> </span><span class="s">being</span><span class="nv"> </span><span class="s">used.</span><span class="nv"> </span><span class="s">[Default:</span>
                  <span class="s">true]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">usageReportingInitialDelay</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">UsageReportingInitialDelay</span><span class="nv"> </span><span class="s">controls</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">minimum</span><span class="nv"> </span><span class="s">delay</span>
                  <span class="s">before</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">makes</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">report.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">300s]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">usageReportingInterval</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">UsageReportingInterval</span><span class="nv"> </span><span class="s">controls</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">interval</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">which</span>
                  <span class="s">Felix</span><span class="nv"> </span><span class="s">makes</span><span class="nv"> </span><span class="s">reports.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">86400s]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">useInternalDataplaneDriver</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">vxlanEnabled</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">vxlanMTU</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">VXLANMTU</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">MTU</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">tunnel</span><span class="nv"> </span><span class="s">device.</span><span class="nv"> </span><span class="s">See</span>
                  <span class="s">Configuring</span><span class="nv"> </span><span class="s">MTU</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">1440]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">vxlanPort</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">vxlanVNI</span><span class="pi">:</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">wireguardEnabled</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">WireguardEnabled</span><span class="nv"> </span><span class="s">controls</span><span class="nv"> </span><span class="s">whether</span><span class="nv"> </span><span class="s">Wireguard</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">enabled.</span>
                  <span class="s">[Default:</span><span class="nv"> </span><span class="s">false]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">wireguardInterfaceName</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">WireguardInterfaceName</span><span class="nv"> </span><span class="s">specifies</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">for</span>
                  <span class="s">the</span><span class="nv"> </span><span class="s">Wireguard</span><span class="nv"> </span><span class="s">interface.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">wg.calico]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
              <span class="na">wireguardListeningPort</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">WireguardListeningPort</span><span class="nv"> </span><span class="s">controls</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">listening</span><span class="nv"> </span><span class="s">port</span><span class="nv"> </span><span class="s">used</span>
                  <span class="s">by</span><span class="nv"> </span><span class="s">Wireguard.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">51820]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">wireguardMTU</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">WireguardMTU</span><span class="nv"> </span><span class="s">controls</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">MTU</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Wireguard</span><span class="nv"> </span><span class="s">interface.</span>
                  <span class="s">See</span><span class="nv"> </span><span class="s">Configuring</span><span class="nv"> </span><span class="s">MTU</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">1420]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">wireguardRoutingRulePriority</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">WireguardRoutingRulePriority</span><span class="nv"> </span><span class="s">controls</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">priority</span><span class="nv"> </span><span class="s">value</span>
                  <span class="s">to</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Wireguard</span><span class="nv"> </span><span class="s">routing</span><span class="nv"> </span><span class="s">rule.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">99]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
              <span class="na">xdpEnabled</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">XDPEnabled</span><span class="nv"> </span><span class="s">enables</span><span class="nv"> </span><span class="s">XDP</span><span class="nv"> </span><span class="s">acceleration</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">suitable</span><span class="nv"> </span><span class="s">untracked</span>
                  <span class="s">incoming</span><span class="nv"> </span><span class="s">deny</span><span class="nv"> </span><span class="s">rules.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">true]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">xdpRefreshInterval</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">XDPRefreshInterval</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">period</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">Felix</span><span class="nv"> </span><span class="s">re-checks</span>
                  <span class="s">all</span><span class="nv"> </span><span class="s">XDP</span><span class="nv"> </span><span class="s">state</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">ensure</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">no</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">process</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">accidentally</span><span class="nv"> </span><span class="s">broken</span>
                  <span class="s">Calico'</span><span class="s1">'</span><span class="s">s</span><span class="nv"> </span><span class="s">BPF</span><span class="nv"> </span><span class="s">maps</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">attached</span><span class="nv"> </span><span class="s">programs.</span><span class="nv"> </span><span class="s">Set</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">disable</span><span class="nv"> </span><span class="s">XDP</span>
                  <span class="s">refresh.</span><span class="nv"> </span><span class="s">[Default:</span><span class="nv"> </span><span class="s">90s]'</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
    <span class="na">served</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">storage</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">status</span><span class="pi">:</span>
  <span class="na">acceptedNames</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">plural</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">conditions</span><span class="pi">:</span> <span class="pi">[]</span>
  <span class="na">storedVersions</span><span class="pi">:</span> <span class="pi">[]</span>

<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apiextensions.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">CustomResourceDefinition</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">globalnetworkpolicies.crd.projectcalico.org</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">crd.projectcalico.org</span>
  <span class="na">names</span><span class="pi">:</span>
    <span class="na">kind</span><span class="pi">:</span> <span class="s">GlobalNetworkPolicy</span>
    <span class="na">listKind</span><span class="pi">:</span> <span class="s">GlobalNetworkPolicyList</span>
    <span class="na">plural</span><span class="pi">:</span> <span class="s">globalnetworkpolicies</span>
    <span class="na">singular</span><span class="pi">:</span> <span class="s">globalnetworkpolicy</span>
  <span class="na">scope</span><span class="pi">:</span> <span class="s">Cluster</span>
  <span class="na">versions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">v1</span>
    <span class="na">schema</span><span class="pi">:</span>
      <span class="na">openAPIV3Schema</span><span class="pi">:</span>
        <span class="na">properties</span><span class="pi">:</span>
          <span class="na">apiVersion</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">APIVersion</span><span class="nv"> </span><span class="s">defines</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">versioned</span><span class="nv"> </span><span class="s">schema</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">representation</span>
              <span class="s">of</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">object.</span><span class="nv"> </span><span class="s">Servers</span><span class="nv"> </span><span class="s">should</span><span class="nv"> </span><span class="s">convert</span><span class="nv"> </span><span class="s">recognized</span><span class="nv"> </span><span class="s">schemas</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">latest</span>
              <span class="s">internal</span><span class="nv"> </span><span class="s">value,</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">reject</span><span class="nv"> </span><span class="s">unrecognized</span><span class="nv"> </span><span class="s">values.</span><span class="nv"> </span><span class="s">More</span><span class="nv"> </span><span class="s">info:</span><span class="nv"> </span><span class="s">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">kind</span><span class="pi">:</span>
            <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Kind</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">string</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">representing</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">REST</span><span class="nv"> </span><span class="s">resource</span><span class="nv"> </span><span class="s">this</span>
              <span class="s">object</span><span class="nv"> </span><span class="s">represents.</span><span class="nv"> </span><span class="s">Servers</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">infer</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">endpoint</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">client</span>
              <span class="s">submits</span><span class="nv"> </span><span class="s">requests</span><span class="nv"> </span><span class="s">to.</span><span class="nv"> </span><span class="s">Cannot</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">updated.</span><span class="nv"> </span><span class="s">In</span><span class="nv"> </span><span class="s">CamelCase.</span><span class="nv"> </span><span class="s">More</span><span class="nv"> </span><span class="s">info:</span><span class="nv"> </span><span class="s">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">metadata</span><span class="pi">:</span>
            <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
          <span class="na">spec</span><span class="pi">:</span>
            <span class="na">properties</span><span class="pi">:</span>
              <span class="na">applyOnForward</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">ApplyOnForward indicates to apply the rules in this policy</span>
                  <span class="s">on forward traffic.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">doNotTrack</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">DoNotTrack indicates whether packets matched by the rules</span>
                  <span class="s">in this policy should go through the data plane's connection tracking,</span>
                  <span class="s">such as Linux conntrack.  If True, the rules in this policy are</span>
                  <span class="s">applied before any data plane connection tracking, and packets allowed</span>
                  <span class="s">by this policy are marked as not to be tracked.</span>
                <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
              <span class="na">egress</span><span class="pi">:</span>
                <span class="na">description</span><span class="pi">:</span> <span class="s">The ordered set of egress rules.  Each rule contains</span>
                  <span class="s">a set of packet match criteria and a corresponding action to apply.</span>
                <span class="na">items</span><span class="pi">:</span>
                  <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">A</span><span class="nv"> </span><span class="s">Rule</span><span class="nv"> </span><span class="s">encapsulates</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">match</span><span class="nv"> </span><span class="s">criteria</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">an</span>
                    <span class="s">action.</span><span class="nv">  </span><span class="s">Both</span><span class="nv"> </span><span class="s">selector-based</span><span class="nv"> </span><span class="s">security</span><span class="nv"> </span><span class="s">Policy</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">security</span><span class="nv"> </span><span class="s">Profiles</span>
                    <span class="s">reference</span><span class="nv"> </span><span class="s">rules</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">separated</span><span class="nv"> </span><span class="s">out</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">rules</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">both</span><span class="nv"> </span><span class="s">ingress</span>
                    <span class="s">and</span><span class="nv"> </span><span class="s">egress</span><span class="nv"> </span><span class="s">packet</span><span class="nv"> </span><span class="s">matching.</span><span class="nv"> </span><span class="se">\n</span><span class="nv"> </span><span class="s">Each</span><span class="nv"> </span><span class="s">positive</span><span class="nv"> </span><span class="s">match</span><span class="nv"> </span><span class="s">criteria</span><span class="nv"> </span><span class="s">has</span>
                    <span class="s">a</span><span class="nv"> </span><span class="s">negated</span><span class="nv"> </span><span class="s">version,</span><span class="nv"> </span><span class="s">prefixed</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="se">\"</span><span class="s">Not</span><span class="se">\"</span><span class="s">.</span><span class="nv"> </span><span class="s">All</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">match</span><span class="nv"> </span><span class="s">criteria</span>
                    <span class="s">within</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">rule</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">satisfied</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">packet</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">match.</span><span class="nv"> </span><span class="s">A</span><span class="nv"> </span><span class="s">single</span>
                    <span class="s">rule</span><span class="nv"> </span><span class="s">can</span><span class="nv"> </span><span class="s">contain</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">positive</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">negative</span><span class="nv"> </span><span class="s">version</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">match</span>
                    <span class="s">and</span><span class="nv"> </span><span class="s">both</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">satisfied</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">rule</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">match."</span>
                  <span class="na">properties</span><span class="pi">:</span>
                    <span class="na">action</span><span class="pi">:</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                    <span class="na">destination</span><span class="pi">:</span>
                      <span class="na">description</span><span class="pi">:</span> <span class="s">Destination contains the match criteria that apply</span>
                        <span class="s">to destination entity.</span>
                      <span class="na">properties</span><span class="pi">:</span>
                        <span class="na">namespaceSelector</span><span class="pi">:</span>
                          <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">NamespaceSelector</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">optional</span><span class="nv"> </span><span class="s">field</span><span class="nv"> </span><span class="s">that</span>
                            <span class="s">contains</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">selector</span><span class="nv"> </span><span class="s">expression.</span><span class="nv"> </span><span class="s">Only</span><span class="nv"> </span><span class="s">traffic</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">originates</span>
                            <span class="s">from</span><span class="nv"> </span><span class="s">(or</span><span class="nv"> </span><span class="s">terminates</span><span class="nv"> </span><span class="s">at)</span><span class="nv"> </span><span class="s">endpoints</span><span class="nv"> </span><span class="s">within</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">selected</span>
                            <span class="s">namespaces</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">matched.</span><span class="nv"> </span><span class="s">When</span><span class="nv"> </span><span class="s">both</span><span class="nv"> </span><span class="s">NamespaceSelector</span>
                            <span class="s">and</span><span class="nv"> </span><span class="s">Selector</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">defined</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">same</span><span class="nv"> </span><span class="s">rule,</span><span class="nv"> </span><span class="s">then</span><span class="nv"> </span><span class="s">only</span><span class="nv"> </span><span class="s">workload</span>
                            <span class="s">endpoints</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">matched</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">both</span><span class="nv"> </span><span class="s">selectors</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">selected</span>
                            <span class="s">by</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">rule.</span><span class="nv"> </span><span class="se">\n</span><span class="nv"> </span><span class="s">For</span><span class="nv"> </span><span class="s">NetworkPolicy,</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">empty</span><span class="nv"> </span><span class="s">NamespaceSelector</span>
                            <span class="s">implies</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Selector</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">limited</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">selecting</span><span class="nv"> </span><span class="s">only</span>
                            <span class="s">workload</span><span class="nv"> </span><span class="s">endpoints</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">same</span><span class="nv"> </span><span class="s">namespace</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">NetworkPolicy.</span>
                            <span class="se">\n</span><span class="nv"> </span><span class="s">For</span><span class="nv"> </span><span class="s">NetworkPolicy,</span><span class="nv"> </span><span class="s">`global()`</span><span class="nv"> </span><span class="s">NamespaceSelector</span><span class="nv"> </span><span class="s">implies</span>
                            <span class="s">that</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Selector</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">limited</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">selecting</span><span class="nv"> </span><span class="s">only</span><span class="nv"> </span><span class="s">GlobalNetworkSet</span>
                            <span class="s">or</span><span class="nv"> </span><span class="s">HostEndpoint.</span><span class="nv"> </span><span class="se">\n</span><span class="nv"> </span><span class="s">For</span><span class="nv"> </span><span class="s">GlobalNetworkPolicy,</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">empty</span>
                            <span class="s">NamespaceSelector</span><span class="nv"> </span><span class="s">implies</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Selector</span><span class="nv"> </span><span class="s">applies</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">workload</span>
                            <span class="s">endpoints</span><span class="nv"> </span><span class="s">across</span><span class="nv"> </span><span class="s">all</span><span class="nv"> </span><span class="s">namespaces."</span>
                          <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                        <span class="na">nets</span><span class="pi">:</span>
                          <span class="na">description</span><span class="pi">:</span> <span class="s">Nets is an optional field that restricts the</span>
                            <span class="s">rule to only apply to traffic that originates from (or</span>
                            <span class="s">terminates at) IP addresses in any of the given subnets.</span>
                          <span class="na">items</span><span class="pi">:</span>
                            <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                          <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
                        <span class="na">notNets</span><span class="pi">:</span>
                          <span class="na">description</span><span class="pi">:</span> <span class="s">NotNets is the negated version of the Nets</span>
                            <span class="s">field.</span>
                          <span class="na">items</span><span class="pi">:</span>
                            <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                          <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
                        <span class="na">notPorts</span><span class="pi">:</span>
                          <span class="na">description</span><span class="pi">:</span> <span class="s">NotPorts is the negated version of the Ports</span>
                            <span class="s">field. Since only some protocols have ports, if any ports</span>
                            <span class="s">are specified it requires the Protocol match in the Rule</span>
                            <span class="s">to be set to "TCP" or "UDP".</span>
                          <span class="na">items</span><span class="pi">:</span>
                            <span class="na">anyOf</span><span class="pi">:</span>
                            <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
                            <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                            <span class="na">pattern</span><span class="pi">:</span> <span class="s">^.*</span>
                            <span class="na">x-kubernetes-int-or-string</span><span class="pi">:</span> <span class="no">true</span>
                          <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
                        <span class="na">notSelector</span><span class="pi">:</span>
                          <span class="na">description</span><span class="pi">:</span> <span class="s">NotSelector is the negated version of the Selector</span>
                            <span class="s">field.  See Selector field for subtleties with negated</span>
                            <span class="s">selectors.</span>
                          <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                        <span class="na">ports</span><span class="pi">:</span>
                          <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Ports</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">optional</span><span class="nv"> </span><span class="s">field</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">restricts</span>
                            <span class="s">the</span><span class="nv"> </span><span class="s">rule</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">only</span><span class="nv"> </span><span class="s">apply</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">traffic</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">source</span><span class="nv"> </span><span class="s">(destination)</span>
                            <span class="s">port</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">matches</span><span class="nv"> </span><span class="s">one</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">these</span><span class="nv"> </span><span class="s">ranges/values.</span><span class="nv"> </span><span class="s">This</span><span class="nv"> </span><span class="s">value</span>
                            <span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">integers</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">strings</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">represent</span><span class="nv"> </span><span class="s">ranges</span>
                            <span class="s">of</span><span class="nv"> </span><span class="s">ports.</span><span class="nv"> </span><span class="se">\n</span><span class="nv"> </span><span class="s">Since</span><span class="nv"> </span><span class="s">only</span><span class="nv"> </span><span class="s">some</span><span class="nv"> </span><span class="s">protocols</span><span class="nv"> </span><span class="s">have</span><span class="nv"> </span><span class="s">ports,</span><span class="nv"> </span><span class="s">if</span>
                            <span class="s">any</span><span class="nv"> </span><span class="s">ports</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">specified</span><span class="nv"> </span><span class="s">it</span><span class="nv"> </span><span class="s">requires</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Protocol</span><span class="nv"> </span><span class="s">match</span>
                            <span class="s">in</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Rule</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="se">\"</span><span class="s">TCP</span><span class="se">\"</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="se">\"</span><span class="s">UDP</span><span class="se">\"</span><span class="s">."</span>
                          <span class="na">items</span><span class="pi">:</span>
                            <span class="na">anyOf</span><span class="pi">:</span>
                            <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
                            <span class="pi">-</span> <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                            <span class="na">pattern</span><span class="pi">:</span> <span class="s">^.*</span>
                            <span class="na">x-kubernetes-int-or-string</span><span class="pi">:</span> <span class="no">true</span>
                          <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
                        <span class="na">selector</span><span class="pi">:</span>
                          <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Selector</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">optional</span><span class="nv"> </span><span class="s">field</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">contains</span>
                            <span class="s">a</span><span class="nv"> </span><span class="s">selector</span><span class="nv"> </span><span class="s">expression</span><span class="nv"> </span><span class="s">(see</span><span class="nv"> </span><span class="s">Policy</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">sample</span><span class="nv"> </span><span class="s">syntax).</span>
                            <span class="se">\ </span><span class="s">Only</span><span class="nv"> </span><span class="s">traffic</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">originates</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">(terminates</span><span class="nv"> </span><span class="s">at)</span><span class="nv"> </span><span class="s">endpoints</span>
                            <span class="s">matching</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">selector</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">matched.</span><span class="nv"> </span><span class="se">\n</span><span class="nv"> </span><span class="s">Note</span><span class="nv"> </span><span class="s">that:</span><span class="nv"> </span><span class="s">in</span>
                            <span class="s">addition</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">negated</span><span class="nv"> </span><span class="s">version</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Selector</span><span class="nv"> </span><span class="s">(see</span><span class="nv"> </span><span class="s">NotSelector</span>
                            <span class="s">below),</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">selector</span><span class="nv"> </span><span class="s">expression</span><span class="nv"> </span><span class="s">syntax</span><span class="nv"> </span><span class="s">itself</span><span class="nv"> </span><span class="s">supports</span>
                            <span class="s">negation.</span><span class="nv">  </span><span class="s">The</span><span class="nv"> </span><span class="s">two</span><span class="nv"> </span><span class="s">types</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">negation</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">subtly</span><span class="nv"> </span><span class="s">different.</span>
                            <span class="s">One</span><span class="nv"> </span><span class="s">negates</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">set</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">matched</span><span class="nv"> </span><span class="s">endpoints,</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">negates</span>
                            <span class="s">the</span><span class="nv"> </span><span class="s">whole</span><span class="nv"> </span><span class="s">match:</span><span class="nv"> </span><span class="se">\n</span><span class="nv"> </span><span class="se">\t</span><span class="s">Selector</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="se">\"</span><span class="s">!has(my_label)</span><span class="se">\"</span><span class="nv"> </span><span class="s">matches</span>
                            <span class="s">packets</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">Calico-controlled</span><span class="nv"> </span><span class="se">\t</span><span class="s">endpoints</span>
                            <span class="s">that</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">have</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">label</span><span class="nv"> </span><span class="se">\"</span><span class="s">my_label</span><span class="se">\"</span><span class="s">.</span><span class="nv"> </span><span class="se">\n</span><span class="nv"> </span><span class="se">\t</span><span class="s">NotSelector</span>
                            <span class="s">=</span><span class="nv"> </span><span class="se">\"</span><span class="s">has(my_label)</span><span class="se">\"</span><span class="nv"> </span><span class="s">matches</span><span class="nv"> </span><span class="s">packets</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">from</span>
                            <span class="s">Calico-controlled</span><span class="nv"> </span><span class="se">\t</span><span class="s">endpoints</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">have</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">label</span><span class="nv"> </span><span class="se">\"</span><span class="s">my_label</span><span class="se">\"</span><span class="s">.</span>
                            <span class="se">\n</span><span class="nv"> </span><span class="s">The</span><span class="nv"> </span><span class="s">effect</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">latter</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">accept</span><span class="nv"> </span><span class="s">packets</span><span class="nv"> </span><span class="s">from</span>
                            <span class="s">non-Calico</span><span class="nv"> </span><span class="s">sources</span><span class="nv"> </span><span class="s">whereas</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">former</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">limited</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">packets</span>
                            <span class="s">from</span><span class="nv"> </span><span class="s">Calico-controlled</span><span class="nv"> </span><span class="s">endpoints."</span>
                          <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                        <span class="na">serviceAccounts</span><span class="pi">:</span>
                          <span class="na">description</span><span class="pi">:</span> <span class="s">ServiceAccounts is an optional field that restricts</span>
                            <span class="s">the rule to only apply to traffic that originates from</span>
                            <span class="s">(or terminates at) a pod running as a matching service</span>
                            <span class="s">account.</span>
                          <span class="na">properties</span><span class="pi">:</span>
                            <span class="na">names</span><span class="pi">:</span>
                              <span class="na">description</span><span class="pi">:</span> <span class="s">Names is an optional field that restricts</span>
                                <span class="s">the rule to only apply to traffic that originates</span>
                                <span class="s">from (or terminates at) a pod running as a service</span>
                                <span class="s">account whose name is in the list.</span>
                              <span class="na">items</span><span class="pi">:</span>
                                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                              <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
                            <span class="na">selector</span><span class="pi">:</span>
                              <span class="na">description</span><span class="pi">:</span> <span class="s">Selector is an optional field that restricts</span>
                                <span class="s">the rule to only apply to traffic that originates</span>
                                <span class="s">from (or terminates at) a pod running as a service</span>
                                <span class="s">account that matches the given label selector. If</span>
                                <span class="s">both Names and Selector are specified then they are</span>
                                <span class="s">AND'ed.</span>
                              <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                          <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
                    <span class="na">http</span><span class="pi">:</span>
                      <span class="na">description</span><span class="pi">:</span> <span class="s">HTTP contains match criteria that apply to HTTP</span>
                        <span class="s">requests.</span>
                      <span class="na">properties</span><span class="pi">:</span>
                        <span class="na">methods</span><span class="pi">:</span>
                          <span class="na">description</span><span class="pi">:</span> <span class="s">Methods is an optional field that restricts</span>
                            <span class="s">the rule to apply only to HTTP requests that use one of</span>
                            <span class="s">the listed HTTP Methods (e.g. GET, PUT, etc.) Multiple</span>
                            <span class="s">methods are OR'd together.</span>
                          <span class="na">items</span><span class="pi">:</span>
                            <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                          <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
                        <span class="na">paths</span><span class="pi">:</span>
                          <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Paths</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">optional</span><span class="nv"> </span><span class="s">field</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">restricts</span>
                            <span class="s">the</span><span class="nv"> </span><span class="s">rule</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">apply</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">HTTP</span><span class="nv"> </span><span class="s">requests</span><span class="nv"> </span><span class="s">that</span><span class="nv"> </span><span class="s">use</span><span class="nv"> </span><span class="s">one</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span>
                            <span class="s">listed</span><span class="nv"> </span><span class="s">HTTP</span><span class="nv"> </span><span class="s">Paths.</span><span class="nv"> </span><span class="s">Multiple</span><span class="nv"> </span><span class="s">paths</span><span class="nv"> </span><span class="s">are</span><span class="nv"> </span><span class="s">OR'</span><span class="s1">'</span><span class="s">d</span><span class="nv"> </span><span class="s">together.</span>
                            <span class="s">e.g:</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">exact:</span><span class="nv"> </span><span class="s">/foo</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">prefix:</span><span class="nv"> </span><span class="s">/bar</span><span class="nv"> </span><span class="s">NOTE:</span><span class="nv"> </span><span class="s">Each</span><span class="nv"> </span><span class="s">entry</span><span class="nv"> </span><span class="s">may</span>
                            <span class="s">ONLY</span><span class="nv"> </span><span class="s">specify</span><span class="nv"> </span><span class="s">either</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">`exact`</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">`prefix`</span><span class="nv"> </span><span class="s">match.</span><span class="nv"> </span><span class="s">The</span>
                            <span class="s">validator</span><span class="nv"> </span><span class="s">will</span><span class="nv"> </span><span class="s">check</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">it.'</span>
                          <span class="na">items</span><span class="pi">:</span>
                            <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">HTTPPath</span><span class="nv"> </span><span class="s">specifies</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">HTTP</span><span class="nv"> </span><span class="s">path</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">match.</span>
                              <span class="s">It</span><span class="nv"> </span><span class="s">may</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">either</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">form:</span><span class="nv"> </span><span class="s">exact:</span><span class="nv"> </span><span class="s">&lt;path&gt;:</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">matches</span>
                              <span class="s">the</span><span class="nv"> </span><span class="s">path</span><span class="nv"> </span><span class="s">exactly</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">prefix:</span><span class="nv"> </span><span class="s">&lt;path-prefix&gt;:</span><span class="nv"> </span><span class="s">which</span><span class="nv"> </span><span class="s">matches</span>
                              <span class="s">the</span><span class="nv"> </span><span class="s">path</span><span class="nv"> </span><span class="s">prefix'</span>
                            <span class="na">properties</span><span class="pi">:</span>
                              <span class="na">exact</span><span class="pi">:</span>
                                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                              <span class="na">prefix</span><span class="pi">:</span>
                                <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
                            <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
                          <span class="na">type</span><span class="pi">:</span> <span class="s">array</span>
                      <span class="na">type</span><span class="pi">:</span> <span class="s">object</span>
                    <span class="na">icmp</span><span class="pi">:</span>
                      <span class="na">description</span><span class="pi">:</span> <span class="s">ICMP is an optional field that restricts the rule</span>
                        <span class="s">to apply to a specific type and code of ICMP traffic.  This</span>
                        <span class="s">should only be specified if the Protocol field is set to "ICMP"</span>
                        <span class="s">or "ICMPv6".</span>
                      <span class="na">properties</span><span class="pi">:</span>
                        <span class="na">code</span><span class="pi">:</span>
                          <span class="na">description</span><span class="pi">:</span> <span class="s">Match on a specific ICMP code.  If specified,</span>
                            <span class="s">the Type value must also be specified. This is a technical</span>
                            <span class="s">limitation imposed by the kernel's iptables firewall,</span>
                            <span class="s">which Calico uses to enforce the rule.</span>
                          <span class="na">type</span><span class="pi">:</span> <span class="s">integer</span>
                        <span class="na">type</span><span class="pi">:</span>
                          <span class="na">description</span><span class="pi">:</span> <span class="s">Match on a specific ICMP type.  For example</span>
                            <span class="s">a value of 8```</span>

<span class="s">执行初始化 `Calico`命令</span>

<span class="err">```</span><span class="s">bash</span>
<span class="s">kubectl apply -f calico.yaml</span>
</code></pre></div></div>

<h2 id="安装-helm-应用">安装 Helm 应用</h2>

<p>这里使用 Helm 3，注意安装脚本下载最新版本</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-fsSL</span> <span class="nt">-o</span> get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
<span class="nb">chmod </span>700 get_helm.sh
./get_helm.sh
</code></pre></div></div>

<h2 id="安装-storageclass">安装 StorageClass</h2>

<p>默认情况下，可以安装 K8s 默认 localdisk 作为默认存储，这里采用开源项目 Hwameistor 用作本地磁盘管理。</p>

<blockquote>
  <p>项目介绍： <a href="https://hwameistor.io">https://hwameistor.io</a>
安装指引： <a href="https://hwameistor.io/cn/docs/quick_start/install/deploy">https://hwameistor.io/cn/docs/quick_start/install/deploy</a></p>
</blockquote>

<h3 id="安装-helm-仓库">安装 Helm 仓库</h3>

<p>Hwameistor 依赖 Helm 进行安装，所以事先 需要完成 Helm 应用的安装</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm repo add hwameistor http://hwameistor.io/hwameistor

helm repo update hwameistor

helm pull hwameistor/hwameistor <span class="nt">--untar</span>
</code></pre></div></div>

<h3 id="安装-hwameistior-应用">安装 HwameiStior 应用</h3>

<p>使用镜像仓库安装，要切换镜像仓库的镜像，请使用 –set 更改这两个参数值：<code class="language-plaintext highlighter-rouge">global.k8sImageRegistry</code> 和 <code class="language-plaintext highlighter-rouge">global.hwameistorImageRegistry</code></p>
<blockquote>
  <p>注意默认的镜像仓库 quay.io 和 ghcr.io。如果无法访问，可尝试使用 DaoCloud 提供的镜像源 quay.m.daocloud.io 和 ghcr.m.daocloud.io</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>helm <span class="nb">install </span>hwameistor ./hwameistor <span class="se">\</span>
    <span class="nt">-n</span> hwameistor <span class="nt">--create-namespace</span> <span class="se">\</span>
    <span class="nt">--set</span> global.k8sImageRegistry<span class="o">=</span>k8s-gcr.m.daocloud.io <span class="se">\</span>
    <span class="nt">--set</span> global.hwameistorImageRegistry<span class="o">=</span>ghcr.m.daocloud.io
</code></pre></div></div>

<p>检查 Hwameistor 的全部 Pod 状态</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl <span class="nt">-n</span> hwameistor get pod
NAME                                                       READY   STATUS
hwameistor-local-disk-csi-controller-665bb7f47d-6227f      2/2     Running
hwameistor-local-disk-manager-5ph2d                        2/2     Running
hwameistor-local-disk-manager-jhj59                        2/2     Running
hwameistor-local-disk-manager-k9cvj                        2/2     Running
hwameistor-local-disk-manager-kxwww                        2/2     Running
hwameistor-local-storage-csi-controller-667d949fbb-k488w   3/3     Running
hwameistor-local-storage-csqqv                             2/2     Running
hwameistor-local-storage-gcrzm                             2/2     Running
hwameistor-local-storage-v8g7t                             2/2     Running
hwameistor-local-storage-zkwmn                             2/2     Running
hwameistor-scheduler-58dfcf79f5-lswkt                      1/1     Running
hwameistor-webhook-986479678-278cr                         1/1     Running
</code></pre></div></div>

<blockquote>
  <p>local-disk-manager 和 local-storage 是 DaemonSet。在每个 Kubernetes 节点上都应该有一个 DaemonSet Pod。</p>
</blockquote>

<p>等到全部状态正常后，可进行后续操作，检查 <code class="language-plaintext highlighter-rouge">StorageClass</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get storageclass hwameistor-storage-lvm-hdd
NAME                                   PROVISIONER         RECLAIMPOLICY
hwameistor-storage-lvm-hdd <span class="o">(</span>default<span class="o">)</span>   lvm.hwameistor.io   Delete
</code></pre></div></div>

<h3 id="检查-lockdisknode和-lockdisk">检查 <code class="language-plaintext highlighter-rouge">LockDiskNode</code>和 <code class="language-plaintext highlighter-rouge">LockDisk</code></h3>

<p>默认在使用的磁盘状态应该 <code class="language-plaintext highlighter-rouge">PHASE</code> 展示位 <code class="language-plaintext highlighter-rouge">Bound</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get localdisknodes
NAME               NODEMATCH          PHASE
master01-k8s-com   master01-k8s-com   Bound
node01-k8s-com     node01-k8s-com     Bound
node02-k8s-com     node02-k8s-com     Bound

<span class="nv">$ </span>kubectl get localdisks
NAME                   NODEMATCH          CLAIM              PHASE
master01-k8s-com-vda   master01-k8s-com                      Bound
master01-k8s-com-vdb   master01-k8s-com   master01-k8s-com   Bound
node01-k8s-com-vda     node01-k8s-com                        Bound
node01-k8s-com-vdb     node01-k8s-com     node01-k8s-com     Bound
node02-k8s-com-vda     node02-k8s-com                        Bound
node02-k8s-com-vdb     node02-k8s-com     node02-k8s-com     Bound
</code></pre></div></div>

<h3 id="设置默认的-storageclass">设置默认的 <code class="language-plaintext highlighter-rouge">StorageClass</code></h3>

<p>这个对应的 <code class="language-plaintext highlighter-rouge">storageclasses</code>增加标识为默认的 <code class="language-plaintext highlighter-rouge">annotations</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl patch storageclasses.storage.k8s.io hwameistor-storage-lvm-hdd <span class="nt">-p</span> <span class="s1">'{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}'</span>
</code></pre></div></div>

<h3 id="创建存储池">创建存储池</h3>

<p>使用下方的命令创建对应的存储池，注意替换对应的 <code class="language-plaintext highlighter-rouge">nodeName</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>helm template ./hwameistor <span class="se">\</span>
   <span class="nt">-s</span> templates/post-install-claim-disks.yaml <span class="se">\</span>
   <span class="nt">--set</span> <span class="nv">storageNodes</span><span class="o">=</span><span class="s1">'{master01-k8s-com,node01-k8s-com,node02-k8s-com}'</span> <span class="se">\</span>
   | kubectl apply <span class="nt">-f</span> -
</code></pre></div></div>

<blockquote>
  <p>创建成功后，查看本地磁盘的 <code class="language-plaintext highlighter-rouge">ldc</code>，应该全部是 <code class="language-plaintext highlighter-rouge">Bound</code></p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get ldc
</code></pre></div></div>

<h2 id="安装-metrics-server">安装 <code class="language-plaintext highlighter-rouge">Metrics server</code></h2>

<p>接下来需要安装的 DCE5.0 需要安装 <code class="language-plaintext highlighter-rouge">metrics-server</code>，将下方的文件内容保存为 <code class="language-plaintext highlighter-rouge">metrics-server.yaml</code></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">metrics-server</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metrics-server</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kube-system</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">metrics-server</span>
    <span class="s">rbac.authorization.k8s.io/aggregate-to-admin</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
    <span class="s">rbac.authorization.k8s.io/aggregate-to-edit</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
    <span class="s">rbac.authorization.k8s.io/aggregate-to-view</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">system:aggregated-metrics-reader</span>
<span class="na">rules</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">metrics.k8s.io</span>
  <span class="na">resources</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">pods</span>
  <span class="pi">-</span> <span class="s">nodes</span>
  <span class="na">verbs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">get</span>
  <span class="pi">-</span> <span class="s">list</span>
  <span class="pi">-</span> <span class="s">watch</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">metrics-server</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">system:metrics-server</span>
<span class="na">rules</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">resources</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">nodes/metrics</span>
  <span class="na">verbs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">get</span>
<span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">resources</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">pods</span>
  <span class="pi">-</span> <span class="s">nodes</span>
  <span class="na">verbs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">get</span>
  <span class="pi">-</span> <span class="s">list</span>
  <span class="pi">-</span> <span class="s">watch</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">RoleBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">metrics-server</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metrics-server-auth-reader</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kube-system</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Role</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">extension-apiserver-authentication-reader</span>
<span class="na">subjects</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metrics-server</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kube-system</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRoleBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">metrics-server</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metrics-server:system:auth-delegator</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">system:auth-delegator</span>
<span class="na">subjects</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metrics-server</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kube-system</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRoleBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">metrics-server</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">system:metrics-server</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">system:metrics-server</span>
<span class="na">subjects</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metrics-server</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kube-system</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">metrics-server</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metrics-server</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kube-system</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">https</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">443</span>
    <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="s">https</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">metrics-server</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">metrics-server</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metrics-server</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">kube-system</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">metrics-server</span>
  <span class="na">strategy</span><span class="pi">:</span>
    <span class="na">rollingUpdate</span><span class="pi">:</span>
      <span class="na">maxUnavailable</span><span class="pi">:</span> <span class="m">0</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">metrics-server</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">args</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">--cert-dir=/tmp</span>
        <span class="pi">-</span> <span class="s">--secure-port=4443</span>
        <span class="pi">-</span> <span class="s">--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span>
        <span class="pi">-</span> <span class="s">--kubelet-use-node-status-port</span>
        <span class="pi">-</span> <span class="s">--metric-resolution=15s</span>
        <span class="pi">-</span> <span class="s">--kubelet-insecure-tls</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">registry.cn-hangzhou.aliyuncs.com/chenby/metrics-server:v0.6.2</span>
        <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
        <span class="na">livenessProbe</span><span class="pi">:</span>
          <span class="na">failureThreshold</span><span class="pi">:</span> <span class="m">3</span>
          <span class="na">httpGet</span><span class="pi">:</span>
            <span class="na">path</span><span class="pi">:</span> <span class="s">/livez</span>
            <span class="na">port</span><span class="pi">:</span> <span class="s">https</span>
            <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTPS</span>
          <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">metrics-server</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">4443</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">https</span>
          <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
        <span class="na">readinessProbe</span><span class="pi">:</span>
          <span class="na">failureThreshold</span><span class="pi">:</span> <span class="m">3</span>
          <span class="na">httpGet</span><span class="pi">:</span>
            <span class="na">path</span><span class="pi">:</span> <span class="s">/readyz</span>
            <span class="na">port</span><span class="pi">:</span> <span class="s">https</span>
            <span class="na">scheme</span><span class="pi">:</span> <span class="s">HTTPS</span>
          <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">20</span>
          <span class="na">periodSeconds</span><span class="pi">:</span> <span class="m">10</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">requests</span><span class="pi">:</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s">100m</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s">200Mi</span>
        <span class="na">securityContext</span><span class="pi">:</span>
          <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="no">false</span>
          <span class="na">readOnlyRootFilesystem</span><span class="pi">:</span> <span class="no">true</span>
          <span class="na">runAsNonRoot</span><span class="pi">:</span> <span class="no">true</span>
          <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">1000</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/tmp</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">tmp-dir</span>
      <span class="na">nodeSelector</span><span class="pi">:</span>
        <span class="s">kubernetes.io/os</span><span class="pi">:</span> <span class="s">linux</span>
      <span class="na">priorityClassName</span><span class="pi">:</span> <span class="s">system-cluster-critical</span>
      <span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">metrics-server</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">tmp-dir</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apiregistration.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">APIService</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">k8s-app</span><span class="pi">:</span> <span class="s">metrics-server</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">v1beta1.metrics.k8s.io</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">group</span><span class="pi">:</span> <span class="s">metrics.k8s.io</span>
  <span class="na">groupPriorityMinimum</span><span class="pi">:</span> <span class="m">100</span>
  <span class="na">insecureSkipTLSVerify</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">service</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">metrics-server</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">kube-system</span>
  <span class="na">version</span><span class="pi">:</span> <span class="s">v1beta1</span>
  <span class="na">versionPriority</span><span class="pi">:</span> <span class="m">100</span>
</code></pre></div></div>

<p>执行安装命令：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span>  metrics-server.yaml
</code></pre></div></div>

<p>安装成功后，通过下方命令可以成功的看到 node 节点的资源利用情况</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl top node
NAME               CPU<span class="o">(</span>cores<span class="o">)</span>   CPU%   MEMORY<span class="o">(</span>bytes<span class="o">)</span>   MEMORY%
master01-k8s-com   218m         5%     5610Mi          35%
node01-k8s-com     445m         11%    9279Mi          59%
node02-k8s-com     464m         11%    9484Mi          60%
</code></pre></div></div>

<h2 id="安装-dce-社区版">安装 DCE 社区版</h2>

<p>以下操作步骤将会带着您一步一步完成 DaoCloud Enterprise 5.0 社区版的完整安装，注意安装细节</p>

<ul>
  <li>官方文档介绍 <a href="https://docs.daocloud.io/">https://docs.daocloud.io/</a></li>
  <li>安装依赖项 <a href="https://docs.daocloud.io/install/install-tools/">https://docs.daocloud.io/install/install-tools/</a></li>
  <li>在线安装标准社区版 <a href="https://docs.daocloud.io/install/community/k8s/online/#_1">https://docs.daocloud.io/install/community/k8s/online/</a></li>
</ul>

<h3 id="安装基础依赖">安装基础依赖</h3>

<p>DCE 已经提供了一键安装的离线工具依赖包，经过测试比较稳定的运行在 <code class="language-plaintext highlighter-rouge">CentOS 7</code> 和 <code class="language-plaintext highlighter-rouge">CentOS 8</code>，如果您也是这样两个系统，可以使用下方脚本。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-LO</span> https://proxy-qiniu-download-public.daocloud.io/DaoCloud_Enterprise/dce5/install_prerequisite.sh
<span class="nb">chmod</span> +x install_prerequisite.sh
<span class="nb">sudo </span>bash install_prerequisite.sh online community
</code></pre></div></div>

<p>也可以选择手动安装这些：</p>

<ul>
  <li>podman</li>
  <li>helm ≥ 3.9.4</li>
  <li>skopeo ≥ 1.9.2</li>
  <li>kind</li>
  <li>kubectl ≥ 1.22.0</li>
  <li>yq ≥ 4.27.5</li>
  <li>minio client</li>
</ul>

<h3 id="下载-dce5-installer-安装器">下载 dce5-installer 安装器</h3>

<p>注意，需要在 Master 节点 来进行 dce5-installer 的安装，建议直接下载到当前节点</p>
<blockquote>
  <p>获取最新版本的查看界面： <a href="https://docs.daocloud.io/download/dce5/#_1">https://docs.daocloud.io/download/dce5/#_1</a></p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 假定 VERSION 为 v0.3.28 , 使用上方链接获取最新版本</span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">VERSION</span><span class="o">=</span>v0.3.28
<span class="nv">$ </span>curl <span class="nt">-Lo</span> ./dce5-installer  https://proxy-qiniu-download-public.daocloud.io/DaoCloud_Enterprise/dce5/dce5-installer-<span class="nv">$VERSION</span>

<span class="nv">$ </span><span class="nb">chmod</span> +x dce5-installer
</code></pre></div></div>

<blockquote>
  <p>如果<code class="language-plaintext highlighter-rouge">proxy-qiniu-download-public.daocloud.io</code> 链接失效，使用 <code class="language-plaintext highlighter-rouge">qiniu-download-public.daocloud.io</code></p>
</blockquote>

<h3 id="安装配置文件-可选">安装配置文件 [可选]</h3>

<p>将下方的配置文件内容保存为 <code class="language-plaintext highlighter-rouge">clusterconfig.yaml</code>，如果使用 <code class="language-plaintext highlighter-rouge">NodePort</code>的方式安装则不需要特定指定配置文件</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">provision.daocloud.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterConfig</span>
<span class="na">spec</span><span class="pi">:</span>
 <span class="na">loadBalancer</span><span class="pi">:</span> <span class="s">metallb</span>
 <span class="na">istioGatewayVip</span><span class="pi">:</span> <span class="s">10.6.229.10/32</span>  <span class="c1"># 这是 Istio gateway 的 VIP，也会是 DCE 5.0 的控制台的浏览器访问 IP</span>
 <span class="na">insightVip</span><span class="pi">:</span> <span class="s">10.6.229.11/32</span>  <span class="c1"># 这是 Global 集群的 Insight-Server 采集子集群的监控指标的网络路径用的 VIP</span>
</code></pre></div></div>

<blockquote>
  <p>如果使用配置文件，注意需要 事先安装 <code class="language-plaintext highlighter-rouge">MetaLB</code>，这一部分需要自行完成。</p>
</blockquote>

<h3 id="执行安装">执行安装</h3>

<p>根据需求选择下方的安装文件，如果选择指定配置文件内的</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 无配置文件</span>
<span class="nv">$ </span>./dce5-installer install-app

<span class="c"># 有指定 loadBalancer</span>
<span class="nv">$ </span>./dce5-installer install-app <span class="nt">-c</span> clusterConfig.yaml
</code></pre></div></div>

<h3 id="安装完成">安装完成</h3>

<p>如果看到下方的页面，说明安装成功了；默认账号密码为： <code class="language-plaintext highlighter-rouge">admin/changeme</code></p>

<p><img src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/J9lNN0.jpg?x-oss-process=image/resize,w_960,m_lfit" alt="resize,w_960,m_lfit" /></p>

<h3 id="重定向登录页-portal-反向代理">重定向登录页 Portal 反向代理</h3>

<p>一般情况下，我们安装后的集群访问地址是一个内网地址，当我们需要集群页面开放到公网访问时，会发现登录页会自动重定向内网地址，这是因为 DCE 5.0 反向代理服务器地址默认是安装时的配置；需要作出以下更新：</p>

<p>设置环境变量，方便在后续中使用</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 您的反向代理地址，例如：`export DCE_PROXY="https://demo-alpha.daocloud.io"`</span>
<span class="nb">export </span><span class="nv">DCE_PROXY</span><span class="o">=</span><span class="s2">"https://domain:port"</span>

<span class="c"># helm --set 参数备份文件</span>
<span class="nb">export </span><span class="nv">GHIPPO_VALUES_BAK</span><span class="o">=</span><span class="s2">"ghippo-values-bak.yaml"</span>

<span class="c"># 获取当前 ghippo 的版本号</span>
<span class="nb">export </span><span class="nv">GHIPPO_HELM_VERSION</span><span class="o">=</span><span class="si">$(</span>helm get notes ghippo <span class="nt">-n</span> ghippo-system | <span class="nb">grep</span> <span class="s2">"Chart Version"</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">': '</span> <span class="s1">'{ print $2 }'</span><span class="si">)</span>
</code></pre></div></div>

<p>更新 Helm repo</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm repo update ghippo
</code></pre></div></div>

<p>备份 –set 参数</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm get values ghippo <span class="nt">-n</span> ghippo-system <span class="nt">-o</span> yaml <span class="o">&gt;</span> <span class="k">${</span><span class="nv">GHIPPO_VALUES_BAK</span><span class="k">}</span>
</code></pre></div></div>

<p>使用 vim 命令编辑并保存</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim <span class="k">${</span><span class="nv">GHIPPO_VALUES_BAK</span><span class="k">}</span>

USER-SUPPLIED VALUES:
...
global:
  ...
  reverseProxy: <span class="k">${</span><span class="nv">DCE_PROXY</span><span class="k">}</span> <span class="c"># 只需要修改这一行</span>

</code></pre></div></div>

<p>使用 heml upgrade 更新配置</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm upgrade ghippo ghippo/ghippo <span class="se">\</span>
  <span class="nt">-n</span> ghippo-system <span class="se">\</span>
  <span class="nt">-f</span> <span class="k">${</span><span class="nv">GHIPPO_VALUES_BAK</span><span class="k">}</span> <span class="se">\</span>
  <span class="nt">--version</span> <span class="k">${</span><span class="nv">GHIPPO_HELM_VERSION</span><span class="k">}</span>
</code></pre></div></div>

<p>使用 kubectl 重启全局管理 Pod，使配置生效</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl rollout restart deploy/ghippo-apiserver <span class="nt">-n</span> ghippo-system
kubectl rollout restart statefulset/ghippo-keycloak <span class="nt">-n</span> ghippo-system
</code></pre></div></div>

<h3 id="申请社区版免费体验">申请社区版免费体验</h3>

<ul>
  <li>申请页面 <a href="https://qingflow.com/f/58604bf8">https://qingflow.com/f/58604bf8</a></li>
  <li>申请操作教程 <a href="https://docs.daocloud.io/dce/license0/">https://docs.daocloud.io/dce/license0/</a></li>
</ul>

      
    </div>
    <br/>
    <div>
      <cite>2022-12-06</cite> <i class="icon-tag"></i>
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2022/11/cskefu-opensource-project.html">开源项目 - 春松客服</a></h1>
    <div class="post_at_index">
      <h2 id="项目起源">项目起源</h2>

<p>很自豪给大家推荐，春松客服是我参与主导团队的第一个纯社区开源项目，目前在 Github 中文项目中开源排名第一。</p>

<p>目前我们正在规划 V8 产品迭代，这将会是一个全新的升级，请关注我们的项目进展 <a href="https://github.com/cskefu/cskefu">cskefu</a></p>

<p>同时也欢迎大家加入我们的团队。</p>

<h3 id="中国本土团队自主研发">中国本土团队自主研发</h3>

<ul>
  <li>春松客服是北京华夏春松于 2018 年发布的开源项目，目的是帮助企业上线智能客服系统。</li>
  <li>2022 年中，春松客服开源社区成立，目前春松客服由春松客服技术委员会领导，核心开发者来自开源社区，实践与客户、合伙伙伴共建社区。</li>
</ul>

<h3 id="最有价值开源项目">最有价值开源项目</h3>

<p>至 2022 年 10 月，春松客服在企业中部署超过 1.8 万次，上线客户超过 500 家，是 GitHub 上最受欢迎的中文开源客服系统。因开源、云原生架构和功能丰富受到广泛好评，在 Gitee 上赢得最有价值项目奖项。</p>

<h2 id="我们的愿景">我们的愿景</h2>

<p>在开源客服系统，我希望将春松客服平台成为一个开源的生态，希望吸引到成千上万的开发者和企业来使用和参与春松客服的开发。</p>

<ul>
  <li>春松客服不是传统的客服操作系统，区别与传统客服产品或客服厂商，因为我们在尝试使用开源方式打造一个可持续发展的客服生态</li>
  <li>我们承诺开放客服系统基础的核心能力和底层框架，上层应用增强功能则有开发者来决定</li>
  <li>开源不代表免费，我们将会对提供的增值能力进行收费，以保证主导团队的可持续发展，包括但不限于（技术支持、SaaS 平台）</li>
  <li>春松客服是一套开发者友好的客服操作系统，我们致力于让春松客服在即使脱离了主导团队，仍旧具备可持续发展的开源产品</li>
</ul>

<p>春松客服是一个依托于开源精神的客服操作系统，我们承诺永远开源，并与开发者打造一个完美的客服系统生态。</p>

<p>我们想做客服系统的 Kubernetes。</p>

<h2 id="最终用户">最终用户</h2>

<h3 id="一线客服团队人员">一线客服团队人员</h3>

<p>一线客服人员作为日常之中，长期使用客服系统的人员；客服系统的能力和效率将直接影响到他们的使用；</p>

<h3 id="客服领域开发者">客服领域开发者</h3>

<p>开发者们，可以利用春松客服的开放能力，为春松客服编写大量的增强插件。</p>

<h2 id="产品设计理念">产品设计理念</h2>

<p>春松客服的核心目标，不是打造一个我们认为的客服系统，而是我们希望打造一套轻量化的智能客服系统框架和具有海量插件的平台。</p>

<ul>
  <li>对于一线客服团队，可以根据自己的需要，选择合适的功能。</li>
  <li>对于客服领域的开发者们，提供一个平台，让开发者们可以轻松实现春松客服 + 的能力</li>
</ul>

<h3 id="合理的功能边界定义">合理的功能边界定义</h3>

<p>传统的客服系统提供了大量复杂的功能和配置，虽然总能找到对用户来说想要的功能，但是大量冗杂、甚至逻辑冲突的功能，这虽然没有过错；但的确极大的提高了一线客服人员的使用成本。</p>

<p>对于真正的使用者来说，我们希望客服系统的功能，可以刚好满足我所需要的全部功能，同时可以方便的进行功能的增减和升级。</p>

<p>所以，春松客服的功能边界在：提供 <strong>高性能、稳定、通用的、生产级</strong> 智能客服系统底座和平台。</p>

<h3 id="明确的功能范围定义">明确的功能范围定义</h3>

<ul>
  <li>春松客服确保底层基础能力的支持，并且保证良好的可扩展性</li>
  <li>春松客服避免直接内置开发复杂的应用功能（这往往会有兼容性问题），更多以标准开放能力为目标，交由开发者来实现 <code class="language-plaintext highlighter-rouge">增强插件</code></li>
</ul>

<h2 id="功能介绍">功能介绍</h2>

<h2 id="春松客服-v7">春松客服 V7</h2>

<p>春松客服到现在，已经发展了 2 年的时间，目前版本迭代到 V7，下面展示春松客服的功能和介绍网址入口。</p>

<table>
  <thead>
    <tr>
      <th>功能</th>
      <th>介绍网址</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>应用部署</td>
      <td><a href="https://docs.cskefu.com/docs/deploy">https://docs.cskefu.com/docs/deploy</a></td>
    </tr>
    <tr>
      <td>系统初始化</td>
      <td><a href="https://docs.cskefu.com/docs/initialization">https://docs.cskefu.com/docs/initialization</a></td>
    </tr>
    <tr>
      <td>开源社区</td>
      <td><a href="https://docs.cskefu.com/docs/osc/">https://docs.cskefu.com/docs/osc/</a></td>
    </tr>
    <tr>
      <td>开源许可协议</td>
      <td><a href="https://docs.cskefu.com/docs/osc/license">https://docs.cskefu.com/docs/osc/license</a></td>
    </tr>
    <tr>
      <td>春松客服大讲堂</td>
      <td><a href="https://docs.cskefu.com/docs/osc/training">https://docs.cskefu.com/docs/osc/training</a></td>
    </tr>
    <tr>
      <td>开发环境搭建</td>
      <td><a href="https://docs.cskefu.com/docs/osc/engineering">https://docs.cskefu.com/docs/osc/engineering</a></td>
    </tr>
    <tr>
      <td>IDE 使用之 Eclipse IDE</td>
      <td><a href="https://docs.cskefu.com/docs/osc/ide_eclipse">https://docs.cskefu.com/docs/osc/ide_eclipse</a></td>
    </tr>
    <tr>
      <td>IDE 使用之 IntelliJ IDEA</td>
      <td><a href="https://docs.cskefu.com/docs/osc/ide_intelij_idea">https://docs.cskefu.com/docs/osc/ide_intelij_idea</a></td>
    </tr>
    <tr>
      <td>系统维护</td>
      <td><a href="https://docs.cskefu.com/docs/osc/maintainence">https://docs.cskefu.com/docs/osc/maintainence</a></td>
    </tr>
    <tr>
      <td>提交代码</td>
      <td><a href="https://docs.cskefu.com/docs/osc/contribution">https://docs.cskefu.com/docs/osc/contribution</a></td>
    </tr>
    <tr>
      <td>REST APIs</td>
      <td><a href="https://docs.cskefu.com/docs/osc/restapi">https://docs.cskefu.com/docs/osc/restapi</a></td>
    </tr>
    <tr>
      <td>账号和权限</td>
      <td><a href="https://docs.cskefu.com/docs/accounting">https://docs.cskefu.com/docs/accounting</a></td>
    </tr>
    <tr>
      <td>坐席工作台</td>
      <td><a href="https://docs.cskefu.com/docs/work">https://docs.cskefu.com/docs/work</a></td>
    </tr>
    <tr>
      <td>渠道管理</td>
      <td><a href="https://docs.cskefu.com/docs/channels/">https://docs.cskefu.com/docs/channels/</a></td>
    </tr>
    <tr>
      <td>Messenger 渠道</td>
      <td><a href="https://docs.cskefu.com/docs/channels/messenger/">https://docs.cskefu.com/docs/channels/messenger/</a></td>
    </tr>
    <tr>
      <td>网页渠道</td>
      <td><a href="https://docs.cskefu.com/docs/channels/webim">https://docs.cskefu.com/docs/channels/webim</a></td>
    </tr>
    <tr>
      <td>客户关系管理</td>
      <td><a href="https://docs.cskefu.com/docs/crm">https://docs.cskefu.com/docs/crm</a></td>
    </tr>
    <tr>
      <td>坐席监控</td>
      <td><a href="https://docs.cskefu.com/docs/monitoring">https://docs.cskefu.com/docs/monitoring</a></td>
    </tr>
    <tr>
      <td>机器人客服</td>
      <td><a href="https://docs.cskefu.com/docs/work-chatbot/">https://docs.cskefu.com/docs/work-chatbot/</a></td>
    </tr>
    <tr>
      <td>安装配置</td>
      <td><a href="https://docs.cskefu.com/docs/work-chatbot/install">https://docs.cskefu.com/docs/work-chatbot/install</a></td>
    </tr>
    <tr>
      <td>集成机器人客服</td>
      <td><a href="https://docs.cskefu.com/docs/work-chatbot/bot-agent">https://docs.cskefu.com/docs/work-chatbot/bot-agent</a></td>
    </tr>
    <tr>
      <td>消息类型</td>
      <td><a href="https://docs.cskefu.com/docs/work-chatbot/message-types">https://docs.cskefu.com/docs/work-chatbot/message-types</a></td>
    </tr>
    <tr>
      <td>会话历史</td>
      <td><a href="https://docs.cskefu.com/docs/reports">https://docs.cskefu.com/docs/reports</a></td>
    </tr>
    <tr>
      <td>访问统计</td>
      <td><a href="https://docs.cskefu.com/docs/usage">https://docs.cskefu.com/docs/usage</a></td>
    </tr>
  </tbody>
</table>

<h3 id="账号和权限">账号和权限</h3>

<h3 id="系统管理员">系统管理员</h3>

<p>在春松客服里，系统管理员是具备管理所辖组织内坐席、权限、角色、联系人和坐席监控等资源的管理员，系统管理员分为两种类型：<strong>超级管理员</strong>和<strong>普通管理员</strong>，普通管理员也简称“管理员”。</p>

<p>超级管理员为春松客服系统设置的，初始化一个春松客服实例后，默认超级管理员用户名为 <code class="language-plaintext highlighter-rouge">admin</code>，密码为 <code class="language-plaintext highlighter-rouge">admin1234</code>，并且有且只有一个，IT 人员在初始化搭建的春松客服实例的第一件事就是更改超级管理员账号的密码，以确保系统安全。超级管理员具备更新系统所有属性的能力，读写数据，是春松客服内权限最大的用户。</p>

<p>安装启动系统，进入春松客服后台界面，输入初始化的超级管理员账号密码(用户名: <code class="language-plaintext highlighter-rouge">admin</code>, 密码: <code class="language-plaintext highlighter-rouge">admin1234</code>)，点击立即登录。</p>

<p><strong>超级管理员同时维护者春松客服的组织机构的高层级，组织机构是树形结构，默认情况下没有组织机构信息，春松客服搭建完成后，由超级管理员设定根节点，比如总公司、总公司下属子公司，维护这样的一个层级结构，再创建其他管理员账号，普通管理员账号可以创建多个，不同管理员隶属于不同组织机构，该管理员只有管理其所在组织机构及该组织机构附属组织机构的权限。</strong></p>

<p>系统管理员切换不同的组织机构，可以查看不同组织机构的数据。</p>

<h3 id="权限设计">权限设计</h3>

<p>春松客服权限体系包括：组织机构，角色，账号。</p>

<h4 id="权限的管理">权限的管理</h4>

<p>角色可以自定义，设置对一系列资源的读写。<strong>角色的创建和删除，修改资源授权，只有超级管理员可以操作，</strong>，普通【管理员】只具备角色的使用权：添加或删除权限里的系统账号。</p>

<h4 id="系统账号读写资源与角色的关系">系统账号读写资源与角色的关系</h4>

<p>将账号添加到角色后，因为账号也同时隶属于不同的组织机构，那么账号所具有的权限就是其所在组织机构以及附属组织机构的角色对应的资源的读写。</p>

<p>根据角色和坐席所在组织机构进行权限检查：</p>

<ul>
  <li>超级管理员可以管理系统所有资源</li>
  <li>管理员可以创建部门人员</li>
  <li>组织机构支持层级的树状结构</li>
  <li>角色包含对不同资源的读写权限</li>
  <li>资源如联系人，客户等是根据组织机构进行隔离的</li>
  <li>网站渠道必须启用技能组，不同网站渠道接入的访客根据网站渠道设置分配给不同的技能组</li>
  <li>系统数据根据坐席当前所在的组织机构进行展示</li>
  <li>坐席可以看到自己所在组织机构以及附属组织机构的数据</li>
</ul>

<p>假设组织机构如下：</p>

<ul>
  <li>李四所能看到的联系人全集是 A 部门及其附属部门所创建的全部联系人</li>
  <li>李四看不到 B 部门的联系人，张三看不到 A 部门的联系人</li>
  <li>李四能看到刘一创建的联系人，刘一看不到李四创建的联系人</li>
</ul>

<h3 id="组织机构管理">组织机构管理</h3>

<h4 id="创建部门">创建部门</h4>

<p><em>系统</em> -&gt; <em>系统概况</em> -&gt; <em>用户和组</em> -&gt; <em>组织机构</em> -&gt; <em>创建部门</em>，并且可以启用或关闭技能组</p>

<ul>
  <li>名词解释：</li>
</ul>

<p><strong>部门</strong> 需要创建的部门名称</p>

<p><strong>上级机构</strong> 选择上级部门</p>

<p><strong>启用技能组</strong> 这里启用与否，技能是接待同一个渠道的坐席人员群组，春松客服支持配置自动分配策略，连接访客与坐席，简称 ACD 模块</p>

<h4 id="更新删除部门">更新、删除部门</h4>

<p>进入部门列表</p>

<p><em>系统</em> -&gt; <em>系统概况</em> -&gt; <em>用户和组</em> -&gt; <em>组织机构</em></p>

<h4 id="编辑-修改-部门">编辑 (修改) 部门</h4>

<p><em>系统</em> -&gt; <em>系统概况</em> -&gt; <em>用户和组</em> -&gt; <em>组织机构</em> -&gt; <em>修改部门</em></p>

<h4 id="删除部门">删除部门</h4>

<p><em>系统</em> -&gt; <em>系统概况</em> -&gt; <em>用户和组</em> -&gt; <em>组织机构</em> -&gt; <em>删除部门</em></p>

<h4 id="设置部门地区">设置部门地区</h4>

<p><em>系统</em> -&gt; <em>系统概况</em> -&gt; <em>用户和组</em> -&gt; <em>组织结构</em> -&gt; <em>选中一个部门</em> -&gt; <em>地区设置</em></p>

<h3 id="角色管理">角色管理</h3>

<h4 id="创建角色">创建角色</h4>

<p><em>系统</em> -&gt; <em>系统概况</em> -&gt; <em>用户和组</em> -&gt; <em>系统角色</em> -&gt; <em>新建角色</em></p>

<p>只有【系统超级管理员】可以创建角色。</p>

<p>名词解释：</p>

<p><strong>角色</strong> 系统中用户的操作权限是通过角色来控制，角色可以理解为具备一定操作权限的用户组；</p>

<p>可以把一个或者更多的用户添加到一个角色下；</p>

<p>可以给一个角色设置一定的系统权限，相当于这个角色下面的用户有了这些系统权限；</p>

<p>角色创建好了以后，在所有组织机构中共享。不同组织机构的管理员，只能管理其所在组织机构和下属组织机构里的账号的角色。</p>

<h4 id="编辑-修改-角色">编辑 (修改) 角色</h4>

<p><em>系统</em> -&gt; <em>系统概况</em> -&gt; <em>用户和组</em> -&gt; <em>系统角色</em> -&gt; <em>修改角色</em></p>

<p>只有【系统超级管理员】可以编辑角色。</p>

<h4 id="删除角色">删除角色</h4>

<p>系统-&gt;系统概况-&gt;用户和组-&gt;系统角色&gt;删除角色</p>

<p>只有【系统超级管理员】可以删除角色。</p>

<h3 id="账号管理">账号管理</h3>

<h4 id="创建用户账号系统---系统概况---用户和组---用户账号---创建新用户">创建用户账号：<em>系统</em> -&gt; <em>系统概况</em> -&gt; <em>用户和组</em> -&gt; <em>用户账号</em> -&gt; <em>创建新用户</em></h4>

<blockquote>
  <p>提示：</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>电子邮件: 需要有效的格式密码: 字母数字最少8位，手动录入手机号: 全系统唯一
</code></pre></div></div>

<ul>
  <li>
    <p>用户分为管理员和普通用户</p>
  </li>
  <li>
    <p>坐席分为一般坐席和 SIP 坐席，普通用户与管理用户都可以成为坐席，SIP 坐席是在多媒体坐席的基础上</p>
  </li>
  <li>
    <p><strong>每个账号必须分配到一个部门下，以及关联到一个角色上，才可以查看或管理资源，请详细阅读【组织机构】和【角色】管理</strong></p>
  </li>
  <li>
    <p>创建普通用户</p>
  </li>
  <li>
    <p>创建多媒体坐席</p>
  </li>
  <li>
    <p>创建管理员</p>
  </li>
</ul>

<h4 id="查看账号信息">查看账号信息</h4>

<p><em>系统</em> -&gt; <em>系统概况</em> -&gt; <em>用户和组</em> -&gt; <em>用户账号</em></p>

<p>点击操作一栏中的“编辑”“删除”，可以对当前用户列表中的所有用户的信息进行编辑或者删除</p>

<h4 id="添加账号到部门">添加账号到部门</h4>

<p><em>系统</em> -&gt; <em>系统概况</em> -&gt; <em>用户和组</em> -&gt; <em>组织结构</em> -&gt; <em>选中一个部门</em> -&gt; <em>添加用户到当前部门</em></p>

<ul>
  <li>
    <p>可以把已经存在的 用户账号 添加到一个特定的部门中</p>
  </li>
  <li>
    <p>一个用户账号只能隶属于一个部门</p>
  </li>
</ul>

<h4 id="添加账号到角色">添加账号到角色</h4>

<p>系统-&gt;系统概况-&gt;用户和组-&gt;系统角色&gt;添加用户到角色</p>

<h3 id="渠道管理">渠道管理</h3>

<p>春松客服支持多种渠道，访客的来源可能是多渠道的，这也是目前联络中心发展的趋势，以及对智能客服系统的一个挑战，一方面随着信息技术和互联网通信、聊天工具的演变，企业的客户逐渐分散，尤其是营销平台多元化。</p>

<p>多渠道的适应能力，是春松客服的重要特色。在【渠道管理】的子菜单中，查看支持的不同类型的渠道。</p>

<h4 id="渠道支持">渠道支持</h4>

<table>
  <thead>
    <tr>
      <th>渠道名称</th>
      <th>简介</th>
      <th>获得</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="https://docs.cskefu.com/docs/channels/webim">网页渠道</a></td>
      <td>通过在网页中注入春松客服网页渠道 HTML，实现聊天控件，访客与客服建立实时通信连接，支持坐席邀请访客对话等功能</td>
      <td><strong>开源，免费</strong>，随<a href="https://github.com/chatopera/cskefu">基础代码</a>发布</td>
    </tr>
    <tr>
      <td><a href="https://docs.cskefu.com/docs/channels/messenger">Facebook Messenger 渠道</a></td>
      <td>简称“Messenger 插件”或“ME”插件，Messenger 是 Facebook 旗下的最主要的即时通信软件，支持多种平台，因其创新的理念、优秀的用户体验和全球最大的社交网络，而广泛应用。春松客服 Messenger 插件帮助企业在 Facebook 平台上实现营销和客户服务</td>
      <td><strong>开源，免费</strong>，随<a href="https://github.com/chatopera/cskefu">基础代码</a>发布</td>
    </tr>
  </tbody>
</table>

<h3 id="网页渠道">网页渠道</h3>

<p>网页聊天支持可以适配移动设备浏览器，桌面浏览器。可以在电脑，手机，微信等渠道接入网页聊天控件。</p>

<h4 id="安装">安装</h4>

<p>获取网页脚本，<em>系统</em> -&gt; <em>系统管理</em> -&gt; <em>客服接入</em> -&gt; <em>网站列表</em> -&gt; <em>点击“Chatopera 官网”</em> -&gt; <em>基本设置</em> -&gt; <em>接入；</em></p>

<p>将图中的代码复制到一个 Web 项目的页面中，例如下图的。</p>

<h4 id="使用">使用</h4>

<p>使用浏览器打开该 Web 页面。</p>

<p>【提示】该网页需要使用 http(s) 打开，不支持使用浏览器打开本地 HTML 页面。</p>

<p>点击该网页中出现的“在线客服”按钮，出现聊天窗口，可以作为访客，与客服聊天了。</p>

<p>【提示】春松客服提供一个测试网页客户端的例子，可以使用 <em><a href="https://docs.cskefu.com/docs/accountinghttp://%7B%7B%E6%98%A5%E6%9D%BE%E6%98%A5%E6%9D%BE%E5%AE%A2%E6%9C%8DIP:%5BPORT">http://IP:PORT</a>]}}/testclient.html</em> 进行访问。</p>

<h3 id="facebook-渠道">Facebook 渠道</h3>

<p>Messenger 是 Facebook 旗下的最主要的即时通信软件，支持多种平台，因其创新的理念、优秀的用户体验和全球最大的社交网络，而广泛应用。通过 Facebook Messenger 的官方链接，可以了解更多。</p>

<p><a href="https://www.messenger.com/">https://www.messenger.com/</a></p>

<p>春松客服 Messenger 插件帮助企业在 Facebook 平台上实现营销和客户服务。</p>

<ul>
  <li>集成 Facebook 粉丝页，使用 OTN 推送营销活动信息，吸引新粉丝和激活老客户</li>
  <li>集成 Chatopera 机器人客服，自动回答常见问题，提升客户体验</li>
  <li>支持机器人客服转人工坐席，解决客户的复杂问题</li>
  <li>产品迭代一年，提供多个最佳实践，帮助企业高效率运营</li>
  <li>春松客服运营分析和 Chatopera 机器人客服运营分析生成报表，洞察业务指标</li>
</ul>

<h4 id="了解-messenger">了解 Messenger</h4>

<p>首先，出海企业要获客，或者通过互联网方式提供服务，那么 Facebook 上的广告和 Messenger 服务，是您无论如何都要使用的，因为你可以从这里找到您的目标客户、潜在客户。但是，如果 Facebook 平台的商业化程度过高，将影响社交网络内用户的体验，比如用户收到和自己不相关、不感兴趣的、大量的广告。为此 Facebook 在广告和 Messenger 上，有很多设计、一些限制，达到了商业化和人们社交需求的平衡，这是 Facebook 能成为今天世界上最大的社交网络的关键原因之一。</p>

<p>其次，您需要了解 Messenger 的一些应用场景，比如 Cskefu 为九九互动提供的智能客服和 OTN 服务的案例 chatopera-me-jiujiu2020。</p>

<p>在正式介绍春松客服 Messenger 插件的使用之前，需要说明 Cskefu 提供该插件是通过 Facebook Messenger 平台的开发者 APIs 实现，因此，该插件的功能安全可靠、稳定强大并且会不断更新。</p>

<p><a href="https://developers.facebook.com/docs/messenger-platform">https://developers.facebook.com/docs/messenger-platform</a></p>

<h4 id="使用指南">使用指南</h4>

<ul>
  <li><a href="https://docs.cskefu.com/docs/channels/messenger/install.html">Messenger 渠道配置</a></li>
  <li><a href="https://docs.cskefu.com/docs/channels/messenger/facebook-otn.html">Facebook OTN 主动推送指南</a></li>
  <li><a href="https://docs.cskefu.com/docs/channels/messenger/messenger-chatbot.html">Messenger 渠道配置机器人客服</a></li>
  <li><a href="https://docs.cskefu.com/docs/channels/messenger/message-types.html">Messenger 管理机器人客服对话</a></li>
</ul>

<h3 id="春松客服全新版本-v8">春松客服全新版本 V8</h3>

<p>自今年春松客服开源社区和技术委员会成立，我们重新复盘了春松客服的发展过往；我们决心重构整个春松客服，所有 V8 会是一个全新定位的版本。</p>

<ul>
  <li>新版本前端 UI 与产品功能
    <ul>
      <li>首页模块</li>
      <li>会话工作台</li>
      <li>工单中心</li>
      <li>用户中心</li>
    </ul>
  </li>
  <li>全新打造学习中心</li>
  <li>多维度统计</li>
  <li>系统设计
    <ul>
      <li>渠道管理
        <ul>
          <li>渠道列表</li>
          <li>渠道配置模板</li>
        </ul>
      </li>
      <li>账号管理
        <ul>
          <li>账号列表</li>
          <li>分组管理</li>
          <li>角色管理</li>
        </ul>
      </li>
      <li>核心功能构建</li>
      <li>性能测试场景设计</li>
      <li>支持横向扩容</li>
      <li>插件平台技术设计方案</li>
      <li>通用渠道接入能力设计</li>
    </ul>
  </li>
  <li>支持 K8s 部署，Helm Chart
    <ul>
      <li>部署方式优化</li>
      <li>Docker-compose 部署</li>
      <li>依赖组件升级</li>
    </ul>
  </li>
</ul>

<h2 id="后端技术栈">后端技术栈</h2>

<ul>
  <li>JAVA 版本：JAVA 11</li>
  <li>构建工具：Maven</li>
  <li>后端技术栈
    <ul>
      <li>Spring security</li>
      <li>Webflux</li>
      <li>MyBatis 2.2.2</li>
      <li>Jackson</li>
      <li>Redisson 3.17.7</li>
      <li>Mysql 8.0</li>
      <li>HikariCP</li>
      <li>Swagger 3.0.0</li>
      <li>Spring boot 2.7.4</li>
      <li>Spring cloud 2021.0.4</li>
      <li>Spring cloud alibaba 2021.0.4.0</li>
      <li>RabbitMQ</li>
      <li>XXL-Job</li>
      <li>Seata</li>
      <li>ES6</li>
      <li>Oauth2.0</li>
      <li>MinIO</li>
    </ul>
  </li>
</ul>

<h2 id="应用部署">应用部署</h2>

<p>春松客服适应各种部署方式，本文使用 Docker 和 Docker compose 的方式，适合体验、开发、测试和上线春松客服，此种方式简单快捷。</p>

<blockquote>
  <p>更新：我们正在推进基于 Helm Chart 的方式安装，让企业可以更方便的 Kubernetes 容器平台使用</p>
</blockquote>

<p>重要提示：部署应用后，必须按照<a href="https://docs.cskefu.com/docs/initialization/">《系统初始化》</a>文档进行系统初始化，再使用，不做初始化，会造成坐席无法分配等问题。</p>

<h3 id="环境准备">环境准备</h3>

<table>
  <thead>
    <tr>
      <th>项目</th>
      <th>说明</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>操作系统</td>
      <td>Linux (CentOS 7.x, Ubuntu 16.04+ 等)，<strong>推荐使用 Ubuntu LTS</strong></td>
      <td> </td>
    </tr>
    <tr>
      <td>Docker 版本</td>
      <td>Docker version 1.13.x 及以上</td>
      <td> </td>
    </tr>
    <tr>
      <td>Docker Compose 版本</td>
      <td>version 1.23.x 及以上</td>
      <td> </td>
    </tr>
    <tr>
      <td>防火墙端口</td>
      <td>8035, 8036</td>
      <td> </td>
    </tr>
    <tr>
      <td>其他软件</td>
      <td>git</td>
      <td> </td>
    </tr>
    <tr>
      <td>内存</td>
      <td>开发测试 &gt;= 8GB</td>
      <td>生产环境 &gt;= 16GB</td>
    </tr>
    <tr>
      <td>CPU 颗数</td>
      <td>开发测试 &gt;= 2</td>
      <td>生产环境 &gt;= 4</td>
    </tr>
    <tr>
      <td>硬盘</td>
      <td>&gt;= 20GB</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h3 id="获取源码">获取源码</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone <span class="nt">-b</span> master https://github.com/cskefu/cskefu.git cskefu
<span class="nb">cd </span>cskefu
<span class="nb">cp </span>sample.env .env <span class="c"># 使用文本编辑器打开 .env 文件，并按照需求需改配置</span>
</code></pre></div></div>

<p>以上命令中，<code class="language-plaintext highlighter-rouge">master</code> 代表当前稳定版，是 <a href="https://github.com/cskefu/cskefu">cskefu/cskefu</a> 的 master 分支，分支说明。</p>

<table>
  <thead>
    <tr>
      <th>分支</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>master</td>
      <td>当前稳定版本</td>
    </tr>
    <tr>
      <td>develop</td>
      <td>当前开发版本</td>
    </tr>
  </tbody>
</table>

<p>克隆代码时，按照需要指定分支信息；本部署文档针对 master 分支。</p>

<h3 id="配置项说明">配置项说明</h3>

<p>以下为部署相关的环境变量，可以在 <code class="language-plaintext highlighter-rouge">.env</code> 中覆盖默认值。</p>

<table>
  <thead>
    <tr>
      <th>KEY</th>
      <th>默认值</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>COMPOSE_FILE</td>
      <td>docker-compose.yml</td>
      <td>服务编排描述文件，保持默认值</td>
    </tr>
    <tr>
      <td>COMPOSE_PROJECT_NAME</td>
      <td>cskefu</td>
      <td>服务实例的容器前缀，可以用其它字符串</td>
    </tr>
    <tr>
      <td>MYSQL_PORT</td>
      <td>8037</td>
      <td>MySQL 数据库映射到宿主机器使用的端口</td>
    </tr>
    <tr>
      <td>REDIS_PORT</td>
      <td>8041</td>
      <td>Redis 映射到宿主机器的端口</td>
    </tr>
    <tr>
      <td>ES_PORT1</td>
      <td>8039</td>
      <td>ElasticSearch RestAPI 映射到宿主机器的端口</td>
    </tr>
    <tr>
      <td>ES_PORT2</td>
      <td>8040</td>
      <td>ElasticSearch 服务发现端口映射到宿主机器的端口</td>
    </tr>
    <tr>
      <td>CC_WEB_PORT</td>
      <td>8035</td>
      <td>春松客服 Web 服务地址映射到宿主机器的端口</td>
    </tr>
    <tr>
      <td>CC_SOCKET_PORT</td>
      <td>8036</td>
      <td>春松客服 SocketIO 服务映射到宿主机器的端口</td>
    </tr>
    <tr>
      <td>ACTIVEMQ_PORT1</td>
      <td>8051</td>
      <td>ActiveMQ 端口</td>
    </tr>
    <tr>
      <td>ACTIVEMQ_PORT2</td>
      <td>8052</td>
      <td>ActiveMQ 端口</td>
    </tr>
    <tr>
      <td>ACTIVEMQ_PORT2</td>
      <td>8053</td>
      <td>ActiveMQ 端口</td>
    </tr>
    <tr>
      <td>DB_PASSWD</td>
      <td>123456</td>
      <td>数据库密码，设置到 MySQL, Redis, ActiveMQ</td>
    </tr>
    <tr>
      <td>LOG_LEVEL</td>
      <td>INFO</td>
      <td>日志级别，可使用 WARN, ERROR, INFO, DEBUG</td>
    </tr>
  </tbody>
</table>

<p>以上配置中，<strong>端口的各默认值需要保证在宿主机器上还没有被占用；数据库的密码尽量复杂；CC_WEB_PORT 和 CC_SOCKET_PORT 这两个值尽量不要变更；生产环境下 LOG_LEVEL 使用至少 WARN 的级别</strong>。</p>

<p>以下为一些业务功能相关配置的环境变量：</p>

<table>
  <thead>
    <tr>
      <th>KEY</th>
      <th>默认值</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>TONGJI_BAIDU_SITEKEY</td>
      <td>placeholder</td>
      <td>使用<a href="https://tongji.baidu.com/web/welcome/login">百度统计</a> 记录和查看页面访问情况，默认不记录</td>
    </tr>
    <tr>
      <td>EXTRAS_LOGIN_BANNER</td>
      <td>off</td>
      <td>登录页上方展示通知的内容，默认 (off) 不展示</td>
    </tr>
    <tr>
      <td>EXTRAS_LOGIN_CHATBOX</td>
      <td>off</td>
      <td>登录页支持加入一个春松客服网页渠道聊天按钮，比如 <a href="https://oh-my.cskefu.com/im/xxx.html%EF%BC%8C%E9%BB%98%E8%AE%A4(off)">https://oh-my.cskefu.com/im/xxx.html，默认 (off</a>不展示</td>
    </tr>
  </tbody>
</table>

<h3 id="管理命令">管理命令</h3>

<h4 id="启动服务">启动服务</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cskefu                            <span class="c"># 进入下载后的文件夹</span>
docker-compose pull                  <span class="c"># 拉取镜像</span>
docker-compose up <span class="nt">-d</span> contact-center  <span class="c"># 启动服务</span>
</code></pre></div></div>

<h4 id="查看服务日志">查看服务日志</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose logs <span class="nt">-f</span> contact-center
</code></pre></div></div>

<h3 id="登陆系统">登陆系统</h3>

<p>在日志中，查看到如下类似信息，代表服务已经启动。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO  c.c.socketio.SocketIOServer - SocketIO server started at port: 8036 <span class="o">[</span>nioEventLoopGroup-2-1]INFO  com.chatopera.cc.Application - Started Application <span class="k">in </span>35.319 seconds <span class="o">(</span>JVM running <span class="k">for </span>42.876<span class="o">)</span> <span class="o">[</span>main]
</code></pre></div></div>

<p>然后，从浏览器打开 <a href="https://docs.cskefu.com/docs/deployhttp://YOUR_IP:CC_WEB_PORT/">http://YOUR_IP:CC_WEB_PORT/</a> 访问服务。默认管理员账号：admin 密码：admin1234</p>

<h2 id="演示环境">演示环境</h2>

<p>春松客服提供了，在线体验环境，方便您了解春松客服最新功能。</p>

<table>
  <thead>
    <tr>
      <th>内容</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>网站</td>
      <td><a href="https://demo.cskefu.com">https://demo.cskefu.com</a></td>
    </tr>
    <tr>
      <td>默认用户名</td>
      <td>admin</td>
    </tr>
    <tr>
      <td>默认密码</td>
      <td>admin1234</td>
    </tr>
  </tbody>
</table>

<p>注意，请不要修改用户名和密码，演示环境随时有可能可能，请自行保障数据安全。</p>

<h2 id="客户案例">客户案例</h2>

<ul>
  <li><a href="https://mp.weixin.qq.com/s/t4J_qPaN6on_yTz6s6GSew">富盈证券上线春松客服</a></li>
  <li><a href="https://mp.weixin.qq.com/s/MSC2E46Y1soeKsfJdntcow">江北新区研创园</a></li>
  <li><a href="https://mp.weixin.qq.com/s/7_eCxA3ylNaxCR48h3eqNw">高科华烨</a></li>
  <li><a href="https://mp.weixin.qq.com/s/9afFcXrQRQHchFPW4usSxg">深圳尔雅</a></li>
</ul>

<h2 id="关注春松客服">关注春松客服</h2>

<ul>
  <li>春松客服官网 <a href="https://www.cskefu.com">https://www.cskefu.com</a></li>
  <li>Github 主页  <a href="https://github.com/cskefu/cskefu">https://github.com/cskefu/cskefu</a></li>
  <li>春松客服文档站 <a href="https://docs.cskefu.com">https://docs.cskefu.com</a></li>
</ul>

<h2 id="社区会议">社区会议</h2>

<h3 id="定期社区会议">定期社区会议</h3>

<p>周日 10:00UTC+8（中文）（单周）。<a href="https://www.thetimezoneconverter.com/?t=10%3A00&amp;tz=GMT%2B8&amp;">转换为您的时区</a></p>

<ul>
  <li>
    <table>
      <tbody>
        <tr>
          <td><a href="https://www.cskefu.com/category/conferences/">会议记录和议程</a></td>
          <td><a href="https://space.bilibili.com/34290698/channel/collectiondetail?sid=817713">Bilibili Video</a></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li><a href="https://www.feishu.cn/calendar/share?token=e1a022850428d49e1ab84aef69e8ee5c">会议日历</a></li>
  <li><a href="https://vc.feishu.cn/j/400656075">会议链接</a></li>
</ul>

<h3 id="往期会议">往期会议</h3>

<ul>
  <li>会议记录 <a href="https://www.cskefu.com/category/conferences/">https://www.cskefu.com/category/conferences/</a></li>
  <li>视频记录 <a href="https://space.bilibili.com/34290698/channel/collectiondetail?sid=817713">https://space.bilibili.com/34290698/channel/collectiondetail?sid=817713</a></li>
</ul>

      
    </div>
    <br/>
    <div>
      <cite>2022-11-28</cite> <i class="icon-tag"></i>
      <a href="/tags.html#开源项目">开源项目</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2022/11/what-is-hukou.html">What is Hukou</a></h1>
    <div class="post_at_index">
      <h2 id="背景">背景</h2>

<p>对于一个大型企业，内部有几十个业务系统是非常正常的一件事情。</p>

<p>在这个背景下，有一个具体的服务可以很干净的只做一件事情是非常棒的：把人管好。</p>

<h2 id="功能接入">功能接入</h2>

<ul>
  <li>支持接收其他业务系统的注册
    <ul>
      <li>支持配置 system_key</li>
      <li>支持自定义回调地址</li>
    </ul>
  </li>
  <li>通用的身份认证接入方式
    <ul>
      <li>接入方系统只需要简单的集成即可完成用户身份的登录支持</li>
    </ul>
  </li>
  <li>支持一键禁用账号登录
    <ul>
      <li>增强版能力，支持广播账号身份信息发生变化，实时触发账号验证
        <ul>
          <li>可选项，由接入方系统根据需求决定是否接入</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>支持与三方业务系统集成
    <ul>
      <li>钉钉</li>
      <li>飞书</li>
      <li>etc.</li>
    </ul>
  </li>
</ul>

<h2 id="功能逻辑说明">功能逻辑说明</h2>

<p><img src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/20221123145010.png?x-oss-process=image/resize,w_960,m_lfit" alt="resize,w_960,m_lfit" /></p>

<blockquote>
  <p>验证流程图</p>
</blockquote>

<p><img src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/VIzBnN.jpg?x-oss-process=image/resize,w_960,m_lfit" alt="resize,w_960,m_lfit" /></p>

<h2 id="相关技术和开源实现">相关技术和开源实现</h2>

<ul>
  <li>开源项目
    <ul>
      <li>Keyclock</li>
    </ul>
  </li>
  <li>相关技术
    <ul>
      <li>Microsoft AD</li>
      <li>LDAP</li>
      <li>OIDC</li>
      <li>OAtuh</li>
    </ul>
  </li>
  <li>SaaS 产品
    <ul>
      <li>飞书 <门神></门神></li>
      <li><a href="https://auth0.com">auth0.com</a></li>
      <li><a href="https://fusionauth.io/">fusionauth</a></li>
    </ul>
  </li>
</ul>

      
    </div>
    <br/>
    <div>
      <cite>2022-11-23</cite> <i class="icon-tag"></i>
      <a href="/tags.html#OAuth">OAuth</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2022/11/Copy-To-Markdwon.html">Copy to Markdown</a></h1>
    <div class="post_at_index">
      <h2 id="背景">背景</h2>

<p>梳理笔记工具，最近把语雀都迁移到了 Github，找个时间可以 讨论下中间的过程。</p>

      
    </div>
    <br/>
    <div>
      <cite>2022-11-20</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Markdown">Markdown</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2022/11/Dubbo-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html">Dubbo 基础知识梳理</a></h1>
    <div class="post_at_index">
      <blockquote>
  <p>参考资料：</p>
</blockquote>

<ul>
  <li><a href="https://juejin.cn/post/7128953614403371015#heading-5">https://juejin.cn/post/7128953614403371015#heading-5</a></li>
  <li><a href="https://dubbo.apache.org/zh/docs/">https://dubbo.apache.org/zh/docs/</a></li>
</ul>

<h2 id="简介">简介</h2>

<ul>
  <li>Apache Dubbo 一款基于 RPC 服务开发的云原生微服务框架，与 SpringCloud 类似</li>
  <li>使用 Dubbo 开发的微服务原生具备相互之间远程地址发现 (注册中心) 和通信的能力</li>
  <li>Dubbo 支持丰富的服务治理特性，包含 服务发现、负载均衡、流量调度 等，高度可扩展</li>
  <li>Dubbo 由 阿里巴巴 开发，并贡献给 Apache</li>
</ul>

<h2 id="发展历程">发展历程</h2>

<h3 id="版本迭代">版本迭代</h3>

<p><img src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/20221117023215.png?x-oss-process=image/resize,w_960,m_lfit" alt="resize,w_960,m_lfit" /></p>

<h3 id="软件生态的活跃度">软件生态的活跃度</h3>

<p><img src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/8G8hZG.jpg?x-oss-process=image/resize,w_960,m_lfit" alt="resize,w_960,m_lfit" /></p>

<h2 id="与-springcloud-相比的优势">与 SpringCloud 相比的优势</h2>

<ul>
  <li>功能丰富，基于原生库即可完成大部分的微服务治理能力</li>
  <li>支持超大规模的微服务机器设计，高性能 RPC 通信协议实现</li>
  <li>高度可扩展性，支持在调用过程中对流量及协议进行拦截扩展，如 Filter、Router、LB 等</li>
  <li>支持微服务治理的扩展组件
    <ul>
      <li>Registry 注册中心：Zookeeper、Nacos</li>
      <li>Config Center 配置中心：Zookeeper、Nacos</li>
      <li>Metadata Center 元数据中心 (Dubbo3 支持)</li>
    </ul>
  </li>
</ul>

<h2 id="dubbo-的基础概念介绍">Dubbo 的基础概念介绍</h2>

<ul>
  <li>RPC 通信</li>
  <li>服务发现</li>
  <li>流量治理</li>
</ul>

<h3 id="rpc-通信">RPC 通信</h3>

<ul>
  <li>Dubbo3 之中，RPC 通信主要使用 Triple 协议，构建在 HTTP/2 协议之上，兼容 gRPC</li>
  <li>提供 Request Response、Request Streaming、Response Streaming、Bi-directional Streaming 通信模型</li>
  <li>支持 IDL，基于 Triple 协议</li>
</ul>

<h3 id="服务发现">服务发现</h3>

<p>服务发现，是消费端自动发现服务地址列表的能力，是微服务框架需要具备的关键能力，借助于自动化的服务发现，微服务之间在无需感知对端部署位置与 IP 地址的情况下实现通信。</p>

<p>Dubbo 提供的 Client-Based 服务发现机制，同时也需要第三方注册中心来协调服务发现过程，比如 Nacos/Zookeeper 等。</p>

<p><img src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/oaqyGX.jpg?x-oss-process=image/resize,w_960,m_lfit" alt="resize,w_960,m_lfit" /></p>

<h3 id="流量治理">流量治理</h3>

<ul>
  <li>Dubbo2 开始，Dubbo 就提供了丰富的服务治理规则，包括路由规则/动态配置等</li>
  <li>Dubbo3 之中的实现
    <ul>
      <li>Dubbo Mesh : 通过对接 xDS 对接到时下流行的 Mesh 产品如 Istio 中所使用的以 VirtualService、DestinationRule 为代表的治理规则</li>
      <li>另一方面 Dubbo 正寻求设计一套自有规则以实现在不通部署场景下的流量治理，以及灵活的治理能力。</li>
    </ul>
  </li>
</ul>

<h2 id="dubbo-mesh">Dubbo Mesh</h2>

<p>Dubbo Mesh 的目标是提供适应 Dubbo 体系的完整 Mesh 解决方案，包含定制化控制面（Control Plane）、定制化数据面解决方案。Dubbo 控制面基于业界主流 Istio 扩展，支持更丰富的流量治理规则、Dubbo 应用级服务发现模型等，Dubbo 数据面可以采用 Envoy Sidecar，即实现 Dubbo SDK + Envoy 的部署方案，也可以采用 Dubbo Proxyless 模式，直接实现 Dubbo 与控制面的通信。</p>

<p><img src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/vMniiR.jpg?x-oss-process=image/resize,w_960,m_lfit" alt="resize,w_960,m_lfit" /></p>

<h2 id="dubbo3">Dubbo3</h2>

<p>Dubbo 3.0 提供的新特性包括：</p>

<ul>
  <li><strong>新的地址发现模型（应用级服务发现）</strong>
    <ul>
      <li>查看<a href="https://dubbo.apache.org/zh/docs/migration/migration-service-discovery">应用级服务发现的迁移步骤</a></li>
      <li>查看应用级服务发现的使用方式</li>
      <li>查看应用级服务发现设计与实现</li>
    </ul>
  </li>
  <li><strong>下一代基于 HTTP/2 的 Triple 协议</strong>
    <ul>
      <li>查看<a href="https://dubbo.apache.org/zh/docs/migration/migration-triple">Triple 协议迁移步骤</a></li>
      <li>查看 <a href="https://dubbo.apache.org/zh/docs/references/protocols/tri">Triple 协议使用方式</a></li>
      <li>查看 Triple 协议设计与实现</li>
    </ul>
  </li>
  <li><strong>统一的路由规则。</strong>
    <ul>
      <li>查看<a href="https://dubbo.apache.org/zh/docs/migration/migration-routingrule/">统一路由规则的迁移步骤</a></li>
      <li>查看<a href="https://dubbo.apache.org/zh/docs/references/routers/">统一路由规则使用方式</a></li>
      <li>查看统一路由规则设计与实现</li>
    </ul>
  </li>
</ul>

      
    </div>
    <br/>
    <div>
      <cite>2022-11-16</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Dubbo">Dubbo</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2022/11/Panads-fill-NaN-value-to-Zero.html">Panads fill NaN value to Zero</a></h1>
    <div class="post_at_index">
      <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'somefile.txt'</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

      
    </div>
    <br/>
    <div>
      <cite>2022-11-10</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Pandas">Pandas</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2022/10/Redash-for-Docker-%E9%83%A8%E7%BD%B2.html">Redash for Docker 部署</a></h1>
    <div class="post_at_index">
      <blockquote>
  <p>暗坑很多</p>
</blockquote>

<h2 id="部署过程">部署过程</h2>

<ol>
  <li>需要自行维护一个 env 作为配置文件</li>
</ol>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>REDASH_COOKIE_SECRET=a07cca441ab9f28b66c589f3118e0de48469b1bc6a5036eade7badbed305d96e
POSTGRES_HOST_AUTH_METHOD=trust
REDASH_REDIS_URL=redis://redis:6379/0
REDASH_DATABASE_URL=postgresql://postgres
</code></pre></div></div>

<ul>
  <li>
    <p>需要创建一个 postgres-data 并配置 docker-compose.yml 的路径，数据库持久化</p>
  </li>
  <li>需要给 postgres 容器增加 sudo 命令
    <ul>
      <li>apk add sudo</li>
    </ul>
  </li>
  <li>需要手工进入到 postgresql 容器内创建 role 和 database
    <ul>
      <li>createuser -U postgres redash</li>
      <li>createdb -U postgres redash</li>
    </ul>
  </li>
  <li>执行数据库初始化动作</li>
  <li>docker-compose run –rm server create_db</li>
  <li>然后重启 redash 全部服务即可 docker-compose down 后重启</li>
</ul>

<blockquote>
  <p>postgresql 在执行 psql 命令时，默认会读取当前系统用户作为执行 role；但 psql 默认用户是 postgres</p>
</blockquote>

<p><a href="https://redash.io/help/open-source/setup">https://redash.io/help/open-source/setup</a>
<a href="https://redash.io/help/open-source/dev-guide/docker">https://redash.io/help/open-source/dev-guide/docker</a>
<a href="https://docs.victoriametrics.com/url-examples.html#apiv1exportcsv">https://docs.victoriametrics.com/url-examples.html#apiv1exportcsv</a></p>

<p><a href="https://mp.weixin.qq.com/s?src=11\&amp;timestamp=1660629444\&amp;ver=3985\&amp;signature=verv70veamW*Ez2Sgc8e89yMJGwANIOzz4lfwbezyVV3wpWNT2d9SnGrDecUOwrbTJBR2o-Ax6ZS4Fpu2UxfX7Sy9xsk1LCXfY1wNr42ucl3tFePfJ7c536c8z*L-HOy\&amp;new=1">https://mp.weixin.qq.com/s?src=11\&amp;timestamp=1660629444\&amp;ver=3985\&amp;signature=verv70veamW<em>Ez2Sgc8e89yMJGwANIOzz4lfwbezyVV3wpWNT2d9SnGrDecUOwrbTJBR2o-Ax6ZS4Fpu2UxfX7Sy9xsk1LCXfY1wNr42ucl3tFePfJ7c536c8z</em>L-HOy\&amp;new=1</a></p>

<p><a href="https://mp.weixin.qq.com/s?src=11&amp;timestamp=1660682601&amp;ver=3986&amp;signature=h8m0RzEX3qWsKcUo6Ee3azdsnzLQqUf3N8FdLhyWNa52U4vAvlbEaBFUCrTZnh54tT-YS2mODfkp-6Hemmzt3n*hzGHlEmXP-HO5830W0Fzmn4MMfnsOPBKLrcjaiU0h&amp;new=1">https://mp.weixin.qq.com/s?src=11&amp;timestamp=1660682601&amp;ver=3986&amp;signature=h8m0RzEX3qWsKcUo6Ee3azdsnzLQqUf3N8FdLhyWNa52U4vAvlbEaBFUCrTZnh54tT-YS2mODfkp-6Hemmzt3n*hzGHlEmXP-HO5830W0Fzmn4MMfnsOPBKLrcjaiU0h&amp;new=1</a></p>

<ul>
  <li>redash env 配置：<a href="https://redash.io/help/open-source/admin-guide/env-vars-settings">https://redash.io/help/open-source/admin-guide/env-vars-settings</a></li>
  <li>postgres 权限问题 <a href="https://stackoverflow.com/a/25051632/5067657">https://stackoverflow.com/a/25051632/5067657</a></li>
  <li><a href="https://techoverflow.net/2021/05/07/how-to-fix-alpine-linux-ash-sudo-not-found/">https://techoverflow.net/2021/05/07/how-to-fix-alpine-linux-ash-sudo-not-found/</a></li>
  <li><a href="https://discuss.redash.io/t/error-99-connecting-to-localhost-6379-cannot-assign-requested-address/9716/7">https://discuss.redash.io/t/error-99-connecting-to-localhost-6379-cannot-assign-requested-address/9716/7</a></li>
</ul>

<h2 id="启动的服务介绍">启动的服务介绍</h2>

<ul>
  <li>v10-redashio_adhoc_worker_1     # 执行查询任务的 worker</li>
  <li>v10-redashio_postgres_1       # 数据库</li>
  <li>v10-redashio_redis_1        # 缓存</li>
  <li>v10-redashio_scheduled_worker_1   # 执行计划任务的 worker</li>
  <li>v10-redashio_scheduler_1      # 计划任务管理 server</li>
  <li>v10-redashio_server_1        # 主体 server</li>
</ul>

<p>以上主要会设计到 3 个镜像，redis、pgsql、redash，其中核心是 redash，所以关注镜像版本也是这个</p>

<h2 id="版本升级">版本升级</h2>

<p>redash 的版本升级较为方便，更换 server 的镜像；然后升级数据库即可。</p>

<blockquote>
  <p>测试过从 v8 升级到 v10 , 和 v9 升级到 v10，都是 ok 的。</p>
</blockquote>

<ol>
  <li>关闭 Redash 服务
    <ol>
      <li><code class="language-plaintext highlighter-rouge">docker-compose stop server scheduler scheduled_worker adhoc_worker</code></li>
    </ol>
  </li>
  <li>更新 docker-compose.yml
    <ol>
      <li>基本上这一步，只需要更新 redash 的镜像版本即可</li>
      <li>然后执行 <code class="language-plaintext highlighter-rouge">docker-compose pull</code> 拉取新镜像版本</li>
    </ol>
  </li>
  <li>执行数据库升级
    <ol>
      <li><code class="language-plaintext highlighter-rouge">docker-compose run --rm server manage db upgrade</code></li>
    </ol>
  </li>
  <li>启动全部服务即可
    <ol>
      <li><code class="language-plaintext highlighter-rouge">docker-compse up -d</code></li>
    </ol>
  </li>
</ol>

<h2 id="解决-es-的-https-问题">解决 ES 的 HTTPS 问题</h2>

<p>由于我们的 es 地址访问地址采用 https，但为自签证书，所以在 request 之中会有些问题，所以我在这里更新了 elasticsearch 的插件，然后将其上传到我个人的 docker hub.
<a href="https://hub.docker.com/r/samzong/redash">https://hub.docker.com/r/samzong/redash</a></p>

<blockquote>
  <p>带来的问题，页面上无法选择到 Elasticsearch 作为数据源，没时间去研究了</p>
</blockquote>

<p>看了下还是可以使用 redash 的 API 去创建的 <code class="language-plaintext highlighter-rouge">/api/data_sources</code>:</p>

<h2 id="配置">配置</h2>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"options"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"basic_auth_password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-----"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"basic_auth_user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"elastic"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"server"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://10.6.51.101:31001/"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"skip_tls_verification"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"elasticsearch"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test-es"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>创建完成后，就可以在页面上更新了。</p>

      
    </div>
    <br/>
    <div>
      <cite>2022-10-22</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Redash">Redash</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2022/10/JWT-%E5%86%85%E7%BD%AE%E7%9A%84%E6%96%B9%E5%BC%8F.html">JWT 内置的方式</a></h1>
    <div class="post_at_index">
      <ul>
  <li>支持为 API 启用 jwt token 解码的能力 ,  读取网关的 jwt key
    <ul>
      <li>读取请求 Header 中的 Authorization</li>
    </ul>
  </li>
  <li>需要支持为网关配置多 jwt key , and 加密长度 ?
    <ul>
      <li>解密的性能问题</li>
      <li>expire_time 过期时间的配置</li>
      <li>解密后的参数传递</li>
    </ul>
  </li>
</ul>

<p><img src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/1666060887030-ff0a6f09-9bf0-44d5-a92b-dc36fc9b7d47.png?x-oss-process=image/resize,w_960,m_lfit" alt="image.png" /></p>

<h3 id="迭代的方向">迭代的方向</h3>

<ol>
  <li>采用外置的 Jwt server 认证服务
    <ol>
      <li>配置 jwt server url</li>
      <li>respone 解密后的  json 内容；进行参数传递</li>
    </ol>
  </li>
  <li>采用托管的 Jwt server 来进行托管
    <ol>
      <li>配置 jwt key (支持自动生成)</li>
      <li>expire_time</li>
      <li>加密长度</li>
      <li>自动配置参数传递
        <ol>
          <li>全部传递</li>
          <li>全部传递 (not token)</li>
          <li>白名单传递</li>
        </ol>
      </li>
    </ol>
  </li>
</ol>

      
    </div>
    <br/>
    <div>
      <cite>2022-10-18</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Contour">Contour</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    

    <!-- Pagination links -->
    <nav>
      <ul class="pagination hidden-xs">
        
        <li class="disabled">
          <a>&laquo; Previous</a>
        </li>
        

        
        <li class="active">
          <a>1</a>
        </li>
        
        <li>
          <a href="/page2">2</a>
        </li>
        
        <li>
          <a href="/page3">3</a>
        </li>
        
        <li>
          <a href="/page4">4</a>
        </li>
        
        <li>
          <a href="/page5">5</a>
        </li>
        
        <li><span>...</span></li>
        <li><a href="/page25">25</a></li>
        

        
        

        
        

        
        <li>
          <a href="/page2">Next &raquo;</a>
        </li>
        
      </ul>
    </nav>
  </div>
  <div class="col-xs-12 col-md-4">
		<!-- <div>
			<a class="twitter-timeline" data-width="390" data-height="640" data-theme="light" href="https://twitter.com/samzong_lu?ref_src=twsrc%5Etfw">Tweets by SAMZONG</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
		</div> -->
    <div>
      <h2>传送门</h2>
      <ul>
        <li><a href="https://yuque.com/samzong">语雀-花园</a></li>
        <li><a href="https://github.com/samzong">Github</a></li>
      </ul>
    </div>
    <div class="categories">
      <h2>文章分类</h2>
      <ul class="tag_box">
        
        


  
     
    	
      <li><a href="/categories.html#故事汇">
    		故事汇 <span>23</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Linux">
    		Linux <span>22</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#前端">
    		前端 <span>5</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#数据库">
    		数据库 <span>30</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Git">
    		Git <span>6</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Mac">
    		Mac <span>18</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Tools">
    		Tools <span>7</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#OpenSource">
    		OpenSource <span>11</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Python">
    		Python <span>45</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#云平台">
    		云平台 <span>8</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#虚拟化">
    		虚拟化 <span>3</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Java">
    		Java <span>6</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Docker">
    		Docker <span>6</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Blog">
    		Blog <span>7</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#安全">
    		安全 <span>2</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#读书笔记">
    		读书笔记 <span>16</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#微服务">
    		微服务 <span>2</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Kubernetes">
    		Kubernetes <span>15</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#DaoCloud Enterprise">
    		DaoCloud Enterprise <span>2</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#春松客服">
    		春松客服 <span>1</span>
    	</a></li>
    
  



      </ul>
    </div>
    <div>
      <h2>最近文章</h2>
      <ul>
        
        <li>
          <a href="/post/2022/12/raycast-01.html">Raycast 你的年度报告已到达</a>
          从 Alfred 切换到 Raycast 也就 2 个多月的时间；使用体验有着比较大的提升。


        </li>
        
        <li>
          <a href="/post/2022/12/Skoala-Install-Dce5.html">DCE5-Skoala 安装教程</a>
          使用之前的话


        </li>
        
        <li>
          <a href="/post/2022/12/dce50.html">保姆式安装 DCE5.0</a>
          前言


        </li>
        
        <li>
          <a href="/post/2022/11/cskefu-opensource-project.html">开源项目 - 春松客服</a>
          项目起源


        </li>
        
        <li>
          <a href="/post/2022/11/what-is-hukou.html">What is Hukou</a>
          背景


        </li>
        
      </ul>
    </div>
  </div>
</div>

			</div>

		</div>

    <footer>
      <div class="container">
        <div class="row mobilepadding">
          			<hr>
      &copy; 2023 船长. Powered by <a href="http://jekyllrb.com" target="_blank" title="The simple, blog-aware, static site generator.">Jekyll</a>. Theme Creator <a href="https://github.com/einverne" target="_blank" title="Ein Verne's GitHub Repos">Ein Verne</a> . Host on <a href="https://github.com/samzong/samzong.me" target="_blank" title="Samzong's GitHub Repos">Github</a> .
      <br><br>
      </div>
    </div>
    </footer>

    




	<script async type="text/javascript" src="/assets/themes/evjekylltheme/bootstrap-3.3.5/js/bootstrap.min.js"></script>
	<script async type="text/javascript" src="/assets/themes/evjekylltheme/webcore.js"></script>

 </body>
</html>

