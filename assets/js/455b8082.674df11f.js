"use strict";(self.webpackChunksamzong_me=self.webpackChunksamzong_me||[]).push([[27059],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>m});var o=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=o.createContext({}),c=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},p=function(e){var n=c(e.components);return o.createElement(l.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},h=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(t),h=a,m=d["".concat(l,".").concat(h)]||d[h]||u[h]||i;return t?o.createElement(m,r(r({ref:n},p),{},{components:t})):o.createElement(m,r({ref:n},p))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,r=new Array(i);r[0]=h;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[d]="string"==typeof e?e:a,r[1]=s;for(var c=2;c<i;c++)r[c]=t[c];return o.createElement.apply(null,r)}return o.createElement.apply(null,t)}h.displayName="MDXCreateElement"},84074:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var o=t(87462),a=(t(67294),t(3905));const i={title:"\u4fdd\u59c6\u5f0f\u5b89\u88c5 DCE5.0"},r=void 0,s={permalink:"/notes/2022/12/06/dce5",source:"@site/blog/2022-12-06-dce5.md",title:"\u4fdd\u59c6\u5f0f\u5b89\u88c5 DCE5.0",description:"\u524d\u8a00",date:"2022-12-06T00:00:00.000Z",formattedDate:"December 6, 2022",tags:[],readingTime:43.665,hasTruncateMarker:!1,authors:[],frontMatter:{title:"\u4fdd\u59c6\u5f0f\u5b89\u88c5 DCE5.0"},prevItem:{title:"DCE5-Skoala \u5b89\u88c5\u6559\u7a0b",permalink:"/notes/2022/12/15/Skoala-Install-Dce5"},nextItem:{title:"\u6625\u677e\u5ba2\u670d",permalink:"/notes/2022/11/28/cskefu-opensource-project"}},l={authorsImageUrls:[]},c=[{value:"\u524d\u8a00",id:"\u524d\u8a00",level:2},{value:"\u96c6\u7fa4\u89c4\u5212",id:"\u96c6\u7fa4\u89c4\u5212",level:3},{value:"\u7ec4\u4ef6\u4ecb\u7ecd",id:"\u7ec4\u4ef6\u4ecb\u7ecd",level:3},{value:"\u8282\u70b9\u7cfb\u7edf\u4f18\u5316",id:"\u8282\u70b9\u7cfb\u7edf\u4f18\u5316",level:3},{value:"\u914d\u7f6e\u4e3b\u673a\u540d",id:"\u914d\u7f6e\u4e3b\u673a\u540d",level:4},{value:"\u6dfb\u52a0 /etc/hosts \u914d\u7f6e",id:"\u6dfb\u52a0-etchosts-\u914d\u7f6e",level:4},{value:"\u7981\u7528 Swap",id:"\u7981\u7528-swap",level:4},{value:"\u7981\u7528 SElinux",id:"\u7981\u7528-selinux",level:4},{value:"\u5173\u95ed\u9632\u706b\u5899",id:"\u5173\u95ed\u9632\u706b\u5899",level:4},{value:"\u5141\u8bb8 iptables \u68c0\u67e5\u6865\u63a5\u6d41\u91cf",id:"\u5141\u8bb8-iptables-\u68c0\u67e5\u6865\u63a5\u6d41\u91cf",level:4},{value:"K8s \u73af\u5883\u5b89\u88c5",id:"k8s-\u73af\u5883\u5b89\u88c5",level:2},{value:"\u5b89\u88c5 Docker",id:"\u5b89\u88c5-docker",level:3},{value:"\u5b89\u88c5 Docker \u7684\u8f6f\u4ef6\u6e90",id:"\u5b89\u88c5-docker-\u7684\u8f6f\u4ef6\u6e90",level:4},{value:"\u5b89\u88c5 Docker \u548c Containerd.io",id:"\u5b89\u88c5-docker-\u548c-containerdio",level:4},{value:"\u4fee\u6539 Docker \u7684\u914d\u7f6e",id:"\u4fee\u6539-docker-\u7684\u914d\u7f6e",level:4},{value:"\u4fee\u6539 Containerd \u7684\u914d\u7f6e",id:"\u4fee\u6539-containerd-\u7684\u914d\u7f6e",level:4},{value:"\u542f\u52a8\u670d\u52a1\u914d\u7f6e",id:"\u542f\u52a8\u670d\u52a1\u914d\u7f6e",level:4},{value:"\u68c0\u67e5\u914d\u7f6e\u6210\u529f",id:"\u68c0\u67e5\u914d\u7f6e\u6210\u529f",level:4},{value:"\u5b89\u88c5 Kubernetes \u7cfb\u7edf\u7ec4\u4ef6",id:"\u5b89\u88c5-kubernetes-\u7cfb\u7edf\u7ec4\u4ef6",level:3},{value:"\u5b89\u88c5 Kubernetes \u8f6f\u4ef6\u6e90",id:"\u5b89\u88c5-kubernetes-\u8f6f\u4ef6\u6e90",level:4},{value:"\u5b89\u88c5 Kubernetes \u7ec4\u4ef6",id:"\u5b89\u88c5-kubernetes-\u7ec4\u4ef6",level:4},{value:"\u542f\u52a8 <code>kubelet</code>\u7cfb\u7edf\u670d\u52a1",id:"\u542f\u52a8-kubelet\u7cfb\u7edf\u670d\u52a1",level:4},{value:"\u521d\u59cb\u5316 Master \u8282\u70b9",id:"\u521d\u59cb\u5316-master-\u8282\u70b9",level:3},{value:"\u52a0\u5165\u5de5\u4f5c\u8282\u70b9",id:"\u52a0\u5165\u5de5\u4f5c\u8282\u70b9",level:3},{value:"\u5b89\u88c5 CNI Calico",id:"\u5b89\u88c5-cni-calico",level:3},{value:"\u5b89\u88c5 Helm \u5e94\u7528",id:"\u5b89\u88c5-helm-\u5e94\u7528",level:2},{value:"\u5b89\u88c5 StorageClass",id:"\u5b89\u88c5-storageclass",level:2},{value:"\u5b89\u88c5 Helm \u4ed3\u5e93",id:"\u5b89\u88c5-helm-\u4ed3\u5e93",level:3},{value:"\u5b89\u88c5 HwameiStior \u5e94\u7528",id:"\u5b89\u88c5-hwameistior-\u5e94\u7528",level:3},{value:"\u68c0\u67e5 <code>LockDiskNode</code>\u548c <code>LockDisk</code>",id:"\u68c0\u67e5-lockdisknode\u548c-lockdisk",level:3},{value:"\u8bbe\u7f6e\u9ed8\u8ba4\u7684 <code>StorageClass</code>",id:"\u8bbe\u7f6e\u9ed8\u8ba4\u7684-storageclass",level:3},{value:"\u521b\u5efa\u5b58\u50a8\u6c60",id:"\u521b\u5efa\u5b58\u50a8\u6c60",level:3},{value:"\u5b89\u88c5 <code>Metrics server</code>",id:"\u5b89\u88c5-metrics-server",level:2},{value:"\u5b89\u88c5 DCE \u793e\u533a\u7248",id:"\u5b89\u88c5-dce-\u793e\u533a\u7248",level:2},{value:"\u5b89\u88c5\u57fa\u7840\u4f9d\u8d56",id:"\u5b89\u88c5\u57fa\u7840\u4f9d\u8d56",level:3},{value:"\u4e0b\u8f7d dce5-installer \u5b89\u88c5\u5668",id:"\u4e0b\u8f7d-dce5-installer-\u5b89\u88c5\u5668",level:3},{value:"\u5b89\u88c5\u914d\u7f6e\u6587\u4ef6 \u53ef\u9009",id:"\u5b89\u88c5\u914d\u7f6e\u6587\u4ef6-\u53ef\u9009",level:3},{value:"\u6267\u884c\u5b89\u88c5",id:"\u6267\u884c\u5b89\u88c5",level:3},{value:"\u5b89\u88c5\u5b8c\u6210",id:"\u5b89\u88c5\u5b8c\u6210",level:3},{value:"\u91cd\u5b9a\u5411\u767b\u5f55\u9875 Portal \u53cd\u5411\u4ee3\u7406",id:"\u91cd\u5b9a\u5411\u767b\u5f55\u9875-portal-\u53cd\u5411\u4ee3\u7406",level:3},{value:"\u7533\u8bf7\u793e\u533a\u7248\u514d\u8d39\u4f53\u9a8c",id:"\u7533\u8bf7\u793e\u533a\u7248\u514d\u8d39\u4f53\u9a8c",level:3}],p={toc:c},d="wrapper";function u(e){let{components:n,...t}=e;return(0,a.kt)(d,(0,o.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,a.kt)("p",null,"\u672c\u6587\u5b8c\u6210\u4e86\u4ece 0 \u5230 1 \u7684\u5b8c\u6210 DCE5.0 \u793e\u533a\u7248\u7684\u5b89\u88c5\uff1b\u5176\u4e2d\u5305\u542b\u793e\u533a\u7248\u9700\u8981\u4e00\u4e2a K8s \u96c6\u7fa4\u3001\u4e0e\u4e00\u4e9b\u5b89\u88c5\u7ec6\u8282\u548c\u6ce8\u610f\u4e8b\u9879\u3002"),(0,a.kt)("h3",{id:"\u96c6\u7fa4\u89c4\u5212"},"\u96c6\u7fa4\u89c4\u5212"),(0,a.kt)("p",null,"\u5f53\u524d\u8ba1\u5212\u4f7f\u7528\u5728 3 \u53f0 UCloud \u7684 VM\uff0c\u914d\u7f6e\u5747\u4e3a 8 \u6838 16G\u3002"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"\u89d2\u8272"),(0,a.kt)("th",{parentName:"tr",align:null},"\u4e3b\u673a\u540d"),(0,a.kt)("th",{parentName:"tr",align:null},"\u64cd\u4f5c\u7cfb\u7edf"),(0,a.kt)("th",{parentName:"tr",align:null},"IP"),(0,a.kt)("th",{parentName:"tr",align:null},"\u914d\u7f6e"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"master"),(0,a.kt)("td",{parentName:"tr",align:null},"master-k8s-com"),(0,a.kt)("td",{parentName:"tr",align:null},"CentOS 7.9"),(0,a.kt)("td",{parentName:"tr",align:null},"10.23.245.63"),(0,a.kt)("td",{parentName:"tr",align:null},"8 \u6838 16G 300GB")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"node01"),(0,a.kt)("td",{parentName:"tr",align:null},"node01-k8s-com"),(0,a.kt)("td",{parentName:"tr",align:null},"CentOS 7.9"),(0,a.kt)("td",{parentName:"tr",align:null},"10.23.104.173"),(0,a.kt)("td",{parentName:"tr",align:null},"8 \u6838 16G 300GB")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"node02"),(0,a.kt)("td",{parentName:"tr",align:null},"node02-k8s-com"),(0,a.kt)("td",{parentName:"tr",align:null},"CentOS 7.9"),(0,a.kt)("td",{parentName:"tr",align:null},"10.23.112.244"),(0,a.kt)("td",{parentName:"tr",align:null},"8 \u6838 16G 300GB")))),(0,a.kt)("h3",{id:"\u7ec4\u4ef6\u4ecb\u7ecd"},"\u7ec4\u4ef6\u4ecb\u7ecd"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Kubernetes  1.24.8"),(0,a.kt)("li",{parentName:"ul"},"CRI containerd"),(0,a.kt)("li",{parentName:"ul"},"CNI Calico"),(0,a.kt)("li",{parentName:"ul"},"StorageClass HwameiStior")),(0,a.kt)("h3",{id:"\u8282\u70b9\u7cfb\u7edf\u4f18\u5316"},"\u8282\u70b9\u7cfb\u7edf\u4f18\u5316"),(0,a.kt)("h4",{id:"\u914d\u7f6e\u4e3b\u673a\u540d"},"\u914d\u7f6e\u4e3b\u673a\u540d"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"hostnamctl set-hostname master-k8s-com\n")),(0,a.kt)("h4",{id:"\u6dfb\u52a0-etchosts-\u914d\u7f6e"},"\u6dfb\u52a0 /etc/hosts \u914d\u7f6e"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"cat <<EOF | tee /etc/hosts\n10.23.245.63    master-k8s-com\n10.23.104.173   node01-k8s-com\n10.23.112.244   node02-k8s-com\nEOF\n")),(0,a.kt)("h4",{id:"\u7981\u7528-swap"},"\u7981\u7528 Swap"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"swapoff -a\nsed -i '/ swap / s/^/#/' /etc/fstab\n")),(0,a.kt)("h4",{id:"\u7981\u7528-selinux"},"\u7981\u7528 SElinux"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"setenforce 0\nsed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config\n")),(0,a.kt)("h4",{id:"\u5173\u95ed\u9632\u706b\u5899"},"\u5173\u95ed\u9632\u706b\u5899"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"systemctl stop firewalld\nsystemctl disable firewalld\n")),(0,a.kt)("h4",{id:"\u5141\u8bb8-iptables-\u68c0\u67e5\u6865\u63a5\u6d41\u91cf"},"\u5141\u8bb8 iptables \u68c0\u67e5\u6865\u63a5\u6d41\u91cf"),(0,a.kt)("p",null,"\u52a0\u8f7d ",(0,a.kt)("inlineCode",{parentName:"p"},"br_netfilter")," \u6a21\u5757"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"cat <<EOF | tee /etc/modules-load.d/kubernetes.conf\nbr_netfilter\nEOF\n\n# \u52a0\u8f7d\u6a21\u5757\nmodprobe br_netfilter\n")),(0,a.kt)("p",null,"\u4fee\u6539 ",(0,a.kt)("inlineCode",{parentName:"p"},"net.bridge.bridge-nf-call-iptables")," \u8bbe\u7f6e\u4e3a 1"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"cat <<EOF | tee /etc/sysctl.d/kubernetes.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n\n# \u5237\u65b0\u914d\u7f6e\nsysctl --system\n")),(0,a.kt)("h2",{id:"k8s-\u73af\u5883\u5b89\u88c5"},"K8s \u73af\u5883\u5b89\u88c5"),(0,a.kt)("h3",{id:"\u5b89\u88c5-docker"},"\u5b89\u88c5 Docker"),(0,a.kt)("h4",{id:"\u5b89\u88c5-docker-\u7684\u8f6f\u4ef6\u6e90"},"\u5b89\u88c5 Docker \u7684\u8f6f\u4ef6\u6e90"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo yum install -y yum-utils\nsudo yum-config-manager \\\n    --add-repo \\\n    https://download.docker.com/linux/centos/docker-ce.repo\n")),(0,a.kt)("h4",{id:"\u5b89\u88c5-docker-\u548c-containerdio"},"\u5b89\u88c5 Docker \u548c Containerd.io"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo yum -y install docker-ce docker-ce-cli containerd.io\n")),(0,a.kt)("h4",{id:"\u4fee\u6539-docker-\u7684\u914d\u7f6e"},"\u4fee\u6539 Docker \u7684\u914d\u7f6e"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'sudo touch /etc/docker/daemon.json\n\ncat <<EOF | tee /etc/docker/daemon.json\n{\n  "exec-opts": ["native.cgroupdriver=systemd"]\n}\nEOF\n')),(0,a.kt)("h4",{id:"\u4fee\u6539-containerd-\u7684\u914d\u7f6e"},"\u4fee\u6539 Containerd \u7684\u914d\u7f6e"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# \u6e05\u7406\u914d\u7f6e\u6587\u4ef6\nsudo rm -f /etc/containerd/config.toml\n\n# \u521d\u59cb\u5316\u914d\u7f6e\nsudo containerd config default | sudo tee /etc/containerd/config.toml\n\n# \u66f4\u65b0\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\nsed -i 's/SystemdCgroup\\ =\\ false/SystemdCgroup\\ =\\ true/' /etc/containerd/config.toml\nsed 's/k8s.gcr.io\\/pause/registry.cn-hangzhou.aliyuncs.com\\/google_containers\\/pause/g' /etc/containerd/config.toml\n")),(0,a.kt)("h4",{id:"\u542f\u52a8\u670d\u52a1\u914d\u7f6e"},"\u542f\u52a8\u670d\u52a1\u914d\u7f6e"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl daemon-reload\nsudo systemctl enable --now docker\nsudo systemctl enable --now containerd\n")),(0,a.kt)("h4",{id:"\u68c0\u67e5\u914d\u7f6e\u6210\u529f"},"\u68c0\u67e5\u914d\u7f6e\u6210\u529f"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl status docker containerd\nsudo docker info\n")),(0,a.kt)("h3",{id:"\u5b89\u88c5-kubernetes-\u7cfb\u7edf\u7ec4\u4ef6"},"\u5b89\u88c5 Kubernetes \u7cfb\u7edf\u7ec4\u4ef6"),(0,a.kt)("h4",{id:"\u5b89\u88c5-kubernetes-\u8f6f\u4ef6\u6e90"},"\u5b89\u88c5 Kubernetes \u8f6f\u4ef6\u6e90"),(0,a.kt)("p",null,"\u8fd9\u91cc\u91c7\u7528\u56fd\u5185\u963f\u91cc\u4e91\u7684\u6e90\uff0c\u5177\u6709\u52a0\u901f\u6548\u679c"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n")),(0,a.kt)("h4",{id:"\u5b89\u88c5-kubernetes-\u7ec4\u4ef6"},"\u5b89\u88c5 Kubernetes \u7ec4\u4ef6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"echo K8sVersion=1.24.8\nsudo yum install -y kubelet-1.24.8-$K8sVersion kubeadm-1.24.8-$K8sVersion\nsudo yum install -y kubectl-1.24.8-$K8sVersion  # \u53ef\u4ee5\u4ec5\u5728 Master \u8282\u70b9\u5b89\u88c5\n")),(0,a.kt)("h4",{id:"\u542f\u52a8-kubelet\u7cfb\u7edf\u670d\u52a1"},"\u542f\u52a8 ",(0,a.kt)("inlineCode",{parentName:"h4"},"kubelet"),"\u7cfb\u7edf\u670d\u52a1"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl enable --now kubelet\n")),(0,a.kt)("p",null,"\u6b64\u65f6\u542f\u52a8\u540e\u670d\u52a1\u72b6\u6001\u5f02\u5e38\uff0c\u4f1a\u68c0\u67e5\u96c6\u7fa4\u914d\u7f6e\uff0c\u56e0\u4e3a\u6ca1\u6709\u914d\u7f6e\u4f1a\u4e0d\u65ad\u7684\u91cd\u542f\uff0c\u4e0d\u5f71\u54cd\u540e\u7eed\u64cd\u4f5c"),(0,a.kt)("h3",{id:"\u521d\u59cb\u5316-master-\u8282\u70b9"},"\u521d\u59cb\u5316 Master \u8282\u70b9"),(0,a.kt)("p",null,"\u6ce8\u610f\u89c4\u5212\u96c6\u7fa4\u4e3b\u8282\u70b9\u914d\u7f6e\uff0c\u521d\u59cb\u5316\u4e3b\u8282\u70b9\u65f6\uff0c\u89c4\u5212\u7f51\u7edc\u914d\u7f6e"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'# \u6307\u5b9a\u5bf9\u5e94\u7684 kubernetes \u7684\u7248\u672c\uff0c\u6ce8\u610f\u4e0e\u4e0a\u65b9\u914d\u7f6e\u4fdd\u6301\u4e00\u81f4\n$ sudokubeadm init --kubernetes-version=v1.24.8 \\\n --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers \\\n --pod-network-cidr 10.11.0.0/16 \\\n\n[init] Using Kubernetes version: v1.24.8\n[preflight] Running pre-flight checks\n[preflight] Pulling images required for setting up a Kubernetes cluster\n[preflight] This might take a minute or two, depending on the speed of your internet connection\n[preflight] You can also perform this action in beforehand using \'kubeadm config images pull\'\n[certs] Using certificateDir folder "/etc/kubernetes/pki"\n[certs] Generating "ca" certificate and key\n[certs] Generating "apiserver" certificate and key\n[certs] Generating "apiserver-kubelet-client" certificate and key\n[certs] Generating "front-proxy-ca" certificate and key\n[certs] Generating "front-proxy-client" certificate and key\n[certs] Generating "etcd/ca" certificate and key\n[certs] Generating "etcd/server" certificate and key\n[certs] Generating "etcd/peer" certificate and key\n[certs] Generating "etcd/healthcheck-client" certificate and key\n[certs] Generating "apiserver-etcd-client" certificate and key\n[certs] Generating "sa" key and public key\n[kubeconfig] Using kubeconfig folder "/etc/kubernetes"\n[kubeconfig] Writing "admin.conf" kubeconfig file\n[kubeconfig] Writing "kubelet.conf" kubeconfig file\n[kubeconfig] Writing "controller-manager.conf" kubeconfig file\n[kubeconfig] Writing "scheduler.conf" kubeconfig file\n[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"\n[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"\n[kubelet-start] Starting the kubelet\n[control-plane] Using manifest folder "/etc/kubernetes/manifests"\n[control-plane] Creating static Pod manifest for "kube-apiserver"\n[control-plane] Creating static Pod manifest for "kube-controller-manager"\n[control-plane] Creating static Pod manifest for "kube-scheduler"\n[etcd] Creating static Pod manifest for local etcd in "/etc/kubernetes/manifests"\n[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory "/etc/kubernetes/manifests". This can take up to 4m0s\n[apiclient] All control plane components are healthy after 6.503693 seconds\n[upload-config] Storing the configuration used in ConfigMap "kubeadm-config" in the "kube-system" Namespace\n[kubelet] Creating a ConfigMap "kubelet-config-1.24.8" in namespace kube-system with the configuration for the kubelets in the cluster\nNOTE: The "kubelet-config-1.24.8" naming of the kubelet ConfigMap is deprecated. Once the UnversionedKubeletConfigMap feature gate graduates to Beta the default name will become just "kubelet-config". Kubeadm upgrade will handle this transition transparently.\n[upload-certs] Skipping phase. Please see --upload-certs\n[mark-control-plane] Marking the node node1.k8s.com as control-plane by adding the labels: [node-role.kubernetes.io/master(deprecated) node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]\n[mark-control-plane] Marking the node node1.k8s.com as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]\n[bootstrap-token] Using token: c0wcm5.0yu9szfktsxvurza\n[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\n[bootstrap-token] Creating the "cluster-info" ConfigMap in the "kube-public" namespace\n[kubelet-finalize] Updating "/etc/kubernetes/kubelet.conf" to point to a rotatable kubelet client certificate and key\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nAlternatively, if you are the root user, you can run:\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun "kubectl apply -f [podnetwork].yaml" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 10.23.245.63:6443 --token djdsj2.sj23js90213j323 \\\n        --discovery-token-ca-cert-hash sha256:ewuosdjk2390rjertw32p32j43p25a70298db818ajsdjk1293jk23k23201934h\n')),(0,a.kt)("h3",{id:"\u52a0\u5165\u5de5\u4f5c\u8282\u70b9"},"\u52a0\u5165\u5de5\u4f5c\u8282\u70b9"),(0,a.kt)("p",null,"\u6ce8\u610f\u9700\u8981\u786e\u4fdd\u5b8c\u6210\u4e86\u524d\u9762\u7684\u6b65\u9aa4 \u8282\u70b9\u7cfb\u7edf\u4f18\u5316\u3001\u5b89\u88c5 Docker\u3001\u5b89\u88c5 Kubernetes \u7cfb\u7edf\u7ec4\u4ef6\uff0c\u5e76\u4e14\u6210\u529f\u5b8c\u6210 \u521d\u59cb\u5316 Master \u8282\u70b9"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubeadm join 10.23.245.63:6443 --token djdsj2.sj23js90213j323 \\\n        --discovery-token-ca-cert-hash sha256:ewuosdjk2390rjertw32p32j43p25a70298db818ajsdjk1293jk23k23201934h\n")),(0,a.kt)("p",null,"\u8bf7\u5206\u522b\u6dfb\u52a0 2 \u4e2a\u5de5\u4f5c\u8282\u70b9\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl get nodes\nNAME               STATUS   ROLES           AGE   VERSION\nmaster01-k8s-com   Ready    control-plane   9h    v1.24.8\nnode01-k8s-com     Ready    <none>          9h    v1.24.8\nnode02-k8s-com     Ready    <none>          9h    v1.24.8\n")),(0,a.kt)("h3",{id:"\u5b89\u88c5-cni-calico"},"\u5b89\u88c5 CNI Calico"),(0,a.kt)("p",null,"\u5c06\u4e0b\u53d1 ",(0,a.kt)("inlineCode",{parentName:"p"},"yaml"),"\u4fdd\u5b58\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"calico.yaml"),"\uff0c\u6216\u8005 \u5230\u6211\u7684 Github \u53bb\u4e0b\u8f7d\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"---\n# Source: calico/templates/calico-config.yaml\n# This ConfigMap is used to configure a self-hosted Calico installation.\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  # Typha is disabled.\n  typha_service_name: \"none\"\n  # Configure the backend to use.\n  calico_backend: \"bird\"\n\n  # Configure the MTU to use for workload interfaces and tunnels.\n  # By default, MTU is auto-detected, and explicitly setting this field should not be required.\n  # You can override auto-detection by providing a non-zero value.\n  veth_mtu: \"0\"\n\n  # The CNI network configuration to install on each node. The special\n  # values in this config will be automatically populated.\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.1\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"log_file_path\": \"/var/log/calico/cni/cni.log\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n              \"type\": \"calico-ipam\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        },\n        {\n          \"type\": \"bandwidth\",\n          \"capabilities\": {\"bandwidth\": true}\n        }\n      ]\n    }\n\n---\n# Source: calico/templates/kdd-crds.yaml\n\napiVersion: apiextensions.k8s.io/v1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  group: crd.projectcalico.org\n  names:\n    kind: BGPConfiguration\n    listKind: BGPConfigurationList\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n  scope: Cluster\n  versions:\n  - name: v1\n    schema:\n      openAPIV3Schema:\n        description: BGPConfiguration contains the configuration for any BGP routing.\n        properties:\n          apiVersion:\n            description: 'APIVersion defines the versioned schema of this representation\n              of an object. Servers should convert recognized schemas to the latest\n              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'\n            type: string\n          kind:\n            description: 'Kind is a string value representing the REST resource this\n              object represents. Servers may infer this from the endpoint the client\n              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'\n            type: string\n          metadata:\n            type: object\n          spec:\n            description: BGPConfigurationSpec contains the values of the BGP configuration.\n            properties:\n              asNumber:\n                description: 'ASNumber is the default AS number used by a node. [Default:\n                  64512]'\n                format: int32\n                type: integer\n              communities:\n                description: Communities is a list of BGP community values and their\n                  arbitrary names for tagging routes.\n                items:\n                  description: Community contains standard or large community value\n                    and its name.\n                  properties:\n                    name:\n                      description: Name given to community value.\n                      type: string\n                    value:\n                      description: Value must be of format `aa:nn` or `aa:nn:mm`.\n                        For standard community use `aa:nn` format, where `aa` and\n                        `nn` are 16 bit number. For large community use `aa:nn:mm`\n                        format, where `aa`, `nn` and `mm` are 32 bit number. Where,\n                        `aa` is an AS Number, `nn` and `mm` are per-AS identifier.\n                      pattern: ^(\\d+):(\\d+)$|^(\\d+):(\\d+):(\\d+)$\n                      type: string\n                  type: object\n                type: array\n              listenPort:\n                description: ListenPort is the port where BGP protocol should listen.\n                  Defaults to 179\n                maximum: 65535\n                minimum: 1\n                type: integer\n              logSeverityScreen:\n                description: 'LogSeverityScreen is the log severity above which logs\n                  are sent to the stdout. [Default: INFO]'\n                type: string\n              nodeToNodeMeshEnabled:\n                description: 'NodeToNodeMeshEnabled sets whether full node to node\n                  BGP mesh is enabled. [Default: true]'\n                type: boolean\n              prefixAdvertisements:\n                description: PrefixAdvertisements contains per-prefix advertisement\n                  configuration.\n                items:\n                  description: PrefixAdvertisement configures advertisement properties\n                    for the specified CIDR.\n                  properties:\n                    cidr:\n                      description: CIDR for which properties should be advertised.\n                      type: string\n                    communities:\n                      description: Communities can be list of either community names\n                        already defined in `Specs.Communities` or community value\n                        of format `aa:nn` or `aa:nn:mm`. For standard community use\n                        `aa:nn` format, where `aa` and `nn` are 16 bit number. For\n                        large community use `aa:nn:mm` format, where `aa`, `nn` and\n                        `mm` are 32 bit number. Where,`aa` is an AS Number, `nn` and\n                        `mm` are per-AS identifier.\n                      items:\n                        type: string\n                      type: array\n                  type: object\n                type: array\n              serviceClusterIPs:\n                description: ServiceClusterIPs are the CIDR blocks from which service\n                  cluster IPs are allocated. If specified, Calico will advertise these\n                  blocks, as well as any cluster IPs within them.\n                items:\n                  description: ServiceClusterIPBlock represents a single allowed ClusterIP\n                    CIDR block.\n                  properties:\n                    cidr:\n                      type: string\n                  type: object\n                type: array\n              serviceExternalIPs:\n                description: ServiceExternalIPs are the CIDR blocks for Kubernetes\n                  Service External IPs. Kubernetes Service ExternalIPs will only be\n                  advertised if they are within one of these blocks.\n                items:\n                  description: ServiceExternalIPBlock represents a single allowed\n                    External IP CIDR block.\n                  properties:\n                    cidr:\n                      type: string\n                  type: object\n                type: array\n              serviceLoadBalancerIPs:\n                description: ServiceLoadBalancerIPs are the CIDR blocks for Kubernetes\n                  Service LoadBalancer IPs. Kubernetes Service status.LoadBalancer.Ingress\n                  IPs will only be advertised if they are within one of these blocks.\n                items:\n                  description: ServiceLoadBalancerIPBlock represents a single allowed\n                    LoadBalancer IP CIDR block.\n                  properties:\n                    cidr:\n                      type: string\n                  type: object\n                type: array\n            type: object\n        type: object\n    served: true\n    storage: true\nstatus:\n  acceptedNames:\n    kind: \"\"\n    plural: \"\"\n  conditions: []\n  storedVersions: []\n\n---\napiVersion: apiextensions.k8s.io/v1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  group: crd.projectcalico.org\n  names:\n    kind: BGPPeer\n    listKind: BGPPeerList\n    plural: bgppeers\n    singular: bgppeer\n  scope: Cluster\n  versions:\n  - name: v1\n    schema:\n      openAPIV3Schema:\n        properties:\n          apiVersion:\n            description: 'APIVersion defines the versioned schema of this representation\n              of an object. Servers should convert recognized schemas to the latest\n              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'\n            type: string\n          kind:\n            description: 'Kind is a string value representing the REST resource this\n              object represents. Servers may infer this from the endpoint the client\n              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'\n            type: string\n          metadata:\n            type: object\n          spec:\n            description: BGPPeerSpec contains the specification for a BGPPeer resource.\n            properties:\n              asNumber:\n                description: The AS Number of the peer.\n                format: int32\n                type: integer\n              keepOriginalNextHop:\n                description: Option to keep the original nexthop field when routes\n                  are sent to a BGP Peer. Setting \"true\" configures the selected BGP\n                  Peers node to use the \"next hop keep;\" instead of \"next hop self;\"(default)\n                  in the specific branch of the Node on \"bird.cfg\".\n                type: boolean\n              node:\n                description: The node name identifying the Calico node instance that\n                  is targeted by this peer. If this is not set, and no nodeSelector\n                  is specified, then this BGP peer selects all nodes in the cluster.\n                type: string\n              nodeSelector:\n                description: Selector for the nodes that should have this peering.  When\n                  this is set, the Node field must be empty.\n                type: string\n              password:\n                description: Optional BGP password for the peerings generated by this\n                  BGPPeer resource.\n                properties:\n                  secretKeyRef:\n                    description: Selects a key of a secret in the node pod's namespace.\n                    properties:\n                      key:\n                        description: The key of the secret to select from.  Must be\n                          a valid secret key.\n                        type: string\n                      name:\n                        description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names\n                          TODO: Add other useful fields. apiVersion, kind, uid?'\n                        type: string\n                      optional:\n                        description: Specify whether the Secret or its key must be\n                          defined\n                        type: boolean\n                    required:\n                    - key\n                    type: object\n                type: object\n              peerIP:\n                description: The IP address of the peer followed by an optional port\n                  number to peer with. If port number is given, format should be `[<IPv6>]:port`\n                  or `<IPv4>:<port>` for IPv4. If optional port number is not set,\n                  and this peer IP and ASNumber belongs to a calico/node with ListenPort\n                  set in BGPConfiguration, then we use that port to peer.\n                type: string\n              peerSelector:\n                description: Selector for the remote nodes to peer with.  When this\n                  is set, the PeerIP and ASNumber fields must be empty.  For each\n                  peering between the local node and selected remote nodes, we configure\n                  an IPv4 peering if both ends have NodeBGPSpec.IPv4Address specified,\n                  and an IPv6 peering if both ends have NodeBGPSpec.IPv6Address specified.  The\n                  remote AS number comes from the remote node's NodeBGPSpec.ASNumber,\n                  or the global default if that is not set.\n                type: string\n              sourceAddress:\n                description: Specifies whether and how to configure a source address\n                  for the peerings generated by this BGPPeer resource.  Default value\n                  \"UseNodeIP\" means to configure the node IP as the source address.  \"None\"\n                  means not to configure a source address.\n                type: string\n            type: object\n        type: object\n    served: true\n    storage: true\nstatus:\n  acceptedNames:\n    kind: \"\"\n    plural: \"\"\n  conditions: []\n  storedVersions: []\n\n---\napiVersion: apiextensions.k8s.io/v1\nkind: CustomResourceDefinition\nmetadata:\n  name: blockaffinities.crd.projectcalico.org\nspec:\n  group: crd.projectcalico.org\n  names:\n    kind: BlockAffinity\n    listKind: BlockAffinityList\n    plural: blockaffinities\n    singular: blockaffinity\n  scope: Cluster\n  versions:\n  - name: v1\n    schema:\n      openAPIV3Schema:\n        properties:\n          apiVersion:\n            description: 'APIVersion defines the versioned schema of this representation\n              of an object. Servers should convert recognized schemas to the latest\n              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'\n            type: string\n          kind:\n            description: 'Kind is a string value representing the REST resource this\n              object represents. Servers may infer this from the endpoint the client\n              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'\n            type: string\n          metadata:\n            type: object\n          spec:\n            description: BlockAffinitySpec contains the specification for a BlockAffinity\n              resource.\n            properties:\n              cidr:\n                type: string\n              deleted:\n                description: Deleted indicates that this block affinity is being deleted.\n                  This field is a string for compatibility with older releases that\n                  mistakenly treat this field as a string.\n                type: string\n              node:\n                type: string\n              state:\n                type: string\n            required:\n            - cidr\n            - deleted\n            - node\n            - state\n            type: object\n        type: object\n    served: true\n    storage: true\nstatus:\n  acceptedNames:\n    kind: \"\"\n    plural: \"\"\n  conditions: []\n  storedVersions: []\n\n---\napiVersion: apiextensions.k8s.io/v1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  group: crd.projectcalico.org\n  names:\n    kind: ClusterInformation\n    listKind: ClusterInformationList\n    plural: clusterinformations\n    singular: clusterinformation\n  scope: Cluster\n  versions:\n  - name: v1\n    schema:\n      openAPIV3Schema:\n        description: ClusterInformation contains the cluster specific information.\n        properties:\n          apiVersion:\n            description: 'APIVersion defines the versioned schema of this representation\n              of an object. Servers should convert recognized schemas to the latest\n              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'\n            type: string\n          kind:\n            description: 'Kind is a string value representing the REST resource this\n              object represents. Servers may infer this from the endpoint the client\n              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'\n            type: string\n          metadata:\n            type: object\n          spec:\n            description: ClusterInformationSpec contains the values of describing\n              the cluster.\n            properties:\n              calicoVersion:\n                description: CalicoVersion is the version of Calico that the cluster\n                  is running\n                type: string\n              clusterGUID:\n                description: ClusterGUID is the GUID of the cluster\n                type: string\n              clusterType:\n                description: ClusterType describes the type of the cluster\n                type: string\n              datastoreReady:\n                description: DatastoreReady is used during significant datastore migrations\n                  to signal to components such as Felix that it should wait before\n                  accessing the datastore.\n                type: boolean\n              variant:\n                description: Variant declares which variant of Calico should be active.\n                type: string\n            type: object\n        type: object\n    served: true\n    storage: true\nstatus:\n  acceptedNames:\n    kind: \"\"\n    plural: \"\"\n  conditions: []\n  storedVersions: []\n\n---\napiVersion: apiextensions.k8s.io/v1\nkind: CustomResourceDefinition\nmetadata:\n  name: felixconfigurations.crd.projectcalico.org\nspec:\n  group: crd.projectcalico.org\n  names:\n    kind: FelixConfiguration\n    listKind: FelixConfigurationList\n    plural: felixconfigurations\n    singular: felixconfiguration\n  scope: Cluster\n  versions:\n  - name: v1\n    schema:\n      openAPIV3Schema:\n        description: Felix Configuration contains the configuration for Felix.\n        properties:\n          apiVersion:\n            description: 'APIVersion defines the versioned schema of this representation\n              of an object. Servers should convert recognized schemas to the latest\n              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'\n            type: string\n          kind:\n            description: 'Kind is a string value representing the REST resource this\n              object represents. Servers may infer this from the endpoint the client\n              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'\n            type: string\n          metadata:\n            type: object\n          spec:\n            description: FelixConfigurationSpec contains the values of the Felix configuration.\n            properties:\n              allowIPIPPacketsFromWorkloads:\n                description: 'AllowIPIPPacketsFromWorkloads controls whether Felix\n                  will add a rule to drop IPIP encapsulated traffic from workloads\n                  [Default: false]'\n                type: boolean\n              allowVXLANPacketsFromWorkloads:\n                description: 'AllowVXLANPacketsFromWorkloads controls whether Felix\n                  will add a rule to drop VXLAN encapsulated traffic from workloads\n                  [Default: false]'\n                type: boolean\n              awsSrcDstCheck:\n                description: 'Set source-destination-check on AWS EC2 instances. Accepted\n                  value must be one of \"DoNothing\", \"Enabled\" or \"Disabled\". [Default:\n                  DoNothing]'\n                enum:\n                - DoNothing\n                - Enable\n                - Disable\n                type: string\n              bpfConnectTimeLoadBalancingEnabled:\n                description: 'BPFConnectTimeLoadBalancingEnabled when in BPF mode,\n                  controls whether Felix installs the connection-time load balancer.  The\n                  connect-time load balancer is required for the host to be able to\n                  reach Kubernetes services and it improves the performance of pod-to-service\n                  connections.  The only reason to disable it is for debugging purposes.  [Default:\n                  true]'\n                type: boolean\n              bpfDataIfacePattern:\n                description: BPFDataIfacePattern is a regular expression that controls\n                  which interfaces Felix should attach BPF programs to in order to\n                  catch traffic to/from the network.  This needs to match the interfaces\n                  that Calico workload traffic flows over as well as any interfaces\n                  that handle incoming traffic to nodeports and services from outside\n                  the cluster.  It should not match the workload interfaces (usually\n                  named cali...).\n                type: string\n              bpfDisableUnprivileged:\n                description: 'BPFDisableUnprivileged, if enabled, Felix sets the kernel.unprivileged_bpf_disabled\n                  sysctl to disable unprivileged use of BPF.  This ensures that unprivileged\n                  users cannot access Calico''s BPF maps and cannot insert their own\n                  BPF programs to interfere with Calico''s. [Default: true]'\n                type: boolean\n              bpfEnabled:\n                description: 'BPFEnabled, if enabled Felix will use the BPF dataplane.\n                  [Default: false]'\n                type: boolean\n              bpfExtToServiceConnmark:\n                description: 'BPFExtToServiceConnmark in BPF mode, control a 32bit\n                  mark that is set on connections from an external client to a local\n                  service. This mark allows us to control how packets of that connection\n                  are routed within the host and how is routing intepreted by RPF\n                  check. [Default: 0]'\n                type: integer\n              bpfExternalServiceMode:\n                description: 'BPFExternalServiceMode in BPF mode, controls how connections\n                  from outside the cluster to services (node ports and cluster IPs)\n                  are forwarded to remote workloads.  If set to \"Tunnel\" then both\n                  request and response traffic is tunneled to the remote node.  If\n                  set to \"DSR\", the request traffic is tunneled but the response traffic\n                  is sent directly from the remote node.  In \"DSR\" mode, the remote\n                  node appears to use the IP of the ingress node; this requires a\n                  permissive L2 network.  [Default: Tunnel]'\n                type: string\n              bpfKubeProxyEndpointSlicesEnabled:\n                description: BPFKubeProxyEndpointSlicesEnabled in BPF mode, controls\n                  whether Felix's embedded kube-proxy accepts EndpointSlices or not.\n                type: boolean\n              bpfKubeProxyIptablesCleanupEnabled:\n                description: 'BPFKubeProxyIptablesCleanupEnabled, if enabled in BPF\n                  mode, Felix will proactively clean up the upstream Kubernetes kube-proxy''s\n                  iptables chains.  Should only be enabled if kube-proxy is not running.  [Default:\n                  true]'\n                type: boolean\n              bpfKubeProxyMinSyncPeriod:\n                description: 'BPFKubeProxyMinSyncPeriod, in BPF mode, controls the\n                  minimum time between updates to the dataplane for Felix''s embedded\n                  kube-proxy.  Lower values give reduced set-up latency.  Higher values\n                  reduce Felix CPU usage by batching up more work.  [Default: 1s]'\n                type: string\n              bpfLogLevel:\n                description: 'BPFLogLevel controls the log level of the BPF programs\n                  when in BPF dataplane mode.  One of \"Off\", \"Info\", or \"Debug\".  The\n                  logs are emitted to the BPF trace pipe, accessible with the command\n                  `tc exec bpf debug`. [Default: Off].'\n                type: string\n              chainInsertMode:\n                description: 'ChainInsertMode controls whether Felix hooks the kernel''s\n                  top-level iptables chains by inserting a rule at the top of the\n                  chain or by appending a rule at the bottom. insert is the safe default\n                  since it prevents Calico''s rules from being bypassed. If you switch\n                  to append mode, be sure that the other rules in the chains signal\n                  acceptance by falling through to the Calico rules, otherwise the\n                  Calico policy will be bypassed. [Default: insert]'\n                type: string\n              dataplaneDriver:\n                type: string\n              debugDisableLogDropping:\n                type: boolean\n              debugMemoryProfilePath:\n                type: string\n              debugSimulateCalcGraphHangAfter:\n                type: string\n              debugSimulateDataplaneHangAfter:\n                type: string\n              defaultEndpointToHostAction:\n                description: 'DefaultEndpointToHostAction controls what happens to\n                  traffic that goes from a workload endpoint to the host itself (after\n                  the traffic hits the endpoint egress policy). By default Calico\n                  blocks traffic from workload endpoints to the host itself with an\n                  iptables \"DROP\" action. If you want to allow some or all traffic\n                  from endpoint to host, set this parameter to RETURN or ACCEPT. Use\n                  RETURN if you have your own rules in the iptables \"INPUT\" chain;\n                  Calico will insert its rules at the top of that chain, then \"RETURN\"\n                  packets to the \"INPUT\" chain once it has completed processing workload\n                  endpoint egress policy. Use ACCEPT to unconditionally accept packets\n                  from workloads after processing workload endpoint egress policy.\n                  [Default: Drop]'\n                type: string\n              deviceRouteProtocol:\n                description: This defines the route protocol added to programmed device\n                  routes, by default this will be RTPROT_BOOT when left blank.\n                type: integer\n              deviceRouteSourceAddress:\n                description: This is the source address to use on programmed device\n                  routes. By default the source address is left blank, leaving the\n                  kernel to choose the source address used.\n                type: string\n              disableConntrackInvalidCheck:\n                type: boolean\n              endpointReportingDelay:\n                type: string\n              endpointReportingEnabled:\n                type: boolean\n              externalNodesList:\n                description: ExternalNodesCIDRList is a list of CIDR's of external-non-calico-nodes\n                  which may source tunnel traffic and have the tunneled traffic be\n                  accepted at calico nodes.\n                items:\n                  type: string\n                type: array\n              failsafeInboundHostPorts:\n                description: 'FailsafeInboundHostPorts is a list of UDP/TCP ports\n                  and CIDRs that Felix will allow incoming traffic to host endpoints\n                  on irrespective of the security policy. This is useful to avoid\n                  accidentally cutting off a host with incorrect configuration. For\n                  back-compatibility, if the protocol is not specified, it defaults\n                  to \"tcp\". If a CIDR is not specified, it will allow traffic from\n                  all addresses. To disable all inbound host ports, use the value\n                  none. The default value allows ssh access and DHCP. [Default: tcp:22,\n                  udp:68, tcp:179, tcp:2379, tcp:2380, tcp:6443, tcp:6666, tcp:6667]'\n                items:\n                  description: ProtoPort is combination of protocol, port, and CIDR.\n                    Protocol and port must be specified.\n                  properties:\n                    net:\n                      type: string\n                    port:\n                      type: integer\n                    protocol:\n                      type: string\n                  required:\n                  - port\n                  - protocol\n                  type: object\n                type: array\n              failsafeOutboundHostPorts:\n                description: 'FailsafeOutboundHostPorts is a list of UDP/TCP ports\n                  and CIDRs that Felix will allow outgoing traffic from host endpoints\n                  to irrespective of the security policy. This is useful to avoid\n                  accidentally cutting off a host with incorrect configuration. For\n                  back-compatibility, if the protocol is not specified, it defaults\n                  to \"tcp\". If a CIDR is not specified, it will allow traffic from\n                  all addresses. To disable all outbound host ports, use the value\n                  none. The default value opens etcd''s standard ports to ensure that\n                  Felix does not get cut off from etcd as well as allowing DHCP and\n                  DNS. [Default: tcp:179, tcp:2379, tcp:2380, tcp:6443, tcp:6666,\n                  tcp:6667, udp:53, udp:67]'\n                items:\n                  description: ProtoPort is combination of protocol, port, and CIDR.\n                    Protocol and port must be specified.\n                  properties:\n                    net:\n                      type: string\n                    port:\n                      type: integer\n                    protocol:\n                      type: string\n                  required:\n                  - port\n                  - protocol\n                  type: object\n                type: array\n              featureDetectOverride:\n                description: FeatureDetectOverride is used to override the feature\n                  detection. Values are specified in a comma separated list with no\n                  spaces, example; \"SNATFullyRandom=true,MASQFullyRandom=false,RestoreSupportsLock=\".\n                  \"true\" or \"false\" will force the feature, empty or omitted values\n                  are auto-detected.\n                type: string\n              genericXDPEnabled:\n                description: 'GenericXDPEnabled enables Generic XDP so network cards\n                  that don''t support XDP offload or driver modes can use XDP. This\n                  is not recommended since it doesn''t provide better performance\n                  than iptables. [Default: false]'\n                type: boolean\n              healthEnabled:\n                type: boolean\n              healthHost:\n                type: string\n              healthPort:\n                type: integer\n              interfaceExclude:\n                description: 'InterfaceExclude is a comma-separated list of interfaces\n                  that Felix should exclude when monitoring for host endpoints. The\n                  default value ensures that Felix ignores Kubernetes'' IPVS dummy\n                  interface, which is used internally by kube-proxy. If you want to\n                  exclude multiple interface names using a single value, the list\n                  supports regular expressions. For regular expressions you must wrap\n                  the value with ''/''. For example having values ''/^kube/,veth1''\n                  will exclude all interfaces that begin with ''kube'' and also the\n                  interface ''veth1''. [Default: kube-ipvs0]'\n                type: string\n              interfacePrefix:\n                description: 'InterfacePrefix is the interface name prefix that identifies\n                  workload endpoints and so distinguishes them from host endpoint\n                  interfaces. Note: in environments other than bare metal, the orchestrators\n                  configure this appropriately. For example our Kubernetes and Docker\n                  integrations set the ''cali'' value, and our OpenStack integration\n                  sets the ''tap'' value. [Default: cali]'\n                type: string\n              interfaceRefreshInterval:\n                description: InterfaceRefreshInterval is the period at which Felix\n                  rescans local interfaces to verify their state. The rescan can be\n                  disabled by setting the interval to 0.\n                type: string\n              ipipEnabled:\n                type: boolean\n              ipipMTU:\n                description: 'IPIPMTU is the MTU to set on the tunnel device. See\n                  Configuring MTU [Default: 1440]'\n                type: integer\n              ipsetsRefreshInterval:\n                description: 'IpsetsRefreshInterval is the period at which Felix re-checks\n                  all iptables state to ensure that no other process has accidentally\n                  broken Calico''s rules. Set to 0 to disable iptables refresh. [Default:\n                  90s]'\n                type: string\n              iptablesBackend:\n                description: IptablesBackend specifies which backend of iptables will\n                  be used. The default is legacy.\n                type: string\n              iptablesFilterAllowAction:\n                type: string\n              iptablesLockFilePath:\n                description: 'IptablesLockFilePath is the location of the iptables\n                  lock file. You may need to change this if the lock file is not in\n                  its standard location (for example if you have mapped it into Felix''s\n                  container at a different path). [Default: /run/xtables.lock]'\n                type: string\n              iptablesLockProbeInterval:\n                description: 'IptablesLockProbeInterval is the time that Felix will\n                  wait between attempts to acquire the iptables lock if it is not\n                  available. Lower values make Felix more responsive when the lock\n                  is contended, but use more CPU. [Default: 50ms]'\n                type: string\n              iptablesLockTimeout:\n                description: 'IptablesLockTimeout is the time that Felix will wait\n                  for the iptables lock, or 0, to disable. To use this feature, Felix\n                  must share the iptables lock file with all other processes that\n                  also take the lock. When running Felix inside a container, this\n                  requires the /run directory of the host to be mounted into the calico/node\n                  or calico/felix container. [Default: 0s disabled]'\n                type: string\n              iptablesMangleAllowAction:\n                type: string\n              iptablesMarkMask:\n                description: 'IptablesMarkMask is the mask that Felix selects its\n                  IPTables Mark bits from. Should be a 32 bit hexadecimal number with\n                  at least 8 bits set, none of which clash with any other mark bits\n                  in use on the system. [Default: 0xff000000]'\n                format: int32\n                type: integer\n              iptablesNATOutgoingInterfaceFilter:\n                type: string\n              iptablesPostWriteCheckInterval:\n                description: 'IptablesPostWriteCheckInterval is the period after Felix\n                  has done a write to the dataplane that it schedules an extra read\n                  back in order to check the write was not clobbered by another process.\n                  This should only occur if another application on the system doesn''t\n                  respect the iptables lock. [Default: 1s]'\n                type: string\n              iptablesRefreshInterval:\n                description: 'IptablesRefreshInterval is the period at which Felix\n                  re-checks the IP sets in the dataplane to ensure that no other process\n                  has accidentally broken Calico''s rules. Set to 0 to disable IP\n                  sets refresh. Note: the default for this value is lower than the\n                  other refresh intervals as a workaround for a Linux kernel bug that\n                  was fixed in kernel version 4.11. If you are using v4.11 or greater\n                  you may want to set this to, a higher value to reduce Felix CPU\n                  usage. [Default: 10s]'\n                type: string\n              ipv6Support:\n                type: boolean\n              kubeNodePortRanges:\n                description: 'KubeNodePortRanges holds list of port ranges used for\n                  service node ports. Only used if felix detects kube-proxy running\n                  in ipvs mode. Felix uses these ranges to separate host and workload\n                  traffic. [Default: 30000:32767].'\n                items:\n                  anyOf:\n                  - type: integer\n                  - type: string\n                  pattern: ^.*\n                  x-kubernetes-int-or-string: true\n                type: array\n              logFilePath:\n                description: 'LogFilePath is the full path to the Felix log. Set to\n                  none to disable file logging. [Default: /var/log/calico/felix.log]'\n                type: string\n              logPrefix:\n                description: 'LogPrefix is the log prefix that Felix uses when rendering\n                  LOG rules. [Default: calico-packet]'\n                type: string\n              logSeverityFile:\n                description: 'LogSeverityFile is the log severity above which logs\n                  are sent to the log file. [Default: Info]'\n                type: string\n              logSeverityScreen:\n                description: 'LogSeverityScreen is the log severity above which logs\n                  are sent to the stdout. [Default: Info]'\n                type: string\n              logSeveritySys:\n                description: 'LogSeveritySys is the log severity above which logs\n                  are sent to the syslog. Set to None for no logging to syslog. [Default:\n                  Info]'\n                type: string\n              maxIpsetSize:\n                type: integer\n              metadataAddr:\n                description: 'MetadataAddr is the IP address or domain name of the\n                  server that can answer VM queries for cloud-init metadata. In OpenStack,\n                  this corresponds to the machine running nova-api (or in Ubuntu,\n                  nova-api-metadata). A value of none (case insensitive) means that\n                  Felix should not set up any NAT rule for the metadata path. [Default:\n                  127.0.0.1]'\n                type: string\n              metadataPort:\n                description: 'MetadataPort is the port of the metadata server. This,\n                  combined with global.MetadataAddr (if not ''None''), is used to\n                  set up a NAT rule, from 169.254.169.254:80 to MetadataAddr:MetadataPort.\n                  In most cases this should not need to be changed [Default: 8775].'\n                type: integer\n              mtuIfacePattern:\n                description: MTUIfacePattern is a regular expression that controls\n                  which interfaces Felix should scan in order to calculate the host's\n                  MTU. This should not match workload interfaces (usually named cali...).\n                type: string\n              natOutgoingAddress:\n                description: NATOutgoingAddress specifies an address to use when performing\n                  source NAT for traffic in a natOutgoing pool that is leaving the\n                  network. By default the address used is an address on the interface\n                  the traffic is leaving on (ie it uses the iptables MASQUERADE target)\n                type: string\n              natPortRange:\n                anyOf:\n                - type: integer\n                - type: string\n                description: NATPortRange specifies the range of ports that is used\n                  for port mapping when doing outgoing NAT. When unset the default\n                  behavior of the network stack is used.\n                pattern: ^.*\n                x-kubernetes-int-or-string: true\n              netlinkTimeout:\n                type: string\n              openstackRegion:\n                description: 'OpenstackRegion is the name of the region that a particular\n                  Felix belongs to. In a multi-region Calico/OpenStack deployment,\n                  this must be configured somehow for each Felix (here in the datamodel,\n                  or in felix.cfg or the environment on each compute node), and must\n                  match the [calico] openstack_region value configured in neutron.conf\n                  on each node. [Default: Empty]'\n                type: string\n              policySyncPathPrefix:\n                description: 'PolicySyncPathPrefix is used to by Felix to communicate\n                  policy changes to external services, like Application layer policy.\n                  [Default: Empty]'\n                type: string\n              prometheusGoMetricsEnabled:\n                description: 'PrometheusGoMetricsEnabled disables Go runtime metrics\n                  collection, which the Prometheus client does by default, when set\n                  to false. This reduces the number of metrics reported, reducing\n                  Prometheus load. [Default: true]'\n                type: boolean\n              prometheusMetricsEnabled:\n                description: 'PrometheusMetricsEnabled enables the Prometheus metrics\n                  server in Felix if set to true. [Default: false]'\n                type: boolean\n              prometheusMetricsHost:\n                description: 'PrometheusMetricsHost is the host that the Prometheus\n                  metrics server should bind to. [Default: empty]'\n                type: string\n              prometheusMetricsPort:\n                description: 'PrometheusMetricsPort is the TCP port that the Prometheus\n                  metrics server should bind to. [Default: 9091]'\n                type: integer\n              prometheusProcessMetricsEnabled:\n                description: 'PrometheusProcessMetricsEnabled disables process metrics\n                  collection, which the Prometheus client does by default, when set\n                  to false. This reduces the number of metrics reported, reducing\n                  Prometheus load. [Default: true]'\n                type: boolean\n              removeExternalRoutes:\n                description: Whether or not to remove device routes that have not\n                  been programmed by Felix. Disabling this will allow external applications\n                  to also add device routes. This is enabled by default which means\n                  we will remove externally added routes.\n                type: boolean\n              reportingInterval:\n                description: 'ReportingInterval is the interval at which Felix reports\n                  its status into the datastore or 0 to disable. Must be non-zero\n                  in OpenStack deployments. [Default: 30s]'\n                type: string\n              reportingTTL:\n                description: 'ReportingTTL is the time-to-live setting for process-wide\n                  status reports. [Default: 90s]'\n                type: string\n              routeRefreshInterval:\n                description: 'RouteRefreshInterval is the period at which Felix re-checks\n                  the routes in the dataplane to ensure that no other process has\n                  accidentally broken Calico''s rules. Set to 0 to disable route refresh.\n                  [Default: 90s]'\n                type: string\n              routeSource:\n                description: 'RouteSource configures where Felix gets its routing\n                  information. - WorkloadIPs: use workload endpoints to construct\n                  routes. - CalicoIPAM: the default - use IPAM data to construct routes.'\n                type: string\n              routeTableRange:\n                description: Calico programs additional Linux route tables for various\n                  purposes.  RouteTableRange specifies the indices of the route tables\n                  that Calico should use.\n                properties:\n                  max:\n                    type: integer\n                  min:\n                    type: integer\n                required:\n                - max\n                - min\n                type: object\n              serviceLoopPrevention:\n                description: 'When service IP advertisement is enabled, prevent routing\n                  loops to service IPs that are not in use, by dropping or rejecting\n                  packets that do not get DNAT''d by kube-proxy. Unless set to \"Disabled\",\n                  in which case such routing loops continue to be allowed. [Default:\n                  Drop]'\n                type: string\n              sidecarAccelerationEnabled:\n                description: 'SidecarAccelerationEnabled enables experimental sidecar\n                  acceleration [Default: false]'\n                type: boolean\n              usageReportingEnabled:\n                description: 'UsageReportingEnabled reports anonymous Calico version\n                  number and cluster size to projectcalico.org. Logs warnings returned\n                  by the usage server. For example, if a significant security vulnerability\n                  has been discovered in the version of Calico being used. [Default:\n                  true]'\n                type: boolean\n              usageReportingInitialDelay:\n                description: 'UsageReportingInitialDelay controls the minimum delay\n                  before Felix makes a report. [Default: 300s]'\n                type: string\n              usageReportingInterval:\n                description: 'UsageReportingInterval controls the interval at which\n                  Felix makes reports. [Default: 86400s]'\n                type: string\n              useInternalDataplaneDriver:\n                type: boolean\n              vxlanEnabled:\n                type: boolean\n              vxlanMTU:\n                description: 'VXLANMTU is the MTU to set on the tunnel device. See\n                  Configuring MTU [Default: 1440]'\n                type: integer\n              vxlanPort:\n                type: integer\n              vxlanVNI:\n                type: integer\n              wireguardEnabled:\n                description: 'WireguardEnabled controls whether Wireguard is enabled.\n                  [Default: false]'\n                type: boolean\n              wireguardInterfaceName:\n                description: 'WireguardInterfaceName specifies the name to use for\n                  the Wireguard interface. [Default: wg.calico]'\n                type: string\n              wireguardListeningPort:\n                description: 'WireguardListeningPort controls the listening port used\n                  by Wireguard. [Default: 51820]'\n                type: integer\n              wireguardMTU:\n                description: 'WireguardMTU controls the MTU on the Wireguard interface.\n                  See Configuring MTU [Default: 1420]'\n                type: integer\n              wireguardRoutingRulePriority:\n                description: 'WireguardRoutingRulePriority controls the priority value\n                  to use for the Wireguard routing rule. [Default: 99]'\n                type: integer\n              xdpEnabled:\n                description: 'XDPEnabled enables XDP acceleration for suitable untracked\n                  incoming deny rules. [Default: true]'\n                type: boolean\n              xdpRefreshInterval:\n                description: 'XDPRefreshInterval is the period at which Felix re-checks\n                  all XDP state to ensure that no other process has accidentally broken\n                  Calico''s BPF maps or attached programs. Set to 0 to disable XDP\n                  refresh. [Default: 90s]'\n                type: string\n            type: object\n        type: object\n    served: true\n    storage: true\nstatus:\n  acceptedNames:\n    kind: \"\"\n    plural: \"\"\n  conditions: []\n  storedVersions: []\n\n---\napiVersion: apiextensions.k8s.io/v1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  group: crd.projectcalico.org\n  names:\n    kind: GlobalNetworkPolicy\n    listKind: GlobalNetworkPolicyList\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n  scope: Cluster\n  versions:\n  - name: v1\n    schema:\n      openAPIV3Schema:\n        properties:\n          apiVersion:\n            description: 'APIVersion defines the versioned schema of this representation\n              of an object. Servers should convert recognized schemas to the latest\n              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'\n            type: string\n          kind:\n            description: 'Kind is a string value representing the REST resource this\n              object represents. Servers may infer this from the endpoint the client\n              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'\n            type: string\n          metadata:\n            type: object\n          spec:\n            properties:\n              applyOnForward:\n                description: ApplyOnForward indicates to apply the rules in this policy\n                  on forward traffic.\n                type: boolean\n              doNotTrack:\n                description: DoNotTrack indicates whether packets matched by the rules\n                  in this policy should go through the data plane's connection tracking,\n                  such as Linux conntrack.  If True, the rules in this policy are\n                  applied before any data plane connection tracking, and packets allowed\n                  by this policy are marked as not to be tracked.\n                type: boolean\n              egress:\n                description: The ordered set of egress rules.  Each rule contains\n                  a set of packet match criteria and a corresponding action to apply.\n                items:\n                  description: \"A Rule encapsulates a set of match criteria and an\n                    action.  Both selector-based security Policy and security Profiles\n                    reference rules - separated out as a list of rules for both ingress\n                    and egress packet matching. \\n Each positive match criteria has\n                    a negated version, prefixed with \\\"Not\\\". All the match criteria\n                    within a rule must be satisfied for a packet to match. A single\n                    rule can contain the positive and negative version of a match\n                    and both must be satisfied for the rule to match.\"\n                  properties:\n                    action:\n                      type: string\n                    destination:\n                      description: Destination contains the match criteria that apply\n                        to destination entity.\n                      properties:\n                        namespaceSelector:\n                          description: \"NamespaceSelector is an optional field that\n                            contains a selector expression. Only traffic that originates\n                            from (or terminates at) endpoints within the selected\n                            namespaces will be matched. When both NamespaceSelector\n                            and Selector are defined on the same rule, then only workload\n                            endpoints that are matched by both selectors will be selected\n                            by the rule. \\n For NetworkPolicy, an empty NamespaceSelector\n                            implies that the Selector is limited to selecting only\n                            workload endpoints in the same namespace as the NetworkPolicy.\n                            \\n For NetworkPolicy, `global()` NamespaceSelector implies\n                            that the Selector is limited to selecting only GlobalNetworkSet\n                            or HostEndpoint. \\n For GlobalNetworkPolicy, an empty\n                            NamespaceSelector implies the Selector applies to workload\n                            endpoints across all namespaces.\"\n                          type: string\n                        nets:\n                          description: Nets is an optional field that restricts the\n                            rule to only apply to traffic that originates from (or\n                            terminates at) IP addresses in any of the given subnets.\n                          items:\n                            type: string\n                          type: array\n                        notNets:\n                          description: NotNets is the negated version of the Nets\n                            field.\n                          items:\n                            type: string\n                          type: array\n                        notPorts:\n                          description: NotPorts is the negated version of the Ports\n                            field. Since only some protocols have ports, if any ports\n                            are specified it requires the Protocol match in the Rule\n                            to be set to \"TCP\" or \"UDP\".\n                          items:\n                            anyOf:\n                            - type: integer\n                            - type: string\n                            pattern: ^.*\n                            x-kubernetes-int-or-string: true\n                          type: array\n                        notSelector:\n                          description: NotSelector is the negated version of the Selector\n                            field.  See Selector field for subtleties with negated\n                            selectors.\n                          type: string\n                        ports:\n                          description: \"Ports is an optional field that restricts\n                            the rule to only apply to traffic that has a source (destination)\n                            port that matches one of these ranges/values. This value\n                            is a list of integers or strings that represent ranges\n                            of ports. \\n Since only some protocols have ports, if\n                            any ports are specified it requires the Protocol match\n                            in the Rule to be set to \\\"TCP\\\" or \\\"UDP\\\".\"\n                          items:\n                            anyOf:\n                            - type: integer\n                            - type: string\n                            pattern: ^.*\n                            x-kubernetes-int-or-string: true\n                          type: array\n                        selector:\n                          description: \"Selector is an optional field that contains\n                            a selector expression (see Policy for sample syntax).\n                            \\ Only traffic that originates from (terminates at) endpoints\n                            matching the selector will be matched. \\n Note that: in\n                            addition to the negated version of the Selector (see NotSelector\n                            below), the selector expression syntax itself supports\n                            negation.  The two types of negation are subtly different.\n                            One negates the set of matched endpoints, the other negates\n                            the whole match: \\n \\tSelector = \\\"!has(my_label)\\\" matches\n                            packets that are from other Calico-controlled \\tendpoints\n                            that do not have the label \\\"my_label\\\". \\n \\tNotSelector\n                            = \\\"has(my_label)\\\" matches packets that are not from\n                            Calico-controlled \\tendpoints that do have the label \\\"my_label\\\".\n                            \\n The effect is that the latter will accept packets from\n                            non-Calico sources whereas the former is limited to packets\n                            from Calico-controlled endpoints.\"\n                          type: string\n                        serviceAccounts:\n                          description: ServiceAccounts is an optional field that restricts\n                            the rule to only apply to traffic that originates from\n                            (or terminates at) a pod running as a matching service\n                            account.\n                          properties:\n                            names:\n                              description: Names is an optional field that restricts\n                                the rule to only apply to traffic that originates\n                                from (or terminates at) a pod running as a service\n                                account whose name is in the list.\n                              items:\n                                type: string\n                              type: array\n                            selector:\n                              description: Selector is an optional field that restricts\n                                the rule to only apply to traffic that originates\n                                from (or terminates at) a pod running as a service\n                                account that matches the given label selector. If\n                                both Names and Selector are specified then they are\n                                AND'ed.\n                              type: string\n                          type: object\n                      type: object\n                    http:\n                      description: HTTP contains match criteria that apply to HTTP\n                        requests.\n                      properties:\n                        methods:\n                          description: Methods is an optional field that restricts\n                            the rule to apply only to HTTP requests that use one of\n                            the listed HTTP Methods (e.g. GET, PUT, etc.) Multiple\n                            methods are OR'd together.\n                          items:\n                            type: string\n                          type: array\n                        paths:\n                          description: 'Paths is an optional field that restricts\n                            the rule to apply to HTTP requests that use one of the\n                            listed HTTP Paths. Multiple paths are OR''d together.\n                            e.g: - exact: /foo - prefix: /bar NOTE: Each entry may\n                            ONLY specify either a `exact` or a `prefix` match. The\n                            validator will check for it.'\n                          items:\n                            description: 'HTTPPath specifies an HTTP path to match.\n                              It may be either of the form: exact: <path>: which matches\n                              the path exactly or prefix: <path-prefix>: which matches\n                              the path prefix'\n                            properties:\n                              exact:\n                                type: string\n                              prefix:\n                                type: string\n                            type: object\n                          type: array\n                      type: object\n                    icmp:\n                      description: ICMP is an optional field that restricts the rule\n                        to apply to a specific type and code of ICMP traffic.  This\n                        should only be specified if the Protocol field is set to \"ICMP\"\n                        or \"ICMPv6\".\n                      properties:\n                        code:\n                          description: Match on a specific ICMP code.  If specified,\n                            the Type value must also be specified. This is a technical\n                            limitation imposed by the kernel's iptables firewall,\n                            which Calico uses to enforce the rule.\n                          type: integer\n                        type:\n                          description: Match on a specific ICMP type.  For example\n                            a value of 8```\n\n\u6267\u884c\u521d\u59cb\u5316 `Calico`\u547d\u4ee4\n\n```bash\nkubectl apply -f calico.yaml\n")),(0,a.kt)("h2",{id:"\u5b89\u88c5-helm-\u5e94\u7528"},"\u5b89\u88c5 Helm \u5e94\u7528"),(0,a.kt)("p",null,"\u8fd9\u91cc\u4f7f\u7528 Helm 3\uff0c\u6ce8\u610f\u5b89\u88c5\u811a\u672c\u4e0b\u8f7d\u6700\u65b0\u7248\u672c"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3\nchmod 700 get_helm.sh\n./get_helm.sh\n")),(0,a.kt)("h2",{id:"\u5b89\u88c5-storageclass"},"\u5b89\u88c5 StorageClass"),(0,a.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5b89\u88c5 K8s \u9ed8\u8ba4 localdisk \u4f5c\u4e3a\u9ed8\u8ba4\u5b58\u50a8\uff0c\u8fd9\u91cc\u91c7\u7528\u5f00\u6e90\u9879\u76ee Hwameistor \u7528\u4f5c\u672c\u5730\u78c1\u76d8\u7ba1\u7406\u3002"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u9879\u76ee\u4ecb\u7ecd\uff1a ",(0,a.kt)("a",{parentName:"p",href:"https://hwameistor.io"},"https://hwameistor.io"),"\n\u5b89\u88c5\u6307\u5f15\uff1a ",(0,a.kt)("a",{parentName:"p",href:"https://hwameistor.io/cn/docs/quick_start/install/deploy"},"https://hwameistor.io/cn/docs/quick_start/install/deploy"))),(0,a.kt)("h3",{id:"\u5b89\u88c5-helm-\u4ed3\u5e93"},"\u5b89\u88c5 Helm \u4ed3\u5e93"),(0,a.kt)("p",null,"Hwameistor \u4f9d\u8d56 Helm \u8fdb\u884c\u5b89\u88c5\uff0c\u6240\u4ee5\u4e8b\u5148 \u9700\u8981\u5b8c\u6210 Helm \u5e94\u7528\u7684\u5b89\u88c5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"helm repo add hwameistor http://hwameistor.io/hwameistor\n\nhelm repo update hwameistor\n\nhelm pull hwameistor/hwameistor --untar\n")),(0,a.kt)("h3",{id:"\u5b89\u88c5-hwameistior-\u5e94\u7528"},"\u5b89\u88c5 HwameiStior \u5e94\u7528"),(0,a.kt)("p",null,"\u4f7f\u7528\u955c\u50cf\u4ed3\u5e93\u5b89\u88c5\uff0c\u8981\u5207\u6362\u955c\u50cf\u4ed3\u5e93\u7684\u955c\u50cf\uff0c\u8bf7\u4f7f\u7528 --set \u66f4\u6539\u8fd9\u4e24\u4e2a\u53c2\u6570\u503c\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"global.k8sImageRegistry")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"global.hwameistorImageRegistry")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u6ce8\u610f\u9ed8\u8ba4\u7684\u955c\u50cf\u4ed3\u5e93 quay.io \u548c ghcr.io\u3002\u5982\u679c\u65e0\u6cd5\u8bbf\u95ee\uff0c\u53ef\u5c1d\u8bd5\u4f7f\u7528 DaoCloud \u63d0\u4f9b\u7684\u955c\u50cf\u6e90 quay.m.daocloud.io \u548c ghcr.m.daocloud.io")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm install hwameistor ./hwameistor \\\n    -n hwameistor --create-namespace \\\n    --set global.k8sImageRegistry=k8s-gcr.m.daocloud.io \\\n    --set global.hwameistorImageRegistry=ghcr.m.daocloud.io\n")),(0,a.kt)("p",null,"\u68c0\u67e5 Hwameistor \u7684\u5168\u90e8 Pod \u72b6\u6001"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl -n hwameistor get pod\nNAME                                                       READY   STATUS\nhwameistor-local-disk-csi-controller-665bb7f47d-6227f      2/2     Running\nhwameistor-local-disk-manager-5ph2d                        2/2     Running\nhwameistor-local-disk-manager-jhj59                        2/2     Running\nhwameistor-local-disk-manager-k9cvj                        2/2     Running\nhwameistor-local-disk-manager-kxwww                        2/2     Running\nhwameistor-local-storage-csi-controller-667d949fbb-k488w   3/3     Running\nhwameistor-local-storage-csqqv                             2/2     Running\nhwameistor-local-storage-gcrzm                             2/2     Running\nhwameistor-local-storage-v8g7t                             2/2     Running\nhwameistor-local-storage-zkwmn                             2/2     Running\nhwameistor-scheduler-58dfcf79f5-lswkt                      1/1     Running\nhwameistor-webhook-986479678-278cr                         1/1     Running\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"local-disk-manager \u548c local-storage \u662f DaemonSet\u3002\u5728\u6bcf\u4e2a Kubernetes \u8282\u70b9\u4e0a\u90fd\u5e94\u8be5\u6709\u4e00\u4e2a DaemonSet Pod\u3002")),(0,a.kt)("p",null,"\u7b49\u5230\u5168\u90e8\u72b6\u6001\u6b63\u5e38\u540e\uff0c\u53ef\u8fdb\u884c\u540e\u7eed\u64cd\u4f5c\uff0c\u68c0\u67e5 ",(0,a.kt)("inlineCode",{parentName:"p"},"StorageClass")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl get storageclass hwameistor-storage-lvm-hdd\nNAME                                   PROVISIONER         RECLAIMPOLICY\nhwameistor-storage-lvm-hdd (default)   lvm.hwameistor.io   Delete\n")),(0,a.kt)("h3",{id:"\u68c0\u67e5-lockdisknode\u548c-lockdisk"},"\u68c0\u67e5 ",(0,a.kt)("inlineCode",{parentName:"h3"},"LockDiskNode"),"\u548c ",(0,a.kt)("inlineCode",{parentName:"h3"},"LockDisk")),(0,a.kt)("p",null,"\u9ed8\u8ba4\u5728\u4f7f\u7528\u7684\u78c1\u76d8\u72b6\u6001\u5e94\u8be5 ",(0,a.kt)("inlineCode",{parentName:"p"},"PHASE")," \u5c55\u793a\u4f4d ",(0,a.kt)("inlineCode",{parentName:"p"},"Bound")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl get localdisknodes\nNAME               NODEMATCH          PHASE\nmaster01-k8s-com   master01-k8s-com   Bound\nnode01-k8s-com     node01-k8s-com     Bound\nnode02-k8s-com     node02-k8s-com     Bound\n\n$ kubectl get localdisks\nNAME                   NODEMATCH          CLAIM              PHASE\nmaster01-k8s-com-vda   master01-k8s-com                      Bound\nmaster01-k8s-com-vdb   master01-k8s-com   master01-k8s-com   Bound\nnode01-k8s-com-vda     node01-k8s-com                        Bound\nnode01-k8s-com-vdb     node01-k8s-com     node01-k8s-com     Bound\nnode02-k8s-com-vda     node02-k8s-com                        Bound\nnode02-k8s-com-vdb     node02-k8s-com     node02-k8s-com     Bound\n")),(0,a.kt)("h3",{id:"\u8bbe\u7f6e\u9ed8\u8ba4\u7684-storageclass"},"\u8bbe\u7f6e\u9ed8\u8ba4\u7684 ",(0,a.kt)("inlineCode",{parentName:"h3"},"StorageClass")),(0,a.kt)("p",null,"\u8fd9\u4e2a\u5bf9\u5e94\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"storageclasses"),"\u589e\u52a0\u6807\u8bc6\u4e3a\u9ed8\u8ba4\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"annotations")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl patch storageclasses.storage.k8s.io hwameistor-storage-lvm-hdd -p \'{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}\'\n')),(0,a.kt)("h3",{id:"\u521b\u5efa\u5b58\u50a8\u6c60"},"\u521b\u5efa\u5b58\u50a8\u6c60"),(0,a.kt)("p",null,"\u4f7f\u7528\u4e0b\u65b9\u7684\u547d\u4ee4\u521b\u5efa\u5bf9\u5e94\u7684\u5b58\u50a8\u6c60\uff0c\u6ce8\u610f\u66ff\u6362\u5bf9\u5e94\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"nodeName")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ helm template ./hwameistor \\\n   -s templates/post-install-claim-disks.yaml \\\n   --set storageNodes='{master01-k8s-com,node01-k8s-com,node02-k8s-com}' \\\n   | kubectl apply -f -\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u521b\u5efa\u6210\u529f\u540e\uff0c\u67e5\u770b\u672c\u5730\u78c1\u76d8\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"ldc"),"\uff0c\u5e94\u8be5\u5168\u90e8\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Bound"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl get ldc\n")),(0,a.kt)("h2",{id:"\u5b89\u88c5-metrics-server"},"\u5b89\u88c5 ",(0,a.kt)("inlineCode",{parentName:"h2"},"Metrics server")),(0,a.kt)("p",null,"\u63a5\u4e0b\u6765\u9700\u8981\u5b89\u88c5\u7684 DCE5.0 \u9700\u8981\u5b89\u88c5 ",(0,a.kt)("inlineCode",{parentName:"p"},"metrics-server"),"\uff0c\u5c06\u4e0b\u65b9\u7684\u6587\u4ef6\u5185\u5bb9\u4fdd\u5b58\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"metrics-server.yaml")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    k8s-app: metrics-server\n    rbac.authorization.k8s.io/aggregate-to-admin: "true"\n    rbac.authorization.k8s.io/aggregate-to-edit: "true"\n    rbac.authorization.k8s.io/aggregate-to-view: "true"\n  name: system:aggregated-metrics-reader\nrules:\n- apiGroups:\n  - metrics.k8s.io\n  resources:\n  - pods\n  - nodes\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: system:metrics-server\nrules:\n- apiGroups:\n  - ""\n  resources:\n  - nodes/metrics\n  verbs:\n  - get\n- apiGroups:\n  - ""\n  resources:\n  - pods\n  - nodes\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server-auth-reader\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: extension-apiserver-authentication-reader\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server:system:auth-delegator\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:auth-delegator\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: system:metrics-server\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:metrics-server\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\nspec:\n  ports:\n  - name: https\n    port: 443\n    protocol: TCP\n    targetPort: https\n  selector:\n    k8s-app: metrics-server\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\nspec:\n  selector:\n    matchLabels:\n      k8s-app: metrics-server\n  strategy:\n    rollingUpdate:\n      maxUnavailable: 0\n  template:\n    metadata:\n      labels:\n        k8s-app: metrics-server\n    spec:\n      containers:\n      - args:\n        - --cert-dir=/tmp\n        - --secure-port=4443\n        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname\n        - --kubelet-use-node-status-port\n        - --metric-resolution=15s\n        - --kubelet-insecure-tls\n        image: registry.cn-hangzhou.aliyuncs.com/chenby/metrics-server:v0.6.2\n        imagePullPolicy: IfNotPresent\n        livenessProbe:\n          failureThreshold: 3\n          httpGet:\n            path: /livez\n            port: https\n            scheme: HTTPS\n          periodSeconds: 10\n        name: metrics-server\n        ports:\n        - containerPort: 4443\n          name: https\n          protocol: TCP\n        readinessProbe:\n          failureThreshold: 3\n          httpGet:\n            path: /readyz\n            port: https\n            scheme: HTTPS\n          initialDelaySeconds: 20\n          periodSeconds: 10\n        resources:\n          requests:\n            cpu: 100m\n            memory: 200Mi\n        securityContext:\n          allowPrivilegeEscalation: false\n          readOnlyRootFilesystem: true\n          runAsNonRoot: true\n          runAsUser: 1000\n        volumeMounts:\n        - mountPath: /tmp\n          name: tmp-dir\n      nodeSelector:\n        kubernetes.io/os: linux\n      priorityClassName: system-cluster-critical\n      serviceAccountName: metrics-server\n      volumes:\n      - emptyDir: {}\n        name: tmp-dir\n---\napiVersion: apiregistration.k8s.io/v1\nkind: APIService\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: v1beta1.metrics.k8s.io\nspec:\n  group: metrics.k8s.io\n  groupPriorityMinimum: 100\n  insecureSkipTLSVerify: true\n  service:\n    name: metrics-server\n    namespace: kube-system\n  version: v1beta1\n  versionPriority: 100\n')),(0,a.kt)("p",null,"\u6267\u884c\u5b89\u88c5\u547d\u4ee4\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f  metrics-server.yaml\n")),(0,a.kt)("p",null,"\u5b89\u88c5\u6210\u529f\u540e\uff0c\u901a\u8fc7\u4e0b\u65b9\u547d\u4ee4\u53ef\u4ee5\u6210\u529f\u7684\u770b\u5230 node \u8282\u70b9\u7684\u8d44\u6e90\u5229\u7528\u60c5\u51b5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl top node\nNAME               CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%\nmaster01-k8s-com   218m         5%     5610Mi          35%\nnode01-k8s-com     445m         11%    9279Mi          59%\nnode02-k8s-com     464m         11%    9484Mi          60%\n")),(0,a.kt)("h2",{id:"\u5b89\u88c5-dce-\u793e\u533a\u7248"},"\u5b89\u88c5 DCE \u793e\u533a\u7248"),(0,a.kt)("p",null,"\u4ee5\u4e0b\u64cd\u4f5c\u6b65\u9aa4\u5c06\u4f1a\u5e26\u7740\u60a8\u4e00\u6b65\u4e00\u6b65\u5b8c\u6210 DaoCloud Enterprise 5.0 \u793e\u533a\u7248\u7684\u5b8c\u6574\u5b89\u88c5\uff0c\u6ce8\u610f\u5b89\u88c5\u7ec6\u8282"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5b98\u65b9\u6587\u6863\u4ecb\u7ecd ",(0,a.kt)("a",{parentName:"li",href:"https://docs.daocloud.io/"},"https://docs.daocloud.io/")),(0,a.kt)("li",{parentName:"ul"},"\u5b89\u88c5\u4f9d\u8d56\u9879 ",(0,a.kt)("a",{parentName:"li",href:"https://docs.daocloud.io/install/install-tools/"},"https://docs.daocloud.io/install/install-tools/")),(0,a.kt)("li",{parentName:"ul"},"\u5728\u7ebf\u5b89\u88c5\u6807\u51c6\u793e\u533a\u7248 ",(0,a.kt)("a",{parentName:"li",href:"https://docs.daocloud.io/install/community/k8s/online/#_1"},"https://docs.daocloud.io/install/community/k8s/online/"))),(0,a.kt)("h3",{id:"\u5b89\u88c5\u57fa\u7840\u4f9d\u8d56"},"\u5b89\u88c5\u57fa\u7840\u4f9d\u8d56"),(0,a.kt)("p",null,"DCE \u5df2\u7ecf\u63d0\u4f9b\u4e86\u4e00\u952e\u5b89\u88c5\u7684\u79bb\u7ebf\u5de5\u5177\u4f9d\u8d56\u5305\uff0c\u7ecf\u8fc7\u6d4b\u8bd5\u6bd4\u8f83\u7a33\u5b9a\u7684\u8fd0\u884c\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"CentOS 7")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"CentOS 8"),"\uff0c\u5982\u679c\u60a8\u4e5f\u662f\u8fd9\u6837\u4e24\u4e2a\u7cfb\u7edf\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u65b9\u811a\u672c\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"curl -LO https://proxy-qiniu-download-public.daocloud.io/DaoCloud_Enterprise/dce5/install_prerequisite.sh\nchmod +x install_prerequisite.sh\nsudo bash install_prerequisite.sh online community\n")),(0,a.kt)("p",null,"\u4e5f\u53ef\u4ee5\u9009\u62e9\u624b\u52a8\u5b89\u88c5\u8fd9\u4e9b\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"podman"),(0,a.kt)("li",{parentName:"ul"},"helm \u2265 3.9.4"),(0,a.kt)("li",{parentName:"ul"},"skopeo \u2265 1.9.2"),(0,a.kt)("li",{parentName:"ul"},"kind"),(0,a.kt)("li",{parentName:"ul"},"kubectl \u2265 1.22.0"),(0,a.kt)("li",{parentName:"ul"},"yq \u2265 4.27.5"),(0,a.kt)("li",{parentName:"ul"},"minio client")),(0,a.kt)("h3",{id:"\u4e0b\u8f7d-dce5-installer-\u5b89\u88c5\u5668"},"\u4e0b\u8f7d dce5-installer \u5b89\u88c5\u5668"),(0,a.kt)("p",null,"\u6ce8\u610f\uff0c\u9700\u8981\u5728 Master \u8282\u70b9 \u6765\u8fdb\u884c dce5-installer \u7684\u5b89\u88c5\uff0c\u5efa\u8bae\u76f4\u63a5\u4e0b\u8f7d\u5230\u5f53\u524d\u8282\u70b9"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u83b7\u53d6\u6700\u65b0\u7248\u672c\u7684\u67e5\u770b\u754c\u9762\uff1a ",(0,a.kt)("a",{parentName:"p",href:"https://docs.daocloud.io/download/dce5/#_1"},"https://docs.daocloud.io/download/dce5/#_1"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# \u5047\u5b9a VERSION \u4e3a v0.3.28 , \u4f7f\u7528\u4e0a\u65b9\u94fe\u63a5\u83b7\u53d6\u6700\u65b0\u7248\u672c\n$ export VERSION=v0.3.28\n$ curl -Lo ./dce5-installer  https://proxy-qiniu-download-public.daocloud.io/DaoCloud_Enterprise/dce5/dce5-installer-$VERSION\n\n$ chmod +x dce5-installer\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u5982\u679c",(0,a.kt)("inlineCode",{parentName:"p"},"proxy-qiniu-download-public.daocloud.io")," \u94fe\u63a5\u5931\u6548\uff0c\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"qiniu-download-public.daocloud.io"))),(0,a.kt)("h3",{id:"\u5b89\u88c5\u914d\u7f6e\u6587\u4ef6-\u53ef\u9009"},"\u5b89\u88c5\u914d\u7f6e\u6587\u4ef6 ","[\u53ef\u9009]"),(0,a.kt)("p",null,"\u5c06\u4e0b\u65b9\u7684\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u4fdd\u5b58\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"clusterconfig.yaml"),"\uff0c\u5982\u679c\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"NodePort"),"\u7684\u65b9\u5f0f\u5b89\u88c5\u5219\u4e0d\u9700\u8981\u7279\u5b9a\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: provision.daocloud.io/v1alpha1\nkind: ClusterConfig\nspec:\n loadBalancer: metallb\n istioGatewayVip: 10.6.229.10/32  # \u8fd9\u662f Istio gateway \u7684 VIP\uff0c\u4e5f\u4f1a\u662f DCE 5.0 \u7684\u63a7\u5236\u53f0\u7684\u6d4f\u89c8\u5668\u8bbf\u95ee IP\n insightVip: 10.6.229.11/32  # \u8fd9\u662f Global \u96c6\u7fa4\u7684 Insight-Server \u91c7\u96c6\u5b50\u96c6\u7fa4\u7684\u76d1\u63a7\u6307\u6807\u7684\u7f51\u7edc\u8def\u5f84\u7528\u7684 VIP\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u5982\u679c\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\uff0c\u6ce8\u610f\u9700\u8981 \u4e8b\u5148\u5b89\u88c5 ",(0,a.kt)("inlineCode",{parentName:"p"},"MetaLB"),"\uff0c\u8fd9\u4e00\u90e8\u5206\u9700\u8981\u81ea\u884c\u5b8c\u6210\u3002")),(0,a.kt)("h3",{id:"\u6267\u884c\u5b89\u88c5"},"\u6267\u884c\u5b89\u88c5"),(0,a.kt)("p",null,"\u6839\u636e\u9700\u6c42\u9009\u62e9\u4e0b\u65b9\u7684\u5b89\u88c5\u6587\u4ef6\uff0c\u5982\u679c\u9009\u62e9\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u5185\u7684"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# \u65e0\u914d\u7f6e\u6587\u4ef6\n$ ./dce5-installer install-app\n\n# \u6709\u6307\u5b9a loadBalancer\n$ ./dce5-installer install-app -c clusterConfig.yaml\n")),(0,a.kt)("h3",{id:"\u5b89\u88c5\u5b8c\u6210"},"\u5b89\u88c5\u5b8c\u6210"),(0,a.kt)("p",null,"\u5982\u679c\u770b\u5230\u4e0b\u65b9\u7684\u9875\u9762\uff0c\u8bf4\u660e\u5b89\u88c5\u6210\u529f\u4e86\uff1b\u9ed8\u8ba4\u8d26\u53f7\u5bc6\u7801\u4e3a\uff1a ",(0,a.kt)("inlineCode",{parentName:"p"},"admin/changeme")),(0,a.kt)("img",{src:"http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/J9lNN0.jpg?x-oss-process=image/resize,w_960,m_lfit",alt:"resize,w_960,m_lfit"}),(0,a.kt)("h3",{id:"\u91cd\u5b9a\u5411\u767b\u5f55\u9875-portal-\u53cd\u5411\u4ee3\u7406"},"\u91cd\u5b9a\u5411\u767b\u5f55\u9875 Portal \u53cd\u5411\u4ee3\u7406"),(0,a.kt)("p",null,"\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5b89\u88c5\u540e\u7684\u96c6\u7fa4\u8bbf\u95ee\u5730\u5740\u662f\u4e00\u4e2a\u5185\u7f51\u5730\u5740\uff0c\u5f53\u6211\u4eec\u9700\u8981\u96c6\u7fa4\u9875\u9762\u5f00\u653e\u5230\u516c\u7f51\u8bbf\u95ee\u65f6\uff0c\u4f1a\u53d1\u73b0\u767b\u5f55\u9875\u4f1a\u81ea\u52a8\u91cd\u5b9a\u5411\u5185\u7f51\u5730\u5740\uff0c\u8fd9\u662f\u56e0\u4e3a DCE 5.0 \u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\u5730\u5740\u9ed8\u8ba4\u662f\u5b89\u88c5\u65f6\u7684\u914d\u7f6e\uff1b\u9700\u8981\u4f5c\u51fa\u4ee5\u4e0b\u66f4\u65b0\uff1a"),(0,a.kt)("p",null,"\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u65b9\u4fbf\u5728\u540e\u7eed\u4e2d\u4f7f\u7528"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'# \u60a8\u7684\u53cd\u5411\u4ee3\u7406\u5730\u5740\uff0c\u4f8b\u5982\uff1a`export DCE_PROXY="https://demo-alpha.daocloud.io"`\nexport DCE_PROXY="https://domain:port"\n\n# helm --set \u53c2\u6570\u5907\u4efd\u6587\u4ef6\nexport GHIPPO_VALUES_BAK="ghippo-values-bak.yaml"\n\n# \u83b7\u53d6\u5f53\u524d ghippo \u7684\u7248\u672c\u53f7\nexport GHIPPO_HELM_VERSION=$(helm get notes ghippo -n ghippo-system | grep "Chart Version" | awk -F \': \' \'{ print $2 }\')\n')),(0,a.kt)("p",null,"\u66f4\u65b0 Helm repo"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"helm repo update ghippo\n")),(0,a.kt)("p",null,"\u5907\u4efd --set \u53c2\u6570"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"helm get values ghippo -n ghippo-system -o yaml > ${GHIPPO_VALUES_BAK}\n")),(0,a.kt)("p",null,"\u4f7f\u7528 vim \u547d\u4ee4\u7f16\u8f91\u5e76\u4fdd\u5b58"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ vim ${GHIPPO_VALUES_BAK}\n\nUSER-SUPPLIED VALUES:\n...\nglobal:\n  ...\n  reverseProxy: ${DCE_PROXY} # \u53ea\u9700\u8981\u4fee\u6539\u8fd9\u4e00\u884c\n\n")),(0,a.kt)("p",null,"\u4f7f\u7528 heml upgrade \u66f4\u65b0\u914d\u7f6e"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"helm upgrade ghippo ghippo/ghippo \\\n  -n ghippo-system \\\n  -f ${GHIPPO_VALUES_BAK} \\\n  --version ${GHIPPO_HELM_VERSION}\n")),(0,a.kt)("p",null,"\u4f7f\u7528 kubectl \u91cd\u542f\u5168\u5c40\u7ba1\u7406 Pod\uff0c\u4f7f\u914d\u7f6e\u751f\u6548"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl rollout restart deploy/ghippo-apiserver -n ghippo-system\nkubectl rollout restart statefulset/ghippo-keycloak -n ghippo-system\n")),(0,a.kt)("h3",{id:"\u7533\u8bf7\u793e\u533a\u7248\u514d\u8d39\u4f53\u9a8c"},"\u7533\u8bf7\u793e\u533a\u7248\u514d\u8d39\u4f53\u9a8c"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u7533\u8bf7\u9875\u9762 ",(0,a.kt)("a",{parentName:"li",href:"https://qingflow.com/f/58604bf8"},"https://qingflow.com/f/58604bf8")),(0,a.kt)("li",{parentName:"ul"},"\u7533\u8bf7\u64cd\u4f5c\u6559\u7a0b ",(0,a.kt)("a",{parentName:"li",href:"https://docs.daocloud.io/dce/license0/"},"https://docs.daocloud.io/dce/license0/"))))}u.isMDXComponent=!0}}]);