
<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Blog">
  <head>
    <meta charset="utf-8">
	<link rel="manifest" href="/static/pwa/manifest.json">
	<title> Home | 船长的课记 </title>
    
		
    <meta name="author" content="船长">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="theme-color" content="#2196F3">
	<meta name="google-site-verification" content="puZt0ZyqB-t67BYdYAgLUyIPBeismG68J0dmEc01QeY" />

	
    <script>
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', function () {
				navigator.serviceWorker
										.register('/sw.js')
										.then(function(registration) {
											console.log("Successfully registered service worker", registration.scope);
										}).catch(function(err) {
											console.log("Service worker registration failed: ", err);
										});
				//navigator.serviceWorker.ready always resolve
				navigator.serviceWorker.ready.then(function (registration) {
					console.log('Service worker successfully registered on scope', registration.scope);
				});
			});
		}
    </script>
	<script type="text/javascript" src="/assets/themes/evjekylltheme/jquery-3.6.0.slim.min.js"></script>

	<link href="/assets/themes/evjekylltheme/google-code-prettify/desert.css" type="text/css" rel="stylesheet" />

    <!-- Le styles -->
    <link href="/assets/themes/evjekylltheme/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/evjekylltheme/css/style.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/images/favicon.ico">

    <!-- atom & rss feed -->
    <link href="" type="application/atom+xml" rel="alternate" title="Jekyll auto generate ATOM Feed">
    <link href="" type="application/atom+xml" rel="alternate" title="Site ATOM Feed">
    <link href="" type="application/rss+xml" rel="alternate" title="Site RSS Feed">
	<link rel="stylesheet" href="/assets/themes/evjekylltheme/font-awesome-4.4.0/css/font-awesome.min.css">
  </head>

  <body>
    <div class="navbar navbar-default navbar-fixed-top">
				<div class="container">
          <div class="row mobilepadding">
					<a class="navbar-brand" href="/">SAMZONG</a>
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="collapse navbar-collapse" id="mNavbar">
  					<ul class="nav navbar-nav">
  						
  						
  						


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/friends.html">Friends</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
  



						  <li class="dropdown">
							  <a class="dropdown-toggle" data-toggle="dropdown" href="#">Other</a>
							  <ul class="dropdown-menu">
									<li><a href="/about.html">About</a></li>
									<li><a href="https://yuque.com/samzong/note" target="_blank">船长的课记</a></li>
									<li><a href="https://yuque.com/samzong/ap" target="_blank">果粉日记</a></li>
									<li><a href="https://yuque.com/samzong/code" target="_blank">Code Snippet</a></li>
									<li><a href="https://www.yuque.com/samzong/mcx" target="_blank">集</a></li>
									<li><a href="https://www.yuque.com/zooka" target="_blank">藏金阁</a></li>
								</ul>
						  </li>
  					</ul>
  					<form id="search-form" class="navbar-form navbar-right" role="search">
  						<div class="form-group">
  						<input type="text" class="form-control input-sm" placeholder="Search's Bad" id="query">
  						</div>
  					</form>
  					<div class="nav-icon">
  						<a href="/feed.xml"><i class="fa fa-rss fa-2x"></i></a>
  					</div>
          </div>
				</div>
      </div>
    </div>

    <div class="container">
			<div class="row mobilepadding">
        <div class="row">
					<div class="col-md-12">
						<div class="searchresult">
						</div>
						<div id="search-loader" class="img-wrap">
						</div>
					</div>
        </div>
				<meta itemprop="image" content="https://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com/uPic/telegram-cloud-photo-size-4-5971176114485308439-x.jpg">
<div class="row">
  <div class="col-xs-12 col-md-8">
    
    
    <h1><a class="title" href="/post/2017/03/%E5%9B%9B%E9%98%B6%E9%AD%94%E6%96%B9%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5%E4%B9%8B%E5%A4%84%E7%90%86.html">四阶魔方特殊情况之处理</a></h1>
    <div class="post_at_index">
      <p><img src="https://source.unsplash.com/random/480x480/?Rubik's-Cube" alt="" /></p>

<h2 id="前言">前言</h2>

<blockquote>
  <p>注意，本文不是四阶魔方的还原教程。</p>
</blockquote>

<p>在还原高阶魔方 (四阶及以上) 时，采用的处理方法是，将魔方降级为三阶魔方，然后按照三阶魔方的技巧进行还原即可，但是在还原四阶魔方时会遇到 2 个不可能出现在三阶魔方的特殊情况，下面是针对这两个特殊情况的公式。</p>

<h3 id="特殊情况顶层黄色无法形成十或l">特殊情况：顶层黄色无法形成“十”或“L”</h3>

<ul>
  <li>1.手势：黄色面朝上</li>
  <li>2.右边两层旋转 180’（这时应该黄色面有右面两层为白色）</li>
  <li>3.后面一层旋转 180’</li>
  <li>4.上面一层旋转 180’</li>
  <li>5.左边两层靠近你身体旋转 90’</li>
  <li>6.上面一层旋转 180’</li>
  <li>7.右面两层靠近你身体旋转 90’</li>
  <li>8.上面一层旋转 180’</li>
  <li>9.右面两层远离你身体旋转 90’</li>
  <li>10.上面一层旋转 180’</li>
  <li>11.前面一层旋转 180’</li>
  <li>12.右面两层远离你身体旋转 90’</li>
  <li>13.前面一层旋转 180’</li>
  <li>14.左边两层远离你身体旋转 90’</li>
  <li>15.后面一层旋转 180’</li>
  <li>16.右边两层旋转 180’</li>
</ul>

<h3 id="特殊情况最后四对棱角只有两对还原">特殊情况：最后四对棱角只有两对还原</h3>

<ul>
  <li>1.黄色面已经还原的情况下，黄色面朝上</li>
  <li>2.右面夹层旋转 180’</li>
  <li>3.上面一层旋转 180‘</li>
  <li>4.右面夹层旋转 180’</li>
  <li>5.上面两层旋转 180’</li>
  <li>6.右面夹层旋转 180’</li>
  <li>7.上面两层旋转 180’</li>
</ul>

      
    </div>
    <br/>
    <div>
      <cite>2017-03-04</cite> <i class="icon-tag"></i>
      <a href="/tags.html#随笔">随笔</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/02/MacTips-%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E5%85%B3%E9%97%AD%E5%92%8C%E5%90%AF%E5%8A%A8AirPort.html">MacTips 使用命令关闭和启动 AirPort</a></h1>
    <div class="post_at_index">
      <p>今天在给妹妹调试新的 MacBookAir 13’时遇到一个问题，无法检测到她家的 WiFi，一开始怀疑是不是无线路由器长时间未重启导致，所以重启了路由器，但是问题依然没有解决，于是我们将问题转向排查设备，因我们基本正好有 iPad，iPhone，MacBook 这些设备，发现唯独他的这个 Macbook 无法识别 WiFi，后来在 Google 的帮助下，发现多个版本的 Mac OS X 都出现了类似的问题，可以通过重启 AirPort 解决问题，但是 AirPort 在 System Preferences 找不到选项，所以需要使用命令行来重启。</p>

<h2 id="查看网络接口">查看网络接口</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ifconfig
en0: <span class="nv">flags</span><span class="o">=</span>8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
 ether 60:f8:1d:ad:85:76
 inet6 fe80::18a9:fa23:b02f:5d8a%en0 prefixlen 64 secured scopeid 0x4
 inet 192.168.199.200 netmask 0xffffff00 broadcast 192.168.199.255
 nd6 <span class="nv">options</span><span class="o">=</span>201&lt;PERFORMNUD,DAD&gt;
 media: autoselect
 status: active
</code></pre></div></div>

<h2 id="关闭-airport">关闭 AirPort</h2>

<p>有时候设备的名称是 en0、en1 这样，所以，可以用过设备名称来重启 airport，例如 en0</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>networksetup <span class="nt">-setairportpower</span> en0 off
</code></pre></div></div>

<h2 id="查看状态">查看状态</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>networksetup <span class="nt">-getairportpower</span> en0
</code></pre></div></div>

<h2 id="关闭-airport-networksetup">关闭 AirPort networksetup</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>networksetup <span class="nt">-setairportpower</span> en0 on
</code></pre></div></div>

      
    </div>
    <br/>
    <div>
      <cite>2017-02-27</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Mac">Mac</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/02/HowTo-Install-NextCloud.html">HowTo Install NextCloud</a></h1>
    <div class="post_at_index">
      <p>随着最近一个云盘厂家不再提供个人服务，或者开始各种收费限速，自己存放在第三方云盘厂商的数据被盗取，数据的安全性和数据的稳定性都得不到保证，而且随着智能终端的普及，我也有一些更加高质量的图片文件需要大量储存，所以我想到了自建存储服务的方式，在甄别了 OwnCloud，Seafiles 和 NextCloud，最后选择了 NextCloud 作为自己今后数据存储节点，NextCloud 源自 OwnCloud，但是近些年来 OwnCloud 的发展进度几乎停滞，多数开发者也转战 NextCloud，当然 NextCloud 也继承了搭建简单，依赖于 PHP 环境的特性。</p>

<h2 id="运行环境">运行环境</h2>

<ul>
  <li>阿里云 ECS CentOS 6.x</li>
  <li>免费 SSL 证书 (腾讯云申请)</li>
</ul>

<h2 id="搭建-lnmp-环境">搭建 LNMP 环境</h2>

<h3 id="软件版本">软件版本</h3>

<ul>
  <li>PHP 5.6.30   <a href="https://samzong.me/php54-centos6/">安装教程</a></li>
  <li>MySQL 5.6.35  <a href="https://samzong.me/how-to-install-mysql-5-6-on-centos/">安装教程</a></li>
  <li>Nginx 1.10.2</li>
</ul>

<h3 id="基础环境安装">基础环境安装</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# yum update <span class="nt">-y</span>
<span class="o">[</span>root@ultraera ~]# yum groupinstall <span class="nt">-y</span> <span class="s2">"Base"</span>
<span class="o">[</span>root@ultraera ~]# yum groupinstall <span class="nt">-y</span> <span class="s2">"Development tools"</span>

<span class="c"># Install epel</span>
<span class="o">[</span>root@ultraera ~]# yum <span class="nb">install</span> <span class="nt">-y</span> epel-release

<span class="c"># Install remi</span>
<span class="o">[</span>root@ultraera ~]# yum <span class="nb">install </span>http://rpms.famillecollet.com/enterprise/remi-release-6.rpm

<span class="c"># Install mysql-community</span>
<span class="o">[</span>root@ultraera ~]# yum <span class="nb">install </span>http://repo.mysql.com/yum/mysql-5.6-community/el/6/x86_64/mysql-community-release-el6-7.noarch.rpm
</code></pre></div></div>

<h3 id="install-lnmp">Install LNMP</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install MySQL</span>
<span class="o">[</span>root@ultraera ~]# yum <span class="nt">--enablerepo</span><span class="o">=</span>mysql-community <span class="nb">install</span> <span class="nt">-y</span> mysql-server mysql-libs mysql-devel
<span class="o">[</span>root@ultraera ~]# service mysqld start
<span class="o">[</span>root@ultraera ~]# mysql_secure_installation
<span class="o">[</span>root@ultraera ~]# chkconfig mysqld on

<span class="c"># Install Nginx</span>
<span class="o">[</span>root@ultraera ~]# yum <span class="nt">--enablerepo</span><span class="o">=</span>epel <span class="nb">install</span> <span class="nt">-y</span> nginx
<span class="o">[</span>root@ultraera ~]# service nginx start
<span class="o">[</span>root@ultraera ~]# chkconfig nginx on

<span class="c"># Install PHP and php-fpm</span>
<span class="o">[</span>root@ultraera ~]# yum <span class="nt">--enablerepo</span><span class="o">=</span>remi-php56 <span class="nb">install </span>php php-fpm php-mysql php-gd php-xml php-redis php-libs php-devel php-zlib
<span class="o">[</span>root@ultraera ~]# service php-fpm start
<span class="o">[</span>root@ultraera ~]# chkconfig php-fpm on
<span class="o">[</span>root@ultraera ~]# service nginx restart
</code></pre></div></div>

<h3 id="下载-nextcloud">下载 NextCloud</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# wget https://download.nextcloud.com/server/releases/nextcloud-11.0.1.tar.bz2
<span class="o">[</span>root@ultraera ~]# <span class="nb">tar </span>xf nextcloud-11.0.1.tar.bz2
<span class="o">[</span>root@ultraera ~]# <span class="nb">mv </span>nextcloud-11.0.1 /opt/nextcloud
</code></pre></div></div>

<h3 id="配置-nginx-和-php-fpm">配置 Nginx 和 php-fpm</h3>

<p>因为 php-fpm 默认运行的用户身份是 apache，我们这里使用的环境是 nginx，所有要修改 php-fpm 配置文件的用户和组，注意不要为了省事直接改为 root，这在 php-fpm 中是不允许的</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# vim /etc/php-fpm.d/www.conf
<span class="nv">user</span><span class="o">=</span>nginx
<span class="nv">group</span><span class="o">=</span>nginx
<span class="o">[</span>root@ultraera ~]# service php-fpm restart
</code></pre></div></div>

<p>因为 NextCloud 默认是以 Apache 的身份运行的，所以我们需要单独配置 NextCloud 的 Nginx 配置文件，以下配置文件，你可以直接拿去用，注意在文件中说明了，需要修改的地方：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# vim /etc/nginx/conf.d/nextcloud.conf
 upstream php-handler <span class="o">{</span>
   <span class="c"># 这里是你php-fpm的服务端口，默认是9000</span>
    server 127.0.0.1:9000<span class="p">;</span>
    <span class="c">#server unix:/var/run/php5-fpm.sock;</span>
<span class="o">}</span>

server <span class="o">{</span>
   <span class="c"># 你的域名</span>
    listen pan.ultraera.org:80<span class="p">;</span>
    server_name pan.ultraera.org<span class="p">;</span>
    <span class="c"># enforce https</span>
    <span class="k">return </span>301 https://<span class="nv">$server_name$request_uri</span><span class="p">;</span>
<span class="o">}</span>

server <span class="o">{</span>
    <span class="c"># 你的域名</span>
    listen pan.ultraera.org:443 ssl<span class="p">;</span>
    server_name pan.ultraera.org<span class="p">;</span>

   <span class="c"># 以下是你的ssl证书文件存放路径</span>
    ssl_certificate /etc/nginx/ssl/1_pan.ultraera.org_bundle.crt<span class="p">;</span>
    ssl_certificate_key /etc/nginx/ssl/2_pan.ultraera.org.key<span class="p">;</span>

    <span class="c"># Add headers to serve security related headers</span>
    <span class="c"># Before enabling Strict-Transport-Security headers please read into this</span>
    <span class="c"># topic first.</span>
    <span class="c"># add_header Strict-Transport-Security "max-age=15768000;</span>
    <span class="c"># includeSubDomains; preload;";</span>
    add_header X-Content-Type-Options nosniff<span class="p">;</span>
    add_header X-Frame-Options <span class="s2">"SAMEORIGIN"</span><span class="p">;</span>
    add_header X-XSS-Protection <span class="s2">"1; mode=block"</span><span class="p">;</span>
    add_header X-Robots-Tag none<span class="p">;</span>
    add_header X-Download-Options noopen<span class="p">;</span>
    add_header X-Permitted-Cross-Domain-Policies none<span class="p">;</span>
 add_header Strict-Transport-Security <span class="s2">"max-age=15552000; includeSubdomains; "</span><span class="p">;</span>

    <span class="c"># 设定你的NextCloud的根目录，请根据实际修改</span>
    root /opt/nextcloud/<span class="p">;</span>

    location <span class="o">=</span> /robots.txt <span class="o">{</span>
        allow all<span class="p">;</span>
        log_not_found off<span class="p">;</span>
        access_log off<span class="p">;</span>
    <span class="o">}</span>

    <span class="c"># The following 2 rules are only needed for the user_webfinger app.</span>
    <span class="c"># Uncomment it if you're planning to use this app.</span>
    <span class="c">#rewrite ^/.well-known/host-meta /public.php?service=host-meta last;</span>
    <span class="c">#rewrite ^/.well-known/host-meta.json /public.php?service=host-meta-json</span>
    <span class="c"># last;</span>

    location <span class="o">=</span> /.well-known/carddav <span class="o">{</span>
      <span class="k">return </span>301 <span class="nv">$scheme</span>://<span class="nv">$host</span>/remote.php/dav<span class="p">;</span>
    <span class="o">}</span>
    location <span class="o">=</span> /.well-known/caldav <span class="o">{</span>
      <span class="k">return </span>301 <span class="nv">$scheme</span>://<span class="nv">$host</span>/remote.php/dav<span class="p">;</span>
    <span class="o">}</span>

    <span class="c"># set max upload size</span>
    client_max_body_size 512M<span class="p">;</span>
    fastcgi_buffers 64 4K<span class="p">;</span>

    <span class="c"># Disable gzip to avoid the removal of the ETag header</span>
    <span class="nb">gzip </span>off<span class="p">;</span>

    <span class="c"># Uncomment if your server is build with the ngx_pagespeed module</span>
    <span class="c"># This module is currently not supported.</span>
    <span class="c">#pagespeed off;</span>

    error_page 403 /core/templates/403.php<span class="p">;</span>
    error_page 404 /core/templates/404.php<span class="p">;</span>

    location / <span class="o">{</span>
        rewrite ^ /index.php<span class="nv">$uri</span><span class="p">;</span>
   <span class="o">}</span>

    location ~ ^/<span class="o">(</span>?:build|tests|config|lib|3rdparty|templates|data<span class="o">)</span>/ <span class="o">{</span>
        deny all<span class="p">;</span>
    <span class="o">}</span>
    location ~ ^/<span class="o">(</span>?:<span class="se">\.</span>|autotest|occ|issue|indie|db_|console<span class="o">)</span> <span class="o">{</span>
        deny all<span class="p">;</span>
    <span class="o">}</span>

    location ~ ^/<span class="o">(</span>?:index|remote|public|cron|core/ajax/update|status|ocs/v[12]|updater/.+|ocs-provider/.+|core/templates/40[34]<span class="o">)</span><span class="se">\.</span>php<span class="o">(</span>?:<span class="nv">$|</span>/<span class="o">)</span> <span class="o">{</span>
        include fastcgi_params<span class="p">;</span>
        fastcgi_split_path_info ^<span class="o">(</span>.+<span class="se">\.</span>php<span class="o">)(</span>/.<span class="k">*</span><span class="o">)</span><span class="nv">$;</span>
        fastcgi_param SCRIPT_FILENAME <span class="nv">$document_root$fastcgi_script_name</span><span class="p">;</span>
        fastcgi_param PATH_INFO <span class="nv">$fastcgi_path_info</span><span class="p">;</span>
        fastcgi_param HTTPS on<span class="p">;</span>
        <span class="c">#Avoid sending the security headers twice</span>
        fastcgi_param modHeadersAvailable <span class="nb">true</span><span class="p">;</span>
        fastcgi_param front_controller_active <span class="nb">true</span><span class="p">;</span>
        fastcgi_pass php-handler<span class="p">;</span>
        fastcgi_intercept_errors on<span class="p">;</span>
        fastcgi_request_buffering off<span class="p">;</span>
    <span class="o">}</span>

    location ~ ^/<span class="o">(</span>?:updater|ocs-provider<span class="o">)(</span>?:<span class="nv">$|</span>/<span class="o">)</span> <span class="o">{</span>
        try_files <span class="nv">$uri</span>/ <span class="o">=</span>404<span class="p">;</span>
        index index.php<span class="p">;</span>
    <span class="o">}</span>

    <span class="c"># Adding the cache control header for js and css files</span>
    <span class="c"># Make sure it is BELOW the PHP block</span>
    location ~<span class="k">*</span> <span class="se">\.</span><span class="o">(</span>?:css|js|woff|svg|gif<span class="o">)</span><span class="nv">$ </span><span class="o">{</span>
        try_files <span class="nv">$uri</span> /index.php<span class="nv">$uri$is_args$args</span><span class="p">;</span>
        add_header Cache-Control <span class="s2">"public, max-age=7200"</span><span class="p">;</span>
        <span class="c"># Add headers to serve security related headers (It is intended to</span>
        <span class="c"># have those duplicated to the ones above)</span>
        <span class="c"># Before enabling Strict-Transport-Security headers please read into</span>
        <span class="c"># this topic first.</span>
        <span class="c"># add_header Strict-Transport-Security "max-age=15768000;</span>
        <span class="c">#  includeSubDomains; preload;";</span>
        add_header X-Content-Type-Options nosniff<span class="p">;</span>
        add_header X-Frame-Options <span class="s2">"SAMEORIGIN"</span><span class="p">;</span>
        add_header X-XSS-Protection <span class="s2">"1; mode=block"</span><span class="p">;</span>
        add_header X-Robots-Tag none<span class="p">;</span>
        add_header X-Download-Options noopen<span class="p">;</span>
        add_header X-Permitted-Cross-Domain-Policies none<span class="p">;</span>
        <span class="c"># Optional: Don't log access to assets</span>
        access_log off<span class="p">;</span>
    <span class="o">}</span>

    location ~<span class="k">*</span> <span class="se">\.</span><span class="o">(</span>?:png|html|ttf|ico|jpg|jpeg<span class="o">)</span><span class="nv">$ </span><span class="o">{</span>
        try_files <span class="nv">$uri</span> /index.php<span class="nv">$uri$is_args$args</span><span class="p">;</span>
        <span class="c"># Optional: Don't log access to other assets</span>
        access_log off<span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="o">[</span>root@ultraera ~]# service nginx restart
</code></pre></div></div>

<h3 id="文件权限调整">文件权限调整</h3>

<p>因为 NextCloud 运行是以 nginx 程序，注意修改目录所属用户和组为 nginx</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# <span class="nb">chown</span> <span class="nt">-R</span> nginx:nginx /opt/nextcloud
</code></pre></div></div>

<h3 id="创建-mysql-数据库">创建 MySQL 数据库</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; CREATE DATABASE nextcloud CHARACTER SET UTF-8<span class="p">;</span>
mysql&gt; GRANT ALL PRIVILEGES ON nextcloud.<span class="k">*</span> TO <span class="s1">'nextcloud'</span>@<span class="s1">'localhost'</span> IDENTIFIED BY <span class="s1">'your_password'</span><span class="p">;</span>
mysql&gt; FLUSH PRIVILEGES<span class="p">;</span>
</code></pre></div></div>

<h2 id="初始化-nextcloud">初始化 NextCloud</h2>

<p>在浏览器打开你在 nginx 中配置的域名，NextCloud 初始化非常简单，设定一个管理员账户和密码，然后设定数据库即可，按照我们上一步针对 MySQL 的设定，你会非常清楚地知道你的数据库信息：</p>

<p><img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/jjkqh.png" alt="image" /></p>

<p>登录之后的界面是这样：</p>

<p><img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7n28v.png" alt="image" /></p>

<p>你可以在登录之后，在你的右上角点击头像选择 Admin 进入管理界面查看和修改你的服务器设置，你还可以在浏览器上方看到你的服务器现有哪些问题，会有对应文档提醒你如何解决这些问题。</p>

<p><img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/yx34e.png" alt="image" /></p>

<h2 id="other">Other</h2>

<h3 id="修改默认-data-目录">修改默认 data 目录</h3>

<p>在我们首次打开 NextCloud 网页时，需要我们设定 datadir 目录，这里有个默认目录在 nextcloud 项目包，这其实是不安全的，我们最后将目录路径修改为其他位置：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# <span class="nb">mkdir</span> /nextcloud_files/
<span class="o">[</span>root@ultraera ~]# <span class="nb">chown</span> <span class="nt">-R</span> nginx:nginx /nextcloud_files/

<span class="c"># 修改datadirectory的路径</span>
<span class="o">[</span>root@ultraera ~]# vim /opt/nextcloud/config/config.php
datadirectory<span class="s1">' =&gt; '</span>/nextcloud/data
</code></pre></div></div>

<h3 id="无法登陆到个人用户界面">无法登陆到个人用户界面</h3>

<p>我在安装时碰到这个问题，折腾了很久才解决，因为我们是使用 nginx 程序，但是 php-fpm 默认用户身份为 apache，所以<code class="language-plaintext highlighter-rouge">/var/lib/php/session</code>目录的所属用户和组都是 apache，导致我们没有权限去写入 session，所以无法登入系统，报错信息可以在 NextCloud 的 log 文件下看到：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# <span class="nb">tail</span> <span class="nt">-n</span> 1 /usr/nextcloud/data/nextcloud.log
<span class="o">{</span><span class="s2">"reqId"</span>:<span class="s2">"NNnIwMCCPDMQtzZW5Ndc"</span>,<span class="s2">"remoteAddr"</span>:<span class="s2">"180.166.66.226"</span>,<span class="s2">"app"</span>:<span class="s2">"PHP"</span>,<span class="s2">"message"</span>:<span class="s2">"session_write_close(): Failed to write session data (files). Please verify that the current setting of session.save_path is correct (</span><span class="se">\/</span><span class="s2">var</span><span class="se">\/</span><span class="s2">lib</span><span class="se">\/</span><span class="s2">php</span><span class="se">\/</span><span class="s2">session) at </span><span class="se">\/</span><span class="s2">usr</span><span class="se">\/</span><span class="s2">nextcloud</span><span class="se">\/</span><span class="s2">lib</span><span class="se">\/</span><span class="s2">private</span><span class="se">\/</span><span class="s2">Session</span><span class="se">\/</span><span class="s2">Internal.php#104"</span>,<span class="s2">"level"</span>:3,<span class="s2">"time"</span>:<span class="s2">"2017-02-24T10:46:13+00:00"</span>,<span class="s2">"method"</span>:<span class="s2">"POST"</span>,<span class="s2">"url"</span>:<span class="s2">"</span><span class="se">\/</span><span class="s2">index.php"</span>,<span class="s2">"user"</span>:<span class="s2">"samzong"</span>,<span class="s2">"version"</span>:<span class="s2">"11.0.0.10"</span><span class="o">}</span>

<span class="c"># 修改/var/lib/php/的属组为nginx即可</span>
<span class="o">[</span>root@ultraera ~]# <span class="nb">chgrp</span> <span class="nt">-R</span> nginx /var/lib/php
</code></pre></div></div>

<h3 id="增加-redis-组件提高性能">增加 redis 组件，提高性能</h3>

<p>关于如何安装 redis 我在之前的文章中也有讲到，大家可以去看下 <a href="https://samzong.me/redis01/">安装教程</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@ultraera ~]# yum <span class="nt">--enablerepo</span><span class="o">=</span>remi <span class="nb">install</span> <span class="nt">-y</span> redis

<span class="c"># 增加php的redis插件</span>
<span class="o">[</span>root@ultraera ~]# yum <span class="nt">--enablerepo</span><span class="o">=</span>remi-php56 <span class="nb">install </span>php-redis

<span class="c"># 配置文件增加redis</span>
  <span class="s1">'memcache.local'</span> <span class="o">=&gt;</span> <span class="s1">'\\OC\\Memcache\\Redis'</span>,
  <span class="s1">'memcache.locking'</span> <span class="o">=&gt;</span> <span class="s1">'\\OC\\Memcache\\Redis'</span>,
  <span class="s1">'redis'</span> <span class="o">=&gt;</span>
   array <span class="o">(</span>
    <span class="s1">'host'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span>,
    <span class="s1">'port'</span> <span class="o">=&gt;</span> 6379,
   <span class="o">)</span>

<span class="c"># 重启令服务生效</span>
<span class="o">[</span>root@ultraera ~]# service php-fpm restart
<span class="o">[</span>root@ultraera ~]# service nginx restart
</code></pre></div></div>

<p>我的 NextCloud 配置如下：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
<span class="nv">$CONFIG</span> <span class="o">=</span> array <span class="o">(</span>
  <span class="s1">'memcache.local'</span> <span class="o">=&gt;</span> <span class="s1">'\\OC\\Memcache\\Redis'</span>,
  <span class="s1">'memcache.locking'</span> <span class="o">=&gt;</span> <span class="s1">'\\OC\\Memcache\\Redis'</span>,
  <span class="s1">'redis'</span> <span class="o">=&gt;</span>
  array <span class="o">(</span>
    <span class="s1">'host'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span>,
    <span class="s1">'port'</span> <span class="o">=&gt;</span> 6379,
  <span class="o">)</span>,
  <span class="s1">'enable_previews'</span> <span class="o">=&gt;</span> <span class="nb">false</span>,
  <span class="s1">'instanceid'</span> <span class="o">=&gt;</span> <span class="s1">'ockhup01dxbf'</span>,
  <span class="s1">'passwordsalt'</span> <span class="o">=&gt;</span> <span class="s1">'TlJgWGrE0N7vOrRfZkOojwdYh/BixL'</span>,
  <span class="s1">'secret'</span> <span class="o">=&gt;</span> <span class="s1">'/IQh0LioZp5eYFQJhicY7n324Q80WQUYOzWL+8OcxcXVw3Ef'</span>,
  <span class="s1">'trusted_domains'</span> <span class="o">=&gt;</span>
  array <span class="o">(</span>
    0 <span class="o">=&gt;</span> <span class="s1">'pan.ultraera.org'</span>,
  <span class="o">)</span>,
  <span class="s1">'datadirectory'</span> <span class="o">=&gt;</span> <span class="s1">'/nextcloud'</span>,
  <span class="s1">'overwrite.cli.url'</span> <span class="o">=&gt;</span> <span class="s1">'https://pan.ultraera.org'</span>,
  <span class="s1">'dbtype'</span> <span class="o">=&gt;</span> <span class="s1">'mysql'</span>,
  <span class="s1">'version'</span> <span class="o">=&gt;</span> <span class="s1">'11.0.0.10'</span>,
  <span class="s1">'dbname'</span> <span class="o">=&gt;</span> <span class="s1">'nextcloud'</span>,
  <span class="s1">'dbhost'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span>,
  <span class="s1">'dbport'</span> <span class="o">=&gt;</span> <span class="s1">''</span>,
  <span class="s1">'dbtableprefix'</span> <span class="o">=&gt;</span> <span class="s1">'oc_'</span>,
  <span class="s1">'dbuser'</span> <span class="o">=&gt;</span> <span class="s1">'nextcloud'</span>,
  <span class="s1">'dbpassword'</span> <span class="o">=&gt;</span> <span class="s1">'nextcloud'</span>,
  <span class="s1">'logtimezone'</span> <span class="o">=&gt;</span> <span class="s1">'CST'</span>,
  <span class="s1">'installed'</span> <span class="o">=&gt;</span> <span class="nb">true</span>,
  <span class="s1">'mail_from_address'</span> <span class="o">=&gt;</span> <span class="s1">'luchuanjia'</span>,
  <span class="s1">'mail_smtpmode'</span> <span class="o">=&gt;</span> <span class="s1">'php'</span>,
  <span class="s1">'mail_domain'</span> <span class="o">=&gt;</span> <span class="s1">'msn.com'</span>,
<span class="o">)</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="ssl-证书">SSL 证书</h3>

<p>现国内提供免费的 SSL 证书的服务商很多，作为个人站点，免费 SSL 证书是个挺不错的选择，我在之前 nginx 配置时将 ssl 的配置方式写在了配置文件中了，注意如果不启用 ssl 时，不要启用 https 的虚拟主机，当然你可以自己生成一个 ssl 证书来提供服务，但这样在别人访问你的网站时，会不提示不受信任的证书，具体如何获取的证书的方式，因各个厂家方式有些区别，这里就不赘述，可以联系对应的厂商的技术人员咨询。</p>

<h2 id="使用现状">使用现状</h2>

<p>在将服务搭建完成之后，对于存储的文件加密，现在通过 jobs，每日凌晨将文件推送到 oss 内，保存 2 天的数据，避免因为服务器宕机导致文件丢失；使用端，自己的电脑和手机，还有家人的手机，都安装了应用，后台自动将拍照图片等自动上传到云盘，使用起来目前很稳定，只是 iOS 应用是收费的，因为 NextCloud 源于 OwnCloud，如果你之前购买了 OwnCloud 的 App 也可以直接使用，当然 NextCloud 也有很多其他功能，可以根据你的实际需求发掘。</p>

      
    </div>
    <br/>
    <div>
      <cite>2017-02-27</cite> <i class="icon-tag"></i>
      <a href="/tags.html#NextCloud">NextCloud</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/02/HowTo-Install-Redmine.html">HowTo Install Redmine</a></h1>
    <div class="post_at_index">
      <h4 id="runtime-environment">Runtime environment</h4>

<ul>
  <li>CentOS 6.x</li>
  <li>Redmine 3.3.2</li>
  <li>Ruby 2.2.6</li>
  <li>rails 4.2</li>
  <li>MySQL 5.1</li>
  <li>Nginx 1.10</li>
</ul>

<h4 id="安装-rvm">安装 rvm</h4>

<h5 id="导入公钥">导入公钥</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# curl -sSL https://rvm.io/mpapis.asc | gpg --import
</code></pre></div></div>

<h5 id="安装">安装</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# curl -L https://get.rvm.io | bash -s stable
</code></pre></div></div>

<h5 id="加载-rvm-环境并安装基础依赖包">加载 rvm 环境并安装基础依赖包</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# source /etc/profile.d/rvm.sh
[root@localhost ~]# rvm requirements
</code></pre></div></div>

<h4 id="安装-ruby">安装 ruby</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# rvm install 2.2.6
...
[root@localhost ~]# rvm use 2.2.6 --default
</code></pre></div></div>

<h4 id="安装-rails">安装 rails</h4>

<h5 id="更换-gem-源">更换 gem 源</h5>

<p>默认 gem 的源站点是<a href="https://rubygems.org">https://rubygems.org</a> 由于国内的网络原因导致无法连接，所以导致无法使用 gem 安装，这里换成国内淘宝的 gem 镜像站点</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# gem sources -l
*** CURRENT SOURCES ***

https://rubygems.org/
[root@localhost ~]# gem sources --remove https://rubygems.org/
[root@localhost ~]# gem sources -a https://ruby.taobao.org/
[root@localhost ~]# gem sources -l
*** CURRENT SOURCES ***

https://ruby.taobao.org/
</code></pre></div></div>

<h5 id="安装-1">安装</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# gem install rails -v=4.2
</code></pre></div></div>

<h4 id="安装-mysql">安装 MySQL</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# yum install -y mysql-server mysql-libs mysql-devel mysql
[root@localhost ~]# service mysqld start
[root@localhost ~]# mysql_secure_installation
</code></pre></div></div>

<h4 id="安装-redmine">安装 redmine</h4>

<h5 id="下载-redmine-332">下载 Redmine 3.3.2</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# wget http://www.redmine.org/releases/redmine-3.3.2.tar.gz
[root@localhost ~]# tar xf redmine-3.3.2.tar.gz
[root@localhost ~]# mv redmine-3.3.2 /opt
</code></pre></div></div>

<h5 id="安装管理-ruby-的包管理工具-bundler">安装管理 ruby 的包管理工具 bundler</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 注意，一定要在redmine目录下操作
[root@localhost ~]# cd /opt/redmine-3.3.2
[root@localhost redmine-3.3.2]# gem install bundler
</code></pre></div></div>

<h5 id="安装-redmine-运行所需要的依赖包">安装 redmine 运行所需要的依赖包</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# bundle install --without development test rmagick
</code></pre></div></div>

<h5 id="为-rails-生产-cookies-秘钥">为 rails 生产 cookies 秘钥</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# rake generate_secret_token
</code></pre></div></div>

<h5 id="创建-redmine-的数据库">创建 redmine 的数据库</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; create database redmine character set utf8;
mysql&gt; grant all privileges on redmine.* to 'redmine'@'localhost' identified by 'redmine_pass';
</code></pre></div></div>

<h5 id="修改-redmine-的-databaseyml">修改 redmine 的 database.yml</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# cp config/database.yml.example config/database.yml
[root@localhost redmine-3.3.2]# vim config/database.yml
production:
  adapter: mysql2
  database: redmine
  host: localhost
  username: redmine
  password: "redmine_pass"
  encoding: utf8
</code></pre></div></div>

<h5 id="创建数据库结构">创建数据库结构</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# RAILS_ENV=production bundle exec rake db:migrate
</code></pre></div></div>

<h5 id="生产缺省数据">生产缺省数据</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# RAILS_ENV=production bundle exec rake redmine:load_default_data
# 选择默认语言，之后可更改，初始为en
</code></pre></div></div>

<h5 id="测试是否安装成功">测试是否安装成功</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# bundle exec rails server webrick -e production -b 0.0.0.0
</code></pre></div></div>

<blockquote>
  <p>默认运行 3000 端口，默认管理员 admin/admin</p>
</blockquote>

<h4 id="配置-redmine-在-nginx-上运行">配置 Redmine 在 Nginx 上运行</h4>

<p>Redmine 常用的解决办法是使用 passenger+nginx，但是 Nginx 不支持装载模块，所以需要重新编译安装 Nginx，安装 Nginx 的 Passenger 有两种方式</p>

<ul>
  <li>采用 Passenger 提供的脚本进行安装，适合新环境</li>
  <li>手动编译安装 Nginx 增加 Passenger 模块，适合已存在 Nginx 环境</li>
</ul>

<h5 id="采用-passenger-提供脚本安装">采用 Passenger 提供脚本安装</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# gem install passenger
[root@localhost redmine-3.3.2]# passenger-install-nginx-module --auto --prefix=/opt/nginx
</code></pre></div></div>

<h5 id="采用重新编译-nginx-增加-passenger-模块">采用重新编译 Nginx 增加 Passenger 模块</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 获取passenger的安装路径
[root@localhost ~]# passenger-config --root
/usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2

# 重新编译Nginx并添加模块
[root@localhost ~]# wget http://nginx.org/download/nginx-1.10.3.tar.gz
[root@localhost ~]# tar xf nginx-1.10.3.tar.gz
[root@localhost ~]# cd nginx-1.10.3
[root@localhost nginx-1.10.3]# ./configure ... -add-module=/usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2
</code></pre></div></div>

<h5 id="增加-http-模块内以下配置">增加 HTTP 模块内以下配置</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>passenger_root /usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2
</code></pre></div></div>

<h5 id="配置-nginxconf-修改-server-模块中-location-的配置">配置 nginx.conf 修改 server 模块中 location 的配置</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ...
server {
  # ...
  passenger_enabled on;
  location / {
    root /opt/redmine-3.3.2/public;
    index index.html index.htm;
  }
}
# ...
</code></pre></div></div>

<h5 id="启动-nginx">启动 Nginx</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# /root/nginx-1.10.3/sbin/nginx -c /root/nginx-1.10.3/conf/nginx.conf
</code></pre></div></div>

<h4 id="其他">其他</h4>

<p>到这里，所有的安装都完成了，过程中我遇到这些问题，你也注意下：</p>

<h5 id="71-could-not-find-gem-mysql2--0311-in-any-of-the-gem-sources-listed-in-your-gemfile">7.1 Could not find gem ‘mysql2 (~&gt; 0.3.11)’ in any of the gem sources listed in your Gemfile</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# rm -f Gemfile.lock
[root@localhost redmine-3.3.2]# bundle install
</code></pre></div></div>

<h5 id="72-curl-tools">7.2 curl-tools</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install libcurl-devel
</code></pre></div></div>

      
    </div>
    <br/>
    <div>
      <cite>2017-02-22</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Redmine">Redmine</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/02/HowTo-Upgrade-Your-Ghost-Version.html">HowTo Upgrade Your Ghost Version</a></h1>
    <div class="post_at_index">
      <h4 id="1-下载最新版的-ghost">1. 下载最新版的 Ghost</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -LOk https://ghost.org/zip/ghost-latest.zip
</code></pre></div></div>

<h4 id="2-创建临时目录并解压-ghost-latestzip-到此">2. 创建临时目录，并解压 ghost-latest.zip 到此</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /usr/ghost-tmp
unzip ghost-latest.zip -d /usr/ghost-tmp
</code></pre></div></div>

<h4 id="3-进入到原-ghost-目录删除-core">3. 进入到原 ghost 目录，删除 core</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd  /usr/ghost
rm -rf core
</code></pre></div></div>

<h4 id="4进入到新版本的-ghost-临时目录">4.进入到新版本的 ghost 临时目录</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /usr/ghost-tmp
</code></pre></div></div>

<h4 id="5-拷贝所需文件到-ghost-升级目录">5. 拷贝所需文件到 ghost 升级目录</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp -R core /usr/ghost
cp index.js *.json /usr/ghost
</code></pre></div></div>

<h4 id="6-可选-升级-casperghost-默认主题">6. (可选) 升级 casper，ghost 默认主题</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp -R content/themes/casper /usr/ghost/content/themes/
</code></pre></div></div>

<h4 id="7-切换回到-ghost-安装目录">7. 切换回到 ghost 安装目录</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /usr/ghost
</code></pre></div></div>

<h4 id="8-修改文件目录所有者和所属组为-ghost">8. 修改文件目录所有者和所属组为 ghost</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chown -R ghost:ghost ./*
</code></pre></div></div>

<h4 id="9-重新安装环境">9. 重新安装环境</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install --production
</code></pre></div></div>

<h4 id="10-重启-ghost">10. 重启 Ghost</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pm2 restart ghost
</code></pre></div></div>

      
    </div>
    <br/>
    <div>
      <cite>2017-02-20</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Ghost">Ghost</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/02/HowTo-Automatic-Updates-CENTOS-RHEL-Using-YUM.html">HowTo Automatic Updates CENTOS/RHEL Using YUM</a></h1>
    <div class="post_at_index">
      <p>大家若工作遇到需要管理的 Linux 集群机器较多时，同时我们知道系统的安全更新补丁维护这些非常重要，无论你在安装时优化维护做的再好，随着时间的推移，如果不去更新的话，系统早晚都会不安全，所以定期更新我们的系统补丁是一个运维人员的基本工作内容</p>

<h3 id="install-yum-cron">Install yum-cron</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo yum install -y yum-cron
</code></pre></div></div>

<p>因为我的服务器系统多为 CentOS 6，6 的配置文件在<code class="language-plaintext highlighter-rouge">/etc/sysconfig/yum-cron</code>，你可以用以下命令查看配置文件位置：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rpm -ql yum-cron
/etc/cron.daily/0yum.cron
/etc/rc.d/init.d/yum-cron
/etc/sysconfig/yum-cron
/etc/yum/yum-daily.yum
/etc/yum/yum-weekly.yum
/usr/share/doc/yum-cron-3.2.29
/usr/share/doc/yum-cron-3.2.29/COPYING
/usr/share/man/man8/yum-cron.8.gz
</code></pre></div></div>

<h3 id="configure-etcsysconfigyum-cron">Configure “/etc/sysconfig/yum-cron”</h3>

<p>yum-cron 的默认设置是会在每天自动检查和安装系统更新包，在安装完成后有些配置需要注意下：</p>

<h5 id="1-对于不需要更新的可以忽略掉">1. 对于不需要更新的可以忽略掉</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>YUM_PARAMETER="--exclude='kernel*' --exclude='php*'"
</code></pre></div></div>

<h5 id="2-设置管理员邮箱">2. 设置管理员邮箱</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MAILTO="luchuanjia@msn.com"
</code></pre></div></div>

<h5 id="3-不自动安装仅检查通知管理邮箱">3. 不自动安装，仅检查，通知管理邮箱</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CHECK_ONLY=yes
</code></pre></div></div>

<h5 id="4-不自动安装仅下载">4. 不自动安装，仅下载</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DOWNLOAD_ONLY=yes
</code></pre></div></div>

<h3 id="automatic-starting-yum-cron">Automatic Starting yum-cron</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chkconfig yum-cron on
</code></pre></div></div>

      
    </div>
    <br/>
    <div>
      <cite>2017-02-19</cite> <i class="icon-tag"></i>
      <a href="/tags.html#CentOS">CentOS</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/02/MySQL-8-%E7%B4%A2%E5%BC%95%E5%88%9B%E5%BB%BA-%E5%88%A0%E9%99%A4%E5%92%8C%E6%9F%A5%E7%9C%8B.html">MySQL 索引创建、删除和查看</a></h1>
    <div class="post_at_index">
      <h4 id="1-索引的作用"><strong>1. 索引的作用</strong></h4>

<p>在索引列上，数据库利用各种各样的快速定位技术，能够大大的提高查询效率，特别是当数据量非常大和查询设计到多个表时，索引的利用能够将效率提高成千上万倍，当然要合理的利用索引。</p>

<h4 id="2-创建索引"><strong>2. 创建索引</strong></h4>

<p>​ 在执行 CREATE TABLE 时可以创建索引，也可以在之后单独使用 CREATE INDEX 或 ALTER TABLE 来为表增加索引。</p>

<h6 id="21-alter-table">2.1 ALTER TABLE</h6>

<p>​ ALTER TABLE 用来创建普通索引、UNIQUE 索引或 PRIMARY KEY 索引。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ALTER TABLE tb_name ADD INDEX index_Name (column_list);
ALTER TABLE tb_name ADD UNIQUE (column_list);
ALTER TABLE tb_name ADD PRIMARY KEY (column_list);
</code></pre></div></div>

<p>​ tb_name 是要增加索引的表名，column_list 是要增加索引的列，多列用逗号隔开，index_Name 是可选，缺省为第一个索引列赋名称，ALTER TABLE 允许在单个语句中更改多个表，因此可以也可以同时创建多个索引。</p>

<h6 id="22-create-index">2.2 CREATE INDEX</h6>

<p>​ CREATE INDEX 可对表增加普通索引或者 UNIQUE 索引。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE INDEX index_Name ON tb_name(column_list);
CREATE UNIQUE INDEX index_Name ON tb_name(column_list);
</code></pre></div></div>

<p>​ tb_name、index_Name 和 column_list 具有 ALTER TABLE 语句中相同的含义，索引名称不可自定义，也不能创建 PRIMARY KEY。</p>

<h4 id="3-索引类型"><strong>3. 索引类型</strong></h4>

<p>​ 在创建索引时，可以规定索引能否包含重复的值，如果不包含，则索引应该为 PRIMARY KEY 或 UNIQUE 索引，对于单列唯一索引，这能保证单列不包含重复的值，对于多列唯一索引，保证多值的组合不重复。</p>

<p>​ PRIMAY KEY 索引与 UNIQUE 索引非常类似，实际上 PRIMAY KEY 索引仅是一个具有名称 PRIMAY 的 UNIQUE 索引，这表示一个表只能包含一个 PRIMAY KEY 索引，因为一个表中不可能具有两个同名的索引。</p>

<h4 id="4-删除索引"><strong>4. 删除索引</strong></h4>

<p>​ 可以使用 ALTER TABLE 或 DROP INDEX 语句来删除索引：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DROP INDEX index_Name On tb_name;
ALTER TABLE tb_Name DROP TABLE index_Name;
ALTER TABLE tb_Name DROP PRIMAY KEY;
</code></pre></div></div>

<p>​ 第一条和第二条作用是一样的，删除 tb_Name 中 index_Name 索引；第三条仅适用于删除 PRIMAY KEY 时，因为一个只可能有一个 PRIMAY KEY 索引。</p>

<p>​ 另外，如果在表中删除了某列，则索引会受到影响，对于多列组合的索引，如果删除其中某列，则该列也会在索引中删除，如果删除所有列，则该索引也会被删除。</p>

<h4 id="5-查看索引"><strong>5. 查看索引</strong></h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; show index from tb_name;
mysql&gt; show keys from tb_name;
</code></pre></div></div>

<ul>
  <li>Table : 表名</li>
  <li>Non_unique：如果索引不能包含重复值为 0，如果可以为 1</li>
  <li>Key_name：索引的名称</li>
  <li>Seq_in_index：索引中列的序号，从 1 开始</li>
  <li>Column_name：列的名称</li>
  <li>Collation：列以什么方式存储在索引中，在 MySQL 中有值‘A’(升序) 和 NULL(无分类)</li>
  <li>Cardinality：索引中唯一值的数量估计值，通过运行 ANALYZE TABLE 或者 myisamchk -a 可以更新，基数根据被存储的整数的统计数据来计数，所以，即使对于小型表，该值也没有必要是精确的，基数越大，当进行联合时，MySQL 使用该索引的机会就越大。</li>
  <li>Sub_part：如果列只是被部分编入，则为编入索引的字符数目，如果整列被编入索引，则为 NULL</li>
  <li>Packed：关键字如何被压缩，没有压缩为 NULL</li>
  <li>Null：如果列含有 NULL 为 YES，如果没有则为 NO</li>
  <li>Index_type：用过的索引方法，BTREE，FULLTEXT，HASH，RTREE</li>
  <li>Comment：备注</li>
</ul>

      
    </div>
    <br/>
    <div>
      <cite>2017-02-09</cite> <i class="icon-tag"></i>
      <a href="/tags.html#MySQL">MySQL</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/01/HowTo-Monitor-Tomcat-Head-Memory-for-Zabbix.html">HowTo Monitor Tomcat HeadMemory for Zabbix</a></h1>
    <div class="post_at_index">
      <p>最近项目上由于 BUG 问题导致 Tomcat 程序在运行过程中经常内存泄漏，而本身监控系统之中没有更好的检测到 Tomcat 堆空间 (Head Memory) 的使用情况导致报警频发，这篇文章主要讲述，如何在 Zabbix 之中调用 jmx 监控服务器上 Tomcat 堆空间的使用情况并增加对应报警功能。</p>

<blockquote>
  <p>测试环境：
CentOS 6.8
Zabbix 2.4
Tomcat 7.0</p>
</blockquote>

<p>实验前提默认是各位已经安装 Zabbix Server 服务器，并且至少有一台 Zabbix agent 服务器正常监控。关于如何搭建 Zabbix 监控集群，会有专门文章描述。</p>

<h4 id="zabbix-java-gateway-的工作机制">zabbix-java-gateway 的工作机制</h4>

<ul>
  <li>首先我们需要配置我们的 Tomcat 服务启用监控服务，这个是默认不启用的</li>
  <li>之后需要在 Zabbix 的管理页面添加对应 Tomcat 服务器的 jmx 监控接口</li>
  <li>最后 zabbix 端会自动获取 zabbix-java-gateway 的数据并根据相应模板进行展
示</li>
  <li>工作流：[Zabbix-Server]–&gt;(port:10053 on zabbix server)–&gt; [zabbix-java-gateway] –(port:12345 on tomcatserver)–&gt; [JMX enabled]</li>
</ul>

<h4 id="1-install-zabbix-java-gateway-on-zabbix-server">1. Install zabbix-java-gateway on Zabbix Server</h4>

<p>因为我的 zabbix 是使用 zabbix 2.4 官方源安装，所以只需要用 yum 在安装即可：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@6 ~]# sudo  yum install -y zabbix-java-gateway
</code></pre></div></div>

<p>如果你没有官方源可能先安装该源，注意我的服务器 zabbix 版本是 2.4 如果你是不同的版本，请到[<a href="http://repo.zabbix.com/zabbix/">这里</a>] 查找对应版本。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 查看zabbix server版本
[root@6 ~]# zabbix_server --version
Zabbix server v2.4.8 (revision 59539) (20 April 2016)
Compilation time: May  4 2016 01:32:12
</code></pre></div></div>

<p>在使用 yum 安装 zabbix-java-gateway 源时，会自动关联安装 openjdk，尽管这段程序没多大影响，如果你想保证系统 JAVA 环境不受到改变的话，可以在/etc/profile 文件最后，增加如下内容：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># add follows to the end
export JAVA_HOME=/usr/java/default
export PATH=$PATH:$JAVA_HOME/bin
export CLASSPATH=.:$JAVA_HOME/jre/lib:$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar
</code></pre></div></div>

<h4 id="2-confiure-tomcat-host-with-enable-jmx">2. Confiure Tomcat host with enable jmx</h4>

<p>首先在$tomcatdir/bin/catalina.sh 文件开头处增加如下：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/sh

CATALINA_OPTS="-Dcom.sun.management.jmxremote \
-Dcom.sun.management.jmxremote.authenticate=false \
-Dcom.sun.management.jmxremote.ssl=false \
-Dcom.sun.management.jmxremote.port=12345"
</code></pre></div></div>

<p>然后，启动 Tomcat，你会发现多了一个 12345 端口，这就是 jmx 的监听端口，请保证 zabbix-java-gateway 可以访问到这台服务器。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@6 ~]# /tomcat7/bin/startup.sh
Starting Tomcat7:
Using CATALINA_BASE:   /tomcat7
Using CATALINA_HOME:   /tomcat7
Using CATALINA_TMPDIR: /tomcat7/temp
Using JRE_HOME:        /usr
Using CLASSPATH:       /tomcat7/bin/bootstrap.jar:/tomcat7/bin/tomcat-juli.jar
Tomcat started.

[root@6 ~]# netstat -ntlp | grep 12345
tcp  0      0 :::12345   :::*     LISTEN      8793/java
[root@6 ~]#
</code></pre></div></div>

<h4 id="fix-1---zabbix-agent-与-server-存在复杂网络环境">==<em>fix 1</em> == : zabbix agent 与 server 存在复杂网络环境</h4>

<p>这里疏忽了 1 个问题，如果您的 zabbix server 与 agent 端之间有防火墙规则，而按照我上面的所述只是增加了 12345 这个端口，那么很可能，您在/var/log/zabbix/zabbix_java_gateway.log 中会看到“No route to host”的报错，这是因为 JMX 不光开启了 12345 端口，还开启了另外两个随机端口，而在获取监控数据时会使用到其中一个，这就导致了无法通过固定的防火墙规则来开放该端口。其实有另外一个替代方式来使该监听端口固定下来——使用 Tomcat 提供的额外组件 catalina-jmx-remote.jar，这个组件是需要另外下载的：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 查看当前Tomcat版本.
[root@6 bin]# ./catalina.sh version
Using CATALINA_BASE:   /tomcat7
Using CATALINA_HOME:   /tomcat7
Using CATALINA_TMPDIR: /tomcat7/temp
Using JRE_HOME:        /usr
Using CLASSPATH:       /tomcat7/bin/bootstrap.jar:/tomcat7/bin/tomcat-juli.jar
Server version: Apache Tomcat/7.0.64
Server built:   Aug 19 2015 17:18:06 UTC
Server number:  7.0.64.0
OS Name:        Linux
OS Version:     2.6.32-642.11.1.el6.x86_64
Architecture:   amd64
JVM Version:    1.8.0_111-b15
JVM Vendor:     Oracle Corporation

# 下载 catalina-jmx-remote.jar # 请注意下载版本不要高于当前tomcat版本.
wget http://mirror.bit.edu.cn/apache/tomcat/tomcat-7/v7.0.57/bin/extras/catalina-jmx-remote.jar -O lib/catalina-jmx-remote.jar
</code></pre></div></div>

<p>增加如下内容，在 conf/server.xml 中：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Listener className="org.apache.catalina.mbeans.JmxRemoteLifecycleListener"
          rmiRegistryPortPlatform="12345" rmiServerPortPlatform="12346" /&gt;
</code></pre></div></div>

<p>因为我们已经在conf/server.xml定义了rmiRegistryPortPlatform，所以要将bin/catalina.sh中CATALINA_OPTS的com.sun.management.jmxremote.port去掉，否则会因为jmxremote.port配置有优先级更高而导致配置失效。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CATALINA_OPTS="-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false"
</code></pre></div></div>

<p>完成之后，重启 tomcat 这时会发现 jmx 默认端口已经固定为 12345 何 12346，而 server 依然可以正常获取监控数据。</p>

<h4 id="3-configure-zabbix-server">3. Configure Zabbix Server</h4>

<p>首先需要修改 zabbix_server.conf 启用 zabbix-java-gateway，让 zabbix 可以检测到服务，修改如下：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>### Option: JavaGateway
 #       IP address (or hostname) of Zabbix Java gateway.
 #       Only required if Java pollers are started.
 #
 # Mandatory: no
 # Default:
JavaGateway=10.211.55.4 # 设置为你的zabbixsever IP

### Option: JavaGatewayPort

# Port that Zabbix Java gateway listens on

#

# Mandatory: no

# Range: 1024-32767

# Default

 JavaGatewayPort=10053 # 设置服务端监听接口

### Option: StartJavaPollers

# Number of pre-forked instances of Java pollers

#

# Mandatory: no

# Range: 0-1000

# Default

 StartJavaPollers=5 # 设置多线程启动

</code></pre></div></div>

<p>然后修改 zabbix_java_gateway.conf 配置如下：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
### Option: zabbix.listenIP

# IP address to listen on

#

# Mandatory: no

# Default

 LISTEN_IP="10.211.55.4" # 配置监听IP

### Option: zabbix.listenPort

# Port to listen on

#

# Mandatory: no

# Range: 1024-32767

# Default

 LISTEN_PORT=10053 # 配置监听端口

### Option: zabbix.pidFile

# Name of PID file

# If omitted, Zabbix Java Gateway is started as a console application

#

# Mandatory: no

# Default

# PID_FILE=

 PID_FILE="/var/run/zabbix/zabbix_java.pid"

### Option: zabbix.startPollers

# Number of worker threads to start

#

# Mandatory: no

# Range: 1-1000

# Default

# 不能大于zabbix_server.conf的值，否则可能导致当连接Java gateway时没有多余的线程进行处理

 START_POLLERS=5

</code></pre></div></div>

<p>最后启动启动 zabbix-java-gateway，并重启 zabbix-server</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
[root@6 ~]# service zabbix-java-gateway start
Starting zabbix java gateway:              [  OK  ]
[root@6 ~]# service zabbix-server restart
Stopping zabbix server:              [  OK  ]
Starting zabbix server:              [  OK  ]

</code></pre></div></div>

<p>我在尝试重启发现一问题，zabbix-java-gateway 通过 service 命令管理 stop 不能删除 pid 文件导致服务无法启动，如果你也碰到，解决办法如下：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
[root@6 zabbix]# vim /etc/rc.d/init.d/zabbix-java-gateway

# line 97, 注释修改为如下

# kill `cat $PID_FILE` &amp;&amp; rm $PID_FILE

        rm -f $PID_FILE

</code></pre></div></div>

<h4 id="4-adding-jmx-host-on-zabbix-web-consloe">4. Adding jmx host on Zabbix Web consloe</h4>

<p>首先，上传 Template Tomcat Head Memory 模板，这个我做了一个简单的模板，只针对了堆内存空间的监控，并针对使用率超过 60% 以及 80%，不同的警报。需要的同学可以直接从我这里下载，然后在 Configuration-Templates 导入到 zabbix 模板库内。
下载请点击：<a href="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zbx_template_app_tomcat_head_memory.xml">Template App Tomcat Head Memory</a></p>

<p>然后，增加服务器的 jmx 监控
<img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-jmx-settings.png" alt="image" /></p>

<p>关联模板
<img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-host-select-template.png" alt="image" /></p>

<h4 id="5-view-the-head-memory-monitoring">5. View the Head Memory Monitoring</h4>

<p><img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-view-monitor.png" alt="image" /></p>

      
    </div>
    <br/>
    <div>
      <cite>2017-01-18</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Zabbix">Zabbix</a>
      , 
      <a href="/tags.html#Tomcat">Tomcat</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/01/%E6%AF%8F%E6%97%A5%E5%A4%87%E4%BB%BDMySQL%E5%8D%95%E8%A1%A8%E6%95%B0%E6%8D%AE.html">每日备份 MySQL 单表数据</a></h1>
    <div class="post_at_index">
      <p>最近愈近年底，客户业务涉及对账操作，所以同事提出需求需要单独备份某张表数据，并且每日备份；思考之后解决办法如下：</p>

<ol>
  <li>mysqldump 导出单张表的表结构及数据</li>
  <li>新增数据库，专做临时每日数据备份库</li>
  <li>导入该表数据到新增数据库内</li>
  <li>重命名导入的表名（预防计划任务下次导入时数据覆盖）</li>
  <li>编写脚本，添加 Linux 计划任务</li>
</ol>

<h4 id="1-mysqldump-导出但张表的表结构及数据">1. mysqldump 导出但张表的表结构及数据</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysqldump -h dbServer -PdbServerPort -u db_user -p -d dbName tbName &gt; tbName.sql
</code></pre></div></div>

<h4 id="2-新增数据库专做临时每日数据备份库">2. 新增数据库，专做临时每日数据备份库</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># loginTo your DBserver
mysql&gt; create database bakdbName character set utf8;
</code></pre></div></div>

<h4 id="3-导入该表数据到新增数据库内">3. 导入该表数据到新增数据库内</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -h dbServer -P dbServerPort -u db_user -p bakdbName &lt; tbName.sql
</code></pre></div></div>

<h4 id="4--重命名导入的表名">4 . 重命名导入的表名</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u db_user -p -e "rename table bakdbName.tbName to bakdbName.tbName_$DATE"
</code></pre></div></div>

<h4 id="5-编写脚本">5. 编写脚本</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@testServer01 ~]# cat /usr/local/bin/bakTable.sh
#!/bin/bash

#Create by SAMZONG

DATE=`date +%Y%m%d`
TMPDIR=/tmp/baksql

# modify your DB configure
DBSERVER1=localhost
DBSERVER1_PORT=3306
DBSERVER1_USER=root
DBSERVER1_PASSWORD=password
MASTER_DBNAME=zabbix
MASTER_TBNAME=users

DBSERVER2=localhost
DBSERVER2_PORT=3306
DBSERVER2_USER=root
DBSERVER2_PASSWORD=password
BAKDBNAME=z3

# creat tmp folder
if [ ! -d $TMPDIR ]; then
 mkdir $TMPDIR
fi

# dump tbName
mysqldump -h $DBSERVER1 -P $DBSERVER1_PORT -u $DBSERVER1_USER -p"$DBSERVER1_PASSWORD" -d $MASTER_DBNAME  $MASTER_TBNAME &gt; $TMPDIR/$MASTER_TBNAME.sql


# insert tbNAME to bakdbName
if [ $? -eq 0  ]; then
 mysql -h $DBSERVER2 -P $DBSERVER2_PORT -u $DBSERVER2_USER -p"$DBSERVER2_PASSWORD" $BAKDBNAME &lt; $TMPDIR/$MASTER_TBNAME.sql

 if [ $? -eq 0 ]; then
  # rename tbName
  mysql -h $DBSERVER2 -P $DBSERVER2_PORT -u $DBSERVER2_USER -p"$DBSERVER2_PASSWORD" -e "rename table "$BAKDBNAME"."$MASTER_TBNAME" to "$BAKDBNAME"."$MASTER_TBNAME"_"$DATE";"
 fi

fi
</code></pre></div></div>

<h4 id="6-添加到-linux-计划任务">6. 添加到 Linux 计划任务</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>00 00 * * * /usr/local/bin/bakTable.sh
</code></pre></div></div>

      
    </div>
    <br/>
    <div>
      <cite>2017-01-15</cite> <i class="icon-tag"></i>
      <a href="/tags.html#MySQL">MySQL</a>
      , 
      <a href="/tags.html#Shell">Shell</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/01/%E7%94%9F%E6%B4%BB%E5%9C%A8%E5%88%AB%E5%A4%84.html">生活在别处</a></h1>
    <div class="post_at_index">
      <p>生活在别处，第一次看到这句话的时候是初中，便在之后的许多年间未曾忘记。</p>

<p>第一我不懂为何“生活在别处”，生活如何在别处？生活不应再当下？生活如影随行，在你忙忙碌碌烦烦烦烦时，生活就在这里，在你快快乐乐时，生活还在这里，我一直以为所见所行就是生活；可是，随着生长，你依旧在这里，而生活早已飘落别处。</p>

<p>“生活在别处”是法国诗人兰波的一句名言，而他用一生践行了这句话，他一生都在出走，从法国到英国而后非洲，兰波一生都在出走，直到最后死去；他是一位无法被归类的诗人，放荡不羁，与魏尔伦的爱情，新世界的开创者，兰波一生都在尝试不同的人生，就像他说的：“我愿成为任何人”。</p>

<blockquote>
  <p><em>《全蝕狂愛》1995，描述了兰波的故事，与魏尔伦的爱情。由李奥纳多扮演。</em></p>
</blockquote>

<p>我不会写故事，更多的用来记录我的生活，本来今天晚上准备写些什么，如何关于整理笔记之类，下班日常刷知乎，看到《这个杀手不太冷》中一句话，“生活一直是那么艰难吗？还是只有小时候是这样？” “一直是。”脑海里就浮现了“生活在别处”这句话，随着人生阅历的成长，对这几句话的理解，也是不断加深；所以，回来写下这段文字。</p>

<p>我一直试着找出自身的问题，我一直努力和生活更好地相处，我其实并不知道如何规划，我能感受到生命中特别重要的东西，要拼尽所有力气去抓住；我不喜欢去做承诺，我所能做的就是一直努力去做；在我们的人生中肯定会存在一些望不到顶的大山，可能我穷尽一生也无法看到山顶的景色和山的那边的一切，这的确是一件想想就很难过的事情，并且这一切无法逃避，听起来是那么地令人绝望，但是，亲爱的，我们总要去面对，或是大步向前，冲向那满是荆棘望不到顶的大山，要打败可以吃掉我们的大老虎，一次又一次，我们会经常失败，摔倒，伤痕累累，可是我总要爬起来，一次又一次，每次都像是用尽整个生命的力量，也许我们真的最后跌倒爬不起来了，也许我们最后真的无法凝聚一丝力量，那至少，我们明白我是真的做不到，而不是说从一开始就放弃，努力让自己变更好；嗯，方向也很重要。</p>

<p>好了，我还要去整理笔记，然后早点睡觉，今天心情不太好，可身边总有些美丽的人，谢谢！</p>

<p>最后，生活一直是那么艰难吗？</p>

      
    </div>
    <br/>
    <div>
      <cite>2017-01-10</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Zero">Zero</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    

    <!-- Pagination links -->
    <nav>
      <ul class="pagination hidden-xs">
        
        
        <li>
          <a href="/page15">&laquo; Previous</a>
        </li>
        
        

        
        <li>
          <a href="/">1</a>
        </li>
        

        
          
            
            <li>
              <a href="/page2">2</a>
            </li>
            
            <li>
              <a href="/page3">3</a>
            </li>
            
            <li>
              <a href="/page4">4</a>
            </li>
            
            <li>
              <a href="/page5">5</a>
            </li>
            
            <li class="disabled"><span>...</span></li>
            <li class="active"><a>16</a></li>
          
          <li class="disabled"><span>...</span></li>
          <li><a href="/page25">25</a></li>
        

        
        

        
        <li>
          <a href="/page17">Next &raquo;</a>
        </li>
        
      </ul>
    </nav>
  </div>
  <div class="col-xs-12 col-md-4">
		<!-- <div>
			<a class="twitter-timeline" data-width="390" data-height="640" data-theme="light" href="https://twitter.com/samzong_lu?ref_src=twsrc%5Etfw">Tweets by SAMZONG</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
		</div> -->
    <div>
      <h2>传送门</h2>
      <ul>
        <li><a href="https://yuque.com/samzong">语雀-花园</a></li>
        <li><a href="https://github.com/samzong">Github</a></li>
      </ul>
    </div>
    <div class="categories">
      <h2>文章分类</h2>
      <ul class="tag_box">
        
        


  
     
    	
      <li><a href="/categories.html#故事汇">
    		故事汇 <span>23</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Linux">
    		Linux <span>22</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#前端">
    		前端 <span>5</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#数据库">
    		数据库 <span>30</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Git">
    		Git <span>6</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Mac">
    		Mac <span>18</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Tools">
    		Tools <span>7</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#OpenSource">
    		OpenSource <span>11</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Python">
    		Python <span>46</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#云平台">
    		云平台 <span>8</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#虚拟化">
    		虚拟化 <span>3</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Java">
    		Java <span>6</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Docker">
    		Docker <span>6</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Blog">
    		Blog <span>7</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#安全">
    		安全 <span>2</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#读书笔记">
    		读书笔记 <span>16</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#微服务">
    		微服务 <span>2</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Kubernetes">
    		Kubernetes <span>15</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#DaoCloud Enterprise">
    		DaoCloud Enterprise <span>2</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#春松客服">
    		春松客服 <span>1</span>
    	</a></li>
    
  



      </ul>
    </div>
    <div>
      <h2>最近文章</h2>
      <ul>
        
        <li>
          <a href="/post/2023/02/Ketbrains%E6%BF%80%E6%B4%BB%E6%9C%8D%E5%8A%A1%E5%99%A8.html">在线服务器激活 Ketbrains</a>
          Ketbrains 激活服务器


        </li>
        
        <li>
          <a href="/post/2022/12/raycast-01.html">Raycast 你的年度报告已到达</a>
          从 Alfred 切换到 Raycast 也就 2 个多月的时间；使用体验有着比较大的提升。


        </li>
        
        <li>
          <a href="/post/2022/12/Skoala-Install-Dce5.html">DCE5-Skoala 安装教程</a>
          使用之前的话


        </li>
        
        <li>
          <a href="/post/2022/12/dce50.html">保姆式安装 DCE5.0</a>
          前言


        </li>
        
        <li>
          <a href="/post/2022/11/cskefu-opensource-project.html">开源项目 - 春松客服</a>
          项目起源


        </li>
        
      </ul>
    </div>
  </div>
</div>

			</div>

		</div>

    <footer>
      <div class="container">
        <div class="row mobilepadding">
          			<hr>
      &copy; 2023 船长. Powered by <a href="http://jekyllrb.com" target="_blank" title="The simple, blog-aware, static site generator.">Jekyll</a>. Theme Creator <a href="https://github.com/einverne" target="_blank" title="Ein Verne's GitHub Repos">Ein Verne</a> . Host on <a href="https://github.com/samzong/samzong.me" target="_blank" title="Samzong's GitHub Repos">Github</a> .
      <br><br>
      </div>
    </div>
    </footer>

    




	<script async type="text/javascript" src="/assets/themes/evjekylltheme/bootstrap-3.3.5/js/bootstrap.min.js"></script>
	<script async type="text/javascript" src="/assets/themes/evjekylltheme/webcore.js"></script>

 </body>
</html>

