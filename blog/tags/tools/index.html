<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">16 posts tagged with &quot;Tools&quot; | SAMZONG</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://samzong.me/blog/tags/tools"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="16 posts tagged with &quot;Tools&quot; | SAMZONG"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://samzong.me/blog/tags/tools"><link data-rh="true" rel="alternate" href="https://samzong.me/blog/tags/tools" hreflang="en"><link data-rh="true" rel="alternate" href="https://samzong.me/blog/tags/tools" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="SAMZONG RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="SAMZONG Atom Feed"><link rel="stylesheet" href="/assets/css/styles.44c5c7e5.css">
<link rel="preload" href="/assets/js/runtime~main.a4192aa2.js" as="script">
<link rel="preload" href="/assets/js/main.be9b3ddb.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/07/13/google-sou-suo-ji-qiao-zheng-li">Google 搜索技巧整理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/21/ketbrains-ji-huo-fu-wu-qi">在线服务器激活 Ketbrains</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/16/raycast">Raycast 你的年度报告已到达</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/15/Skoala-Install-Dce5">DCE5-Skoala 安装教程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/06/dce5">保姆式安装 DCE5.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/28/cskefu-opensource-project">春松客服</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/23/what-is-hukou">What is Hukou</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/20/Copy-To-Markdwon">Copy to Markdown</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/16/dubbo-ji-chu-zhi-shi">Dubbo 基础知识梳理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/10/panads-fill-nan-value-to-zero">Panads fill NaN value to Zero</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/10/22/redash-for-docker-bu-shu">Redash for Docker 部署</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/10/18/jwt-nei-zhi-de-fang-shi">JWT 内置的方式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/10/06/ji-ji-fu-ji-ji">唧唧复唧唧</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/10/04/zi-bei-yu-chao-yue">自卑与超越</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/28/gitlab-forked-ru-he-gen-sui-upstream-zhu-ku">GitLab Forked 如何跟随 upstream 主库</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/27/kafka-jing-pin-diao-yan-ji-gong-neng-she-ji">Kafka 调研及功能设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/22/poetry-shi-yong-bi-ji">Poetry 使用笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/20/skoala-bu-shu-jiao-cheng">Skoala 部署教程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/18/shi-yong-canal-jin-xing-shu-ju-ku-zeng-liang-tong-bu">使用 canal 进行数据库增量同步</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/12/k8s-xi-lie-nan-bei-liu-liang-he-dong-xi-liu-liang">K8s 系列 南北流量和东西流量</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/08/17/docker-for-mac-wang-luo-ji-qiao">Docker for Mac 网络技巧</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/08/15/wa-er-deng-hu">瓦尔登湖</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/08/10/contour-xue-xi-bi-ji">Contour 学习笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/24/tong-guo-pipreqs-huo-qu-dang-qian-xiang-mu-di-yi-lai-ku">通过 pipreqs 获取当前项目的依赖库</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/22/contour-envoy-zhi-biao">Contour和Envoy指标介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/22/jq-ming-ling-xing-json-chu-li-shen-qi">jq 命令行 Json 处理神器</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/21/wei-fu-wu-yin-qing-wang-guan-neng-li-jie-shao">微服务引擎网关能力介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/18/bi-guan-bei-zhan-11-yue">闭关备战 11 月</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/18/i18n-shi-yong-gou-jian">i18n 使用构建</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/29/mac-shang-an-zhuang-ruan-jian-de-fang-shi">Mac 上安装软件的方式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/18/httpproxy-api-chuang-jian">HTTPProxy API 创建</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/28/hexo-admonition">Hexo 增加 admonition 样式支持</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/18/gitlab-fa-song-qi-wei-ji-qi-ren-xiao-xi">Gitlab 发送企微机器人消息</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/17/guo-nei-huan-jing-da-jian-macos-k8s-kai-fa-huan-jing">国内环境搭建 MacOS K8s 开发环境</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/17/kubernetes-operator">Kubernetes Operator</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/11/contour-she-ji-li-nian">Contour 设计理念</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/07/macos-yin-cang-dock-lan-zhong-te-ding-ying-yong">MacOS 隐藏 Dock 栏中特定应用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/06/man-zu-yu-qi-de-wen-dang-zhan-mkdocs">满足预期的文档站 Mkdocs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/06/a-li-yun-yun-yuan-sheng-wang-guan">阿里云云原生网关</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/06/teng-xun-yun-wei-fu-wu-wang-guan">腾讯云微服务网关</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/03/alfred-workflow-tui-jian">Alfred Workflow 推荐</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/03/youtube-dl-xia-zai-youtube-shi-pin">youtube-dl 下载 YouTube 视频</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/03/tao-bao-python-sdk-you-hua-zhi-chi-python3">淘宝 Python SDK 优化支持 Python3</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/24/kubernetes-xue-xi-zhi-lu">kubernetes 学习之路</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/22/github-pages-de-miao-yong">GitHub Pages 的妙用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/21/kubernetes-bu-shu-cuo-wu-jie-jue-hui-zong">Kubernetes 部署错误解决汇总</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/19/xu-yao-liao-jie-de-jing-pin">需要了解的 K8s 发行版本</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/18/cka-kao-shi-zhun-bei">CKA 考试准备</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/17/Docker-Run-at-Apple-Silicon-M1">Dockerfile Run at M1 processor build failed</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/17/python-request-install-pip-error">python Request install pip error</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/16/metabase-shang-shou-shi-yong-jar">Metabase 上手 - 使用 Jar 运行</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/15/sql-dui-shi-jian-zheng-dian-de-chu-li">SQL 对时间整点的处理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/14/tao-bao-python-sdk-you-hua-zhi-chi-python3">淘宝 Python SDK 优化支持 Python3</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/14/python-pip-guo-nei-jia-su">Python Pip 国内加速</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/11/git-xiu-fu-li-shi-cuo-wu-de-author-xin-xi">Git 修复历史错误的 Author 信息</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/10/awsome-telegram-bot">Awsome Telegram Bot</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/28/Javascript-Tips">Javascript Tips</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/27/awesome-hexo-plugins">Awesome Hexo Plugin</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/27/poetry-shi-yong-bi-ji">Poetry 使用笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/27/python-duo-ban-ben-guan-li-gong-ju">Pyenv Python 多版本管理利器</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/11/xin-de-mu-biao">2022 新的目标</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/02/24/fastapi-shi-yong-wen-dang">FastAPI 使用文档</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/02/11/yi-ge-python-xiang-mu-di-mu-lu-jie-gou-she-ji">Python 项目的目录结构设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/21/python3-wen-ben-chu-li-strip-split">Python3 文本处理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/20/clickhouse-chang-yong-han-shu-shi-yong">ClickHouse 常用函数使用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/04/mysql-case-when">MySQL Case WHEN</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/03/apollo-ru-he-shi-xian-pei-zhi-re-fa-bu">Apollo 如何实现配置热发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/03/get-current-timestamp">get current timestamp</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/03/python-flask-form">python flask form</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/11/29/git-zhong-duan-clone-jia-su">Github 使用 SSH 拉取代码加速</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/11/19/ding-ding-nei-wang-chuan-tou-gong-ju">钉钉内网穿透工具</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/11/17/creating-dataframe-using-list">Creating DataFrame using list</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/11/17/shi-yong-ding-ding-san-fang-shou-quan-deng-lu">使用钉钉三方授权登录</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/11/03/metabase-cai-keng-tiao-zhuan-lian-jie-de-liu-lan-qi-huan-cun">Metabase 踩坑：跳转链接的浏览器缓存</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/10/19/python-version-manage-pyenv">Python Version Manage `pyenv`</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/10/12/macos-10.15-kai-qi-hidpi">MacOS 10.15 开启 HiDPI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/09/24/kuai-su-liao-jie-lian-jie-shu-ju-ku">快速了解连接数据库</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/09/24/node-nvm">node nvm</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/09/05/dataframe-pandas">dataframe - Pandas</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/09/05/shi-yong-python3-ge-shi-hua-da-xing-json-wen-jian">使用 Python3 格式化大型 json 文件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/08/25/python-zhua-chu-lai-sui-ji-xia-zai-ji-lu">Python 抓出来随机下载记录</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/08/09/mysql-regexp-huo-xue-huo-yong">MySQL REGEXP 活学活用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/08/08/chang-yong-sql">常用 SQL-拼接日期</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/07/22/zai-gu-ge-liu-lan-qi-zhong-an-zhuang-.crx-cha-jian">在谷歌浏览器中安装.crx 插件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/07/22/zhi-hu-zhou-kan-dan-shen-hui-shang-yin">知乎周刊・单身会上瘾</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/06/25/iphone-ipad-bu-yue-yu-an-zhuang-jiu-ban-cheng-xu">iPhone/iPad 不越狱安装旧版程序</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/06/12/mac-ru-he-kuai-su-lu-zhi-gif-xiao-shi-pin">Mac 如何快速录制 GiF 小视频</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/04/18/kuai-su-liao-jie-mysql-shi-jian-fan-wei-can-shu">快速了解 MySQL 时间范围参数</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/04/16/hql-sql-shi-jian-chu-li">HQL/SQL时间处理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/27/zhi-hu-zhou-kan-·-qiao-bu-si-wang-shi">知乎周刊·乔布斯往事</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/12/how-to-set-container-auto-restarting-with-docker">how to set container auto-restarting with docker</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/ai-ni-jiu-xiang-ai-sheng-ming">爱你就像爱生命</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/ju-ying-guo">巨婴国</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/macos-10.15-kai-qi-hidpi">macOS 10.15 开启 HiDPI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/qi-shi-ni-suo-zhi-dao-de-shi-jie-hen-mo-sheng">其实，你所知道的世界很陌生</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/ren-jian-shi-ge">人间失格</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/ren-sheng-de-jia-suo">人生的枷锁</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/san-sheng-san-shi-shi-li-tao-hua">三生三世十里桃花</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/wei-chuan-de-hong-jia-yi-chen-fu">未穿的红嫁衣·沉浮</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/wo-men-sheng-huo-zai-ju-da-de-cha-ju-li">我们生活在巨大的差距里</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/wo-suo-li-jie-de-sheng-huo">我所理解的生活</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/yuan-you-ren-pei-ni-dian-pei-liu-li">愿有人陪你颠沛流离</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/zui-hou-de-shua-hou-ren">最后的耍猴人</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/15/macos-terminal-san-jian-ke">macOs Terminal 三剑客</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/15/pprint-beautiful-json-format">pprint beautiful json format</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/15/python3-traceback">python3 traceback</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/15/requests-post-data-shi-dui-json-xu-yao-te-shu-zhu-yi">requests post data 时对 json 需要特殊注意</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/09/dingtalk-orgbot-sign-generate">dingtalk orgBot sign generate</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/07/python-django-bian-xie-gong-gong-mo-kuai-zai-app-zhong-yin-yong">python django 编写公共模块在 app 中引用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/01/20/python-xlsxwriter-xie-ru-excel">python xlsxwriter 写入 excel</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/01/01/year-the-new-start">2021 年 - 全新出发</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/25/jian-cha-nin-de-app-shi-fou-yi-zhi-chi-applesilicon">检查您的 App 是否已支持 AppleSilicon</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/25/mac-tiao-zheng-launchpad-tu-biao-da-xiao">Mac 调整 Launchpad 图标大小</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/13/learn-sqlalchemy">learn sqlalchemy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/09/covert-timestamp2datetime">covert timestamp2datetime</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/08/python-wan-cheng-dou-dian-api-shou-quan">python 完成抖店 API 授权</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/03/python3-str-qu-chu-te-ding-nei-rong">python3 str 去除特定内容</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/24/Check-You-Favorites-App-Is-Ready-Apple-Silicon">Check You App readyOnAppleSilicon</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/23/ru-he-zhong-zhi-mac-de-smc">如何重置 Mac 的 SMC</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/18/dai-ma-ge-shi-xiang-guan">代码格式相关</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/18/django-lian-shou-xiang-mu">Django 练手项目</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/17/python-re-zheng-ze-biao-da-shi">python re 正则表达式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/16/autoscraper-pa-chong-suo-jian-ji-suo-de">autoscraper 爬虫 所见即所得</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/09/django-chu-shi-hua-project">Django 初始化 project</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/06/django-xiu-gai-modules-shi-chu-cuo">Django 修改 modules 时出错</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/06/join-yu-format-bu-tong-de-yong-fa">join 与 format 不同的用法</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/05/beautiful-soup-4-shi-yong-ji-qiao">beautiful soup 4 使用技巧</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/04/python3-setup.py-help-commands">python3 setup.py --help-commands</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/10/23/use-devtools-encodeurl-&amp;-decodeurl">Use devtools encodeurl &amp; decodeurl</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/10/17/mac-shi-yong-ming-ling-guan-bi-he-qi-dong-airport">使用命令关闭和启动 AirPort</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/11/17/mac-jie-jue-oh-my-zsh-zai-zhong-duan-xia-da-kai-huan-man">Mac 下解决 oh-my-zsh 在终端下打开缓慢</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/07/22/mac-xia-homebrew-de-shi-yong">Mac 下 Homebrew 的使用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/07/03/mysql-ming-ling-xing-fu-zhu-mycli">MySQL 命令行辅助 mycli</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/01/22/mac-ru-he-kuai-su-lu-zhi-gif-xiao-shi-pin">MacTips 如何快速录制 GiF 小视频</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2018/11/17/mactips-dan-du-she-zhi-cheng-xu-yu-yan">MacTips 单独设置程序语言</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2018/08/04/HowTo-Skip-Atlassian-Auth-for-SourceTree">HowTo Skip Atlassian Auth for SourceTree</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2018/02/28/shi-yong-guo-nei-pypi-yuan-jia-su-pip-an-zhuang">使用国内 pypi 源加速 pip 安装</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2018/01/09/git-shi-yong-gui-fan-liu-cheng">Git 使用规范流程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/12/02/Howto-Install-Redmine-on-Ubuntu-16.04">Howto Install Redmine on Ubuntu 16.04</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/11/15/Howto-use-ssr-on-mac">HowTo Use SSR Service on Mac</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/10/22/iphone:ipad-bu-yue-yu-an-zhuang-jiu-ban-cheng-xu">iPhone/iPad 不越狱安装旧版程序</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/08/12/blazemeter-recoding-jmx">Jmeter 使用 BlazeMeter 为 Jmeter 录制脚本</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/06/02/bai-du-wang-pan-python-ke-hu-duan">bypy 百度网盘 Python 客户端</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/08/04/dong-ping-guo-jia-sen-lin-gong-yuan">东平国家森林公园</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/05/20/wo-lai-dao-zhe-shi-shang">我来到这世上</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/05/15/wannacry-ru-chong-bing-du-shi-jian-ji-xiu-fu-fang-an">Wannacry 蠕虫病毒事件及修复方案</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/04/18/centos-zeng-jia-xin-ying-pan-gei-gen-wen-jian-xi-tong-kuo-rong">CentOS 增加新硬盘给根文件系统扩容</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/04/13/HowTo-Install-GitLab">HowTo Install GitLab</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/04/11/guan-yu-kao-shi">关于考试</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/04/05/HowTo-set-Tomcat-7-automatic-startup-with-CentOS-7">HowTo set Tomcat 7 automatic startup with CentOS 7</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/03/23/zai-linux-zhong-duan-shi-yong-ssr-fu-wu-shi-xian-ke-xue-shang-wang">在 Linux 终端使用 SSR 服务实现科学上网</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/03/06/HowTo-install-Zoomdata">HowTo install Zoomdata</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/03/04/si-jie-mo-fang-te-shu-qing-kuang-zhi-chu-li">四阶魔方特殊情况之处理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/27/mactips-shi-yong-ming-ling-guan-bi-he-qi-dong-airport">MacTips 使用命令关闭和启动 AirPort</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/27/HowTo-Install-NextCloud">HowTo Install NextCloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/22/HowTo-Install-Redmine">HowTo Install Redmine</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/20/HowTo-Upgrade-Your-Ghost-Version">HowTo Upgrade Your Ghost Version</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/19/HowTo-Automatic-Updates-CENTOS-RHEL-Using-YUM">HowTo Automatic Updates CENTOS/RHEL Using YUM</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/09/mysql-8-suo-yin-chuang-jian-shan-chu-he-cha-kan">MySQL 索引创建、删除和查看</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/01/18/HowTo-Monitor-Tomcat-Head-Memory-for-Zabbix">HowTo Monitor Tomcat HeadMemory for Zabbix</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/01/15/mei-ri-bei-fen-mysql-dan-biao-shu-ju">每日备份 MySQL 单表数据</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/01/10/sheng-huo-zai-bie-chu">生活在别处</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/01/07/docker-hub-guo-nei-jia-su">Docker Hub 国内加速</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/01/01/wo-de-2017">我的 2017</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/20/HowTo-Mount-OSS-Bucket-On-ECS">HowTo Mount OSS Bucket On ECS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/17/shang-hai-tian-leng-le">上海天冷了</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/17/gao-bie">告别</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/11/xue-zhan-gang-ju-ling">血战钢锯岭</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/08/HowTo-Install-Python3-on-CentOS-6-x">HowTo Install Python3 on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/04/HowTo-Reset-MySQL-Root-Password">HowTo Reset MySQL Root Password</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/03/tomcat-2-li-yong-jdk-zi-shen-keytool-shi-xian-https">Tomcat 利用 JDK 自身 keytool 实现 HTTPS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/30/aws-use-s3cmd-ming-ling-xing-guan-li-s3-cun-chu">AWS Use s3cmd 命令行管理 S3 存储</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/29/Tomcat-1-java-lang-OutOfMemoryError">Tomcat java.lang.OutOfMemoryError</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/28/HowTo-Install-LNMP-on-CentOS-6-x">HowTo Install LNMP on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/27/shi-jie-shang-zui-mei-yong-de-dong-xi">世界上最没用的东西</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/23/denyhosts-zeng-jia-fu-wu-qi-ssh-hei-ming-dan-ji-zhi">Denyhosts 增加服务器 SSH 黑名单机制</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/10/mysql-5-qing-kong-biao-ming-ling-zhi-truncate-yu-delete-qu-bie">MySQL 清空表命令之：truncate 与 delete 区别</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/10/29/SSH-LINUX-Security-Settings">SSH LINUX Security Settings</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/10/20/HowTo-Install-PostgreSQL-9-5-on-CentOS-6-x">HowTo Install PostgreSQL 9.5 on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/10/14/xie-de-wei-bo">微博随笔</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/10/14/xie-de-weibo">写的微博</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/09/22/HowTo-Use-pt-query-digest">HowTo Use pt-query-digest</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/09/20/sheng-zhe-gu-du">生者孤独</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/09/19/HowTo-Install-a-Tomcat-Server-7">HowTo Install a Tomcat Server 7</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/19/er-shi-si-sui">二十四岁</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/13/Script-Install-LNMP">Use Script Install LNMP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/04/HowTo-Setup-MariaDB-Galera-Cluster-10-On-CentOS-6-x">HowTo Setup MariaDB Galera Cluster 10 On CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/02/HowTo-Install-Openfire-on-CentOS">HowTo Install Openfire  on CentOS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/02/HowTo-Use-Docker-create-a-Tomcat-Project">HowTo Use Docker create a Tomcat Project</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/01/ni-hao-ba-yue">你好，八月</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/29/HowTo-Trun-Off-IPv6-in-CentOS-6-x">HowTo Trun Off IPv6 in CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/27/HowTo-Install-KVM-Manage-Server-webvirtmgr">HowTo Install KVM Manage Server webvirtmgr</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/27/yum-zhong-releasever-he-basearch-de-qu-zhi">Yum 中$releasever 和$basearch 的取值</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/27/Manage-Tomcat-Service-Use-Shell-Script">Manage Tomcat Service Use Shell Script</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/24/HowTo-Play-Pokemon-GO-in-China">HowTo Play Pokemon GO in China</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/10/HowTo-Reset-Azure-VM-Linux-Password">HowTo Reset Azure VM Linux Password</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/07/HowTo-Install-Docker-on-CentOS-6-x">HowTo Install Docker on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/07/HowTo-Install-MySQL-5-5-6-7-on-RHEL-CentOS-5-6-7">HowTo Install MySQL 5.5/6/7 on RHEL/CentOS 5/6/7</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/07/HowTo-Use-Remi-Install-Redis">HowTo Use Remi Install Redis</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/05/HowTo-Use-Fuse-sshfs-to-Mount-Remote-Filesystems">HowTo Use Fuse-sshfs to Mount Remote Filesystems</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/06/16/mysql-1-chang-yong-you-hua">MySQL 常用配置优化</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/06/16/shi-yong-mosh-dai-ti-ssh-lian-jie-fu-wu-qi">使用 mosh 代替 ssh 连接服务器</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/24/Azure-HowTo-Use-Azure-CLI-on-Mac">HowTo Use Azure CLI on Mac</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/24/Azure-3-HowTo-Use-Azure-CLI-on-Mac">Azure CLI Import AcountInfo</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/20/HowTo-Monitoring-MySQL-server-for-Zabbix">HowTo Monitoring MySQL server for Zabbix</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/18/HowTo-Install-CloudStack-4-8-on-CentOS-6-x">HowTo Install CloudStack 4.8 on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/15/openstak-jie-shao">OpenStak 介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/12/azure-4-chuang-jian-he-shi-yong-azure-redis-cache">创建和使用 Azure Redis Cache</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/05/HowTo-Install-Fabric-on-CentOS-7-x">HowTo Install Fabric on CentOS 7.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/05/centos-7-2-xi-tong-fu-wu-guan-li-fang-shi">CentOS 系统服务管理方式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/08/12/HowTo-Automatic-EasyBackup-MysqlDB">CentOS 修改系统主机名</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/05/centos-7-1-xiu-gai-xi-tong-zhu-ji-ming">CentOS 修改系统主机名</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/05/mysql-3-mysqldump-chang-yong-can-shu">mysqldump 常用参数</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/04/HowTo-Install-Python-2-7-8-on-CentOS-6-x">HowTo Install Python 2.7.8 on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/27/HowTo-Add-Piwik-Tracking-to-Ghost">HowTo Add Piwik Tracking to Ghost</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/27/HowTo-Install-piwik-with-nginx-on-centos-6-x">HowTo Install piwik with nginx on centos 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/20/shi-yong-sourecetree-guan-li-ni-de-git-xiang-mu">使用 SoureceTree 管理你的 git 项目</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/09/mac-1-tiao-zheng-launchpad-tu-biao-da-xiao">MacTips 调整 Launchpad 图标大小</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/08/mac-2-jie-jue-oh-my-zsh-zai-zhong-duan-xia-da-kai-huan-man">MacTips 解决 oh-my-zsh 在 Terminal 下打开缓慢</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/01/ru-he-zai-centos-6-an-zhuang-geng-gao-ban-ben-de-php">如何在 CentOS 6 安装更高版本的 PHP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/29/mysql-4-mysql-shu-ju-ku-ji-chu">MySQL 数据库使用基础</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/29/linux-zhong-de-san-ge-te-shu-quan-xian">Linux 中的三个特殊权限</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/29/centos-6-1-shi-yong-createrepo-da-jian-ben-di-yuan">CentOS 使用 createrepo 搭建本地源</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/27/HowTo-Install-MongoDB-on-CentOS-6-x">HowTo Install MongoDB  on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/24/zai-centos-zhong-pei-zhi-sftp-huan-jing">在 CentOS 中配置 SFTP 环境</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/24/mysql-6-li-yong-linux-ji-hua-ren-wu-ding-shi-tong-bu-mysql">利用 Linux 计划任务定时同步 MySQL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/23/linux-bi-shi-shi-ti">Linux 笔试试题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/22/mysql-2-kai-qi-man-ri-zhi-you-hua">MySQL 开启慢日志优化</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/19/centos-6-2-chu-shi-an-zhuang-ji-ben-you-hua-cao-zuo">CentOS 初始安装基本优化操作</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/18/li-jie-linux-de-ying-lian-jie-yu-ruan-lian-jie">理解 Linux 的硬链接与软链接</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/07/long-zu-lu-ming-fei">龙族路明非</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/04/2016-chun-jie-du-shu-bi-ji">2016 春节读书笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/02/12/HowTo-use-TortoiseGit-for-Windows">HowTo use TortoiseGit for Windows</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/01/22/install-mariadb10-centos7">How to install MariaDB 10.1 on CentOS 7.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/01/15/ru-he-zuo-yi-ge-cheng-shu-de-zi-ji">何余生说要感谢身边所有美好的人</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/12/31/Hello-2016">Hello 2016</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/11/17/ji-jian-zhu-yi">极简主义</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/07/18/wu-ti">无题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/06/04/min-yao-shi-sheng">民谣是生</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/04/12/zhe-shi-yi-dao-gui-men-guan">这是一道鬼门关</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/04/03/lu-tu-shang">路途上</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/02/23/xie-de-di-yi-ge-qian-duan-ye-mian">写的第一个前端页面</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2014/07/22/centos7-configure-bind-dns-server">CentOS 7 Configure DNS Server</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2014/03/27/wo-shi-yi-ge-zui-bu-hui-xie-biao-ti-de-ren">我是一个最不会写标题的人</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2012/07/30/ai-yu-tong-de-bian-yuan">爱与痛的边缘</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>16 posts tagged with &quot;Tools&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2022/10/22/redash-for-docker-bu-shu">Redash for Docker 部署</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-10-22T00:00:00.000Z" itemprop="datePublished">October 22, 2022</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><blockquote><p>暗坑很多</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="部署过程">部署过程<a href="#部署过程" class="hash-link" aria-label="Direct link to 部署过程" title="Direct link to 部署过程">​</a></h2><ol><li>需要自行维护一个 env 作为配置文件</li></ol><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">REDASH_COOKIE_SECRET=a07cca441ab9f28b66c589f3118e0de48469b1bc6a5036eade7badbed305d96e</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">POSTGRES_HOST_AUTH_METHOD=trust</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">REDASH_REDIS_URL=redis://redis:6379/0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">REDASH_DATABASE_URL=postgresql://postgres</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>需要创建一个 postgres-data 并配置 docker-compose.yml 的路径，数据库持久化</p></li><li><p>需要给 postgres 容器增加 sudo 命令</p><ul><li>apk add sudo</li></ul></li><li><p>需要手工进入到 postgresql 容器内创建 role 和 database</p><ul><li>createuser -U postgres redash</li><li>createdb -U postgres redash</li></ul></li><li><p>执行数据库初始化动作</p></li><li><p>docker-compose run --rm server create<!-- -->_<!-- -->db</p></li><li><p>然后重启 redash 全部服务即可 docker-compose down 后重启</p></li></ul><blockquote><p>postgresql 在执行 psql 命令时，默认会读取当前系统用户作为执行 role；但 psql 默认用户是 postgres</p></blockquote><p><a href="https://redash.io/help/open-source/setup" target="_blank" rel="noopener noreferrer">https://redash.io/help/open-source/setup</a>
<a href="https://redash.io/help/open-source/dev-guide/docker" target="_blank" rel="noopener noreferrer">https://redash.io/help/open-source/dev-guide/docker</a>
<a href="https://docs.victoriametrics.com/url-examples.html#apiv1exportcsv" target="_blank" rel="noopener noreferrer">https://docs.victoriametrics.com/url-examples.html#apiv1exportcsv</a></p><p><a href="https://mp.weixin.qq.com/s?src=11%5C&amp;timestamp=1660629444%5C&amp;ver=3985%5C&amp;signature=verv70veamW*Ez2Sgc8e89yMJGwANIOzz4lfwbezyVV3wpWNT2d9SnGrDecUOwrbTJBR2o-Ax6ZS4Fpu2UxfX7Sy9xsk1LCXfY1wNr42ucl3tFePfJ7c536c8z*L-HOy%5C&amp;new=1" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s?src=11\<!-- -->×<!-- -->tamp=1660629444\&amp;ver=3985\&amp;signature=verv70veamW<em>Ez2Sgc8e89yMJGwANIOzz4lfwbezyVV3wpWNT2d9SnGrDecUOwrbTJBR2o-Ax6ZS4Fpu2UxfX7Sy9xsk1LCXfY1wNr42ucl3tFePfJ7c536c8z</em>L-HOy\&amp;new=1</a></p><p><a href="https://mp.weixin.qq.com/s?src=11&amp;timestamp=1660682601&amp;ver=3986&amp;signature=h8m0RzEX3qWsKcUo6Ee3azdsnzLQqUf3N8FdLhyWNa52U4vAvlbEaBFUCrTZnh54tT-YS2mODfkp-6Hemmzt3n*hzGHlEmXP-HO5830W0Fzmn4MMfnsOPBKLrcjaiU0h&amp;new=1" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s?src=11<!-- -->×<!-- -->tamp=1660682601&amp;ver=3986&amp;signature=h8m0RzEX3qWsKcUo6Ee3azdsnzLQqUf3N8FdLhyWNa52U4vAvlbEaBFUCrTZnh54tT-YS2mODfkp-6Hemmzt3n*hzGHlEmXP-HO5830W0Fzmn4MMfnsOPBKLrcjaiU0h&amp;new=1</a></p><ul><li>redash env 配置：<a href="https://redash.io/help/open-source/admin-guide/env-vars-settings" target="_blank" rel="noopener noreferrer">https://redash.io/help/open-source/admin-guide/env-vars-settings</a></li><li>postgres 权限问题 <a href="https://stackoverflow.com/a/25051632/5067657" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/a/25051632/5067657</a></li><li><a href="https://techoverflow.net/2021/05/07/how-to-fix-alpine-linux-ash-sudo-not-found/" target="_blank" rel="noopener noreferrer">https://techoverflow.net/2021/05/07/how-to-fix-alpine-linux-ash-sudo-not-found/</a></li><li><a href="https://discuss.redash.io/t/error-99-connecting-to-localhost-6379-cannot-assign-requested-address/9716/7" target="_blank" rel="noopener noreferrer">https://discuss.redash.io/t/error-99-connecting-to-localhost-6379-cannot-assign-requested-address/9716/7</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="启动的服务介绍">启动的服务介绍<a href="#启动的服务介绍" class="hash-link" aria-label="Direct link to 启动的服务介绍" title="Direct link to 启动的服务介绍">​</a></h2><ul><li>v10-redashio_adhoc_worker_1     # 执行查询任务的 worker</li><li>v10-redashio_postgres_1       # 数据库</li><li>v10-redashio_redis_1        # 缓存</li><li>v10-redashio_scheduled_worker_1   # 执行计划任务的 worker</li><li>v10-redashio_scheduler_1      # 计划任务管理 server</li><li>v10-redashio_server_1        # 主体 server</li></ul><p>以上主要会设计到 3 个镜像，redis、pgsql、redash，其中核心是 redash，所以关注镜像版本也是这个</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="版本升级">版本升级<a href="#版本升级" class="hash-link" aria-label="Direct link to 版本升级" title="Direct link to 版本升级">​</a></h2><p>redash 的版本升级较为方便，更换 server 的镜像；然后升级数据库即可。</p><blockquote><p>测试过从 v8 升级到 v10 , 和 v9 升级到 v10，都是 ok 的。</p></blockquote><ol><li>关闭 Redash 服务<ol><li><code>docker-compose stop server scheduler scheduled_worker adhoc_worker</code></li></ol></li><li>更新 docker-compose.yml<ol><li>基本上这一步，只需要更新 redash 的镜像版本即可</li><li>然后执行 <code>docker-compose pull</code> 拉取新镜像版本</li></ol></li><li>执行数据库升级<ol><li><code>docker-compose run --rm server manage db upgrade</code></li></ol></li><li>启动全部服务即可<ol><li><code>docker-compse up -d</code></li></ol></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="解决-es-的-https-问题">解决 ES 的 HTTPS 问题<a href="#解决-es-的-https-问题" class="hash-link" aria-label="Direct link to 解决 ES 的 HTTPS 问题" title="Direct link to 解决 ES 的 HTTPS 问题">​</a></h2><p>由于我们的 es 地址访问地址采用 https，但为自签证书，所以在 request 之中会有些问题，所以我在这里更新了 elasticsearch 的插件，然后将其上传到我个人的 docker hub.
<a href="https://hub.docker.com/r/samzong/redash" target="_blank" rel="noopener noreferrer">https://hub.docker.com/r/samzong/redash</a></p><blockquote><p>带来的问题，页面上无法选择到 Elasticsearch 作为数据源，没时间去研究了</p></blockquote><p>看了下还是可以使用 redash 的 API 去创建的 <code>/api/data_sources</code>:</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="配置">配置<a href="#配置" class="hash-link" aria-label="Direct link to 配置" title="Direct link to 配置">​</a></h2><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;options&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;basic_auth_password&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;-----&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;basic_auth_user&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;elastic&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;server&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://10.6.51.101:31001/&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;skip_tls_verification&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;elasticsearch&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;test-es&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>创建完成后，就可以在页面上更新了。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2022/09/18/shi-yong-canal-jin-xing-shu-ju-ku-zeng-liang-tong-bu">使用 canal 进行数据库增量同步</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-09-18T00:00:00.000Z" itemprop="datePublished">September 18, 2022</time> · <!-- -->3 min read</div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/1662586780206-7328e88e-c0e3-4e2f-ac6d-e072747efc4a.png?x-oss-process=image/resize,w_960,m_lfit" alt="image.png" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="Direct link to 简介" title="Direct link to 简介">​</a></h2><p><img loading="lazy" src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/20191104101735947.png?x-oss-process=image/resize,w_960,m_lfit" alt="image" class="img_ev3q"></p><p><strong>canal <!-- -->[<!-- -->kə&#x27;næl]</strong>，译意为水道/管道/沟渠，主要用途是基于 MySQL 数据库增量日志解析，提供增量数据订阅和消费</p><p>早期阿里巴巴因为杭州和美国双机房部署，存在跨机房同步的业务需求，实现方式主要是基于业务 trigger 获取增量变更。从 2010 年开始，业务逐步尝试数据库日志解析获取增量变更进行同步，由此衍生出了大量的数据库增量订阅和消费业务。</p><p>基于日志增量订阅和消费的业务包括</p><ul><li>数据库镜像</li><li>数据库实时备份</li><li>索引构建和实时维护 (拆分异构索引、倒排索引等)</li><li>业务 cache 刷新</li><li>带业务逻辑的增量数据处理</li></ul><p>当前的 canal 支持源端 MySQL 版本包括 5.1.x , 5.5.x , 5.6.x , 5.7.x , 8.0.x</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="工作原理">工作原理<a href="#工作原理" class="hash-link" aria-label="Direct link to 工作原理" title="Direct link to 工作原理">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mysql-主备复制原理">MySQL 主备复制原理<a href="#mysql-主备复制原理" class="hash-link" aria-label="Direct link to MySQL 主备复制原理" title="Direct link to MySQL 主备复制原理">​</a></h3><ul><li>MySQL master 将数据变更写入二进制日志 ( binary log, 其中记录叫做二进制日志事件 binary log events，可以通过 show binlog events 进行查看)</li><li>MySQL slave 将 master 的 binary log events 拷贝到它的中继日志 (relay log)</li><li>MySQL slave 重放 relay log 中事件，将数据变更反映它自己的数据</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="canal-工作原理">canal 工作原理<a href="#canal-工作原理" class="hash-link" aria-label="Direct link to canal 工作原理" title="Direct link to canal 工作原理">​</a></h3><ul><li>canal 模拟 MySQL slave 的交互协议，伪装自己为 MySQL slave，向 MySQL master 发送 dump 协议</li><li>MySQL master 收到 dump 请求，开始推送 binary log 给 slave (即 canal )</li><li>canal 解析 binary log 对象 (原始为 byte 流)</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="文档支持">文档支持<a href="#文档支持" class="hash-link" aria-label="Direct link to 文档支持" title="Direct link to 文档支持">​</a></h2><ul><li><a href="https://github.com/alibaba/canal/wiki/Home" target="_blank" rel="noopener noreferrer">Home</a></li><li><a href="https://github.com/alibaba/canal/wiki/Introduction" target="_blank" rel="noopener noreferrer">Introduction</a></li><li><a href="https://github.com/alibaba/canal/wiki/QuickStart" target="_blank" rel="noopener noreferrer">QuickStart</a><ul><li><a href="https://github.com/alibaba/canal/wiki/Docker-QuickStart" target="_blank" rel="noopener noreferrer">Docker QuickStart</a></li><li><a href="https://github.com/alibaba/canal/wiki/Canal-Kafka-RocketMQ-QuickStart%22" target="_blank" rel="noopener noreferrer">Canal Kafka/RocketMQ QuickStart</a></li><li><a href="https://github.com/alibaba/canal/wiki/aliyun-RDS-QuickStart" target="_blank" rel="noopener noreferrer">Aliyun RDS for MySQL QuickStart</a></li><li><a href="https://github.com/alibaba/canal/wiki/Prometheus-QuickStart" target="_blank" rel="noopener noreferrer">Prometheus QuickStart</a></li></ul></li><li>Canal Admin<ul><li><a href="https://github.com/alibaba/canal/wiki/Canal-Admin-QuickStart" target="_blank" rel="noopener noreferrer">Canal Admin QuickStart</a></li><li><a href="https://github.com/alibaba/canal/wiki/Canal-Admin-Guide" target="_blank" rel="noopener noreferrer">Canal Admin Guide</a></li><li><a href="https://github.com/alibaba/canal/wiki/Canal-Admin-ServerGuide" target="_blank" rel="noopener noreferrer">Canal Admin ServerGuide</a></li><li><a href="https://github.com/alibaba/canal/wiki/Canal-Admin-Docker" target="_blank" rel="noopener noreferrer">Canal Admin Docker</a></li></ul></li><li><a href="https://github.com/alibaba/canal/wiki/AdminGuide" target="_blank" rel="noopener noreferrer">AdminGuide</a></li><li><a href="https://github.com/alibaba/canal/wiki/ClientExample" target="_blank" rel="noopener noreferrer">ClientExample</a></li><li><a href="https://github.com/alibaba/canal/wiki/ClientAPI" target="_blank" rel="noopener noreferrer">ClientAPI</a></li><li><a href="https://github.com/alibaba/canal/wiki/Performance" target="_blank" rel="noopener noreferrer">Performance</a></li><li><a href="https://github.com/alibaba/canal/wiki/DevGuide" target="_blank" rel="noopener noreferrer">DevGuide</a></li><li><a href="https://github.com/alibaba/canal/wiki/BinlogChange%28mysql5.6%29" target="_blank" rel="noopener noreferrer">BinlogChange(MySQL 5.6)</a></li><li><a href="https://github.com/alibaba/canal/wiki/BinlogChange%28MariaDB%29" target="_blank" rel="noopener noreferrer">BinlogChange(MariaDB)</a></li><li><a href="https://github.com/alibaba/canal/wiki/TableMetaTSDB" target="_blank" rel="noopener noreferrer">TableMetaTSDB</a></li><li><a href="http://alibaba.github.com/canal/release.html" target="_blank" rel="noopener noreferrer">ReleaseNotes</a></li><li><a href="https://github.com/alibaba/canal/releases" target="_blank" rel="noopener noreferrer">Download</a></li><li><a href="https://github.com/alibaba/canal/wiki/FAQ" target="_blank" rel="noopener noreferrer">FAQ</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="多语言">多语言<a href="#多语言" class="hash-link" aria-label="Direct link to 多语言" title="Direct link to 多语言">​</a></h2><p>canal 特别设计了 client-server 模式，交互协议使用 protobuf 3.0 , client 端可采用不同语言实现不同的消费逻辑，欢迎大家提交 pull request</p><ul><li>canal java 客户端：<a href="https://github.com/alibaba/canal/wiki/ClientExample" target="_blank" rel="noopener noreferrer">https://github.com/alibaba/canal/wiki/ClientExample</a></li><li>canal c# 客户端：<a href="https://github.com/dotnetcore/CanalSharp" target="_blank" rel="noopener noreferrer">https://github.com/dotnetcore/CanalSharp</a></li><li>canal go 客户端：<a href="https://github.com/CanalClient/canal-go" target="_blank" rel="noopener noreferrer">https://github.com/CanalClient/canal-go</a></li><li>canal php 客户端：<a href="https://github.com/xingwenge/canal-php" target="_blank" rel="noopener noreferrer">https://github.com/xingwenge/canal-php</a></li><li>canal Python 客户端：<a href="https://github.com/haozi3156666/canal-python" target="_blank" rel="noopener noreferrer">https://github.com/haozi3156666/canal-python</a></li><li>canal Rust 客户端：<a href="https://github.com/laohanlinux/canal-rs" target="_blank" rel="noopener noreferrer">https://github.com/laohanlinux/canal-rs</a></li><li>canal Nodejs 客户端：<a href="https://github.com/marmot-z/canal-nodejs" target="_blank" rel="noopener noreferrer">https://github.com/marmot-z/canal-nodejs</a></li></ul><p>canal 作为 MySQL binlog 增量获取和解析工具，可将变更记录投递到 MQ 系统中，比如 Kafka/RocketMQ，可以借助于 MQ 的多语言能力</p><ul><li>参考文档：<a href="https://github.com/alibaba/canal/wiki/Canal-Kafka-RocketMQ-QuickStart" target="_blank" rel="noopener noreferrer">Canal Kafka/RocketMQ QuickStart</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="资料整理">资料整理<a href="#资料整理" class="hash-link" aria-label="Direct link to 资料整理" title="Direct link to 资料整理">​</a></h2><p>canal 的策略是模拟了 MySQL Slave 的行为，因此需要有 SELECT, REPLICATION SLAVE, REPLICATION CLIENT 的权限</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/my-sql">MySQL</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2022/04/16/metabase-shang-shou-shi-yong-jar">Metabase 上手 - 使用 Jar 运行</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-04-16T02:40:00.000Z" itemprop="datePublished">April 16, 2022</time> · <!-- -->3 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="metabase-documentation">Metabase Documentation<a href="#metabase-documentation" class="hash-link" aria-label="Direct link to Metabase Documentation" title="Direct link to Metabase Documentation">​</a></h2><p>这里主要是 metabase 的部署和使用方法，以及相关的组件的使用方法。</p><p>我正在打造一个中文环境下 Metabase 交互的社群，如果你有任何关于 Metabase 的问题，请联系我们：</p><blockquote><p>Metabase 中文交流 <strong><a href="https://t.me/metabase_zh" target="_blank" rel="noopener noreferrer">https://t.me/metabase_zh</a></strong></p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation">Installation<a href="#installation" class="hash-link" aria-label="Direct link to Installation" title="Direct link to Installation">​</a></h2><p>Metabase 的安装方式有三种：</p><ul><li>以 Jar 包的形式，在本地运行，只需要简单的步骤即可 <strong>(本文)</strong></li><li>以 Docker 容器的形式，部署到服务器上</li></ul><p>以 Jar 的方式来运行相对简单，对环境依赖也是比较少，只要的电脑上有 JDK 就可以了。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="检查-java-环境">检查 Java 环境<a href="#检查-java-环境" class="hash-link" aria-label="Direct link to 检查 Java 环境" title="Direct link to 检查 Java 环境">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">java -version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> java version </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1.8.0_311&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> Java</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">TM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> SE Runtime Environment </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">build </span><span class="token number">1.8</span><span class="token plain">.0_311-b11</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> Java HotSpot</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">TM</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token number">64</span><span class="token plain">-Bit Server VM </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">build </span><span class="token number">25.311</span><span class="token plain">-b11, mixed mode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Metabase 要求 Java 8 及以上，如果你的环境不支持，请先升级</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="获取-metabase-的-jar-包">获取 Metabase 的 Jar 包<a href="#获取-metabase-的-jar-包" class="hash-link" aria-label="Direct link to 获取 Metabase 的 Jar 包" title="Direct link to 获取 Metabase 的 Jar 包">​</a></h3><blockquote><p><a href="https://metabase.com/start/jar.html" target="_blank" rel="noopener noreferrer">https://metabase.com/start/jar.html</a></p></blockquote><p>通过上方这个链接，可以很快的获取到 Metabase 的最新版本的 Jar 包</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="启动-metabase">启动 Metabase<a href="#启动-metabase" class="hash-link" aria-label="Direct link to 启动 Metabase" title="Direct link to 启动 Metabase">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">java -jar metabase.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过一个简单的命令，就可以启动 Metabase 了，这个命令会自动检查环境，如果环境没问题，就会自动启动 Metabase 了。</p><blockquote><p>生产环境的 MetaBase 路径是 /data/product/metabase/</p></blockquote><p>成功启动后，Metabase 会运行在 3000 端口</p><blockquote><p><a href="http://localhost:3000/" target="_blank" rel="noopener noreferrer">http://localhost:3000/</a></p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="以后台方式运行-metabase">以后台方式运行 Metabase<a href="#以后台方式运行-metabase" class="hash-link" aria-label="Direct link to 以后台方式运行 Metabase" title="Direct link to 以后台方式运行 Metabase">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">nohup</span><span class="token plain"> java -jar metabase.jar </span><span class="token operator">&gt;</span><span class="token plain"> metabase.log </span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token plain"> </span><span class="token operator">&amp;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>日志文件会保存在本地的 metabase.log 文件中，如果你想查看 Metabase 的日志，可以使用 tail -f metabase.log 来查看。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置-metabase-的数据库">配置 Metabase 的数据库<a href="#配置-metabase-的数据库" class="hash-link" aria-label="Direct link to 配置 Metabase 的数据库" title="Direct link to 配置 Metabase 的数据库">​</a></h3><p>Metabase 默认的采用的是 H2 的作为数据库存储，会存放在程序运行目录下的 <code>data</code> 目录下；但对于在正式环境中启用 Metabase，我们建议使用 MySQL 来作为数据库存储。</p><p>而指定 Metabase 的数据库配置，可以很方便的加载到系统的默认环境中：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">vim</span><span class="token plain"> ~/.bashrc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># update metabase config at .bashrc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">MB_DB_TYPE</span><span class="token operator">=</span><span class="token plain">mysql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">MB_DB_DBNAME</span><span class="token operator">=</span><span class="token plain">metabase</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">MB_DB_PORT</span><span class="token operator">=</span><span class="token number">3306</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">MB_DB_USER</span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">MB_DB_PASS</span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">MB_DB_HOST</span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">MB_DB_CONNECTION_URI</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;mysql://MB_DB_HOST:MB_DB_PORT/MB_DB_DBNAME?user=MB_DB_USER&amp;password=MB_DB_PASS&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">JAVA_TIMEZONE</span><span class="token operator">=</span><span class="token plain">Asia/Shanghai</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置-metabase-的-nginx">配置 Metabase 的 Nginx<a href="#配置-metabase-的-nginx" class="hash-link" aria-label="Direct link to 配置 Metabase 的 Nginx" title="Direct link to 配置 Metabase 的 Nginx">​</a></h3><p>通过配置 Metabase 的 Nginx，可以让 Metabase 在网站上运行，这样可以开放外部服务给使用者</p><p>对 Nginx 的配置，比较简单，可以参考这个文档：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">server </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> listen </span><span class="token number">443</span><span class="token plain"> ssl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> server_name example.com</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> root /var/www/example.com/public</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># reverse proxy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> location /mb/ </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  proxy_pass http://127.0.0.1:3000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  proxy_set_header Host </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$Host</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>overseas-metabase 的 配置文件放在 /etc/nginx/config.d/leyan.core 下，在 80.conf 内 引用</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置-metabase-的-clickhouse-插件">配置 Metabase 的 ClickHouse 插件<a href="#配置-metabase-的-clickhouse-插件" class="hash-link" aria-label="Direct link to 配置 Metabase 的 ClickHouse 插件" title="Direct link to 配置 Metabase 的 ClickHouse 插件">​</a></h3><blockquote><p>Metabase 官方支持数据库 <a href="https://www.metabase.com/docs/latest/administration-guide/01-managing-databases.html#officially-supported-databases" target="_blank" rel="noopener noreferrer">https://www.metabase.com/docs/latest/administration-guide/01-managing-databases.html#officially-supported-databases</a></p></blockquote><p>Metabase 默认支持非常丰富数据库驱动，这些都会预置在 Jar 内，例如 MySQL、Oracle、SQL Server；但是 ClickHouse 不在其中，所以我们需要独立进行安装。</p><p>ClickHouse 驱动：<a href="https://github.com/enqueue/metabase-clickhouse-driver#readme" target="_blank" rel="noopener noreferrer">https://github.com/enqueue/metabase-clickhouse-driver#readme</a>=</p><ul><li>下载 <strong>合适的</strong> 驱动版本，放在 Metabase 的目录下的 plugin 文件夹下</li><li>重新启动 Metabase 即可</li><li>在 Metabase 的数据库管理中新增数据库，选择类型为 ClickHouse</li></ul><blockquote><p>更多三方驱动：<a href="https://www.metabase.com/docs/latest/developers-guide-drivers.html#how-to-use-a-community-built-driver" target="_blank" rel="noopener noreferrer">https://www.metabase.com/docs/latest/developers-guide-drivers.html#how-to-use-a-community-built-driver</a></p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tips">Tips<a href="#tips" class="hash-link" aria-label="Direct link to Tips" title="Direct link to Tips">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-如何重启-metabase-">1. 如何重启 Metabase ?<a href="#1-如何重启-metabase-" class="hash-link" aria-label="Direct link to 1. 如何重启 Metabase ?" title="Direct link to 1. 如何重启 Metabase ?">​</a></h3><p>直接杀掉进程即可，如果为了以后方便，可以将下述命令保存为 stop.sh 放在目录下，后续直接执行</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">APP_NAME</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;metabase&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">ps</span><span class="token plain"> aux </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> python </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">${APP_NAME}</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;{print $2}&#x27;</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">xargs</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">kill</span><span class="token plain"> -9</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2022/01/20/clickhouse-chang-yong-han-shu-shi-yong">ClickHouse 常用函数使用</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-01-20T00:00:00.000Z" itemprop="datePublished">January 20, 2022</time> · <!-- -->One min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-调整时区">1. 调整时区<a href="#1-调整时区" class="hash-link" aria-label="Direct link to 1. 调整时区" title="Direct link to 1. 调整时区">​</a></h2><p>用于调整时区为查询者的时区</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">-- clickhouse</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">toString</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">toDateTime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">event_time</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Asia/Shanghai&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> event_time</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- mysql howto</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain">  CONVERT_TZ</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;2020-04-06 02:00:00&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;UTC&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Asia/Hong_Kong&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> event_time</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-提前-json-中的字符串">2. 提前 Json 中的字符串<a href="#2-提前-json-中的字符串" class="hash-link" aria-label="Direct link to 2. 提前 Json 中的字符串" title="Direct link to 2. 提前 Json 中的字符串">​</a></h2><p>通过 <code>JSONExtractRaw</code>对多层 Json 结构的数据进行 <code>精准提取</code></p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">-- clickhouse</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">JSONExtractRaw</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;properties&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">JSONExtractRaw</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">JSONExtractRaw</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;properties&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;app_env&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> app_env</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- mysql howto</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">json_extract</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;$.properties&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> properties</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">json_extract</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">json_extract</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;$.properties&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;$.app_env&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> app_env</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>提取字符串，然后剔除双引号 <code>&quot;&quot;</code></p></blockquote><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">-- clickhouse</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">JSONExtractString</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">JSONExtractRaw</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;app_env&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> app_env</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">-- mysql</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">json_unquote</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">json_extract</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;$.app_env&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> app_env</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-判断字段不为空">3. 判断字段不为空<a href="#3-判断字段不为空" class="hash-link" aria-label="Direct link to 3. 判断字段不为空" title="Direct link to 3. 判断字段不为空">​</a></h2><p>使用在 where 条件中，判断字段 为空或者不为空</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token operator">and</span><span class="token plain"> notEmpty</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">client_version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">--不为空</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token operator">and</span><span class="token plain"> empty</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">app_version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">--为空</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2021/11/03/metabase-cai-keng-tiao-zhuan-lian-jie-de-liu-lan-qi-huan-cun">Metabase 踩坑：跳转链接的浏览器缓存</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-11-03T00:00:00.000Z" itemprop="datePublished">November 3, 2021</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/1635955971186-4f85ab8d-9d1e-46ab-bd20-ee914c91fade.png?x-oss-process=image/resize,w_960,m_lfit" alt="image.png" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="背景说明">背景说明<a href="#背景说明" class="hash-link" aria-label="Direct link to 背景说明" title="Direct link to 背景说明">​</a></h3><p>最近在使用 Metabase 做一个内部工具的跳转传送门，大概实现的方式是这样：
<img loading="lazy" src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/1635956694248-79aec951-9e6d-4360-b4e9-37bd2cefd740.png?x-oss-process=image/resize,w_960,m_lfit" alt="image.png" class="img_ev3q"></p><ul><li>通过 Metabase 带有的字段支持链接跳转的功能，拼接上查询结果的部分</li><li>后端服务完成对用户行为的校验，并且完成身份预认证，生成验证 token</li><li>然后带着预认证的信息跳转到对应的系统内</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题分析">问题分析<a href="#问题分析" class="hash-link" aria-label="Direct link to 问题分析" title="Direct link to 问题分析">​</a></h3><p>起初用的时候发现还好，不过陆续有同学反馈有些行数的结果不能够进入后台去，而让其他人使用又是没问题；</p><p>简单分析了下服务端日志，发现不能正常登录情况是请求根本没有到后端服务器，浏览器直接进行了跳转，而之前签发的 token 是有时效的，超过时间就过期了，所以导致跳转后校验不通过</p><p><a href="https://juejin.cn/post/6844904130482274318" target="_blank" rel="noopener noreferrer"><img loading="lazy" src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/1635957317795-60317ecd-b550-42d6-ab25-3f0b7d9247d9.png?x-oss-process=image/resize,w_960,m_lfit" alt="image.png" class="img_ev3q"></a></p><blockquote><p>有兴趣的同学，可以点击上方的图片链接，去详细介绍的原文看看</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="解决思路">解决思路<a href="#解决思路" class="hash-link" aria-label="Direct link to 解决思路" title="Direct link to 解决思路">​</a></h3><p>靠着对前端和浏览器一知半解+Google 出来的结果，<strong>只要欺骗浏览器每次请求的路径不一样，就可以解决这个问题。</strong></p><p>所以解铃还须系铃人，当然还是靠着 Metabase 来解决这个问题</p><div class="theme-admonition theme-admonition-success alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>在 SQL 查询结果中增加一个每次都是不一样的结果字段 <strong>取 unixtimestamp 时间</strong>，然后将结果拼接到 url 中</p></div></div><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> UNIX_TIMESTAMP</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token identifier">ts</span><span class="token identifier punctuation" style="color:rgb(248, 248, 242)">`</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">//每次取值当前时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> table_name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>解决之后对比</p></blockquote><p><img loading="lazy" src="http://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com//uPic/1635957781278-bd41df03-24be-4640-b77f-54ba77774bea.png?x-oss-process=image/resize,w_960,m_lfit" alt="image.png" class="img_ev3q"></p><p>🎆🎆🎆  完毕，问题得以解决</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="其他">其他<a href="#其他" class="hash-link" aria-label="Direct link to 其他" title="Direct link to 其他">​</a></h3><p>注意在后端服务上去除对时间参数的过滤，因为我是只处理了我想要的字段，所以这样的调整 服务端代码都不用改</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/12/02/Howto-Install-Redmine-on-Ubuntu-16.04">Howto Install Redmine on Ubuntu 16.04</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-12-02T00:00:00.000Z" itemprop="datePublished">December 2, 2017</time> · <!-- -->One min read</div></header><div class="markdown" itemprop="articleBody"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># base</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> mysql-server libmysqlclient-dev git-core subversion imagemagick libmagickwand-dev libcurl4-openssl-dev </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> build-essential mysql-server ruby ruby-dev libmysqlclient-dev imagemagick libmagickwand-dev</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># install mysql</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">enable</span><span class="token plain"> mysql.service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl start mysql.service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create database redmine character </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">set</span><span class="token plain"> utf8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">grant all privileges on redmine.* to redmine@</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;localhost&#x27;</span><span class="token plain"> identified by </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;redmine&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">flush privileges</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Install ruby</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -sSL https://get.rvm.io </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">bash</span><span class="token plain"> -s stable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">source</span><span class="token plain"> /etc/profile.d/rvm.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rvm requirements</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rvm </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> </span><span class="token number">2.4</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rvm use </span><span class="token number">2.4</span><span class="token plain">.1 --default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># install passenger and nginx </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gem </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> passenger --no-ri --no-rdoc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">passenger-install-nginx-module</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 1. auto install nginx.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> https://raw.githubusercontent.com/makevoid/nginx-passenger-ubuntu/master/nginx/nginx.service </span><span class="token operator">&gt;</span><span class="token plain"> /lib/systemd/system/nginx.service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl daemon-reload</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">enable</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">vim</span><span class="token plain"> /opt/nginx/conf/nginx.conf </span><span class="token comment" style="color:rgb(98, 114, 164)"># 注销 location / {} 的配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  listen  </span><span class="token number">80</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  server_name </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">your_server_domain_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># redmine.com;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  root /var/data/redmine/public</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  passenger_enabled on</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  client_max_body_size      10m</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># Max attachemnt size</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl start nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># install redmine</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain"> /var/data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> /var/data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">svn co http://svn.redmine.org/redmine/branches/3.4-stable redmine</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> /var/data/redmine</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">cp</span><span class="token plain"> -pR /var/data/redmine/config/database.yml.example /var/data/redmine/config/database.yml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">vim</span><span class="token plain"> config/database.yml  </span><span class="token comment" style="color:rgb(98, 114, 164)"># set redmine db user and password</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Install Plugins</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> /var/data/redmine</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gem </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> bundler --no-ri --no-rdoc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bundle </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># configure redmine</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> /var/data/redmine</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain"> public/plugin_assets</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">chown</span><span class="token plain"> -R www-data:www-data files log tmp public/plugin_assets config.ru</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> -R </span><span class="token number">755</span><span class="token plain"> files log tmp public/plugin_assets</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># input database and base file.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">RAILS_ENV</span><span class="token operator">=</span><span class="token plain">production bundle </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exec</span><span class="token plain"> rake db:migrate</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">RAILS_ENV</span><span class="token operator">=</span><span class="token plain">production bundle </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exec</span><span class="token plain"> rake redmine:load_default_data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bundle </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exec</span><span class="token plain"> rake generate_secret_token</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># restart nginx, install ok.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl restart nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># restart redmine</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">touch</span><span class="token plain"> /var/data/redmine/tmp/restart.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># configure email service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">vim</span><span class="token plain"> /var/data/redmine/config/configuration.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/08/12/blazemeter-recoding-jmx">Jmeter 使用 BlazeMeter 为 Jmeter 录制脚本</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-08-12T00:00:00.000Z" itemprop="datePublished">August 12, 2017</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><p>之前一直使用阿里云的 PTS 服务作为测试，但是今天发现阿里云的 PTS 服务正在升级无法使用，所以打算用 Jmeter 来做压力测试，并使用 Chrome 插件 BlazeMeter 来录制.jmx 脚本。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装-blazemeter-插件">安装 BlazeMeter 插件<a href="#安装-blazemeter-插件" class="hash-link" aria-label="Direct link to 安装 BlazeMeter 插件" title="Direct link to 安装 BlazeMeter 插件">​</a></h4><p><a href="https://chrome.google.com/webstore/search/blazemeter" target="_blank" rel="noopener noreferrer">插件安装</a> , 需要能登录到Chrome应用商店，如果不能登录的话，可以在网上搜索下载crx包，手动加载到Chrome中即可。</p><p>安装成功之后，在 Chrome 插件栏可以看到程序入口，<img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/r0ps7.jpg" alt="image" class="img_ev3q"></p><p>BlazeMeter 限制需要登录才能导出 jmx 脚本，所以首先需要注册账号。成功登陆后，完整界面如图所示：</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/oamv4.png" alt="image" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="录制过程">录制过程<a href="#录制过程" class="hash-link" aria-label="Direct link to 录制过程" title="Direct link to 录制过程">​</a></h4><p>填写测试脚本名称后，点击开始录制，执行一系列操作后，点停止录制，然后到处 jmx 文件到本地。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="导入脚本到-jmeter">导入脚本到 Jmeter<a href="#导入脚本到-jmeter" class="hash-link" aria-label="Direct link to 导入脚本到 Jmeter" title="Direct link to 导入脚本到 Jmeter">​</a></h4><p>在 Jmeter 中&quot;File-Open&quot;导入你 jmx 脚本，为了方便观察结果，我们需要增加一些察看报告。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/uxe75.jpg" alt="image" class="img_ev3q"></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="聚合报告-aggregate-report">聚合报告 (Aggregate Report)<a href="#聚合报告-aggregate-report" class="hash-link" aria-label="Direct link to 聚合报告 (Aggregate Report)" title="Direct link to 聚合报告 (Aggregate Report)">​</a></h5><p>我们可以在聚合报告中一些非常有用的信息，这有助于对性能测试的分析。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/j93gs.png" alt="image" class="img_ev3q"></p><ul><li>Samples：一共完成了多少事务</li><li>Averge：平均响应时间</li><li>Median：统计意义上的响应时间的中值</li><li>90% Line：90% 的事务响应时间都小于 xx ms</li><li>Min：最小响应时间 ms</li><li>Max :  最大响应时间 ms</li><li>Eror %  : 出错率</li><li>Throughput：吞吐量，事务/秒</li><li>KB/sec：用流量来衡量的吞吐量</li></ul><blockquote><p>吞吐量=完成的事务数/完成这些事务数所需要的时间；</p><p>平均响应时间=所有响应时间的总和/完成的事务数；</p><p>失败率=失败的个数/事务数。</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="查看结果树-view-results-tree">查看结果树 (View Results Tree)<a href="#查看结果树-view-results-tree" class="hash-link" aria-label="Direct link to 查看结果树 (View Results Tree)" title="Direct link to 查看结果树 (View Results Tree)">​</a></h5><p>通过查看结果树，可以看到每个事务的返回结果，其中红色是出错，绿色则为正常。建议在测试开始前将 log/Display Only 中 Errors 打上勾即可，不然会输出很多东西，不方便查看。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/moo9h.png" alt="image" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/test">Test</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/03/06/HowTo-install-Zoomdata">HowTo install Zoomdata</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-03-06T09:44:47.000Z" itemprop="datePublished">March 6, 2017</time> · <!-- -->One min read</div></header><div class="markdown" itemprop="articleBody"><p>Zoomdata 是一个大数据可视化展示的工具，由 ZoomData 企业创建，是为数不多的同时支持移动端的数据分析公司，Zoomdata 的可视化可将大数据流转化为触屏友好的，艺术感十足的三维形态，Zoomdata 的定位是非 ETL(传统的提取、转换和加载的数据处理过程) 工具，Zoomdata 支持多种数据源，包括社交媒体等，其中应用最主流是大数据平台的展示工具，并且 Zoomdata 对 Cloudera Impala 做了很好的支持，所以我们做了 Zoomdata+Cloudera 技术实施。<sup id="fnref-1-1ac1ac"><a href="#fn-1-1ac1ac" class="footnote-ref">1</a></sup></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="系统要求"><strong>系统要求</strong><a href="#系统要求" class="hash-link" aria-label="Direct link to 系统要求" title="Direct link to 系统要求">​</a></h4><p>Zoomdata 最新版是 v2.4，支持常见主流的操作系统，并且有非常友好的安装帮助，但是 Zoomdata 不支持安装在 32 位的操作系统之上</p><table><thead><tr><th>biaoti</th><th>biaoti</th><th>baiiti</th></tr></thead><tbody><tr><td>list</td><td>file</td><td>china</td></tr><tr><td>letian</td><td>zhong</td><td>hongkong</td></tr></tbody></table><div class="footnotes"><hr><ol><li id="fn-1-1ac1ac">这是一个示意的文档<a href="#fnref-1-1ac1ac" class="footnote-backref">↩</a></li></ol></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/microservice">Microservice</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/02/27/HowTo-Install-NextCloud">HowTo Install NextCloud</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-02-27T14:57:00.000Z" itemprop="datePublished">February 27, 2017</time> · <!-- -->7 min read</div></header><div class="markdown" itemprop="articleBody"><p>随着最近一个云盘厂家不再提供个人服务，或者开始各种收费限速，自己存放在第三方云盘厂商的数据被盗取，数据的安全性和数据的稳定性都得不到保证，而且随着智能终端的普及，我也有一些更加高质量的图片文件需要大量储存，所以我想到了自建存储服务的方式，在甄别了 OwnCloud，Seafiles 和 NextCloud，最后选择了 NextCloud 作为自己今后数据存储节点，NextCloud 源自 OwnCloud，但是近些年来 OwnCloud 的发展进度几乎停滞，多数开发者也转战 NextCloud，当然 NextCloud 也继承了搭建简单，依赖于 PHP 环境的特性。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行环境">运行环境<a href="#运行环境" class="hash-link" aria-label="Direct link to 运行环境" title="Direct link to 运行环境">​</a></h2><ul><li>阿里云 ECS CentOS 6.x</li><li>免费 SSL 证书 (腾讯云申请)</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="搭建-lnmp-环境">搭建 LNMP 环境<a href="#搭建-lnmp-环境" class="hash-link" aria-label="Direct link to 搭建 LNMP 环境" title="Direct link to 搭建 LNMP 环境">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="软件版本">软件版本<a href="#软件版本" class="hash-link" aria-label="Direct link to 软件版本" title="Direct link to 软件版本">​</a></h3><ul><li>PHP 5.6.30   <a href="https://samzong.me/php54-centos6/" target="_blank" rel="noopener noreferrer">安装教程</a></li><li>MySQL 5.6.35  <a href="https://samzong.me/how-to-install-mysql-5-6-on-centos/" target="_blank" rel="noopener noreferrer">安装教程</a></li><li>Nginx 1.10.2</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="基础环境安装">基础环境安装<a href="#基础环境安装" class="hash-link" aria-label="Direct link to 基础环境安装" title="Direct link to 基础环境安装">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum update -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum groupinstall -y &quot;Base&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum groupinstall -y &quot;Development tools&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Install epel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum install -y epel-release</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Install remi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum install http://rpms.famillecollet.com/enterprise/remi-release-6.rpm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Install mysql-community</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum install http://repo.mysql.com/yum/mysql-5.6-community/el/6/x86_64/mysql-community-release-el6-7.noarch.rpm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-lnmp">Install LNMP<a href="#install-lnmp" class="hash-link" aria-label="Direct link to Install LNMP" title="Direct link to Install LNMP">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Install MySQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum --enablerepo=mysql-community install -y mysql-server mysql-libs mysql-devel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service mysqld start</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># mysql_secure_installation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chkconfig mysqld on</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Install Nginx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum --enablerepo=epel install -y nginx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service nginx start</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chkconfig nginx on</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Install PHP and php-fpm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum --enablerepo=remi-php56 install php php-fpm php-mysql php-gd php-xml php-redis php-libs php-devel php-zlib</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service php-fpm start</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chkconfig php-fpm on</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service nginx restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="下载-nextcloud">下载 NextCloud<a href="#下载-nextcloud" class="hash-link" aria-label="Direct link to 下载 NextCloud" title="Direct link to 下载 NextCloud">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># wget https://download.nextcloud.com/server/releases/nextcloud-11.0.1.tar.bz2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># tar xf nextcloud-11.0.1.tar.bz2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># mv nextcloud-11.0.1 /opt/nextcloud</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置-nginx-和-php-fpm">配置 Nginx 和 php-fpm<a href="#配置-nginx-和-php-fpm" class="hash-link" aria-label="Direct link to 配置 Nginx 和 php-fpm" title="Direct link to 配置 Nginx 和 php-fpm">​</a></h3><p>因为 php-fpm 默认运行的用户身份是 apache，我们这里使用的环境是 nginx，所有要修改 php-fpm 配置文件的用户和组，注意不要为了省事直接改为 root，这在 php-fpm 中是不允许的</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># vim /etc/php-fpm.d/www.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">user</span><span class="token operator">=</span><span class="token plain">nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token operator">=</span><span class="token plain">nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service php-fpm restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因为 NextCloud 默认是以 Apache 的身份运行的，所以我们需要单独配置 NextCloud 的 Nginx 配置文件，以下配置文件，你可以直接拿去用，注意在文件中说明了，需要修改的地方：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># vim /etc/nginx/conf.d/nextcloud.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> upstream php-handler </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)"># 这里是你php-fpm的服务端口，默认是9000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    server </span><span class="token number">127.0</span><span class="token plain">.0.1:9000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#server unix:/var/run/php5-fpm.sock;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)"># 你的域名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    listen pan.ultraera.org:80</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    server_name pan.ultraera.org</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># enforce https</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">return</span><span class="token plain"> </span><span class="token number">301</span><span class="token plain"> https://</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$server_name</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$request_uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># 你的域名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    listen pan.ultraera.org:443 ssl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    server_name pan.ultraera.org</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)"># 以下是你的ssl证书文件存放路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ssl_certificate /etc/nginx/ssl/1_pan.ultraera.org_bundle.crt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ssl_certificate_key /etc/nginx/ssl/2_pan.ultraera.org.key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Add headers to serve security related headers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Before enabling Strict-Transport-Security headers please read into this</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># topic first.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># add_header Strict-Transport-Security &quot;max-age=15768000;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># includeSubDomains; preload;&quot;;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    add_header X-Content-Type-Options nosniff</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    add_header X-Frame-Options </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;SAMEORIGIN&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    add_header X-XSS-Protection </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1; mode=block&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    add_header X-Robots-Tag none</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    add_header X-Download-Options noopen</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    add_header X-Permitted-Cross-Domain-Policies none</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> add_header Strict-Transport-Security </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;max-age=15552000; includeSubdomains; &quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># 设定你的NextCloud的根目录，请根据实际修改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    root /opt/nextcloud/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location </span><span class="token operator">=</span><span class="token plain"> /robots.txt </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        allow all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        log_not_found off</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        access_log off</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># The following 2 rules are only needed for the user_webfinger app.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Uncomment it if you&#x27;re planning to use this app.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#rewrite ^/.well-known/host-meta /public.php?service=host-meta last;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#rewrite ^/.well-known/host-meta.json /public.php?service=host-meta-json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># last;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location </span><span class="token operator">=</span><span class="token plain"> /.well-known/carddav </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">return</span><span class="token plain"> </span><span class="token number">301</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$scheme</span><span class="token plain">://</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$host</span><span class="token plain">/remote.php/dav</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location </span><span class="token operator">=</span><span class="token plain"> /.well-known/caldav </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">return</span><span class="token plain"> </span><span class="token number">301</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$scheme</span><span class="token plain">://</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$host</span><span class="token plain">/remote.php/dav</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># set max upload size</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    client_max_body_size 512M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    fastcgi_buffers </span><span class="token number">64</span><span class="token plain"> 4K</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Disable gzip to avoid the removal of the ETag header</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">gzip</span><span class="token plain"> off</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Uncomment if your server is build with the ngx_pagespeed module</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># This module is currently not supported.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#pagespeed off;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    error_page </span><span class="token number">403</span><span class="token plain"> /core/templates/403.php</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    error_page </span><span class="token number">404</span><span class="token plain"> /core/templates/404.php</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location / </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rewrite ^ /index.php</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location ~ ^/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:build</span><span class="token operator">|</span><span class="token plain">tests</span><span class="token operator">|</span><span class="token plain">config</span><span class="token operator">|</span><span class="token plain">lib</span><span class="token operator">|</span><span class="token plain">3rdparty</span><span class="token operator">|</span><span class="token plain">templates</span><span class="token operator">|</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">/ </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        deny all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location ~ ^/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">.</span><span class="token operator">|</span><span class="token plain">autotest</span><span class="token operator">|</span><span class="token plain">occ</span><span class="token operator">|</span><span class="token plain">issue</span><span class="token operator">|</span><span class="token plain">indie</span><span class="token operator">|</span><span class="token plain">db_</span><span class="token operator">|</span><span class="token plain">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        deny all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location ~ ^/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:index</span><span class="token operator">|</span><span class="token plain">remote</span><span class="token operator">|</span><span class="token plain">public</span><span class="token operator">|</span><span class="token function" style="color:rgb(80, 250, 123)">cron</span><span class="token operator">|</span><span class="token plain">core/ajax/update</span><span class="token operator">|</span><span class="token plain">status</span><span class="token operator">|</span><span class="token plain">ocs/v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">12</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token operator">|</span><span class="token plain">updater/.+</span><span class="token operator">|</span><span class="token plain">ocs-provider/.+</span><span class="token operator">|</span><span class="token plain">core/templates/40</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">34</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">.php</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:$</span><span class="token operator">|</span><span class="token plain">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        include fastcgi_params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_split_path_info ^</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">.+</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">.php</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">/.*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">$</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_param SCRIPT_FILENAME </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$document_root</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$fastcgi_script_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_param PATH_INFO </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$fastcgi_path_info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_param HTTPS on</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">#Avoid sending the security headers twice</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_param modHeadersAvailable </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_param front_controller_active </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_pass php-handler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_intercept_errors on</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_request_buffering off</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location ~ ^/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:updater</span><span class="token operator">|</span><span class="token plain">ocs-provider</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:$</span><span class="token operator">|</span><span class="token plain">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try_files </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$uri</span><span class="token plain">/ </span><span class="token operator">=</span><span class="token number">404</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        index index.php</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Adding the cache control header for js and css files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Make sure it is BELOW the PHP block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location ~* </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:css</span><span class="token operator">|</span><span class="token plain">js</span><span class="token operator">|</span><span class="token plain">woff</span><span class="token operator">|</span><span class="token plain">svg</span><span class="token operator">|</span><span class="token plain">gif</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">$ </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try_files </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$uri</span><span class="token plain"> /index.php</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$uri</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$is_args</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$args</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header Cache-Control </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;public, max-age=7200&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Add headers to serve security related headers (It is intended to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># have those duplicated to the ones above)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Before enabling Strict-Transport-Security headers please read into</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># this topic first.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># add_header Strict-Transport-Security &quot;max-age=15768000;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">#  includeSubDomains; preload;&quot;;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header X-Content-Type-Options nosniff</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header X-Frame-Options </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;SAMEORIGIN&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header X-XSS-Protection </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1; mode=block&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header X-Robots-Tag none</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header X-Download-Options noopen</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header X-Permitted-Cross-Domain-Policies none</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Optional: Don&#x27;t log access to assets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        access_log off</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location ~* </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:png</span><span class="token operator">|</span><span class="token plain">html</span><span class="token operator">|</span><span class="token plain">ttf</span><span class="token operator">|</span><span class="token plain">ico</span><span class="token operator">|</span><span class="token plain">jpg</span><span class="token operator">|</span><span class="token plain">jpeg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">$ </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try_files </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$uri</span><span class="token plain"> /index.php</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$uri</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$is_args</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$args</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Optional: Don&#x27;t log access to other assets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        access_log off</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service nginx restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="文件权限调整">文件权限调整<a href="#文件权限调整" class="hash-link" aria-label="Direct link to 文件权限调整" title="Direct link to 文件权限调整">​</a></h3><p>因为 NextCloud 运行是以 nginx 程序，注意修改目录所属用户和组为 nginx</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chown -R nginx:nginx /opt/nextcloud</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建-mysql-数据库">创建 MySQL 数据库<a href="#创建-mysql-数据库" class="hash-link" aria-label="Direct link to 创建 MySQL 数据库" title="Direct link to 创建 MySQL 数据库">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> CREATE DATABASE nextcloud CHARACTER SET UTF-8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> GRANT ALL PRIVILEGES ON nextcloud.* TO </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;nextcloud&#x27;</span><span class="token plain">@</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;localhost&#x27;</span><span class="token plain"> IDENTIFIED BY </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;your_password&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> FLUSH PRIVILEGES</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="初始化-nextcloud">初始化 NextCloud<a href="#初始化-nextcloud" class="hash-link" aria-label="Direct link to 初始化 NextCloud" title="Direct link to 初始化 NextCloud">​</a></h2><p>在浏览器打开你在 nginx 中配置的域名，NextCloud 初始化非常简单，设定一个管理员账户和密码，然后设定数据库即可，按照我们上一步针对 MySQL 的设定，你会非常清楚地知道你的数据库信息：</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/jjkqh.png" alt="image" class="img_ev3q"></p><p>登录之后的界面是这样：</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7n28v.png" alt="image" class="img_ev3q"></p><p>你可以在登录之后，在你的右上角点击头像选择 Admin 进入管理界面查看和修改你的服务器设置，你还可以在浏览器上方看到你的服务器现有哪些问题，会有对应文档提醒你如何解决这些问题。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/yx34e.png" alt="image" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="other">Other<a href="#other" class="hash-link" aria-label="Direct link to Other" title="Direct link to Other">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="修改默认-data-目录">修改默认 data 目录<a href="#修改默认-data-目录" class="hash-link" aria-label="Direct link to 修改默认 data 目录" title="Direct link to 修改默认 data 目录">​</a></h3><p>在我们首次打开 NextCloud 网页时，需要我们设定 datadir 目录，这里有个默认目录在 nextcloud 项目包，这其实是不安全的，我们最后将目录路径修改为其他位置：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># mkdir /nextcloud_files/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chown -R nginx:nginx /nextcloud_files/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 修改datadirectory的路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># vim /opt/nextcloud/config/config.php</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">datadirectory</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27; =&gt; &#x27;</span><span class="token plain">/nextcloud/data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="无法登陆到个人用户界面">无法登陆到个人用户界面<a href="#无法登陆到个人用户界面" class="hash-link" aria-label="Direct link to 无法登陆到个人用户界面" title="Direct link to 无法登陆到个人用户界面">​</a></h3><p>我在安装时碰到这个问题，折腾了很久才解决，因为我们是使用 nginx 程序，但是 php-fpm 默认用户身份为 apache，所以<code>/var/lib/php/session</code>目录的所属用户和组都是 apache，导致我们没有权限去写入 session，所以无法登入系统，报错信息可以在 NextCloud 的 log 文件下看到：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># tail -n 1 /usr/nextcloud/data/nextcloud.log</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;reqId&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;NNnIwMCCPDMQtzZW5Ndc&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;remoteAddr&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;180.166.66.226&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;app&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;PHP&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;message&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;session_write_close(): Failed to write session data (files). Please verify that the current setting of session.save_path is correct (\/var\/lib\/php\/session) at \/usr\/nextcloud\/lib\/private\/Session\/Internal.php#104&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;level&quot;</span><span class="token plain">:3,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;time&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;2017-02-24T10:46:13+00:00&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;method&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;POST&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;url&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;\/index.php&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;user&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;samzong&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;version&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;11.0.0.10&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 修改/var/lib/php/的属组为nginx即可</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chgrp -R nginx /var/lib/php</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="增加-redis-组件提高性能">增加 redis 组件，提高性能<a href="#增加-redis-组件提高性能" class="hash-link" aria-label="Direct link to 增加 redis 组件，提高性能" title="Direct link to 增加 redis 组件，提高性能">​</a></h3><p>关于如何安装 redis 我在之前的文章中也有讲到，大家可以去看下 <a href="https://samzong.me/redis01/" target="_blank" rel="noopener noreferrer">安装教程</a></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum --enablerepo=remi install -y redis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 增加php的redis插件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum --enablerepo=remi-php56 install php-redis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 配置文件增加redis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;memcache.local&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;\\OC\\Memcache\\Redis&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;memcache.locking&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;\\OC\\Memcache\\Redis&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;redis&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   array </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;host&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;localhost&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;port&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">6379</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 重启令服务生效</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service php-fpm restart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service nginx restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我的 NextCloud 配置如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token operator">&lt;</span><span class="token plain">?php</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$CONFIG</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> array </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;memcache.local&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;\\OC\\Memcache\\Redis&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;memcache.locking&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;\\OC\\Memcache\\Redis&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;redis&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  array </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;host&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;localhost&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;port&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">6379</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;enable_previews&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;instanceid&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;ockhup01dxbf&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;passwordsalt&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;TlJgWGrE0N7vOrRfZkOojwdYh/BixL&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;secret&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;/IQh0LioZp5eYFQJhicY7n324Q80WQUYOzWL+8OcxcXVw3Ef&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;trusted_domains&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  array </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;pan.ultraera.org&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;datadirectory&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;/nextcloud&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;overwrite.cli.url&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;https://pan.ultraera.org&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dbtype&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;mysql&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;version&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;11.0.0.10&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dbname&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;nextcloud&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dbhost&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;localhost&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dbport&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dbtableprefix&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;oc_&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dbuser&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;nextcloud&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dbpassword&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;nextcloud&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;logtimezone&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;CST&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;installed&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> true,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;mail_from_address&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;luchuanjia&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;mail_smtpmode&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;php&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;mail_domain&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;msn.com&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ssl-证书">SSL 证书<a href="#ssl-证书" class="hash-link" aria-label="Direct link to SSL 证书" title="Direct link to SSL 证书">​</a></h3><p>现国内提供免费的 SSL 证书的服务商很多，作为个人站点，免费 SSL 证书是个挺不错的选择，我在之前 nginx 配置时将 ssl 的配置方式写在了配置文件中了，注意如果不启用 ssl 时，不要启用 https 的虚拟主机，当然你可以自己生成一个 ssl 证书来提供服务，但这样在别人访问你的网站时，会不提示不受信任的证书，具体如何获取的证书的方式，因各个厂家方式有些区别，这里就不赘述，可以联系对应的厂商的技术人员咨询。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用现状">使用现状<a href="#使用现状" class="hash-link" aria-label="Direct link to 使用现状" title="Direct link to 使用现状">​</a></h2><p>在将服务搭建完成之后，对于存储的文件加密，现在通过 jobs，每日凌晨将文件推送到 oss 内，保存 2 天的数据，避免因为服务器宕机导致文件丢失；使用端，自己的电脑和手机，还有家人的手机，都安装了应用，后台自动将拍照图片等自动上传到云盘，使用起来目前很稳定，只是 iOS 应用是收费的，因为 NextCloud 源于 OwnCloud，如果你之前购买了 OwnCloud 的 App 也可以直接使用，当然 NextCloud 也有很多其他功能，可以根据你的实际需求发掘。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/02/22/HowTo-Install-Redmine">HowTo Install Redmine</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-02-22T12:30:36.000Z" itemprop="datePublished">February 22, 2017</time> · <!-- -->3 min read</div></header><div class="markdown" itemprop="articleBody"><h4 class="anchor anchorWithStickyNavbar_LWe7" id="runtime-environment">Runtime environment<a href="#runtime-environment" class="hash-link" aria-label="Direct link to Runtime environment" title="Direct link to Runtime environment">​</a></h4><ul><li>CentOS 6.x</li><li>Redmine 3.3.2</li><li>Ruby 2.2.6</li><li>rails 4.2</li><li>MySQL 5.1</li><li>Nginx 1.10</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装-rvm">安装 rvm<a href="#安装-rvm" class="hash-link" aria-label="Direct link to 安装 rvm" title="Direct link to 安装 rvm">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="导入公钥">导入公钥<a href="#导入公钥" class="hash-link" aria-label="Direct link to 导入公钥" title="Direct link to 导入公钥">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# curl -sSL https://rvm.io/mpapis.asc | gpg --import</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="安装">安装<a href="#安装" class="hash-link" aria-label="Direct link to 安装" title="Direct link to 安装">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# curl -L https://get.rvm.io | bash -s stable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="加载-rvm-环境并安装基础依赖包">加载 rvm 环境并安装基础依赖包<a href="#加载-rvm-环境并安装基础依赖包" class="hash-link" aria-label="Direct link to 加载 rvm 环境并安装基础依赖包" title="Direct link to 加载 rvm 环境并安装基础依赖包">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# source /etc/profile.d/rvm.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# rvm requirements</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装-ruby">安装 ruby<a href="#安装-ruby" class="hash-link" aria-label="Direct link to 安装 ruby" title="Direct link to 安装 ruby">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# rvm install 2.2.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# rvm use 2.2.6 --default</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装-rails">安装 rails<a href="#安装-rails" class="hash-link" aria-label="Direct link to 安装 rails" title="Direct link to 安装 rails">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="更换-gem-源">更换 gem 源<a href="#更换-gem-源" class="hash-link" aria-label="Direct link to 更换 gem 源" title="Direct link to 更换 gem 源">​</a></h5><p>默认 gem 的源站点是<a href="https://rubygems.org" target="_blank" rel="noopener noreferrer">https://rubygems.org</a> 由于国内的网络原因导致无法连接，所以导致无法使用 gem 安装，这里换成国内淘宝的 gem 镜像站点</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# gem sources -l</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*** CURRENT SOURCES ***</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">https://rubygems.org/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# gem sources --remove https://rubygems.org/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# gem sources -a https://ruby.taobao.org/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# gem sources -l</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*** CURRENT SOURCES ***</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">https://ruby.taobao.org/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="安装-1">安装<a href="#安装-1" class="hash-link" aria-label="Direct link to 安装" title="Direct link to 安装">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# gem install rails -v=4.2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装-mysql">安装 MySQL<a href="#安装-mysql" class="hash-link" aria-label="Direct link to 安装 MySQL" title="Direct link to 安装 MySQL">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# yum install -y mysql-server mysql-libs mysql-devel mysql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# service mysqld start</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# mysql_secure_installation</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装-redmine">安装 redmine<a href="#安装-redmine" class="hash-link" aria-label="Direct link to 安装 redmine" title="Direct link to 安装 redmine">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="下载-redmine-332">下载 Redmine 3.3.2<a href="#下载-redmine-332" class="hash-link" aria-label="Direct link to 下载 Redmine 3.3.2" title="Direct link to 下载 Redmine 3.3.2">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# wget http://www.redmine.org/releases/redmine-3.3.2.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# tar xf redmine-3.3.2.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# mv redmine-3.3.2 /opt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="安装管理-ruby-的包管理工具-bundler">安装管理 ruby 的包管理工具 bundler<a href="#安装管理-ruby-的包管理工具-bundler" class="hash-link" aria-label="Direct link to 安装管理 ruby 的包管理工具 bundler" title="Direct link to 安装管理 ruby 的包管理工具 bundler">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 注意，一定要在redmine目录下操作</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# cd /opt/redmine-3.3.2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# gem install bundler</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="安装-redmine-运行所需要的依赖包">安装 redmine 运行所需要的依赖包<a href="#安装-redmine-运行所需要的依赖包" class="hash-link" aria-label="Direct link to 安装 redmine 运行所需要的依赖包" title="Direct link to 安装 redmine 运行所需要的依赖包">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# bundle install --without development test rmagick</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="为-rails-生产-cookies-秘钥">为 rails 生产 cookies 秘钥<a href="#为-rails-生产-cookies-秘钥" class="hash-link" aria-label="Direct link to 为 rails 生产 cookies 秘钥" title="Direct link to 为 rails 生产 cookies 秘钥">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# rake generate_secret_token</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="创建-redmine-的数据库">创建 redmine 的数据库<a href="#创建-redmine-的数据库" class="hash-link" aria-label="Direct link to 创建 redmine 的数据库" title="Direct link to 创建 redmine 的数据库">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; create database redmine character set utf8;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; grant all privileges on redmine.* to &#x27;redmine&#x27;@&#x27;localhost&#x27; identified by &#x27;redmine_pass&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="修改-redmine-的-databaseyml">修改 redmine 的 database.yml<a href="#修改-redmine-的-databaseyml" class="hash-link" aria-label="Direct link to 修改 redmine 的 database.yml" title="Direct link to 修改 redmine 的 database.yml">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# cp config/database.yml.example config/database.yml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# vim config/database.yml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">production:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  adapter: mysql2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  database: redmine</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  host: localhost</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  username: redmine</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  password: &quot;redmine_pass&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  encoding: utf8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="创建数据库结构">创建数据库结构<a href="#创建数据库结构" class="hash-link" aria-label="Direct link to 创建数据库结构" title="Direct link to 创建数据库结构">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# RAILS_ENV=production bundle exec rake db:migrate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="生产缺省数据">生产缺省数据<a href="#生产缺省数据" class="hash-link" aria-label="Direct link to 生产缺省数据" title="Direct link to 生产缺省数据">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# RAILS_ENV=production bundle exec rake redmine:load_default_data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 选择默认语言，之后可更改，初始为en</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="测试是否安装成功">测试是否安装成功<a href="#测试是否安装成功" class="hash-link" aria-label="Direct link to 测试是否安装成功" title="Direct link to 测试是否安装成功">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# bundle exec rails server webrick -e production -b 0.0.0.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>默认运行 3000 端口，默认管理员 admin/admin</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="配置-redmine-在-nginx-上运行">配置 Redmine 在 Nginx 上运行<a href="#配置-redmine-在-nginx-上运行" class="hash-link" aria-label="Direct link to 配置 Redmine 在 Nginx 上运行" title="Direct link to 配置 Redmine 在 Nginx 上运行">​</a></h4><p>Redmine 常用的解决办法是使用 passenger+nginx，但是 Nginx 不支持装载模块，所以需要重新编译安装 Nginx，安装 Nginx 的 Passenger 有两种方式</p><ul><li>采用 Passenger 提供的脚本进行安装，适合新环境</li><li>手动编译安装 Nginx 增加 Passenger 模块，适合已存在 Nginx 环境</li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="采用-passenger-提供脚本安装">采用 Passenger 提供脚本安装<a href="#采用-passenger-提供脚本安装" class="hash-link" aria-label="Direct link to 采用 Passenger 提供脚本安装" title="Direct link to 采用 Passenger 提供脚本安装">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# gem install passenger</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# passenger-install-nginx-module --auto --prefix=/opt/nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="采用重新编译-nginx-增加-passenger-模块">采用重新编译 Nginx 增加 Passenger 模块<a href="#采用重新编译-nginx-增加-passenger-模块" class="hash-link" aria-label="Direct link to 采用重新编译 Nginx 增加 Passenger 模块" title="Direct link to 采用重新编译 Nginx 增加 Passenger 模块">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 获取passenger的安装路径</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# passenger-config --root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 重新编译Nginx并添加模块</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# wget http://nginx.org/download/nginx-1.10.3.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# tar xf nginx-1.10.3.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# cd nginx-1.10.3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost nginx-1.10.3]# ./configure ... -add-module=/usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="增加-http-模块内以下配置">增加 HTTP 模块内以下配置<a href="#增加-http-模块内以下配置" class="hash-link" aria-label="Direct link to 增加 HTTP 模块内以下配置" title="Direct link to 增加 HTTP 模块内以下配置">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">passenger_root /usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="配置-nginxconf-修改-server-模块中-location-的配置">配置 nginx.conf 修改 server 模块中 location 的配置<a href="#配置-nginxconf-修改-server-模块中-location-的配置" class="hash-link" aria-label="Direct link to 配置 nginx.conf 修改 server 模块中 location 的配置" title="Direct link to 配置 nginx.conf 修改 server 模块中 location 的配置">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  passenger_enabled on;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  location / {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    root /opt/redmine-3.3.2/public;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    index index.html index.htm;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="启动-nginx">启动 Nginx<a href="#启动-nginx" class="hash-link" aria-label="Direct link to 启动 Nginx" title="Direct link to 启动 Nginx">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# /root/nginx-1.10.3/sbin/nginx -c /root/nginx-1.10.3/conf/nginx.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="其他">其他<a href="#其他" class="hash-link" aria-label="Direct link to 其他" title="Direct link to 其他">​</a></h4><p>到这里，所有的安装都完成了，过程中我遇到这些问题，你也注意下：</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="71-could-not-find-gem-mysql2--0311-in-any-of-the-gem-sources-listed-in-your-gemfile">7.1 Could not find gem &#x27;mysql2 (~&gt; 0.3.11)&#x27; in any of the gem sources listed in your Gemfile<a href="#71-could-not-find-gem-mysql2--0311-in-any-of-the-gem-sources-listed-in-your-gemfile" class="hash-link" aria-label="Direct link to 7.1 Could not find gem &#x27;mysql2 (~&gt; 0.3.11)&#x27; in any of the gem sources listed in your Gemfile" title="Direct link to 7.1 Could not find gem &#x27;mysql2 (~&gt; 0.3.11)&#x27; in any of the gem sources listed in your Gemfile">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# rm -f Gemfile.lock</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# bundle install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="72-curl-tools">7.2 curl-tools<a href="#72-curl-tools" class="hash-link" aria-label="Direct link to 7.2 curl-tools" title="Direct link to 7.2 curl-tools">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">yum install libcurl-devel</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/01/18/HowTo-Monitor-Tomcat-Head-Memory-for-Zabbix">HowTo Monitor Tomcat HeadMemory for Zabbix</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-01-18T23:28:44.000Z" itemprop="datePublished">January 18, 2017</time> · <!-- -->5 min read</div></header><div class="markdown" itemprop="articleBody"><p>最近项目上由于 BUG 问题导致 Tomcat 程序在运行过程中经常内存泄漏，而本身监控系统之中没有更好的检测到 Tomcat 堆空间 (Head Memory) 的使用情况导致报警频发，这篇文章主要讲述，如何在 Zabbix 之中调用 jmx 监控服务器上 Tomcat 堆空间的使用情况并增加对应报警功能。</p><blockquote><p>测试环境：
CentOS 6.8
Zabbix 2.4
Tomcat 7.0</p></blockquote><p>实验前提默认是各位已经安装 Zabbix Server 服务器，并且至少有一台 Zabbix agent 服务器正常监控。关于如何搭建 Zabbix 监控集群，会有专门文章描述。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="zabbix-java-gateway-的工作机制">zabbix-java-gateway 的工作机制<a href="#zabbix-java-gateway-的工作机制" class="hash-link" aria-label="Direct link to zabbix-java-gateway 的工作机制" title="Direct link to zabbix-java-gateway 的工作机制">​</a></h4><ul><li>首先我们需要配置我们的 Tomcat 服务启用监控服务，这个是默认不启用的</li><li>之后需要在 Zabbix 的管理页面添加对应 Tomcat 服务器的 jmx 监控接口</li><li>最后 zabbix 端会自动获取 zabbix-java-gateway 的数据并根据相应模板进行展
示</li><li>工作流：<!-- -->[Zabbix-Server]<!-- -->--&gt;(port:10053 on zabbix server)--&gt; <!-- -->[zabbix-java-gateway]<!-- --> --(port:12345 on tomcatserver)--&gt; <!-- -->[JMX enabled]</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-install-zabbix-java-gateway-on-zabbix-server">1. Install zabbix-java-gateway on Zabbix Server<a href="#1-install-zabbix-java-gateway-on-zabbix-server" class="hash-link" aria-label="Direct link to 1. Install zabbix-java-gateway on Zabbix Server" title="Direct link to 1. Install zabbix-java-gateway on Zabbix Server">​</a></h4><p>因为我的 zabbix 是使用 zabbix 2.4 官方源安装，所以只需要用 yum 在安装即可：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 ~]# sudo  yum install -y zabbix-java-gateway</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果你没有官方源可能先安装该源，注意我的服务器 zabbix 版本是 2.4 如果你是不同的版本，请到[<a href="http://repo.zabbix.com/zabbix/" target="_blank" rel="noopener noreferrer">这里</a>] 查找对应版本。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 查看zabbix server版本</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 ~]# zabbix_server --version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Zabbix server v2.4.8 (revision 59539) (20 April 2016)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Compilation time: May  4 2016 01:32:12</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在使用 yum 安装 zabbix-java-gateway 源时，会自动关联安装 openjdk，尽管这段程序没多大影响，如果你想保证系统 JAVA 环境不受到改变的话，可以在/etc/profile 文件最后，增加如下内容：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># add follows to the end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">export JAVA_HOME=/usr/java/default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">export PATH=$PATH:$JAVA_HOME/bin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">export CLASSPATH=.:$JAVA_HOME/jre/lib:$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-confiure-tomcat-host-with-enable-jmx">2. Confiure Tomcat host with enable jmx<a href="#2-confiure-tomcat-host-with-enable-jmx" class="hash-link" aria-label="Direct link to 2. Confiure Tomcat host with enable jmx" title="Direct link to 2. Confiure Tomcat host with enable jmx">​</a></h4><p>首先在$tomcatdir/bin/catalina.sh 文件开头处增加如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#!/bin/sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CATALINA_OPTS=&quot;-Dcom.sun.management.jmxremote \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-Dcom.sun.management.jmxremote.authenticate=false \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-Dcom.sun.management.jmxremote.ssl=false \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-Dcom.sun.management.jmxremote.port=12345&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后，启动 Tomcat，你会发现多了一个 12345 端口，这就是 jmx 的监听端口，请保证 zabbix-java-gateway 可以访问到这台服务器。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 ~]# /tomcat7/bin/startup.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Starting Tomcat7:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CATALINA_BASE:   /tomcat7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CATALINA_HOME:   /tomcat7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CATALINA_TMPDIR: /tomcat7/temp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using JRE_HOME:        /usr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CLASSPATH:       /tomcat7/bin/bootstrap.jar:/tomcat7/bin/tomcat-juli.jar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Tomcat started.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 ~]# netstat -ntlp | grep 12345</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tcp  0      0 :::12345   :::*     LISTEN      8793/java</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 ~]#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fix-1---zabbix-agent-与-server-存在复杂网络环境">==<em>fix 1</em> == : zabbix agent 与 server 存在复杂网络环境<a href="#fix-1---zabbix-agent-与-server-存在复杂网络环境" class="hash-link" aria-label="Direct link to fix-1---zabbix-agent-与-server-存在复杂网络环境" title="Direct link to fix-1---zabbix-agent-与-server-存在复杂网络环境">​</a></h4><p>这里疏忽了 1 个问题，如果您的 zabbix server 与 agent 端之间有防火墙规则，而按照我上面的所述只是增加了 12345 这个端口，那么很可能，您在/var/log/zabbix/zabbix_java_gateway.log 中会看到“No route to host”的报错，这是因为 JMX 不光开启了 12345 端口，还开启了另外两个随机端口，而在获取监控数据时会使用到其中一个，这就导致了无法通过固定的防火墙规则来开放该端口。其实有另外一个替代方式来使该监听端口固定下来——使用 Tomcat 提供的额外组件 catalina-jmx-remote.jar，这个组件是需要另外下载的：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 查看当前Tomcat版本.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 bin]# ./catalina.sh version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CATALINA_BASE:   /tomcat7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CATALINA_HOME:   /tomcat7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CATALINA_TMPDIR: /tomcat7/temp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using JRE_HOME:        /usr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CLASSPATH:       /tomcat7/bin/bootstrap.jar:/tomcat7/bin/tomcat-juli.jar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Server version: Apache Tomcat/7.0.64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Server built:   Aug 19 2015 17:18:06 UTC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Server number:  7.0.64.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">OS Name:        Linux</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">OS Version:     2.6.32-642.11.1.el6.x86_64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Architecture:   amd64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">JVM Version:    1.8.0_111-b15</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">JVM Vendor:     Oracle Corporation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 下载 catalina-jmx-remote.jar # 请注意下载版本不要高于当前tomcat版本.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wget http://mirror.bit.edu.cn/apache/tomcat/tomcat-7/v7.0.57/bin/extras/catalina-jmx-remote.jar -O lib/catalina-jmx-remote.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>增加如下内容，在 conf/server.xml 中：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;Listener className=&quot;org.apache.catalina.mbeans.JmxRemoteLifecycleListener&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          rmiRegistryPortPlatform=&quot;12345&quot; rmiServerPortPlatform=&quot;12346&quot; /&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因为我们已经在conf/server.xml定义了rmiRegistryPortPlatform，所以要将bin/catalina.sh中CATALINA_OPTS的com.sun.management.jmxremote.port去掉，否则会因为jmxremote.port配置有优先级更高而导致配置失效。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CATALINA_OPTS=&quot;-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>完成之后，重启 tomcat 这时会发现 jmx 默认端口已经固定为 12345 何 12346，而 server 依然可以正常获取监控数据。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-configure-zabbix-server">3. Configure Zabbix Server<a href="#3-configure-zabbix-server" class="hash-link" aria-label="Direct link to 3. Configure Zabbix Server" title="Direct link to 3. Configure Zabbix Server">​</a></h4><p>首先需要修改 zabbix_server.conf 启用 zabbix-java-gateway，让 zabbix 可以检测到服务，修改如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">### Option: JavaGateway</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> #       IP address (or hostname) of Zabbix Java gateway.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> #       Only required if Java pollers are started.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> #</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> # Mandatory: no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> # Default:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">JavaGateway=10.211.55.4 # 设置为你的zabbixsever IP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">### Option: JavaGatewayPort</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Port that Zabbix Java gateway listens on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Mandatory: no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Range: 1024-32767</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> JavaGatewayPort=10053 # 设置服务端监听接口</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">### Option: StartJavaPollers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Number of pre-forked instances of Java pollers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Mandatory: no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Range: 0-1000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> StartJavaPollers=5 # 设置多线程启动</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后修改 zabbix<!-- -->_<!-- -->java<!-- -->_<!-- -->gateway.conf 配置如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">### Option: zabbix.listenIP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># IP address to listen on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Mandatory: no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> LISTEN_IP=&quot;10.211.55.4&quot; # 配置监听IP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">### Option: zabbix.listenPort</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Port to listen on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Mandatory: no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Range: 1024-32767</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> LISTEN_PORT=10053 # 配置监听端口</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">### Option: zabbix.pidFile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Name of PID file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># If omitted, Zabbix Java Gateway is started as a console application</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Mandatory: no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># PID_FILE=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> PID_FILE=&quot;/var/run/zabbix/zabbix_java.pid&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">### Option: zabbix.startPollers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Number of worker threads to start</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Mandatory: no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Range: 1-1000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 不能大于zabbix_server.conf的值，否则可能导致当连接Java gateway时没有多余的线程进行处理</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> START_POLLERS=5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最后启动启动 zabbix-java-gateway，并重启 zabbix-server</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 ~]# service zabbix-java-gateway start</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Starting zabbix java gateway:              [  OK  ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 ~]# service zabbix-server restart</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Stopping zabbix server:              [  OK  ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Starting zabbix server:              [  OK  ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我在尝试重启发现一问题，zabbix-java-gateway 通过 service 命令管理 stop 不能删除 pid 文件导致服务无法启动，如果你也碰到，解决办法如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 zabbix]# vim /etc/rc.d/init.d/zabbix-java-gateway</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># line 97, 注释修改为如下</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># kill `cat $PID_FILE` &amp;&amp; rm $PID_FILE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rm -f $PID_FILE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-adding-jmx-host-on-zabbix-web-consloe">4. Adding jmx host on Zabbix Web consloe<a href="#4-adding-jmx-host-on-zabbix-web-consloe" class="hash-link" aria-label="Direct link to 4. Adding jmx host on Zabbix Web consloe" title="Direct link to 4. Adding jmx host on Zabbix Web consloe">​</a></h4><p>首先，上传 Template Tomcat Head Memory 模板，这个我做了一个简单的模板，只针对了堆内存空间的监控，并针对使用率超过 60% 以及 80%，不同的警报。需要的同学可以直接从我这里下载，然后在 Configuration-Templates 导入到 zabbix 模板库内。
下载请点击：<a href="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zbx_template_app_tomcat_head_memory.xml" target="_blank" rel="noopener noreferrer">Template App Tomcat Head Memory</a></p><p>然后，增加服务器的 jmx 监控
<img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-jmx-settings.png" alt="image" class="img_ev3q"></p><p>关联模板
<img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-host-select-template.png" alt="image" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-view-the-head-memory-monitoring">5. View the Head Memory Monitoring<a href="#5-view-the-head-memory-monitoring" class="hash-link" aria-label="Direct link to 5. View the Head Memory Monitoring" title="Direct link to 5. View the Head Memory Monitoring">​</a></h4><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-view-monitor.png" alt="image" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/microservice">Microservice</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2016/12/20/HowTo-Mount-OSS-Bucket-On-ECS">HowTo Mount OSS Bucket On ECS</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-12-20T06:17:08.000Z" itemprop="datePublished">December 20, 2016</time> · <!-- -->3 min read</div></header><div class="markdown" itemprop="articleBody"><blockquote><p>From <a href="https://github.com/aliyun/ossfs" target="_blank" rel="noopener noreferrer">阿里云官方 Github</a>
Demo: CentOS 6.8 on ECS</p></blockquote><p>ossfs 是通过磁盘挂载的形式，将 oss 存储挂载到 linux、类 unix 等操作系统，而且不仅仅可以挂载阿里云内的 ECS 上，理论上所有网络能到达 oss 的都可以挂载，但还是要以实际问题为准。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1download--install">1.Download &amp; Install<a href="#1download--install" class="hash-link" aria-label="Direct link to 1.Download &amp; Install" title="Direct link to 1.Download &amp; Install">​</a></h2><p><a href="https://github.com/aliyun/ossfs/releases" target="_blank" rel="noopener noreferrer">官方版本发布页面</a>，请根据你的系统类型进行选择，我这演示的环境是 CentOS 6.8；ossfs 目前最新的版本是 v1.79.9，您可以根据自己当时版本进行选择，建议选择最新版本。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 请先将包上传到服务器上</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> yum localinstall ossfs_1.79.9_centos6.5_x86_64.rpm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意使用 localinstall，因为在安装过程，yum 可以很好的解决依赖关系，会节省我们很多时间</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-oss--bucket">2. OSS &amp; Bucket<a href="#2-oss--bucket" class="hash-link" aria-label="Direct link to 2. OSS &amp; Bucket" title="Direct link to 2. OSS &amp; Bucket">​</a></h2><p>需要获取以下信息，在后面我们都会用到的：</p><ul><li><p>Bucket 名称
<img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/QQ20161111-0.jpg" alt="image" class="img_ev3q"></p></li><li><p>Access Key ID</p></li><li><p>Access Key Secret</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/0256A9CB-A0FA-43BC-82AF-4DE17D4852B6.png" alt="image" class="img_ev3q">
<img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/QQ20161111-2.jpg" alt="image" class="img_ev3q"></p></li><li><p>Location，这需要注意点，不要加上 Bucket 的名字，区域对应表如下，注意你的 Bucket 所在区域：</p></li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 设置bucket/access key/id的信息，将其存放在/etc/passwd-ossfs 文件中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 注意这个文件的权限必须正确设置，建议设为 640</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> my-bucket:my-access-key-id:my-access-key-secret </span><span class="token operator">&gt;</span><span class="token plain"> /etc/passwd-ossfs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> </span><span class="token number">640</span><span class="token plain"> /etc/passwd-ossfs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-mount--uasge">3. Mount &amp; Uasge<a href="#3-mount--uasge" class="hash-link" aria-label="Direct link to 3. Mount &amp; Uasge" title="Direct link to 3. Mount &amp; Uasge">​</a></h2><p>将 oss bucket mount 到指定目录：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 我碰到安装后找不到 ossfs 命令，查看下因为 ossfs 没有 x 权限，目录路径为/usr/local/bin，如果您也碰到这个问题，可以增加 x 权限后再测试</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> ossfs my-bucket /mnt/ossdir -ourl</span><span class="token operator">=</span><span class="token plain">http://oss-location.aliyuncs.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 如果使用 ossfs 的机器是阿里云 ECS，可以使用内网域名来避免流量收费和 提高速度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> ossfs my-bucket /tmp/ossfs -ourl</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token plain">http://oss-location-internal.aliyuncs.com</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>磁盘空间达到上百 T：
<img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/0B78E099-5488-4839-AE48-09A074E7415D.png" alt="image" class="img_ev3q"></p><p> umount：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 注意用户身份</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">umount</span><span class="token plain"> /tmp/ossfs </span><span class="token comment" style="color:rgb(98, 114, 164)"># root user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> fusermount -u /tmp/ossfs </span><span class="token comment" style="color:rgb(98, 114, 164)"># non-root user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-debug--faq">4. Debug &amp; FAQ<a href="#4-debug--faq" class="hash-link" aria-label="Direct link to 4. Debug &amp; FAQ" title="Direct link to 4. Debug &amp; FAQ">​</a></h2><p>当遇到错误的时候，可以试着打开 Debug 日志信息，然后分析问题原因：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 使用 -o dbglevel=debug -f -d 参数打印日志信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> ossfs my-bucket /tmp/ossfs -ourl</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token plain">http://oss-location-internal.aliyuncs.com</span><span class="token operator">&gt;</span><span class="token plain"> -o </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">dbglevel</span><span class="token operator">=</span><span class="token plain">debug -f -d </span><span class="token operator">&gt;</span><span class="token plain"> /mnt/ossfs.log </span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更多的问题，请移步查看<a href="https://github.com/aliyun/ossfs/wiki/FAQ" target="_blank" rel="noopener noreferrer">官方的 FAQ 文档</a>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-about">5. About<a href="#5-about" class="hash-link" aria-label="Direct link to 5. About" title="Direct link to 5. About">​</a></h2><p>ossfs 提供的功能和性能和本地文件系统相比，具有一些局限性。具体包括：</p><ul><li>随机或者追加写文件会导致整个文件的重写。</li><li>元数据操作，例如 list directory，性能较差，因为需要远程访问 oss 服务器。</li><li>文件/文件夹的rename操作不是原子的。</li><li>多个客户端挂载同一个 oss bucket 时，依赖用户自行协调各个客户端的行为。例如避免多个客户端写同一个文件等等。</li><li>不支持 hard link。</li><li>不适合用在高并发读/写的场景，这样会让系统的load升高</li></ul><blockquote><p>另外，ossfs 的稳定性很大一部分依赖于网络环境，建议的使用场景更多是作为临时数据迁移或定期备份，虽然 ossfs 挂载到系统中会有着几百 TB 的空间，但是稳定性并不高。</p></blockquote></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/aliyun">Aliyun</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2016/11/30/aws-use-s3cmd-ming-ling-xing-guan-li-s3-cun-chu">AWS Use s3cmd 命令行管理 S3 存储</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-11-30T23:45:54.000Z" itemprop="datePublished">November 30, 2016</time> · <!-- -->5 min read</div></header><div class="markdown" itemprop="articleBody"><p>S3 是 AWS 公有云服务提供的云存储服务，提供海量数据存储服务，同时基于 AWS S3 提供的一系列网络服务接口，也有大量已经开发完成的工具供我们使用，以利用起 AWS 庞大的存储资源，这篇文章的目录选取了其中一个用 Linux 命令行工具<a href="http://s3tools.org" target="_blank" rel="noopener noreferrer">s3cmd</a>来管理 AWS S3 云存储其中的数据。</p><p>s3cmd 是非常优秀的 S3 命令行管理工具，用 python 编写，支持 python 2.6 &amp; 2.7，但是尚不支持 python3，但是目前绝大多数的 Linux 发行版默认都是 python2.x 系列。</p><blockquote><p>Demo CentOS 6.x</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-s3cmd"><strong>Install s3cmd</strong><a href="#install-s3cmd" class="hash-link" aria-label="Direct link to install-s3cmd" title="Direct link to install-s3cmd">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-无论是-denbian-系还是-rehat-系列软件仓库内已经加入了-s3cmd">1. 无论是 Denbian 系还是 Rehat 系列，软件仓库内已经加入了 s3cmd<a href="#1-无论是-denbian-系还是-rehat-系列软件仓库内已经加入了-s3cmd" class="hash-link" aria-label="Direct link to 1. 无论是 Denbian 系还是 Rehat 系列，软件仓库内已经加入了 s3cmd" title="Direct link to 1. 无论是 Denbian 系还是 Rehat 系列，软件仓库内已经加入了 s3cmd">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 1.1 Ubuntu &amp; Debian</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y s3cmd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 1.2 RHEL &amp; CentOS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> yum </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> s3cmd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-如果您的系统比较特殊软件仓库内找不到-s3cmd还有-s3cmd-的-github-上去获取相关安装信息链接">2. 如果您的系统比较特殊，软件仓库内找不到 s3cmd，还有 s3cmd 的 Github 上去获取相关安装信息：<a href="https://github.com/s3tools/s3cmd" target="_blank" rel="noopener noreferrer">链接</a><a href="#2-如果您的系统比较特殊软件仓库内找不到-s3cmd还有-s3cmd-的-github-上去获取相关安装信息链接" class="hash-link" aria-label="Direct link to 2-如果您的系统比较特殊软件仓库内找不到-s3cmd还有-s3cmd-的-github-上去获取相关安装信息链接" title="Direct link to 2-如果您的系统比较特殊软件仓库内找不到-s3cmd还有-s3cmd-的-github-上去获取相关安装信息链接">​</a></h3><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-s3cmd"><strong>Configure s3cmd</strong><a href="#configure-s3cmd" class="hash-link" aria-label="Direct link to configure-s3cmd" title="Direct link to configure-s3cmd">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-第一次运行-s3cmd-需要首先预配置相关-s3-信息">1. 第一次运行 s3cmd 需要首先预配置相关 s3 信息<a href="#1-第一次运行-s3cmd-需要首先预配置相关-s3-信息" class="hash-link" aria-label="Direct link to 1. 第一次运行 s3cmd 需要首先预配置相关 s3 信息" title="Direct link to 1. 第一次运行 s3cmd 需要首先预配置相关 s3 信息">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">s3cmd --configure</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>它会问你一系列问题：</p><ul><li>AWS S3 中 IAM 账户的 Access Key 以及 Secret Key (建议单独创建 IAM)</li><li>对 AWS S3 双向传输的加密密码（自行设定不要忘记）</li><li>为加密数据设定 GPG 程序的路径（默认即可）</li><li>是否使用 https 协议（默认即可）</li><li>如果不是 https 协议，需要设定名字和端口
配置完成之后，配置信息以普通文本保存在~/.s3cfg</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-china-与-global-的区别">2. China 与 Global 的区别<a href="#2-china-与-global-的区别" class="hash-link" aria-label="Direct link to 2. China 与 Global 的区别" title="Direct link to 2. China 与 Global 的区别">​</a></h3><p>笔者在第一次运行时，始终无法添加成功，报错信息如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ERROR: Test failed: </span><span class="token number">403</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">InvalidAccessKeyId</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">: The AWS Accecc Key Id you provided does not exist </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> our records.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>起初以为是 Access Key 不对，在经过多次测试之后，才发现问题，这是因为 s3cmd 内置 s3 的 Domain 为 Global 的信息，而中国与 Global 是独立存在的所以查找不到我们的 Access Key。所以，如果你使用的 Global AWS 那么上面一步应该已经配置好了你的 s3cmd，如果你是 AWS China 的用户，那么你要做以下操作。</p><ul><li>在 Retry configuration? <!-- -->[Y/n]<!-- -->选择“n”</li><li>Save settings? <!-- -->[y/N]<!-- --> 选择“y”</li><li>保存设置之后，编辑配置文件（~/.s3cfg ) 修改其中的如下字段，并将其中%(bucket)s 用您实际的某一个存储桶名字代替掉</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">bucket_location </span><span class="token operator">=</span><span class="token plain"> %</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">host_base </span><span class="token operator">=</span><span class="token plain"> s3.cn-north-1.amazonaws.com.cn</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">host_bucket </span><span class="token operator">=</span><span class="token plain"> %</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bucket</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">s.s3.cn-north-1.amazonaws.com.cn</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">website_endpoint </span><span class="token operator">=</span><span class="token plain"> http://%</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bucket</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">s.s3-website-%</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">location</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">s.amazonaws.com.cn/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>例如，你的存储桶的名字为 s3chinatest: 地域为北京。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">bucket_location </span><span class="token operator">=</span><span class="token plain"> cn-north-1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">host_base </span><span class="token operator">=</span><span class="token plain"> s3.cn-north-1.amazonaws.com.cn</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">host_bucket </span><span class="token operator">=</span><span class="token plain"> s3chinatest.s3.cn-north-1.amazonaws.com.cn</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">website_endpoint </span><span class="token operator">=</span><span class="token plain"> http://s3chinatest.s3-website.amazonaws.com.cn/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-保存配置文件然后用命令测试一下确认-s3cmd-可以正常工作">3. 保存配置文件，然后用命令测试一下，确认 s3cmd 可以正常工作<a href="#3-保存配置文件然后用命令测试一下确认-s3cmd-可以正常工作" class="hash-link" aria-label="Direct link to 3. 保存配置文件，然后用命令测试一下，确认 s3cmd 可以正常工作" title="Direct link to 3. 保存配置文件，然后用命令测试一下，确认 s3cmd 可以正常工作">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ s3cmd </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2016</span><span class="token plain">-11-18 </span><span class="token number">22</span><span class="token plain">:30 s3://s3chinatest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2016</span><span class="token plain">-10-29 00:14 s3://bucket2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="s3cmd-的基本使用"><strong>s3cmd 的基本使用</strong><a href="#s3cmd-的基本使用" class="hash-link" aria-label="Direct link to s3cmd-的基本使用" title="Direct link to s3cmd-的基本使用">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-查看当前账户下所有现有的桶-bucket">1. 查看当前账户下所有现有的桶 (bucket)<a href="#1-查看当前账户下所有现有的桶-bucket" class="hash-link" aria-label="Direct link to 1. 查看当前账户下所有现有的桶 (bucket)" title="Direct link to 1. 查看当前账户下所有现有的桶 (bucket)">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ s3cmd </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2016</span><span class="token plain">-11-18 </span><span class="token number">22</span><span class="token plain">:30 s3://s3chinatest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2016</span><span class="token plain">-10-29 00:14 s3://bucket2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-创建新的-bucket">2. 创建新的 bucket<a href="#2-创建新的-bucket" class="hash-link" aria-label="Direct link to 2. 创建新的 bucket" title="Direct link to 2. 创建新的 bucket">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ s3cmd mb s3://s3chinatest2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Bucket ’s3://s3chinatest2/’ created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-上传文件到-bucket">3. 上传文件到 bucket<a href="#3-上传文件到-bucket" class="hash-link" aria-label="Direct link to 3. 上传文件到 bucket" title="Direct link to 3. 上传文件到 bucket">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ s3cmd put file1.txt file2.txt file3.txt s3://s3chinatest2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">upload: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;file1.txt&#x27;</span><span class="token plain"> -</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s3://s3chinatest2/file1.txt&#x27;</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token plain"> of </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2432</span><span class="token plain"> of </span><span class="token number">2432</span><span class="token plain">   </span><span class="token number">100</span><span class="token plain">% </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain">    0s    </span><span class="token number">43.27</span><span class="token plain"> kB/s  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">upload: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;file2.txt&#x27;</span><span class="token plain"> -</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s3://s3chinatest2/file2.txt&#x27;</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2</span><span class="token plain"> of </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2432</span><span class="token plain"> of </span><span class="token number">2432</span><span class="token plain">   </span><span class="token number">100</span><span class="token plain">% </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain">    0s    </span><span class="token number">59.83</span><span class="token plain"> kB/s  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">upload: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;file3.txt&#x27;</span><span class="token plain"> -</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s3://s3chinatest2/file3.txt&#x27;</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">3</span><span class="token plain"> of </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2432</span><span class="token plain"> of </span><span class="token number">2432</span><span class="token plain">   </span><span class="token number">100</span><span class="token plain">% </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain">    0s    </span><span class="token number">58.93</span><span class="token plain"> kB/s  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> $ s3cmd </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"> s3://s3chinatest2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2016</span><span class="token plain">-11-18 </span><span class="token number">15</span><span class="token plain">:11      </span><span class="token number">2432</span><span class="token plain">   s3://s3chinatest2/file1.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2016</span><span class="token plain">-11-18 </span><span class="token number">15</span><span class="token plain">:11      </span><span class="token number">2432</span><span class="token plain">   s3://s3chinatest2/file2.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2016</span><span class="token plain">-11-18 </span><span class="token number">15</span><span class="token plain">:11      </span><span class="token number">2432</span><span class="token plain">   s3://s3chinatest2/file3.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上传的文件默认访问权限为私有 (private)，只能用户自己可以访问，使用正确的访问和安全密码即可。
如果要上传公开访问权限的文件，需要添加 --acl-public 参数。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ s3cmd put  --acl-public file4.txt s3://s3chinatest2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">upload: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;file4.txt&#x27;</span><span class="token plain"> -</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s3://s3chinatest2/file1.txt&#x27;</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token plain"> of </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2432</span><span class="token plain"> of </span><span class="token number">2432</span><span class="token plain">   </span><span class="token number">100</span><span class="token plain">% </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain">    0s    </span><span class="token number">43.27</span><span class="token plain"> kB/s  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-下载-bucket-内的文件">4. 下载 bucket 内的文件<a href="#4-下载-bucket-内的文件" class="hash-link" aria-label="Direct link to 4. 下载 bucket 内的文件" title="Direct link to 4. 下载 bucket 内的文件">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ s3cmd get s3://s3chinatest2/file1.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">download: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s3://s3chinatest2/file1.txt&#x27;</span><span class="token plain"> -</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./file1.txt&#x27;</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token plain"> of </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2432</span><span class="token plain"> of </span><span class="token number">2432</span><span class="token plain">   </span><span class="token number">100</span><span class="token plain">% </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain">    0s    </span><span class="token number">27.65</span><span class="token plain"> kB/s  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># 支持 &quot; * &quot;匹配任意字符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> $ s3cmd get s3://s3chinatest2/file*.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">download: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s3://s3chinatest2/file1.txt&#x27;</span><span class="token plain"> -</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./file1.txt&#x27;</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token plain"> of </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2432</span><span class="token plain"> of </span><span class="token number">2432</span><span class="token plain">   </span><span class="token number">100</span><span class="token plain">% </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain">    0s    </span><span class="token number">48.11</span><span class="token plain"> kB/s  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">download: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s3://s3chinatest2/file2.txt&#x27;</span><span class="token plain"> -</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./file2.txt&#x27;</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">2</span><span class="token plain"> of </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2432</span><span class="token plain"> of </span><span class="token number">2432</span><span class="token plain">   </span><span class="token number">100</span><span class="token plain">% </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain">    0s    </span><span class="token number">84.76</span><span class="token plain"> kB/s  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">download: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s3://s3chinatest2/file3.txt&#x27;</span><span class="token plain"> -</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;./file3.txt&#x27;</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">3</span><span class="token plain"> of </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2432</span><span class="token plain"> of </span><span class="token number">2432</span><span class="token plain">   </span><span class="token number">100</span><span class="token plain">% </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain">    0s    </span><span class="token number">75.28</span><span class="token plain"> kB/s  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意若当前目录有相同文件时，可以使用--skip-existing 参数跳过这些文件。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-删除-bucket-内的文件">5. 删除 bucket 内的文件<a href="#5-删除-bucket-内的文件" class="hash-link" aria-label="Direct link to 5. 删除 bucket 内的文件" title="Direct link to 5. 删除 bucket 内的文件">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># del 与 rm 都可以使用.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ s3cmd del s3://s3chinatest2/file1.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">delete: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s3://s3chinatest2/file1.txt&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-获取当前-bucket-信息">6. 获取当前 bucket 信息<a href="#6-获取当前-bucket-信息" class="hash-link" aria-label="Direct link to 6. 获取当前 bucket 信息" title="Direct link to 6. 获取当前 bucket 信息">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># bucket的存储位置及访问权限设置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">s3cmd info s3://s3chinatest2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">s3://s3chinatest2/ </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">bucket</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   Location:  cn-north-1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   Payer:     BucketOwner</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   Expiration Rule: none</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   policy:    none</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   cors:      none</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   ACL:       2fe63da8137b85d9868d240869945287b285a58b5d7e07e21ac813b486dcabea: FULL_CONTROL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-上传文件到-bucket-时加密">7. 上传文件到 bucket 时加密<a href="#7-上传文件到-bucket-时加密" class="hash-link" aria-label="Direct link to 7. 上传文件到 bucket 时加密" title="Direct link to 7. 上传文件到 bucket 时加密">​</a></h3><p>当用 s3cmd 下载一个加密过的文件时，它会自动检测加密并在下载过程解密，因此下载和访问加密文件时，就像通常所做的一样</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ s3cmd -e put t_result.java s3://s3chinatest2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">upload: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;/tmp/tmpfile-S9lUXERAEUdnNaz5zHba&#x27;</span><span class="token plain"> -</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s3://s3chinatest2/t_result.java&#x27;</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">1</span><span class="token plain"> of </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">3355</span><span class="token plain"> of </span><span class="token number">3355</span><span class="token plain">   </span><span class="token number">100</span><span class="token plain">% </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain">    0s    </span><span class="token number">39.25</span><span class="token plain"> kB/s  </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="8-查看-bucket-使用情况">8. 查看 bucket 使用情况<a href="#8-查看-bucket-使用情况" class="hash-link" aria-label="Direct link to 8. 查看 bucket 使用情况" title="Direct link to 8. 查看 bucket 使用情况">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ s3cmd </span><span class="token function" style="color:rgb(80, 250, 123)">du</span><span class="token plain"> s3://s3chinatest2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">8219</span><span class="token plain">     </span><span class="token number">3</span><span class="token plain"> objects s3://s3chinatest2/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="9-删除一个-bucket">9. 删除一个 bucket<a href="#9-删除一个-bucket" class="hash-link" aria-label="Direct link to 9. 删除一个 bucket" title="Direct link to 9. 删除一个 bucket">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ s3cmd rb s3://s3chinatest2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ERROR: S3 error: </span><span class="token number">409</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">BucketNotEmpty</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">: The bucket you tried to delete is not empty</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 默认不能删除非空的bucket，所以要先清空存储桶内数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ s3cmd </span><span class="token function" style="color:rgb(80, 250, 123)">rm</span><span class="token plain"> s3://s3chinatest2/*</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">delete: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s3://s3chinatest2/file2.txt&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">delete: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s3://s3chinatest2/file3.txt&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">delete: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s3://s3chinatest2/t_result.java&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ s3cmd rb s3://s3chinatest2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Bucket </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s3://s3chinatest2/&#x27;</span><span class="token plain"> removed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="other"><em>Other</em><a href="#other" class="hash-link" aria-label="Direct link to other" title="Direct link to other">​</a></h2><ol><li>关于 s3cmd 还有非常多的功能，这里只是列举简单的一部分，有兴趣的同学，可以使用 man s3cmd 查看详细的帮助文档。</li><li>s3cmd 适用的场景主要利用脚本做 cron 任务，例如定时备份，然后推送到 s3，降低成本，持久保存。</li><li>Windows 平台也支持 s3cmd 哦，有兴趣的同学可以去研究下。</li></ol></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/aws">AWS</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2016/08/02/HowTo-Install-Openfire-on-CentOS">HowTo Install Openfire  on CentOS</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-08-02T16:04:48.000Z" itemprop="datePublished">August 2, 2016</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-centos-6x-x86_64">Install Centos 6.x x86_64<a href="#install-centos-6x-x86_64" class="hash-link" aria-label="Direct link to Install Centos 6.x x86_64" title="Direct link to Install Centos 6.x x86_64">​</a></h2><p>  <em>略.</em></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装依赖软件">安装依赖软件<a href="#安装依赖软件" class="hash-link" aria-label="Direct link to 安装依赖软件" title="Direct link to 安装依赖软件">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">yum -y </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">wget</span><span class="token plain"> java glibc.i686</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="下载-openfire-38-到本地">下载 openfire 3.8 到本地<a href="#下载-openfire-38-到本地" class="hash-link" aria-label="Direct link to 下载 openfire 3.8 到本地" title="Direct link to 下载 openfire 3.8 到本地">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">wget</span><span class="token plain"> http://download.igniterealtime.org/openfire/openfire-3.8.1-1.i386.rpm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="安装-openfire-38">安装 openfire 3.8<a href="#安装-openfire-38" class="hash-link" aria-label="Direct link to 安装 openfire 3.8" title="Direct link to 安装 openfire 3.8">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">yum -y </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> ./openfire*rpm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="设置服务开启自启动">设置服务开启自启动<a href="#设置服务开启自启动" class="hash-link" aria-label="Direct link to 设置服务开启自启动" title="Direct link to 设置服务开启自启动">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">chkconfig</span><span class="token plain"> openfire on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="yum-install-mysql-server">Yum Install mysql-server<a href="#yum-install-mysql-server" class="hash-link" aria-label="Direct link to Yum Install mysql-server" title="Direct link to Yum Install mysql-server">​</a></h3><p>详见： <a href="http://blog.ultraera.org/how-to-install-mysql-5-6-on-centos/" target="_blank" rel="noopener noreferrer">How to Install MySQL 5.5/6/7 on RHEL/CentOS 5/6/7</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建-openfire-数据库">创建 openfire 数据库<a href="#创建-openfire-数据库" class="hash-link" aria-label="Direct link to 创建 openfire 数据库" title="Direct link to 创建 openfire 数据库">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql -u root -p</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create database openfire character </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">set</span><span class="token plain"> utf8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">grant all privileges on openfire.* to </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;openfire&#x27;</span><span class="token plain">@</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;127.0.0.1&#x27;</span><span class="token plain"> identified by </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;openfire&#x27;</span><span class="token plain"> with grant option</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="启动-openfire">启动 openfire<a href="#启动-openfire" class="hash-link" aria-label="Direct link to 启动 openfire" title="Direct link to 启动 openfire">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">http://Host:9090</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="之后的初始化步骤请根据实际操作注意设定数据库地址用户名和密码时不要出错">之后的初始化步骤，请根据实际操作，注意设定数据库地址用户名和密码时不要出错<a href="#之后的初始化步骤请根据实际操作注意设定数据库地址用户名和密码时不要出错" class="hash-link" aria-label="Direct link to 之后的初始化步骤，请根据实际操作，注意设定数据库地址用户名和密码时不要出错" title="Direct link to 之后的初始化步骤，请根据实际操作，注意设定数据库地址用户名和密码时不要出错">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="faq">FAQ<a href="#faq" class="hash-link" aria-label="Direct link to FAQ" title="Direct link to FAQ">​</a></h2><p>openfire 安装完毕后无法登录控制台</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">报错：Login failed:make sure your username and password are correct and that you’re an admin or moderator</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">解决方案如下：</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">1</span><span class="token plain">.使用Mysql查看工具进入数据库，进入表“ofuser”，将该表清空，然后执行该SQL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INSERT INTO ofUser </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">username, plainPassword, name, email, creationDate, modificationDate</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    VALUES </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;admin&#x27;</span><span class="token plain">, </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;admin&#x27;</span><span class="token plain">, </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Administrator&#x27;</span><span class="token plain">, </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;admin@example.com&#x27;</span><span class="token plain">, </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;0&#x27;</span><span class="token plain">, </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;0&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">2</span><span class="token plain">.关闭openfire服务，就是从其控制台stop然后再start，再用用户名：admin,密码：admin登录即可</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>openfire 进程无法启动</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">报错：nohup: failed to run </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">command</span><span class="token plain"> `/opt/openfire/jre/bin/java&#x27;: No such </span><span class="token function" style="color:rgb(80, 250, 123)">file</span><span class="token plain"> or directory</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">解决方案如下：</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">经检查是由于openfire未能正确识别jre环境变量导致，安装时自带的jre是32位，但操作系统却是64位操作平台。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">，故在/etc/init.d/openfire的启动脚本修改，</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">JAVA_HOME</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/usr/lib/jvm/jre-</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$VERSION</span><span class="token string" style="color:rgb(255, 121, 198)">.x86_64&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2016/04/27/HowTo-Add-Piwik-Tracking-to-Ghost">HowTo Add Piwik Tracking to Ghost</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-04-27T16:51:58.000Z" itemprop="datePublished">April 27, 2016</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><p>This is what about piwik on wiki. <a href="https://en.wikipedia.org/wiki/Piwik" target="_blank" rel="noopener noreferrer">goto</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-1---getting-your-piwik-tracking-code">Step 1 - Getting your Piwik Tracking code<a href="#step-1---getting-your-piwik-tracking-code" class="hash-link" aria-label="Direct link to Step 1 - Getting your Piwik Tracking code" title="Direct link to Step 1 - Getting your Piwik Tracking code">​</a></h2><p>The first step to having Piwik tracking your Ghost blog will be to add a new website in Piwik, if you are unfamiliar with this process you can checkout the Piwik documention on Managing Websites. With your Ghost blog added into Piwik you will end up with tracking code that will look similar to the following:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token plain">-- Piwik --</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">script </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;text/javascript&quot;</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var _paq </span><span class="token operator">=</span><span class="token plain"> _paq </span><span class="token operator">||</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token function-name function" style="color:rgb(80, 250, 123)">function</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> var </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">u</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">((</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https:&quot;</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> document.location.protocol</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> ? </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://{</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$PIWIK_URL</span><span class="token string" style="color:rgb(255, 121, 198)">}/&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;http://{</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$PIWIK_URL</span><span class="token string" style="color:rgb(255, 121, 198)">}/&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    _paq.push</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;setSiteId&#x27;</span><span class="token plain">, </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$IDSITE</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    _paq.push</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;setTrackerUrl&#x27;</span><span class="token plain">, u+</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;piwik.php&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    _paq.push</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;trackPageView&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    _paq.push</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;enableLinkTracking&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">d</span><span class="token operator">=</span><span class="token plain">document, </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">g</span><span class="token operator">=</span><span class="token plain">d.createElement</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;script&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">, </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">s</span><span class="token operator">=</span><span class="token plain">d.getElementsByTagName</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;script&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> g.type</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;text/javascript&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> g.defer</span><span class="token operator">=</span><span class="token plain">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> g.async</span><span class="token operator">=</span><span class="token plain">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> g.src</span><span class="token operator">=</span><span class="token plain">u+</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;piwik.js&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    s.parentNode.insertBefore</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">g,s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">/script</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token plain">-- End Piwik Code --</span><span class="token operator">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>Where <code>$PIWIK_URL</code> will be the domain name you have setup for Piwik.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-2---adding-piwik-tracking-code-to-ghost-theme-file">Step 2 - Adding Piwik Tracking Code To Ghost Theme File<a href="#step-2---adding-piwik-tracking-code-to-ghost-theme-file" class="hash-link" aria-label="Direct link to Step 2 - Adding Piwik Tracking Code To Ghost Theme File" title="Direct link to Step 2 - Adding Piwik Tracking Code To Ghost Theme File">​</a></h2><p>Piwik recommends that you add the tracking code right above the <code>&amp;#60;/body&amp;#62;</code> tag, which you can find in your Ghost&#x27;s <code>default.hbs</code> theme file. You will find the <code>default.hbs</code> file in <code>/path/to/ghost/content/themes/your-theme/default.hbs</code>
How you add the tracking code to your <code>default.hbs</code> will depend on if you are editing the file on your local computer or directly on the server. If you are editing your theme locally you can edit this file in any text editor and when you are finished upload this file to your server. Otherwise if you are editing this file directly on the server you can use the command line editor, <code>vim</code>, to add the tracking code.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-3---restart-ghost">Step 3 - Restart Ghost<a href="#step-3---restart-ghost" class="hash-link" aria-label="Direct link to Step 3 - Restart Ghost" title="Direct link to Step 3 - Restart Ghost">​</a></h2><p>For the changes in your theme to take effect you will need to restart Ghost. Restarting Ghost will load up a fresh copy of your theme files, with your Piwik tracking code. How you restart Ghost depends on how you started Ghost. If you followed our <a href="https://www.howtoinstallghost.com/how-to-start-ghost-with-forever/" target="_blank" rel="noopener noreferrer">https://www.howtoinstallghost.com/how-to-start-ghost-with-forever/</a> Keep Ghost Running with forever<code>, then you can restart Ghost with</code> forever restart ghost`.
Within a few moments you will start to see data coming in for your Ghost blog!
If you have any questions about setting this up or run into any issues please leave us a comment below and we will do what we can to help.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/piwik">Piwik</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2016/04/27/HowTo-Install-piwik-with-nginx-on-centos-6-x">HowTo Install piwik with nginx on centos 6.x</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-04-27T16:00:44.000Z" itemprop="datePublished">April 27, 2016</time> · <!-- -->One min read</div></header><div class="markdown" itemprop="articleBody"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="this-is-my-nginx-config">This is my nginx config<a href="#this-is-my-nginx-config" class="hash-link" aria-label="Direct link to This is my nginx config" title="Direct link to This is my nginx config">​</a></h3><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> listen blog.ultraera.org:80;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> server_name blog.ultraera.org;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> location / {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  proxy_set_header Host $http_host;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  proxy_pass   http://127.0.0.1:2368;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> listen piwik.ultraera.org:80;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> server_name piwik.ultraera.org;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> location / {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  proxy_set_header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  proxy_set_header Host $http_host;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  proxy_pass   http://127.0.0.1:2080;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/piwik">Piwik</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div></div>
<script src="/assets/js/runtime~main.a4192aa2.js"></script>
<script src="/assets/js/main.be9b3ddb.js"></script>
</body>
</html>