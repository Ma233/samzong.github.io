<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">10 posts tagged with &quot;Linux&quot; | SAMZONG</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://samzong.me/blog/tags/linux"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="10 posts tagged with &quot;Linux&quot; | SAMZONG"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://samzong.me/blog/tags/linux"><link data-rh="true" rel="alternate" href="https://samzong.me/blog/tags/linux" hreflang="en"><link data-rh="true" rel="alternate" href="https://samzong.me/blog/tags/linux" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="SAMZONG RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="SAMZONG Atom Feed"><link rel="stylesheet" href="/assets/css/styles.44c5c7e5.css">
<link rel="preload" href="/assets/js/runtime~main.a4192aa2.js" as="script">
<link rel="preload" href="/assets/js/main.be9b3ddb.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/07/13/google-sou-suo-ji-qiao-zheng-li">Google 搜索技巧整理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/21/ketbrains-ji-huo-fu-wu-qi">在线服务器激活 Ketbrains</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/16/raycast">Raycast 你的年度报告已到达</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/15/Skoala-Install-Dce5">DCE5-Skoala 安装教程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/06/dce5">保姆式安装 DCE5.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/28/cskefu-opensource-project">春松客服</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/23/what-is-hukou">What is Hukou</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/20/Copy-To-Markdwon">Copy to Markdown</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/16/dubbo-ji-chu-zhi-shi">Dubbo 基础知识梳理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/10/panads-fill-nan-value-to-zero">Panads fill NaN value to Zero</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/10/22/redash-for-docker-bu-shu">Redash for Docker 部署</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/10/18/jwt-nei-zhi-de-fang-shi">JWT 内置的方式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/10/06/ji-ji-fu-ji-ji">唧唧复唧唧</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/10/04/zi-bei-yu-chao-yue">自卑与超越</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/28/gitlab-forked-ru-he-gen-sui-upstream-zhu-ku">GitLab Forked 如何跟随 upstream 主库</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/27/kafka-jing-pin-diao-yan-ji-gong-neng-she-ji">Kafka 调研及功能设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/22/poetry-shi-yong-bi-ji">Poetry 使用笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/20/skoala-bu-shu-jiao-cheng">Skoala 部署教程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/18/shi-yong-canal-jin-xing-shu-ju-ku-zeng-liang-tong-bu">使用 canal 进行数据库增量同步</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/12/k8s-xi-lie-nan-bei-liu-liang-he-dong-xi-liu-liang">K8s 系列 南北流量和东西流量</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/08/17/docker-for-mac-wang-luo-ji-qiao">Docker for Mac 网络技巧</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/08/15/wa-er-deng-hu">瓦尔登湖</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/08/10/contour-xue-xi-bi-ji">Contour 学习笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/24/tong-guo-pipreqs-huo-qu-dang-qian-xiang-mu-di-yi-lai-ku">通过 pipreqs 获取当前项目的依赖库</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/22/contour-envoy-zhi-biao">Contour和Envoy指标介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/22/jq-ming-ling-xing-json-chu-li-shen-qi">jq 命令行 Json 处理神器</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/21/wei-fu-wu-yin-qing-wang-guan-neng-li-jie-shao">微服务引擎网关能力介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/18/bi-guan-bei-zhan-11-yue">闭关备战 11 月</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/18/i18n-shi-yong-gou-jian">i18n 使用构建</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/29/mac-shang-an-zhuang-ruan-jian-de-fang-shi">Mac 上安装软件的方式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/18/httpproxy-api-chuang-jian">HTTPProxy API 创建</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/28/hexo-admonition">Hexo 增加 admonition 样式支持</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/18/gitlab-fa-song-qi-wei-ji-qi-ren-xiao-xi">Gitlab 发送企微机器人消息</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/17/guo-nei-huan-jing-da-jian-macos-k8s-kai-fa-huan-jing">国内环境搭建 MacOS K8s 开发环境</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/17/kubernetes-operator">Kubernetes Operator</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/11/contour-she-ji-li-nian">Contour 设计理念</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/07/macos-yin-cang-dock-lan-zhong-te-ding-ying-yong">MacOS 隐藏 Dock 栏中特定应用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/06/man-zu-yu-qi-de-wen-dang-zhan-mkdocs">满足预期的文档站 Mkdocs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/06/a-li-yun-yun-yuan-sheng-wang-guan">阿里云云原生网关</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/06/teng-xun-yun-wei-fu-wu-wang-guan">腾讯云微服务网关</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/03/alfred-workflow-tui-jian">Alfred Workflow 推荐</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/03/youtube-dl-xia-zai-youtube-shi-pin">youtube-dl 下载 YouTube 视频</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/03/tao-bao-python-sdk-you-hua-zhi-chi-python3">淘宝 Python SDK 优化支持 Python3</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/24/kubernetes-xue-xi-zhi-lu">kubernetes 学习之路</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/22/github-pages-de-miao-yong">GitHub Pages 的妙用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/21/kubernetes-bu-shu-cuo-wu-jie-jue-hui-zong">Kubernetes 部署错误解决汇总</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/19/xu-yao-liao-jie-de-jing-pin">需要了解的 K8s 发行版本</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/18/cka-kao-shi-zhun-bei">CKA 考试准备</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/17/Docker-Run-at-Apple-Silicon-M1">Dockerfile Run at M1 processor build failed</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/17/python-request-install-pip-error">python Request install pip error</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/16/metabase-shang-shou-shi-yong-jar">Metabase 上手 - 使用 Jar 运行</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/15/sql-dui-shi-jian-zheng-dian-de-chu-li">SQL 对时间整点的处理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/14/tao-bao-python-sdk-you-hua-zhi-chi-python3">淘宝 Python SDK 优化支持 Python3</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/14/python-pip-guo-nei-jia-su">Python Pip 国内加速</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/11/git-xiu-fu-li-shi-cuo-wu-de-author-xin-xi">Git 修复历史错误的 Author 信息</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/10/awsome-telegram-bot">Awsome Telegram Bot</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/28/Javascript-Tips">Javascript Tips</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/27/awesome-hexo-plugins">Awesome Hexo Plugin</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/27/poetry-shi-yong-bi-ji">Poetry 使用笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/27/python-duo-ban-ben-guan-li-gong-ju">Pyenv Python 多版本管理利器</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/11/xin-de-mu-biao">2022 新的目标</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/02/24/fastapi-shi-yong-wen-dang">FastAPI 使用文档</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/02/11/yi-ge-python-xiang-mu-di-mu-lu-jie-gou-she-ji">Python 项目的目录结构设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/21/python3-wen-ben-chu-li-strip-split">Python3 文本处理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/20/clickhouse-chang-yong-han-shu-shi-yong">ClickHouse 常用函数使用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/04/mysql-case-when">MySQL Case WHEN</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/03/apollo-ru-he-shi-xian-pei-zhi-re-fa-bu">Apollo 如何实现配置热发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/03/get-current-timestamp">get current timestamp</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/03/python-flask-form">python flask form</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/11/29/git-zhong-duan-clone-jia-su">Github 使用 SSH 拉取代码加速</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/11/19/ding-ding-nei-wang-chuan-tou-gong-ju">钉钉内网穿透工具</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/11/17/creating-dataframe-using-list">Creating DataFrame using list</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/11/17/shi-yong-ding-ding-san-fang-shou-quan-deng-lu">使用钉钉三方授权登录</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/11/03/metabase-cai-keng-tiao-zhuan-lian-jie-de-liu-lan-qi-huan-cun">Metabase 踩坑：跳转链接的浏览器缓存</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/10/19/python-version-manage-pyenv">Python Version Manage `pyenv`</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/10/12/macos-10.15-kai-qi-hidpi">MacOS 10.15 开启 HiDPI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/09/24/kuai-su-liao-jie-lian-jie-shu-ju-ku">快速了解连接数据库</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/09/24/node-nvm">node nvm</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/09/05/dataframe-pandas">dataframe - Pandas</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/09/05/shi-yong-python3-ge-shi-hua-da-xing-json-wen-jian">使用 Python3 格式化大型 json 文件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/08/25/python-zhua-chu-lai-sui-ji-xia-zai-ji-lu">Python 抓出来随机下载记录</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/08/09/mysql-regexp-huo-xue-huo-yong">MySQL REGEXP 活学活用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/08/08/chang-yong-sql">常用 SQL-拼接日期</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/07/22/zai-gu-ge-liu-lan-qi-zhong-an-zhuang-.crx-cha-jian">在谷歌浏览器中安装.crx 插件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/07/22/zhi-hu-zhou-kan-dan-shen-hui-shang-yin">知乎周刊・单身会上瘾</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/06/25/iphone-ipad-bu-yue-yu-an-zhuang-jiu-ban-cheng-xu">iPhone/iPad 不越狱安装旧版程序</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/06/12/mac-ru-he-kuai-su-lu-zhi-gif-xiao-shi-pin">Mac 如何快速录制 GiF 小视频</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/04/18/kuai-su-liao-jie-mysql-shi-jian-fan-wei-can-shu">快速了解 MySQL 时间范围参数</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/04/16/hql-sql-shi-jian-chu-li">HQL/SQL时间处理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/27/zhi-hu-zhou-kan-·-qiao-bu-si-wang-shi">知乎周刊·乔布斯往事</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/12/how-to-set-container-auto-restarting-with-docker">how to set container auto-restarting with docker</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/ai-ni-jiu-xiang-ai-sheng-ming">爱你就像爱生命</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/ju-ying-guo">巨婴国</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/macos-10.15-kai-qi-hidpi">macOS 10.15 开启 HiDPI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/qi-shi-ni-suo-zhi-dao-de-shi-jie-hen-mo-sheng">其实，你所知道的世界很陌生</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/ren-jian-shi-ge">人间失格</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/ren-sheng-de-jia-suo">人生的枷锁</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/san-sheng-san-shi-shi-li-tao-hua">三生三世十里桃花</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/wei-chuan-de-hong-jia-yi-chen-fu">未穿的红嫁衣·沉浮</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/wo-men-sheng-huo-zai-ju-da-de-cha-ju-li">我们生活在巨大的差距里</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/wo-suo-li-jie-de-sheng-huo">我所理解的生活</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/yuan-you-ren-pei-ni-dian-pei-liu-li">愿有人陪你颠沛流离</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/zui-hou-de-shua-hou-ren">最后的耍猴人</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/15/macos-terminal-san-jian-ke">macOs Terminal 三剑客</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/15/pprint-beautiful-json-format">pprint beautiful json format</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/15/python3-traceback">python3 traceback</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/15/requests-post-data-shi-dui-json-xu-yao-te-shu-zhu-yi">requests post data 时对 json 需要特殊注意</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/09/dingtalk-orgbot-sign-generate">dingtalk orgBot sign generate</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/07/python-django-bian-xie-gong-gong-mo-kuai-zai-app-zhong-yin-yong">python django 编写公共模块在 app 中引用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/01/20/python-xlsxwriter-xie-ru-excel">python xlsxwriter 写入 excel</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/01/01/year-the-new-start">2021 年 - 全新出发</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/25/jian-cha-nin-de-app-shi-fou-yi-zhi-chi-applesilicon">检查您的 App 是否已支持 AppleSilicon</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/25/mac-tiao-zheng-launchpad-tu-biao-da-xiao">Mac 调整 Launchpad 图标大小</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/13/learn-sqlalchemy">learn sqlalchemy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/09/covert-timestamp2datetime">covert timestamp2datetime</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/08/python-wan-cheng-dou-dian-api-shou-quan">python 完成抖店 API 授权</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/03/python3-str-qu-chu-te-ding-nei-rong">python3 str 去除特定内容</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/24/Check-You-Favorites-App-Is-Ready-Apple-Silicon">Check You App readyOnAppleSilicon</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/23/ru-he-zhong-zhi-mac-de-smc">如何重置 Mac 的 SMC</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/18/dai-ma-ge-shi-xiang-guan">代码格式相关</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/18/django-lian-shou-xiang-mu">Django 练手项目</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/17/python-re-zheng-ze-biao-da-shi">python re 正则表达式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/16/autoscraper-pa-chong-suo-jian-ji-suo-de">autoscraper 爬虫 所见即所得</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/09/django-chu-shi-hua-project">Django 初始化 project</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/06/django-xiu-gai-modules-shi-chu-cuo">Django 修改 modules 时出错</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/06/join-yu-format-bu-tong-de-yong-fa">join 与 format 不同的用法</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/05/beautiful-soup-4-shi-yong-ji-qiao">beautiful soup 4 使用技巧</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/04/python3-setup.py-help-commands">python3 setup.py --help-commands</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/10/23/use-devtools-encodeurl-&amp;-decodeurl">Use devtools encodeurl &amp; decodeurl</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/10/17/mac-shi-yong-ming-ling-guan-bi-he-qi-dong-airport">使用命令关闭和启动 AirPort</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/11/17/mac-jie-jue-oh-my-zsh-zai-zhong-duan-xia-da-kai-huan-man">Mac 下解决 oh-my-zsh 在终端下打开缓慢</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/07/22/mac-xia-homebrew-de-shi-yong">Mac 下 Homebrew 的使用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/07/03/mysql-ming-ling-xing-fu-zhu-mycli">MySQL 命令行辅助 mycli</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/01/22/mac-ru-he-kuai-su-lu-zhi-gif-xiao-shi-pin">MacTips 如何快速录制 GiF 小视频</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2018/11/17/mactips-dan-du-she-zhi-cheng-xu-yu-yan">MacTips 单独设置程序语言</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2018/08/04/HowTo-Skip-Atlassian-Auth-for-SourceTree">HowTo Skip Atlassian Auth for SourceTree</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2018/02/28/shi-yong-guo-nei-pypi-yuan-jia-su-pip-an-zhuang">使用国内 pypi 源加速 pip 安装</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2018/01/09/git-shi-yong-gui-fan-liu-cheng">Git 使用规范流程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/12/02/Howto-Install-Redmine-on-Ubuntu-16.04">Howto Install Redmine on Ubuntu 16.04</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/11/15/Howto-use-ssr-on-mac">HowTo Use SSR Service on Mac</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/10/22/iphone:ipad-bu-yue-yu-an-zhuang-jiu-ban-cheng-xu">iPhone/iPad 不越狱安装旧版程序</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/08/12/blazemeter-recoding-jmx">Jmeter 使用 BlazeMeter 为 Jmeter 录制脚本</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/06/02/bai-du-wang-pan-python-ke-hu-duan">bypy 百度网盘 Python 客户端</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/08/04/dong-ping-guo-jia-sen-lin-gong-yuan">东平国家森林公园</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/05/20/wo-lai-dao-zhe-shi-shang">我来到这世上</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/05/15/wannacry-ru-chong-bing-du-shi-jian-ji-xiu-fu-fang-an">Wannacry 蠕虫病毒事件及修复方案</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/04/18/centos-zeng-jia-xin-ying-pan-gei-gen-wen-jian-xi-tong-kuo-rong">CentOS 增加新硬盘给根文件系统扩容</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/04/13/HowTo-Install-GitLab">HowTo Install GitLab</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/04/11/guan-yu-kao-shi">关于考试</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/04/05/HowTo-set-Tomcat-7-automatic-startup-with-CentOS-7">HowTo set Tomcat 7 automatic startup with CentOS 7</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/03/23/zai-linux-zhong-duan-shi-yong-ssr-fu-wu-shi-xian-ke-xue-shang-wang">在 Linux 终端使用 SSR 服务实现科学上网</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/03/06/HowTo-install-Zoomdata">HowTo install Zoomdata</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/03/04/si-jie-mo-fang-te-shu-qing-kuang-zhi-chu-li">四阶魔方特殊情况之处理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/27/mactips-shi-yong-ming-ling-guan-bi-he-qi-dong-airport">MacTips 使用命令关闭和启动 AirPort</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/27/HowTo-Install-NextCloud">HowTo Install NextCloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/22/HowTo-Install-Redmine">HowTo Install Redmine</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/20/HowTo-Upgrade-Your-Ghost-Version">HowTo Upgrade Your Ghost Version</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/19/HowTo-Automatic-Updates-CENTOS-RHEL-Using-YUM">HowTo Automatic Updates CENTOS/RHEL Using YUM</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/09/mysql-8-suo-yin-chuang-jian-shan-chu-he-cha-kan">MySQL 索引创建、删除和查看</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/01/18/HowTo-Monitor-Tomcat-Head-Memory-for-Zabbix">HowTo Monitor Tomcat HeadMemory for Zabbix</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/01/15/mei-ri-bei-fen-mysql-dan-biao-shu-ju">每日备份 MySQL 单表数据</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/01/10/sheng-huo-zai-bie-chu">生活在别处</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/01/07/docker-hub-guo-nei-jia-su">Docker Hub 国内加速</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/01/01/wo-de-2017">我的 2017</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/20/HowTo-Mount-OSS-Bucket-On-ECS">HowTo Mount OSS Bucket On ECS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/17/shang-hai-tian-leng-le">上海天冷了</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/17/gao-bie">告别</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/11/xue-zhan-gang-ju-ling">血战钢锯岭</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/08/HowTo-Install-Python3-on-CentOS-6-x">HowTo Install Python3 on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/04/HowTo-Reset-MySQL-Root-Password">HowTo Reset MySQL Root Password</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/03/tomcat-2-li-yong-jdk-zi-shen-keytool-shi-xian-https">Tomcat 利用 JDK 自身 keytool 实现 HTTPS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/30/aws-use-s3cmd-ming-ling-xing-guan-li-s3-cun-chu">AWS Use s3cmd 命令行管理 S3 存储</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/29/Tomcat-1-java-lang-OutOfMemoryError">Tomcat java.lang.OutOfMemoryError</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/28/HowTo-Install-LNMP-on-CentOS-6-x">HowTo Install LNMP on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/27/shi-jie-shang-zui-mei-yong-de-dong-xi">世界上最没用的东西</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/23/denyhosts-zeng-jia-fu-wu-qi-ssh-hei-ming-dan-ji-zhi">Denyhosts 增加服务器 SSH 黑名单机制</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/10/mysql-5-qing-kong-biao-ming-ling-zhi-truncate-yu-delete-qu-bie">MySQL 清空表命令之：truncate 与 delete 区别</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/10/29/SSH-LINUX-Security-Settings">SSH LINUX Security Settings</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/10/20/HowTo-Install-PostgreSQL-9-5-on-CentOS-6-x">HowTo Install PostgreSQL 9.5 on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/10/14/xie-de-wei-bo">微博随笔</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/10/14/xie-de-weibo">写的微博</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/09/22/HowTo-Use-pt-query-digest">HowTo Use pt-query-digest</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/09/20/sheng-zhe-gu-du">生者孤独</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/09/19/HowTo-Install-a-Tomcat-Server-7">HowTo Install a Tomcat Server 7</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/19/er-shi-si-sui">二十四岁</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/13/Script-Install-LNMP">Use Script Install LNMP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/04/HowTo-Setup-MariaDB-Galera-Cluster-10-On-CentOS-6-x">HowTo Setup MariaDB Galera Cluster 10 On CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/02/HowTo-Install-Openfire-on-CentOS">HowTo Install Openfire  on CentOS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/02/HowTo-Use-Docker-create-a-Tomcat-Project">HowTo Use Docker create a Tomcat Project</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/01/ni-hao-ba-yue">你好，八月</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/29/HowTo-Trun-Off-IPv6-in-CentOS-6-x">HowTo Trun Off IPv6 in CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/27/HowTo-Install-KVM-Manage-Server-webvirtmgr">HowTo Install KVM Manage Server webvirtmgr</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/27/yum-zhong-releasever-he-basearch-de-qu-zhi">Yum 中$releasever 和$basearch 的取值</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/27/Manage-Tomcat-Service-Use-Shell-Script">Manage Tomcat Service Use Shell Script</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/24/HowTo-Play-Pokemon-GO-in-China">HowTo Play Pokemon GO in China</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/10/HowTo-Reset-Azure-VM-Linux-Password">HowTo Reset Azure VM Linux Password</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/07/HowTo-Install-Docker-on-CentOS-6-x">HowTo Install Docker on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/07/HowTo-Install-MySQL-5-5-6-7-on-RHEL-CentOS-5-6-7">HowTo Install MySQL 5.5/6/7 on RHEL/CentOS 5/6/7</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/07/HowTo-Use-Remi-Install-Redis">HowTo Use Remi Install Redis</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/05/HowTo-Use-Fuse-sshfs-to-Mount-Remote-Filesystems">HowTo Use Fuse-sshfs to Mount Remote Filesystems</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/06/16/mysql-1-chang-yong-you-hua">MySQL 常用配置优化</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/06/16/shi-yong-mosh-dai-ti-ssh-lian-jie-fu-wu-qi">使用 mosh 代替 ssh 连接服务器</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/24/Azure-HowTo-Use-Azure-CLI-on-Mac">HowTo Use Azure CLI on Mac</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/24/Azure-3-HowTo-Use-Azure-CLI-on-Mac">Azure CLI Import AcountInfo</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/20/HowTo-Monitoring-MySQL-server-for-Zabbix">HowTo Monitoring MySQL server for Zabbix</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/18/HowTo-Install-CloudStack-4-8-on-CentOS-6-x">HowTo Install CloudStack 4.8 on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/15/openstak-jie-shao">OpenStak 介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/12/azure-4-chuang-jian-he-shi-yong-azure-redis-cache">创建和使用 Azure Redis Cache</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/05/HowTo-Install-Fabric-on-CentOS-7-x">HowTo Install Fabric on CentOS 7.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/05/centos-7-2-xi-tong-fu-wu-guan-li-fang-shi">CentOS 系统服务管理方式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/08/12/HowTo-Automatic-EasyBackup-MysqlDB">CentOS 修改系统主机名</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/05/centos-7-1-xiu-gai-xi-tong-zhu-ji-ming">CentOS 修改系统主机名</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/05/mysql-3-mysqldump-chang-yong-can-shu">mysqldump 常用参数</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/04/HowTo-Install-Python-2-7-8-on-CentOS-6-x">HowTo Install Python 2.7.8 on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/27/HowTo-Add-Piwik-Tracking-to-Ghost">HowTo Add Piwik Tracking to Ghost</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/27/HowTo-Install-piwik-with-nginx-on-centos-6-x">HowTo Install piwik with nginx on centos 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/20/shi-yong-sourecetree-guan-li-ni-de-git-xiang-mu">使用 SoureceTree 管理你的 git 项目</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/09/mac-1-tiao-zheng-launchpad-tu-biao-da-xiao">MacTips 调整 Launchpad 图标大小</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/08/mac-2-jie-jue-oh-my-zsh-zai-zhong-duan-xia-da-kai-huan-man">MacTips 解决 oh-my-zsh 在 Terminal 下打开缓慢</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/01/ru-he-zai-centos-6-an-zhuang-geng-gao-ban-ben-de-php">如何在 CentOS 6 安装更高版本的 PHP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/29/mysql-4-mysql-shu-ju-ku-ji-chu">MySQL 数据库使用基础</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/29/linux-zhong-de-san-ge-te-shu-quan-xian">Linux 中的三个特殊权限</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/29/centos-6-1-shi-yong-createrepo-da-jian-ben-di-yuan">CentOS 使用 createrepo 搭建本地源</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/27/HowTo-Install-MongoDB-on-CentOS-6-x">HowTo Install MongoDB  on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/24/zai-centos-zhong-pei-zhi-sftp-huan-jing">在 CentOS 中配置 SFTP 环境</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/24/mysql-6-li-yong-linux-ji-hua-ren-wu-ding-shi-tong-bu-mysql">利用 Linux 计划任务定时同步 MySQL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/23/linux-bi-shi-shi-ti">Linux 笔试试题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/22/mysql-2-kai-qi-man-ri-zhi-you-hua">MySQL 开启慢日志优化</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/19/centos-6-2-chu-shi-an-zhuang-ji-ben-you-hua-cao-zuo">CentOS 初始安装基本优化操作</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/18/li-jie-linux-de-ying-lian-jie-yu-ruan-lian-jie">理解 Linux 的硬链接与软链接</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/07/long-zu-lu-ming-fei">龙族路明非</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/04/2016-chun-jie-du-shu-bi-ji">2016 春节读书笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/02/12/HowTo-use-TortoiseGit-for-Windows">HowTo use TortoiseGit for Windows</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/01/22/install-mariadb10-centos7">How to install MariaDB 10.1 on CentOS 7.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/01/15/ru-he-zuo-yi-ge-cheng-shu-de-zi-ji">何余生说要感谢身边所有美好的人</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/12/31/Hello-2016">Hello 2016</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/11/17/ji-jian-zhu-yi">极简主义</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/07/18/wu-ti">无题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/06/04/min-yao-shi-sheng">民谣是生</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/04/12/zhe-shi-yi-dao-gui-men-guan">这是一道鬼门关</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/04/03/lu-tu-shang">路途上</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/02/23/xie-de-di-yi-ge-qian-duan-ye-mian">写的第一个前端页面</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2014/07/22/centos7-configure-bind-dns-server">CentOS 7 Configure DNS Server</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2014/03/27/wo-shi-yi-ge-zui-bu-hui-xie-biao-ti-de-ren">我是一个最不会写标题的人</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2012/07/30/ai-yu-tong-de-bian-yuan">爱与痛的边缘</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>10 posts tagged with &quot;Linux&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2016/10/29/SSH-LINUX-Security-Settings">SSH LINUX Security Settings</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-10-29T06:23:59.000Z" itemprop="datePublished">October 29, 2016</time> · <!-- -->6 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ssh-配置安全控制限制登录"><strong>SSH 配置安全控制限制登录</strong><a href="#ssh-配置安全控制限制登录" class="hash-link" aria-label="Direct link to ssh-配置安全控制限制登录" title="Direct link to ssh-配置安全控制限制登录">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-只允许某个-ip-登录拒绝其他所有-ip">1. 只允许某个 IP 登录，拒绝其他所有 IP<a href="#1-只允许某个-ip-登录拒绝其他所有-ip" class="hash-link" aria-label="Direct link to 1. 只允许某个 IP 登录，拒绝其他所有 IP" title="Direct link to 1. 只允许某个 IP 登录，拒绝其他所有 IP">​</a></h3><p>在 /etc/hosts.allow 增加：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sshd: </span><span class="token number">1.2</span><span class="token plain">.3.4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 /etc/hosts.deny 增肌：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sshd: ALL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>用 iptables 也行：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">iptables -A INPUT -p tcp --dport </span><span class="token number">22</span><span class="token plain"> -j DROP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">iptables -A INPUT -p tcp --dport </span><span class="token number">22</span><span class="token plain"> -s </span><span class="token number">1.2</span><span class="token plain">.3.4 -j ACCEPT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-禁止某个用户通过-ssh-登录">2. 禁止某个用户通过 ssh 登录<a href="#2-禁止某个用户通过-ssh-登录" class="hash-link" aria-label="Direct link to 2. 禁止某个用户通过 ssh 登录" title="Direct link to 2. 禁止某个用户通过 ssh 登录">​</a></h2><p>在/etc/ssh/sshd_conf添加</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">AllowUsers 用户名</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">或者</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">AllowGroups 组名</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">或者</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DenyUsers 用户名</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-设定登录黑名单">3. 设定登录黑名单<a href="#3-设定登录黑名单" class="hash-link" aria-label="Direct link to 3. 设定登录黑名单" title="Direct link to 3. 设定登录黑名单">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@6 ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># vim /etc/pam.d/sshd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">auth required /lib/security/pam_listfile.so </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">item</span><span class="token operator">=</span><span class="token plain">user </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">sense</span><span class="token operator">=</span><span class="token plain">deny </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">file</span><span class="token operator">=</span><span class="token plain">/etc/sshd_user_deny_list </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">onerr</span><span class="token operator">=</span><span class="token plain">succeed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 所有/etc/sshd_user_deny_list里面的用户被拒绝ssh登录</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-sshd_config-配置">4. sshd_config 配置<a href="#4-sshd_config-配置" class="hash-link" aria-label="Direct link to 4. sshd_config 配置" title="Direct link to 4. sshd_config 配置">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 关于 SSH Server 的整体设定，包含使用的 port 啦，以及使用的密码演算方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Port </span><span class="token number">22</span><span class="token plain">　　　　　　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># SSH 预设使用 22 这个 port，您也可以使用多的 port ！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 亦即重复使用 port 这个设定项目即可！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Protocol </span><span class="token number">2,1</span><span class="token plain">　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 选择的 SSH 协议版本，可以是 1 也可以是 2 ，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 如果要同时支持两者，就必须要使用 2,1 这个分隔了！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#ListenAddress 0.0.0.0　　 # 监听的主机适配卡！举个例子来说，如果您有两个 IP，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 分别是 192.168.0.100 及 192.168.2.20 ，那么只想要</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 开放 192.168.0.100 时，就可以写如同下面的样式：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ListenAddress </span><span class="token number">192.168</span><span class="token plain">.0.100          </span><span class="token comment" style="color:rgb(98, 114, 164)"># 只监听来自 192.168.0.100 这个 IP 的SSH联机。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 如果不使用设定的话，则预设所有接口均接受 SSH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PidFile /var/run/sshd.pid　　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 可以放置 SSHD 这个 PID 的档案！左列为默认值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LoginGraceTime </span><span class="token number">600</span><span class="token plain">　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 当使用者连上 SSH server 之后，会出现输入密码的画面，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 在该画面中，在多久时间内没有成功连上 SSH server ，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 就断线！时间为秒！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Compression </span><span class="token function" style="color:rgb(80, 250, 123)">yes</span><span class="token plain">　　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 是否可以使用压缩指令？当然可以啰！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 说明主机的 Private Key 放置的档案，预设使用下面的档案即可！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HostKey /etc/ssh/ssh_host_key　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># SSH version 1 使用的私钥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HostKey /etc/ssh/ssh_host_rsa_key　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># SSH version 2 使用的 RSA 私钥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HostKey /etc/ssh/ssh_host_dsa_key　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># SSH version 2 使用的 DSA 私钥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 关于 version 1 的一些设定！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">KeyRegenerationInterval </span><span class="token number">3600</span><span class="token plain">　 　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 由前面联机的说明可以知道， version 1 会使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># server 的 Public Key ，那么如果这个 Public</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># Key 被偷的话，岂不完蛋？所以需要每隔一段时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 来重新建立一次！这里的时间为秒！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ServerKeyBits </span><span class="token number">768</span><span class="token plain"> 　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 没错！这个就是 Server key 的长度！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 关于登录文件的讯息数据放置与 daemon 的名称！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SyslogFacility AUTH　　　　　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 当有人使用 SSH 登入系统的时候，SSH会记录资</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 讯，这个信息要记录在什么 daemon name 底下？</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 预设是以 AUTH 来设定的，即是 /var/log/secure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 里面！什么？忘记了！回到 Linux 基础去翻一下</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 其它可用的 daemon name 为：DAEMON,USER,AUTH,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># LOCAL0,LOCAL1,LOCAL2,LOCAL3,LOCAL4,LOCAL5,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LogLevel INFO　　　　　　　　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 登录记录的等级！嘿嘿！任何讯息！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 同样的，忘记了就回去参考！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 登入设定部分</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PermitRootLogin no　　 　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 是否允许 root 登入！预设是允许的，但是建议设定成 no！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">UserLogin no　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 在 SSH 底下本来就不接受 login 这个程序的登入！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">StrictModes </span><span class="token function" style="color:rgb(80, 250, 123)">yes</span><span class="token plain">　　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 当使用者的 host key 改变之后，Server 就不接受联机，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 可以抵挡部分的木马程序！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#RSAAuthentication yes　　 # 是否使用纯的 RSA 认证！？仅针对 version 1 ！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PubkeyAuthentication </span><span class="token function" style="color:rgb(80, 250, 123)">yes</span><span class="token plain">　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 是否允许 Public Key ？当然允许啦！只有 version 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">AuthorizedKeysFile      .ssh/authorized_keys</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 上面这个在设定若要使用不需要密码登入的账号时，那么那个</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 账号的存放档案所在档名！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Allowusers root@222.XX.XX.XX. </span><span class="token comment" style="color:rgb(98, 114, 164)">#设置允许root帐号只能以222.XX.XX.XX这个IP进行ssh连接</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 认证部分</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RhostsAuthentication no　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 本机系统不止使用 .rhosts ，因为仅使用 .rhosts 太</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 不安全了，所以这里一定要设定为 no ！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">IgnoreRhosts </span><span class="token function" style="color:rgb(80, 250, 123)">yes</span><span class="token plain">　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 是否取消使用 ~/.ssh/.rhosts 来做为认证！当然是！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RhostsRSAAuthentication no </span><span class="token comment" style="color:rgb(98, 114, 164)"># 这个选项是专门给 version 1 用的，使用 rhosts 档案在</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># /etc/hosts.equiv配合 RSA 演算方式来进行认证！不要使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HostbasedAuthentication no </span><span class="token comment" style="color:rgb(98, 114, 164)"># 这个项目与上面的项目类似，不过是给 version 2 使用的！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">IgnoreUserKnownHosts no　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 是否忽略家目录内的 ~/.ssh/known_hosts 这个档案所记录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 的主机内容？当然不要忽略，所以这里就是 no 啦！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PasswordAuthentication </span><span class="token function" style="color:rgb(80, 250, 123)">yes</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># 密码验证当然是需要的！所以这里写 yes 啰！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PermitEmptyPasswords no　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 若上面那一项如果设定为 yes 的话，这一项就最好设定</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 为 no ，这个项目在是否允许以空的密码登入！当然不许！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ChallengeResponseAuthentication </span><span class="token function" style="color:rgb(80, 250, 123)">yes</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># 挑战任何的密码认证！所以，任何 login.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 规定的认证方式，均可适用！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#PAMAuthenticationViaKbdInt yes      # 是否启用其它的 PAM 模块！启用这个模块将会</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 导致 PasswordAuthentication 设定失效！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 与 Kerberos 有关的参数设定！因为我们没有 Kerberos 主机，所以底下不用设定！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#KerberosAuthentication no</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#KerberosOrLocalPasswd yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#KerberosTicketCleanup yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#KerberosTgtPassing no</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 底下是有关在 X-Window 底下使用的相关设定！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">X11Forwarding </span><span class="token function" style="color:rgb(80, 250, 123)">yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#X11DisplayOffset 10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#X11UseLocalhost yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 登入后的项目：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PrintMotd no              </span><span class="token comment" style="color:rgb(98, 114, 164)"># 登入后是否显示出一些信息呢？例如上次登入的时间、地点等</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 等，预设是 yes ，但是，如果为了安全，可以考虑改为 no ！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PrintLastLog </span><span class="token function" style="color:rgb(80, 250, 123)">yes</span><span class="token plain">　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 显示上次登入的信息！可以啊！预设也是 yes ！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">KeepAlive </span><span class="token function" style="color:rgb(80, 250, 123)">yes</span><span class="token plain">　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 一般而言，如果设定这项目的话，那么 SSH Server 会传送</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># KeepAlive 的讯息给 Client 端，以确保两者的联机正常！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 在这个情况下，任何一端死掉后， SSH 可以立刻知道！而不会</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 有僵尸程序的发生！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">UsePrivilegeSeparation </span><span class="token function" style="color:rgb(80, 250, 123)">yes</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># 使用者的权限设定项目！就设定为 yes 吧！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MaxStartups </span><span class="token number">10</span><span class="token plain">　　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 同时允许几个尚未登入的联机画面？当我们连上 SSH ，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 但是尚未输入密码时，这个时候就是我们所谓的联机画面啦！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 在这个联机画面中，为了保护主机，所以需要设定最大值，</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 预设最多十个联机画面，而已经建立联机的不计算在这十个当中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 关于使用者抵挡的设定项目：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DenyUsers *　　　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 设定受抵挡的使用者名称，如果是全部的使用者，那就是全部</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">　　　　　　　　　　　　　</span><span class="token comment" style="color:rgb(98, 114, 164)"># 挡吧！若是部分使用者，可以将该账号填入！例如下列！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DenyUsers </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DenyGroups </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">test</span><span class="token plain">　　　　　 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 与 DenyUsers 相同！仅抵挡几个群组而已！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 关于 SFTP 服务的设定项目！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Subsystem       </span><span class="token function" style="color:rgb(80, 250, 123)">sftp</span><span class="token plain">    /usr/lib/ssh/sftp-server</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">如果不愿意开放 SFTP 的话，将这一行批注掉即可！</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/linux">Linux</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2016/08/13/Script-Install-LNMP">Use Script Install LNMP</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-08-13T06:12:43.000Z" itemprop="datePublished">August 13, 2016</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$1</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;uninstall&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;starting backup data...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain"> -p /www/backup</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> mysqld stop</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> nginxd stop</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> httpd stop</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> wdapache stop</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> pureftpd stop</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> zcvf /www/backup/mysqldatdbk.tar.gz /www/wdlinux/mysql/var</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> zcvf /www/backup/ngconfbk.tar.gz /www/wdlinux/nginx/conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> zcvf /www/backup/apconfbk.tar.gz /www/wdlinux/apache/conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">rpm</span><span class="token plain"> -e lanmp_wdcp --nodeps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">rm</span><span class="token plain"> -fr /www/wdlinux</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot; lanmp,wdcp remove is OK&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Turn off selinux...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">setenforce </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sed</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27;</span><span class="token plain"> /etc/selinux/config</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sed</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;s/^exclude=/#exclude=/g&#x27;</span><span class="token plain"> /etc/yum.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yum </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y gcc gcc-c++ </span><span class="token function" style="color:rgb(80, 250, 123)">make</span><span class="token plain"> autoconf libtool-ltdl-devel gd-devel freetype-devel libxml2-devel libjpeg-devel libpng-devel openssl-devel curl-devel patch libmcrypt-devel libmhash-devel ncurses-devel </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">bzip2</span><span class="token plain"> iptables </span><span class="token function" style="color:rgb(80, 250, 123)">sendmail</span><span class="token plain"> iptables </span><span class="token function" style="color:rgb(80, 250, 123)">unzip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#echo &quot;Check the network...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#ping -c 2 113.105.167.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#if [[ $? != 0 ]];then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># echo &quot;network err&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># exit 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">ping</span><span class="token plain"> -c </span><span class="token number">3</span><span class="token plain"> dl.wdlinux.cn</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$?</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;dns error&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token operator">!</span><span class="token plain"> -d /www/wdlinux </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;rpm remove...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">rpm</span><span class="token plain"> -e php --nodeps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">rpm</span><span class="token plain"> -e httpd --nodeps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">rpm</span><span class="token plain"> -e mysql-server --nodeps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">rpm</span><span class="token plain"> -e mysql --nodeps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;yum update...&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yum </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y </span><span class="token function" style="color:rgb(80, 250, 123)">make</span><span class="token plain"> autoconf </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">wget</span><span class="token plain"> libtool-ltdl-devel gd-devel freetype-devel libxml2-devel libjpeg-devel libpng-devel openssl-devel curl-devel patch libmcrypt-devel libmhash-devel ncurses-devel iptables</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">arch</span><span class="token operator">=</span><span class="token plain">i386</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">Aurl</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;http://dl.wdlinux.cn:5180/rpms&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">uname</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> -m</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;x86_64&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">arch</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;x86_64&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(80, 250, 123)">in_finsh</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;          configuration ,lamp or lnmp,wdcp install is finshed&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;          visit http://ip&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;          wdcp visit http://ip:8080&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;          more infomation please visit http://www.wdlinux.cn&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(80, 250, 123)">in_check</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$1</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;============  </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$2</span><span class="token string" style="color:rgb(255, 121, 198)"> install error  =============&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;============  </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$2</span><span class="token string" style="color:rgb(255, 121, 198)"> install OK  ==============&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> -E </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;wdOS 1|5\.&#x27;</span><span class="token plain"> /etc/redhat-release </span><span class="token operator">&gt;</span><span class="token plain"> /dev/null </span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">v1</span><span class="token operator">=</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> -E </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;wdOS 2|6\.&#x27;</span><span class="token plain"> /etc/redhat-release </span><span class="token operator">&gt;</span><span class="token plain"> /dev/null </span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">v2</span><span class="token operator">=</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$v1</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">RF</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;lanmp_wdcp-2-5.</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$arch</span><span class="token string" style="color:rgb(255, 121, 198)">.rpm&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">elif</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$v2</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">RF</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;lanmp_wdcp-2-5.el6.</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$arch</span><span class="token string" style="color:rgb(255, 121, 198)">.rpm&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$arch</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;x86_64&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">wget</span><span class="token plain"> -c http://dl.wdlinux.cn:5180/soft/rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">rpm</span><span class="token plain"> -ivh rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">wget</span><span class="token plain"> -c http://dl.wdlinux.cn:5180/soft/rpmforge-release-0.5.2-2.el6.rf.i686.rpm</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">rpm</span><span class="token plain"> -ivh rpmforge-release-0.5.2-2.el6.rf.i686.rpm</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> yum </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y mhash-devel libmcrypt-devel</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;The current system does not support&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">wget</span><span class="token plain"> -c http://dl.wdlinux.cn:5180/rpms/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">rpm</span><span class="token plain"> -ivh </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$RF</span><span class="token plain"> --nodeps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">I_F</span><span class="token operator">=</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$I_F</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">in_check </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$I_F</span><span class="token plain"> lanmp_wdcp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">rm</span><span class="token plain"> -f wdcp_v*</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">wget</span><span class="token plain"> -c http://down.wdlinux.cn/down/wdcp_v2.5.tar.gz </span><span class="token operator">&gt;</span><span class="token plain"> /dev/null </span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> zxvf wdcp_v2.5.tar.gz -C / </span><span class="token operator">&gt;</span><span class="token plain"> /dev/null </span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">in_finsh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/linux">Linux</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2016/07/27/Manage-Tomcat-Service-Use-Shell-Script">Manage Tomcat Service Use Shell Script</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-07-27T02:18:24.000Z" itemprop="datePublished">July 27, 2016</time> · <!-- -->6 min read</div></header><div class="markdown" itemprop="articleBody"><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tomcat-项目管理交互式脚本">Tomcat 项目管理交互式脚本<a href="#tomcat-项目管理交互式脚本" class="hash-link" aria-label="Direct link to Tomcat 项目管理交互式脚本" title="Direct link to Tomcat 项目管理交互式脚本">​</a></h4><ul><li>Install pssh</li><li>Use Key Login Server Hosts</li><li>~/.ssh/config 配置使用 host 名登录服务</li><li>指定 Server Group Files 存放位置</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Author Alex LU</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Date 2016-07-20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Version 1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># HostFile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">HostDIR</span><span class="token operator">=~</span><span class="token plain">/.ssh/host/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># war包上传到该目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># /warfolder</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">jobs_select (){</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    STRING=``cat $vmname | grep group</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    if [ -z &quot;$STRING&quot; ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        job_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    else</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">        job2_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">    fi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(80, 250, 123)">HOST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;############ Host List ###############&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ckgroup:ck01,ck02,ck03,ck04&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;sjgroup:sj01,sj02,sj03,sj04&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ddgroup:dd01,dd02,dd03,dd04&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;htgroup:ht01,ht02&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;othergroup:report,tg&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;######################################&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot; Tips: 如果要选择ck01，则输入ck01即可，如果输入ck组，输入ckgroup即可,如果要退出当前脚本输入exit&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot; Tips: 退回上一步请输入back&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">read</span><span class="token plain"> -p </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;请输入你的选择:&quot;</span><span class="token plain"> vmname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ck01</span><span class="token operator">|</span><span class="token plain">ck02</span><span class="token operator">|</span><span class="token plain">ck03</span><span class="token operator">|</span><span class="token plain">ck04</span><span class="token operator">|</span><span class="token plain">sj01</span><span class="token operator">|</span><span class="token plain">sj02</span><span class="token operator">|</span><span class="token plain">sj03</span><span class="token operator">|</span><span class="token plain">sj04</span><span class="token operator">|</span><span class="token plain">dd01</span><span class="token operator">|</span><span class="token plain">dd02</span><span class="token operator">|</span><span class="token plain">dd03</span><span class="token operator">|</span><span class="token plain">dd04</span><span class="token operator">|</span><span class="token plain">report</span><span class="token operator">|</span><span class="token plain">tg</span><span class="token operator">|</span><span class="token plain">ht01</span><span class="token operator">|</span><span class="token plain">ht02</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            job_tomcat </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ckgroup</span><span class="token operator">|</span><span class="token plain">sjgroup</span><span class="token operator">|</span><span class="token plain">htgroup</span><span class="token operator">|</span><span class="token plain">ddgroup</span><span class="token operator">|</span><span class="token plain">othergroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            job2_tomcat </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        back</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">clear</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        *</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;请输入的选择!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            HOST</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">esac</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(80, 250, 123)">job_tomcat</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;############ 动作 ###############&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;  1. 查看当前tomcat7状态&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;  2. 关闭tomcat7&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;  3. 启动tomcat7&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;  4. 重启tomcat7&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;  5. 获取最近200行日志&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;  6. 重新选择主机&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;  7. 回到顶层目录&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;#################################&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">read</span><span class="token plain"> -p </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;请输入你的选择:&quot;</span><span class="token plain"> service_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$service_tomcat</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -H </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ps aux | grep tomcat&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        job_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -H </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;service tomcat7 stop&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># tips： 下面grep的字符串要和你的tomcat项目名称契合</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -H </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ps aux | grep tomcat7 | awk &#x27;{print </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$2</span><span class="token string" style="color:rgb(255, 121, 198)">}&#x27; | xargs kill -9 &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># tips: 下面用到的路径为绝对路径，请更改为自己tomcat的目录，也可以在前面增加自定义变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -H </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;rm -rf /tomcat7/work/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -H </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;rm -rf /tomcat7/logs/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -H </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;rm -rf /tomcat7/temp/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        job_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -H </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;service tomcat7 start&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        job_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -H </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;service tomcat7 stop&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># tips： 下面grep的字符串要和你的tomcat项目名称契合</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -H </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ps aux | grep tomcat7 | awk &#x27;{print </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$2</span><span class="token string" style="color:rgb(255, 121, 198)">}&#x27; | xargs kill -9 &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># tips: 下面用到的路径为绝对路径，请更改为自己tomcat的目录，也可以在前面增加自定义变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -H </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;rm -rf /tomcat7/work/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -H </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;rm -rf /tomcat7/logs/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -H </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;rm -rf /tomcat7/temp/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">sleep</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -H </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;service tomcat7 start&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        job_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -H </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;tail -n 200 /tomcat7/logs/catalina.out&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        job_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        HOST</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">clear</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        *</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;请输入正确的选项！&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        job_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">esac</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(80, 250, 123)">job2_tomcat</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;############ 动作 ###############&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;  1. 查看当前tomcat7状态&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;  2. 关闭tomcat7&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;  3. 启动tomcat7&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;  4. 重启tomcat7&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;  5. 获取最近200行日志&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;  6. 重新选择主机&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;  7. 回到顶层目录&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;################################&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">read</span><span class="token plain"> -p </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;请输入你的选择:&quot;</span><span class="token plain"> service_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$service_tomcat</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ps aux | grep tomcat&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        job2_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;service tomcat7 stop&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># tips： 下面grep的字符串要和你的tomcat项目名称契合</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ps aux | grep tomcat7 | awk &#x27;{print </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$2</span><span class="token string" style="color:rgb(255, 121, 198)">}&#x27; | xargs kill -9 &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># tips: 下面用到的路径为绝对路径，请更改为自己tomcat的目录，也可以在前面增加自定义变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;rm -rf /tomcat7/work/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;rm -rf /tomcat7/logs/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;rm -rf /tomcat7/temp/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        job2_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;service tomcat7 start&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        job2_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;service tomcat7 stop&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># tips： 下面grep的字符串要和你的tomcat项目名称契合</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ps aux | grep tomcat7 | awk &#x27;{print </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$2</span><span class="token string" style="color:rgb(255, 121, 198)">}&#x27; | xargs kill -9 &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># tips: 下面用到的路径为绝对路径，请更改为自己tomcat的目录，也可以在前面增加自定义变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;rm -rf /tomcat7/work/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;rm -rf /tomcat7/logs/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;rm -rf /tomcat7/temp/*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">sleep</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;service tomcat7 start&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        job2_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;tail -n 200 /tomcat7/logs/catalina.out&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        job2_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        HOST</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">clear</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        *</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;请输入正确的选项！&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        job_tomcat</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">esac</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(80, 250, 123)">HOST2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;############ Host List ###############&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ckgroup:ck01,ck02,ck03,ck04&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;sjgroup:sj01,sj02,sj03,sj04&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ddgroup:dd01,dd02,dd03,dd04&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;htgroup:ht01,ht02&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;othergroup:report,tg&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;######################################&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 确认是否所有项目包发布后立即启动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string entity" style="color:rgb(255, 121, 198)">\033</span><span class="token string" style="color:rgb(255, 121, 198)">[7m 更新订单服务器的war包时，会自动启动tomcat程序，为了释放war包，修改order.no，请设置war包内order.no＝0 ,其它服务器tomcat不会自启动，请使用命令操作 </span><span class="token string entity" style="color:rgb(255, 121, 198)">\033</span><span class="token string" style="color:rgb(255, 121, 198)">[0m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot; Tips: 如果要选择ck01，则输入ck01即可，如果输入ck组，输入ckgroup即可,如果要退出当前脚本输入exit&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot; Tips: 退回上一步请输入back&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">read</span><span class="token plain"> -p </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;请输入你的选择:&quot;</span><span class="token plain"> vmname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ck01</span><span class="token operator">|</span><span class="token plain">ck02</span><span class="token operator">|</span><span class="token plain">ck03</span><span class="token operator">|</span><span class="token plain">ck04</span><span class="token operator">|</span><span class="token plain">sj01</span><span class="token operator">|</span><span class="token plain">sj02</span><span class="token operator">|</span><span class="token plain">sj03</span><span class="token operator">|</span><span class="token plain">sj04</span><span class="token operator">|</span><span class="token plain">dd01</span><span class="token operator">|</span><span class="token plain">dd02</span><span class="token operator">|</span><span class="token plain">dd03</span><span class="token operator">|</span><span class="token plain">dd04</span><span class="token operator">|</span><span class="token plain">report</span><span class="token operator">|</span><span class="token plain">tg</span><span class="token operator">|</span><span class="token plain">ht01</span><span class="token operator">|</span><span class="token plain">ht02</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">read</span><span class="token plain"> -p </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;请输入war包的名称,例如:dzcx_ck.war :&quot;</span><span class="token plain"> warname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            pscp_tomcat </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$warname</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ckgroup</span><span class="token operator">|</span><span class="token plain">sjgroup</span><span class="token operator">|</span><span class="token plain">htgroup</span><span class="token operator">|</span><span class="token plain">othergroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">read</span><span class="token plain"> -p </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;请输入war包的名称,例如:dzcx_ck.war :&quot;</span><span class="token plain"> warname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            pscp2_tomcat </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$warname</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ddgroup</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">read</span><span class="token plain"> -p </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;请输入war包的名称,例如:dzcx_ck.war :&quot;</span><span class="token plain"> warname</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            pscp3_tomcat </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$warname</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        back</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token function" style="color:rgb(80, 250, 123)">clear</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        *</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;请输入的选择!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            HOST</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">esac</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(80, 250, 123)">pscp_tomcat</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># single host</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pscp.pssh -H </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> /warfolder/</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$warname</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> /tomcat7/webapps/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    HOST2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(80, 250, 123)">pscp2_tomcat</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pscp.pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> /warfolder/</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$warname</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> /tomcat7/webapps/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    HOST2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(80, 250, 123)">pscp3_tomcat</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># group dd 因为订单需要修改服务器编号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pscp.pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> /warfolder/</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$warname</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> /tomcat7/webapps/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$vmname</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;service tomcat7 start&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">sleep</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pssh -H dd02 </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;sed -i &#x27;s/order.no=0/order.no=1/g&#x27; /tomcat7/webapps/dzcx_socket/WEB-INF/classes/base.properties&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pssh -H dd03 </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;sed -i &#x27;s/order.no=0/order.no=2/g&#x27; /tomcat7/webapps/dzcx_socket/WEB-INF/classes/base.properties&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pssh -H dd04 </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;sed -i &#x27;s/order.no=0/order.no=3/g&#x27; /tomcat7/webapps/dzcx_socket/WEB-INF/classes/base.properties&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    HOST2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(80, 250, 123)">main</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;######################################&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;#  1. 更新war包&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;#  2. 管理tomcat7&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;#  3. 管理mysql&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;#  4. 管理redis&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;#  5. 同步服务器时间&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;#  6. 清理当前屏幕&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;#  7. 退出&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;######################################&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">read</span><span class="token plain"> -p </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;请输入你的选择:&quot;</span><span class="token plain"> num</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$num</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        HOST2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        HOST</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;该功能暂未开放&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;该功能暂未开放&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pssh -h </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$HostDIR</span><span class="token plain">/allhost -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;service ntpd restart&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token function" style="color:rgb(80, 250, 123)">clear</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    *</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;请输入正确的数值！&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">esac</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># --------------------------------- main -------------------------------------------------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">clear</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Tips: 欢迎使用Tomcat项目服务管理工具,您需要预先安装pssh工具，以及配置好ssh免密登录到服务器&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">command</span><span class="token plain"> -v pssh </span><span class="token operator">&gt;</span><span class="token plain"> /dev/null </span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$?</span><span class="token plain"> -eq </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    main</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string entity" style="color:rgb(255, 121, 198)">\033</span><span class="token string" style="color:rgb(255, 121, 198)">[07m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;系统检测到您还没安装pssh，请预先安装pssh&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;yum install -y epel-release&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;yum install -y pssh&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;安装成功请重新运行此脚本&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string entity" style="color:rgb(255, 121, 198)">\033</span><span class="token string" style="color:rgb(255, 121, 198)">[0m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/linux">Linux</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2016/07/05/HowTo-Use-Fuse-sshfs-to-Mount-Remote-Filesystems">HowTo Use Fuse-sshfs to Mount Remote Filesystems</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-07-05T01:58:03.000Z" itemprop="datePublished">July 5, 2016</time> · <!-- -->3 min read</div></header><div class="markdown" itemprop="articleBody"><p>传统我们服务器之间文件共享的方式有采用 NFS、Samba 等等，但是在我看来配置都有一定的复杂性，当然复杂也有它们的优势，这里推荐一个依赖于 SSH 的文件共享工具，Fuse-sshfs。
SSH 是一个强大且安全的工具，我们除了可以用它来远程管理主机外，还可以通过它建立 SSH tunnel 作 Proxy 用，远程传输文件等等。而这里我想要介绍另外一个功能，那就是结合 sshfs 这个工具可以把远程主机的文件系统映射到本地主机上，透过 SSH 把远程文件系统挂载到本机上，这样我们可以不必使用 scp 工具就可以做到直接复制及删除远程主机的文件了，就像操作本地磁盘一样方便。
sshfs 是基于 FUSE 构建的 SSH 文件系统客户端程序，通过它远程主机的配置无需作任何改变，就可以透过 SSH 协议来挂载远程文件系统了，非常方便及安全。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-fuse-sshfs">Install fuse-sshfs<a href="#install-fuse-sshfs" class="hash-link" aria-label="Direct link to Install fuse-sshfs" title="Direct link to Install fuse-sshfs">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">cent@localhost ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> yum </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y epel-relese</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">cent@localhost ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> yum --enablerepo</span><span class="token operator">=</span><span class="token plain">epel </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y fuse-sshfs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="挂载远程-ssh-文件系统">挂载远程 ssh 文件系统<a href="#挂载远程-ssh-文件系统" class="hash-link" aria-label="Direct link to 挂载远程 ssh 文件系统" title="Direct link to 挂载远程 ssh 文件系统">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">cent@localhost ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain"> ./mnt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">cent@localhost ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$ sshfs root@192.168.16.230:/home/ ./mnt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@192.168.16.230&#x27;s password:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">cent@localhost ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">mount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@192.168.16.230:/home/ on /home/cent/mnt </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">type</span><span class="token plain"> fuse.sshfs </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">rw,nosuid,nodev,user</span><span class="token operator">=</span><span class="token plain">cent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="卸载远程-ssh-文件系统">卸载远程 ssh 文件系统<a href="#卸载远程-ssh-文件系统" class="hash-link" aria-label="Direct link to 卸载远程 ssh 文件系统" title="Direct link to 卸载远程 ssh 文件系统">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">cent@localhost ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$ fusermount -u ./mnt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="常用参数">常用参数<a href="#常用参数" class="hash-link" aria-label="Direct link to 常用参数" title="Direct link to 常用参数">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">-C 压缩，或者-o </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">compression</span><span class="token operator">=</span><span class="token plain">yes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-o reconnect 自动重连</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-o transform_symlinks 表示转换绝对链接符号为相对链接符号</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-o follow_symlinks 沿用服务器上的链接符号</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-o </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">cache</span><span class="token operator">=</span><span class="token plain">yes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-o allow_other 这个参数最重要，必须写，否则任何文件都是Permission Deny</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="缺点"> 缺点<a href="#缺点" class="hash-link" aria-label="Direct link to  缺点" title="Direct link to  缺点">​</a></h2><p>当然 sshfs 也不尽是优点，例如远程主机失去响应后本地挂载点卡死并影响本地系统使用，需要手工找出 sshfs 进程并杀死，因网速问题造成操作响应缓慢等等，不过一般在稳定快速的网络中不太会遇上，对比其强大的功能，还是可以接受的，正所谓暇不掩瑜。</p><ol><li>所以 sshfs 适合内部网络比较稳定的地方</li><li>配合 ssh 免密登录使用会更好哦</li><li>可以看到的是 sshfs 默认挂载是 rw 的权限，但是通过 sshfs --help 可以看到有非常详尽的参数配置可以选择，大家可以仔细研究下。</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="附-1">附 1<a href="#附-1" class="hash-link" aria-label="Direct link to 附 1" title="Direct link to 附 1">​</a></h2><p><a href="http://igikorn.com/sshfs-windows-8/" target="_blank" rel="noopener noreferrer">Link</a> 在 windows 下可以使用 sshfs.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/linux">Linux</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2016/06/16/shi-yong-mosh-dai-ti-ssh-lian-jie-fu-wu-qi">使用 mosh 代替 ssh 连接服务器</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-06-16T02:28:02.000Z" itemprop="datePublished">June 16, 2016</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><p>身为一名服务器运维人员，每天打交道最多的就是服务器了，最常用的连接服务器的工具就是 SSH，因为 SSH 是一个不可持续的连接，当网络出现波动时，SSH 断开会导致当前正在运行的服务中断，对工作产生非常大的影响，无意间看到了 Mosh 这个东西，安装使用下，发现网络波动这种事情不会导致服务器连接断开了，特意查了下，原来 Mosh 使用的是 UDP 方式传输：虽然也支持使用 SSH 配置进行认证登录，但是数据传输本身是使用 UDP 方式的，Mosh 支持在会话中断时，不会立即退出，而是启用一个计时器，当网络恢复后会自动连接，同时会延续之前的会话，不会重新开启一个。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mosh-主页">Mosh <a href="https://mosh.mit.edu/#getting" target="_blank" rel="noopener noreferrer">主页</a><a href="#mosh-主页" class="hash-link" aria-label="Direct link to mosh-主页" title="Direct link to mosh-主页">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-安装配置">1. 安装配置<a href="#1-安装配置" class="hash-link" aria-label="Direct link to 1. 安装配置" title="Direct link to 1. 安装配置">​</a></h2><p>需要在服务端和客户端同时安装 Mosh：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">＃ 以centos </span><span class="token number">6</span><span class="token plain">.x 为例：</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">user@host ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> yum </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y epel-release</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">user@host ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> yum </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y mosh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-采用-ssh-配置进行认证登录只需要将-ssh-替换为-mosh-即可">2. 采用 SSH 配置进行认证登录，只需要将 ssh 替换为 mosh 即可<a href="#2-采用-ssh-配置进行认证登录只需要将-ssh-替换为-mosh-即可" class="hash-link" aria-label="Direct link to 2. 采用 SSH 配置进行认证登录，只需要将 ssh 替换为 mosh 即可" title="Direct link to 2. 采用 SSH 配置进行认证登录，只需要将 ssh 替换为 mosh 即可">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">user@host ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$ mosh user@host</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 如何需要指定特定的ssh port或者使用ssh keyfile. 可以使用-ssh参数：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">user@host ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$ mosh -ssh</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ssh -i ~/.ssh/id_rsa -p 10002&quot;</span><span class="token plain"> user@host</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-other">3. Other<a href="#3-other" class="hash-link" aria-label="Direct link to 3. Other" title="Direct link to 3. Other">​</a></h2><p>另外 Mosh 还支持使用临时 key 的方式认证，需要服务器端创建临时 key，然后客户端通过这个 key 进行登录，该 key 在会话结束的十分钟后自动失效。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 创建临时key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">user@host ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$ mosh-server</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MOSH CONNECT </span><span class="token number">53371</span><span class="token plain"> asdAADfdse234LSDSdIbow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mosh-server </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">mosh </span><span class="token number">1.2</span><span class="token plain">.4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Copyright </span><span class="token number">2012</span><span class="token plain"> Keith Winstein </span><span class="token operator">&lt;</span><span class="token plain">mosh-devel@mit.edu</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">License GPLv3+: GNU GPL version </span><span class="token number">3</span><span class="token plain"> or later </span><span class="token operator">&lt;</span><span class="token plain">http://gnu.org/licenses/gpl.html</span><span class="token operator">&gt;</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">This is </span><span class="token function" style="color:rgb(80, 250, 123)">free</span><span class="token plain"> software: you are </span><span class="token function" style="color:rgb(80, 250, 123)">free</span><span class="token plain"> to change and redistribute it.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">There is NO WARRANTY, to the extent permitted by law.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">mosh-server detached, pid </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">27290</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 然后在client定义MOSH_KEY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">user@host ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">MOSH_KEY</span><span class="token operator">=</span><span class="token plain">asdAADfdse234LSDSdIbow</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 注意mosh-client只能跟上具体的ip和临时端口，不支持主机名和域名方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 使用临时key连接服务器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">user@host ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$ mosh-client </span><span class="token number">10.0</span><span class="token plain">.2.4 </span><span class="token number">53371</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/linux">Linux</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2016/03/29/linux-zhong-de-san-ge-te-shu-quan-xian">Linux 中的三个特殊权限</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-03-29T07:50:36.000Z" itemprop="datePublished">March 29, 2016</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="权限介绍">权限介绍<a href="#权限介绍" class="hash-link" aria-label="Direct link to 权限介绍" title="Direct link to 权限介绍">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Linux中除了普通权限之外，还有三个特殊权限。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SUID:：以文件的所属用户执行，而非执行文件的用户，多用于可执行文件，设置suid后，在权限位中，所属用户的  最后一个权</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">限为变为s，添加SUID权限可用“+s”表示。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">例如：passwd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">adam@ultraera  ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$  </span><span class="token function" style="color:rgb(80, 250, 123)">which</span><span class="token plain">  </span><span class="token function" style="color:rgb(80, 250, 123)">passwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/usr/bin/passwd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">adam@ultraera  ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$  </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain">  -l  /usr/bin/passwd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rwsr-xr-x.  </span><span class="token number">1</span><span class="token plain">  root  root  </span><span class="token number">25980</span><span class="token plain">  Feb  </span><span class="token number">22</span><span class="token plain">  </span><span class="token number">2012</span><span class="token plain">  /usr/bin/passwd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">adam@ultraera  ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SGID：主要针对文件夹，在设置了SGID的文件夹中创建任何新文件都继承该文件的所属组，设置sgid后，在权限位中，所属</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">组的最后一个权限位变为s，添加SGID权限可用“+s”表示。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">例如：</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">adam@ultraera  ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$  </span><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain">  ultraera</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">adam@ultraera  ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$  </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain">  -l</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total  </span><span class="token number">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxrwxr-x  </span><span class="token number">2</span><span class="token plain">  adam  adam  </span><span class="token number">4096</span><span class="token plain">  Nov  </span><span class="token number">27</span><span class="token plain">  </span><span class="token number">21</span><span class="token plain">:09  ultraera</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">adam@ultraera  ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$  </span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain">  g+s  ultraera/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">adam@ultraera  ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$  </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain">  -l</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total  </span><span class="token number">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxrwsr-x  </span><span class="token number">2</span><span class="token plain">  adam  adam  </span><span class="token number">4096</span><span class="token plain">  Nov  </span><span class="token number">27</span><span class="token plain">  </span><span class="token number">21</span><span class="token plain">:09  ultraera</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">adam@ultraera  ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$  </span><span class="token function" style="color:rgb(80, 250, 123)">su</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Password:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera  adam</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)">#  mkdir  -p  ultraera/test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera  adam</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)">#  ls  -l  ultraera/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total  </span><span class="token number">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxr-sr-x  </span><span class="token number">2</span><span class="token plain">  root  adam  </span><span class="token number">4096</span><span class="token plain">  Nov  </span><span class="token number">27</span><span class="token plain">  </span><span class="token number">21</span><span class="token plain">:09  </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera  adam</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sticky：针对文件夹，对目录拥有写权限的用户，仅可以删除其所拥有的文件，无法删除其他用户所拥有的文件，设置了sticky</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">之后，在权限位，other的最后一个权限位变为t,添加SGID权限可用“+t”表示。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">例如：</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera  tmp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)">#  mkdir  ultraera</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera  tmp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)">#  chmod  a=rwx,o+t  ultraera/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera  tmp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)">#  ls  -ld  ultraera/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxrwxrwt  </span><span class="token number">2</span><span class="token plain">  root  root  </span><span class="token number">4096</span><span class="token plain">  Nov  </span><span class="token number">27</span><span class="token plain">  </span><span class="token number">21</span><span class="token plain">:29  ultraera/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera  tmp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)">#  useradd  user1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera  tmp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)">#  useradd  user2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera  tmp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)">#  su  user1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">user1@ultraera  tmp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$  </span><span class="token function" style="color:rgb(80, 250, 123)">touch</span><span class="token plain">  ./ultraera/test</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">user1@ultraera  tmp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$  </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain">  -l  ultraera/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total  </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-rw-r--  </span><span class="token number">1</span><span class="token plain">  user1  user1  </span><span class="token number">0</span><span class="token plain">  Nov  </span><span class="token number">27</span><span class="token plain">  </span><span class="token number">21</span><span class="token plain">:31  </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">user1@ultraera  tmp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$  </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera  tmp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)">#  su  user2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">user2@ultraera  tmp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$  </span><span class="token function" style="color:rgb(80, 250, 123)">rm</span><span class="token plain">  -f  ./ultraera/test</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rm:  cannot  remove  `./ultraera/test&#x27;:  Operation  not  permitted</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">user2@ultraera  tmp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">$</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">同样使用chmod来设定特殊权限，与普通权限一样，特殊权限也可以用数字表示：</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">suid  ：  </span><span class="token number">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sgid  ：  </span><span class="token number">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sticky ：  </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain">  </span><span class="token number">4644</span><span class="token plain">  filename </span><span class="token comment" style="color:rgb(98, 114, 164)">#设置文件suid权限</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain">  </span><span class="token number">2755</span><span class="token plain">  flodername </span><span class="token comment" style="color:rgb(98, 114, 164)">#设置文件夹sgid权限</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain">  </span><span class="token number">1755</span><span class="token plain">  flodername </span><span class="token comment" style="color:rgb(98, 114, 164)">#设置文件夹sticky权限</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/linux">Linux</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2016/03/24/zai-centos-zhong-pei-zhi-sftp-huan-jing">在 CentOS 中配置 SFTP 环境</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-03-24T14:55:03.000Z" itemprop="datePublished">March 24, 2016</time> · <!-- -->3 min read</div></header><div class="markdown" itemprop="articleBody"><p>做运维工作的，应该经常会碰到这样的问题，需要新上一个 web 项目，需要上传文件到服务器上，解决方法有很多种，常见的如 sftp 和 ftp，今天讲如何使用 sftp 让系统用户用户上传项目的权限，并且实现 chroot 和无法使用 ssh 登录到系统。</p><p>SFTP 是指 SSH 文件传输协议（SSH File Transfer protocol）或安全文件传输协议（Secure File Transfer Protocol），它提供了可信数据流下的文件访问、文件传输以及文件管理功能。当我们为 SFTP 配置 chroot 环境后，只有被许可的用户可以访问，并被限制到他们的家目录中，换言之：被许可的用户将处于牢笼环境中，在此环境中它们甚至不能切换它们的目录。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-测试环境">1. 测试环境<a href="#1-测试环境" class="hash-link" aria-label="Direct link to 1. 测试环境" title="Direct link to 1. 测试环境">​</a></h2><ul><li>MacBook Pro 15-inch i7 16GB</li><li>VMware Fushion 8 Pro</li><li>Transmit ( SFTP tools for Mac )</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># cat /etc/issue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CentOS release </span><span class="token number">6.6</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">Final</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Kernel </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">r on an </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># rpm -qa | grep openssh-server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">openssh-server-5.3p1-104.el6.i686</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-实验步骤">2. 实验步骤<a href="#2-实验步骤" class="hash-link" aria-label="Direct link to 2. 实验步骤" title="Direct link to 2. 实验步骤">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-增加一个-sftpusers-用户组">2.1 增加一个 sftpusers 用户组<a href="#21-增加一个-sftpusers-用户组" class="hash-link" aria-label="Direct link to 2.1 增加一个 sftpusers 用户组" title="Direct link to 2.1 增加一个 sftpusers 用户组">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># groupadd sftpusers</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-创建一个用户-user01并分配给-sftpusers-用户组">2.2 创建一个用户 user01，并分配给 sftpusers 用户组<a href="#22-创建一个用户-user01并分配给-sftpusers-用户组" class="hash-link" aria-label="Direct link to 2.2 创建一个用户 user01，并分配给 sftpusers 用户组" title="Direct link to 2.2 创建一个用户 user01，并分配给 sftpusers 用户组">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># useradd -g sftpusers user01</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-修改用户家目录及指定不能登录-shell">2.3 修改用户家目录及指定不能登录 shell<a href="#23-修改用户家目录及指定不能登录-shell" class="hash-link" aria-label="Direct link to 2.3 修改用户家目录及指定不能登录 shell" title="Direct link to 2.3 修改用户家目录及指定不能登录 shell">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># mkdir /sftp/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># usermod -s /sbin/nologin -d /sftp/user01 -m user01</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-给用户创建密码注意密码不明文显示">2.4 给用户创建密码（注意密码不明文显示）<a href="#24-给用户创建密码注意密码不明文显示" class="hash-link" aria-label="Direct link to 2.4 给用户创建密码（注意密码不明文显示）" title="Direct link to 2.4 给用户创建密码（注意密码不明文显示）">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># passwd user01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Changing password </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> user user01.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">New password:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BAD PASSWORD: it is too simplistic/systematic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BAD PASSWORD: is too simple</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Retype new password:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">passwd: all authentication tokens updated successfully.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)">#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="25-修改-ssh-的配置文件如下设置">2.5 修改 ssh 的配置文件，如下设置<a href="#25-修改-ssh-的配置文件如下设置" class="hash-link" aria-label="Direct link to 2.5 修改 ssh 的配置文件，如下设置" title="Direct link to 2.5 修改 ssh 的配置文件，如下设置">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># ll /etc/ssh/sshd_config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-------. </span><span class="token number">1</span><span class="token plain"> root root </span><span class="token number">3879</span><span class="token plain"> Oct </span><span class="token number">15</span><span class="token plain">  </span><span class="token number">2014</span><span class="token plain"> /etc/ssh/sshd_config</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># vim /etc/ssh/sshd_config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># line 132</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#Subsystem      sftp    /usr/libexec/openssh/sftp-server    #注释</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Subsystem       </span><span class="token function" style="color:rgb(80, 250, 123)">sftp</span><span class="token plain">    internal-sftp        </span><span class="token comment" style="color:rgb(98, 114, 164)">#修改为internal-sftp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># add this lines at the end of file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Match Group sftpusers        </span><span class="token comment" style="color:rgb(98, 114, 164)">#指定一下参数仅适用的用户组sftpusers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    X11Forwarding no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    AllowTcpForwarding no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ChrootDirectory %h       </span><span class="token comment" style="color:rgb(98, 114, 164)">#设置chroot将用户锁在家目录，%h=家目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ForceCommand internal-sftp    </span><span class="token comment" style="color:rgb(98, 114, 164)">#该参数强制执行内部sftp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="26-重启-ssh-服务">2.6 重启 ssh 服务<a href="#26-重启-ssh-服务" class="hash-link" aria-label="Direct link to 2.6 重启 ssh 服务" title="Direct link to 2.6 重启 ssh 服务">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># /etc/init.d/sshd restart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Stopping sshd:                                             </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">  OK  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Starting sshd:                                             </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">  OK  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="27-设置用户家目录权限注意权限不能大于-0755">2.7 设置用户家目录权限，(注意权限不能大于 0755)<a href="#27-设置用户家目录权限注意权限不能大于-0755" class="hash-link" aria-label="Direct link to 2.7 设置用户家目录权限，(注意权限不能大于 0755)" title="Direct link to 2.7 设置用户家目录权限，(注意权限不能大于 0755)">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chmod 0755 /sftp/user01/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chown root /sftp/user01/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chgrp -R sftpusers /sftp/user01/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="28-关于上传根目录无法上传文件">2.8 关于上传，根目录无法上传文件<a href="#28-关于上传根目录无法上传文件" class="hash-link" aria-label="Direct link to 2.8 关于上传，根目录无法上传文件" title="Direct link to 2.8 关于上传，根目录无法上传文件">​</a></h3><p>因为用户家目录属主是 root，并且权限最大 0755，所以没法写，我的解决方法是在在家目录建立一个文件夹，作为上传目录，并把属主给 user01 即可。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># mkdir /sftp/user01/upload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chown user01:sftpusers /sftp/user01/upload/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-测试验证">3. 测试验证<a href="#3-测试验证" class="hash-link" aria-label="Direct link to 3. 测试验证" title="Direct link to 3. 测试验证">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-linux-登录测试">3.1 Linux 登录测试<a href="#31-linux-登录测试" class="hash-link" aria-label="Direct link to 3.1 Linux 登录测试" title="Direct link to 3.1 Linux 登录测试">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># su - user01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">This account is currently not available.    </span><span class="token comment" style="color:rgb(98, 114, 164)">#su - 切换失败</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># cat /etc/passwd | tail -1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user01:x:500:500::/sftp/user01:/sbin/nologin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># ssh user01@localhost</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">The authenticity of </span><span class="token function" style="color:rgb(80, 250, 123)">host</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;localhost (::1)&#x27;</span><span class="token plain"> can</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;t be established.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">RSA key fingerprint is f3:fc:31:dc:7d:16:d5:ad:8c:bc:eb:69:8f:b2:0b:c9.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">Are you sure you want to continue connecting (yes/no)? yes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">Warning: Permanently added &#x27;</span><span class="token plain">localhost</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27; (RSA) to the list of known hosts.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">user01@localhost&#x27;</span><span class="token plain">s password:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">This </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> allows </span><span class="token function" style="color:rgb(80, 250, 123)">sftp</span><span class="token plain"> connections only.    </span><span class="token comment" style="color:rgb(98, 114, 164)">#ssh登录也失败，ssh设置成功</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Connection to localhost closed.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@test ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># sftp user01@localhost</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Connecting to localhost</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user01@localhost&#x27;s password:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sftp</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">upload</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sftp</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">pwd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Remote working directory: /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sftp</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-sftp-工具测试">3.2 SFTP 工具测试<a href="#32-sftp-工具测试" class="hash-link" aria-label="Direct link to 3.2 SFTP 工具测试" title="Direct link to 3.2 SFTP 工具测试">​</a></h3><p>我这里使用的是 Mac，但是传统的文件传输工具都差不多，Windows 下有 Winscp、Xftp 等。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/linux">Linux</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2016/03/23/linux-bi-shi-shi-ti">Linux 笔试试题</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-03-23T12:05:16.000Z" itemprop="datePublished">March 23, 2016</time> · <!-- -->9 min read</div></header><div class="markdown" itemprop="articleBody"><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">一。选择题（1 题 1 分）</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. 当登录 Linux 时，一个具有唯一进程 ID 号的 shell 将被调用，这个 ID 是什么 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. NID  B. PID  C. UID  D. CID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. 用 vi 打开一个文件，如何用字母&quot;new&quot;来代替字母&quot;old&quot; (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. :s/old/new/g　　　B. :s/old/new　　C. :1,$s/old/new/g　　　D. :r/old/new</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. 请选择对标准的变量 PS2 正确的描述 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. 是一个主 shell 提示符变量    B. 是一个一般的 shell 提示符变量</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">C. 是第二主 shell 提示符变量     D. 是一个连续提示符变量</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. 哪一个命令能用来查找文件 TESTFILE 中只包含四个字符的行？(   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. grep &#x27;^????$&#x27; TESTFILE    B. grep &#x27;????&#x27; TESTFILE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">C. grep &#x27;^....$&#x27; TESTFILE     D. grep &#x27;....&#x27; TESTFILE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. 一个 bash shell 脚本的第一行是什么 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. #!/bin/bash  B. #/bin/bash  C. #/bin/csh   D. /bin/bash</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. 用标准的输出重定向 (&gt;) 像&quot;&gt; file01&quot;能使文件 file01 的数据（   ）</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. 被移动  B. 被复制  C. 被打印   D. 被覆盖</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:D</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. 下面哪个命令是用来定义 shell 的全局变量 (    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. exportfs  B. alias  C. exports  D. export</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:D</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. 如果想加载一个/dev/sdb1的windows95分区到/mnt/win95目录，需要运行哪个命令(   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. mount -t hpfs /dev/sdb1 /mnt/win95</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">B. mount -t hpfs /mnt/win95 /dev/sdb1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">C. mount -t vfat /dev/sdb1 /mnt/win95</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">D. mount -t vfat /mnt/win95 /dev/sdb1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. 哪个文件存放用户密码信息 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. /boot/passwd   B. /etc/shadow   C. /var/passwd  D. /dev/passwd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  假定 kernel 支持 vfat 分区，下面哪一个操作是将/dev/sda1，一个 window98 分区加载到/win 目录 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. mount -s win /dev&#x27;sda1 /win</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">B. mount -fs=msdos /dev/sda1 /win</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">C. mount -t vfat /dev/sda1 /win</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">D. mount -t windows /win /dev/sda1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  默认情况下管理员创建了一个用户，就会在 (   ) 目录下创建一个用户主目录。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. /usr  B. /home   C. /root  D. /etc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  如果要列出一个目录下的所有文件需要使用命令行 (    )。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. ls –l  B. ls   C. ls –a   D. ls -d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  利用哪个工具可以设置用户在文件系统中的空间大小 (   )。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. turboservice  B. turbofscfg  C. turbonetcfg   D. turboxcfg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  哪个命令可以将普通用户转换成超级用户 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. super  B. passwd  C. tar   D. su</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:D</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  哪个命令用来显示/home及其子目录下文件名(   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. ls -R /home  B. ls -d /home  C. ls -a /home    D. ls -l /home</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  在 vi 模式下，哪个命令用来删除光标处的字符 (    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. xd   B. x   C. dd   D. d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:B　　dd删除一行,x删除当前字符</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  在一行内运行多个命令需要用什么字符隔开 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. @  B. $   C. ;  D. *</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  确定 myfile 的文件类型的命令是 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. whatis myfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">B. file myfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">C. type myfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">D. type -q myfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  哪些命令组合起来能统计多少用户登录系统 (    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. who | wc –w   B. who | wc –l   C. who | wc –c   D. who | wc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:BD</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  用 &quot;rm -i&quot;,系统会提示什么来让你确认 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. 命令行的每个选项  B. 是否真的删除  C. 是否有写的权限   D. 文件的位置</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  Linux 启动的第一个进程 init 启动的第一个脚本程序是 (   )。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. /etc/rc.d/init.d   B. /etc/rc.d/rc.sysinit  C. /etc/rc.d/rc5.d  D. /etc/rc.d/rc3.d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  按下 (   ) 键能终止当前运行的命令</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. Ctrl-C   B. Ctrl-F   C. Ctrl-B   D. Ctrl-D</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  用来分离目录名和文件名的字符是 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. dash (-)  B. slash (/)  C. period (.)   D. asterisk (*)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  系统的配置文件在 (  ) 目录下</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. /home   B. /dev  C. /etc   D. /usr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  显示用户的主目录的命令是什么？(   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. echo $HOME  B. echo $USERDIR   C. echo $ENV  D. echo $ECHO</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  在 vi 编辑器里，哪个命令能将光标移到第 200 行 (    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. g200  B. G200  C. :200   D. 200g</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">:200 可以，200G 也可以</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  用&quot;useradd jerry&quot;命令添加一个用户，这个用户的主目录是什么？(   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. /etc/jerry   B. /var/jerry  C. /home/jerry   D. /bin/jerry</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  哪一个命令能用来删除当前目录及其子目录下名为&#x27;core&#x27;的文件 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. find . -name core -exec rm {} \ ;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">B. find . -name core -exec rm ;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">C. find . -name core -exec rm {} ;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">D. find . -name core -exec rm {} -;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  以下哪条命令在创建一个 xp 用户的时候将用户加入到 root 组中 (  )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. useradd -g xp root  B. useradd -r root xp  C. useradd -g root xp   D. useradd root xp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  不改变运行级别而重新读入 inittab 文件的命令是 (    )。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. init s  B. init q  C. init S   D. init Q</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  以下哪个命令可以终止一个用户的所有进程 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. skillall   B. skill  C. kill   D. killall</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:D</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  通过修改哪个文件可以在创建用户的时候改变用 户主目录的路径 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. /etc/default/passwd   B. /etc/default/useradd  C. /etc/profile  D. /etc/fstab</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  以只读方式打开一个文件并进入 vi 编辑器的命令是 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. view -r filename   B. view filename   C. vi filename   D. vi -r filename</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  以下哪个命令是将缓存中的内容粘贴到光标之前 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. a   B. i   C. P   D. p</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  以下哪条 vi 命令能将文档 5-20 行间出现的 abc 替换成为 cba (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. :1,$s/abc/cba/g　　　B. :5,20/abc/cba/g　　C. :5-20s/abc/cba/g　　　D. :5,20s/abc/cba/g</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:D</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">. 在 vi 中通过哪条命令可以将 ps 命令执行的结果插入到文档中 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. :r!ps   B. :!ps   C. :!rps    D. :w!ps</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  以下哪个vi命令可以在当前位置插入/etc/passwd文本文件(   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. :r /etc/passwd   B. :i /etc/passwd  C. :w /etc/passwd   D. :s /etc/passwd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  vi 中复制整行的命令是 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. y1   B. yy   C. ss   D. dd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  以下哪个 vi 命令可以给文档的每行加上一个编号 (    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. :e number   B. :set number  C. :r!date     D. :200g</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:B</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  以下哪些文件只有根用户才能读写 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. /etc/bashrc   B. /etc/profile   C. /etc/shadow    D. /etc/passwd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:BC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  使用 groupdel 删除一个组的时候，命令执行失败，原因可能是 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. 该组是系统组   B. 该组是空的   C. 该组中成员非空   D. 该组不存在</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:CD</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  Linux 中文件名构成的规则比较灵活表现在 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. 文件名长度多达 256 个字符     B. 可以使用除了/符号外的所有ASCII字符</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">C. 不区分大小写            D. 无扩展名限制</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:ABD</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  对用户的口令进行加解锁的命令是 passwd，参数选项是 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. –l  B. –L  C. –u   D. -U</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:AC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  如果你对文件和目录的权限不确定，则不能用 (   ) 命令来检测权限</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. ps   B. ck    C. ls –l   D. chown</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:ABD</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  选择对/proc文件系统不正确的描述(    )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. 通常情况下，不提供中断、IO 端口、CPU 等信息   B. /proc 文件系统可以提供系统核心的许多参数</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">C. /proc 是一个虚拟的文件系统            D. 可以得到系统中运行的进程的一些信息</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  以下哪些符号可以用来连接多条命令 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. ||    B. &amp;&amp;   C. ;   D. |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:ABCD</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  在 shell 中，下面哪些字符串当作普通字符串时候需要使用&quot;\&quot;来转义 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. 分号 (;)   B. 双引号 (&quot;)  C. 单引号 (&#x27;)   D. 反斜杆 (\)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:BCD</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  Linux 中提供了几个重要的工具用来改变服务和进程的运行状态和运行级别以及初始化进程，它们是 (   )。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. chkconfig  B. service  C. turboservice   D. ksysv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:ABCD</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  在/etc/rc.d/init.d目录下的所有脚本至少支持两个运行参数,它们是(    )。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. start   B. restart    C. stop   D. reload</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:AC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  Linux 一般被称为是稳定的服务器系统，它的安全性表现在 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. 网络防火墙  B. 用户管理策略 C. 系统、目录、文件的权限控制 D. 封闭源码便于及时修正漏洞等</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:ABC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  在 vi 中下列哪些命令不能用来在光标前插入文本 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. p [text]　　B. i [text]　　C. o [text]　　　D. a [text]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:ACD</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.  在本地的文件系统中下列哪些 linux 路径结构是无效的 (   )</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">A. \usr/zhang/memo   B. /usr/zhang/memo   C. //usr\zhang/memo   D. \usr\zhang\memo</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">答案:ACD</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">二、简答题（1 题 3 分）</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1.常见的 Linux 发行版本都有什么？你最擅长哪一个？它的官网网站是什么？说明你擅长哪一块？</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2.Linux 开机启动流程详细步骤是什么？系统安装完，忘记密码如何破解？</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4.某一天突然发现 Linux 系统文件只读，该怎么办呢？完整操作步骤。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5.安装一台系统使用 DVD 光盘安装，如何安装 50 台 Linux 系统如何安装呢？思考一下。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">6.用虚拟机安装了一台 Linux 系统，突然想克隆一台服务器，克隆后发现无法上网，如何解决？</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">7.Linux 网卡配置文件路径是什么？要使服务器上外网，必须满足的条件有哪些？需要配置什么？</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">8.一般可以使用什么软件远程 linux 服务器？通过什么上传文件和下载文件？</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">9./mnt 目录主要用于什么？/root 目录跟 root 用户有什么关系？/根目录与/boot 目录有什么联系？</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">10.某一天误操作，执行了 rm  -rf  * ，会有哪些情况发生？请举例。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">三、公有云题目（1 题 5 分）</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1. 请解释上云的好处是什么？传统业务类型与公有云也为类型有什么区别？请举例说明。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2. 列出你用过的阿里云\AWS\Azure 服务？并讲述他们的作用？</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3. 请列出你觉得阿里云\AWS\Azure 目前的特色和不成熟的地方是那些？你觉得应该如何改正。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">4. 请用阿里云\AWS\Azure 设计一个视频网站的架构图并进行解释说明。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/linux">Linux</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2016/03/18/li-jie-linux-de-ying-lian-jie-yu-ruan-lian-jie">理解 Linux 的硬链接与软链接</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-03-18T14:52:13.000Z" itemprop="datePublished">March 18, 2016</time> · <!-- -->15 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="从-inode-了解-linux-文件系统">从 inode 了解 Linux 文件系统<a href="#从-inode-了解-linux-文件系统" class="hash-link" aria-label="Direct link to 从 inode 了解 Linux 文件系统" title="Direct link to 从 inode 了解 Linux 文件系统">​</a></h2><p>硬链接与软链接是 Linux 文件系统中的一个重要概念，其涉及文件系统中的索引节点 (index node 又称 inode)，而索引节点对象是 Linux 虚拟文件系统 (VFS) 的四个基本概念之一。通过剖析硬链接与软链接的联系与区别，我们可更好的了解 Linux 中 VFS 这一通用文件模型。并让 Linux 普通用户和系统管理员正确使用硬链接与软链接，帮助文件系统开发者获取 inode 的相关知识。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux-的文件系统与目录">Linux 的文件系统与目录<a href="#linux-的文件系统与目录" class="hash-link" aria-label="Direct link to Linux 的文件系统与目录" title="Direct link to Linux 的文件系统与目录">​</a></h3><p>现代操作系统为解决信息能独立于进程之外被长期存储引入了文件，文件作为进程创建信息的逻辑单元可被多个进程并发使用。在 UNIX 系统中，操作系统为磁盘上的文本与图像、鼠标与键盘等输入设备及网络交互等 I/O 操作设计了一组通用 API，使他们被处理时均可统一使用字节流方式。换言之，UNIX 系统中除进程之外的一切皆是文件，而 Linux 保持了这一特性。为了便于文件的管理，Linux 还引入了目录（有时亦被称为文件夹）这一概念。目录使文件可被分类管理，且目录的引入使 Linux 的文件系统形成一个层级结构的目录树。<code>清单 1</code>. 所示的是普通 Linux 系统的顶层目录结构，其中 /dev 是存放了设备相关文件的目录。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-1-linux-系统的顶层目录结构">清单 1. Linux 系统的顶层目录结构<a href="#清单-1-linux-系统的顶层目录结构" class="hash-link" aria-label="Direct link to 清单 1. Linux 系统的顶层目录结构" title="Direct link to 清单 1. Linux 系统的顶层目录结构">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /              根目录</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── bin     存放用户二进制文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── boot    存放内核引导配置文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── dev     存放设备文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── etc     存放系统配置文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── home    用户主目录</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── lib     动态共享库</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── lost+found  文件系统恢复时的恢复文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── media   可卸载存储介质挂载点</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── mnt     文件系统临时挂载点</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── opt     附加的应用程序包</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── proc    系统内存的映射目录，提供内核与进程信息</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── root    root 用户主目录</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── sbin    存放系统二进制文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── srv     存放服务相关数据</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── sys     sys 虚拟文件系统挂载点</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── tmp     存放临时文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── usr     存放用户应用程序</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└── var     存放邮件、系统日志等变化文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Linux 将设备当做文件进行处理，<code>清单 2</code>展示了如何打开设备文件 /dev/input/event5 并读取文件内容。文件 event5 表示一种输入设备，其可能是鼠标或键盘等。查看文件 /proc/bus/input/devices 可知 event5 对应设备的类型。设备文件 /dev/input/event5 使用 read() 以字符流的方式被读取。结构体 input_event 被定义在内核头文件 linux/input.h 中。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-2--打开并读取设备文件">清单 2.  打开并读取设备文件<a href="#清单-2--打开并读取设备文件" class="hash-link" aria-label="Direct link to 清单 2.  打开并读取设备文件" title="Direct link to 清单 2.  打开并读取设备文件">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> int fd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> struct input_event ie</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> fd </span><span class="token operator">=</span><span class="token plain"> open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/dev/input/event5&quot;</span><span class="token plain">, O_RDONLY</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> read</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">fd, </span><span class="token operator">&amp;</span><span class="token plain">ie, sizeof</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">struct input_event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">))</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;type = %d  code = %d  value = %d</span><span class="token string entity" style="color:rgb(255, 121, 198)">\n</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ie.type, ie.code, ie.value</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> close</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">fd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="硬链接与软链接的联系与区别">硬链接与软链接的联系与区别<a href="#硬链接与软链接的联系与区别" class="hash-link" aria-label="Direct link to 硬链接与软链接的联系与区别" title="Direct link to 硬链接与软链接的联系与区别">​</a></h3><p>我们知道文件都有文件名与数据，这在 Linux 上被分成两个部分：用户数据 (user data) 与元数据 (metadata)。用户数据，即文件数据块 (data block)，数据块是记录文件真实内容的地方；而元数据则是文件的附加属性，如文件大小、创建时间、所有者等信息。在 Linux 中，元数据中的 inode 号（inode 是文件元数据的一部分但其并不包含文件名，inode 号即索引节点号）才是文件的唯一标识而非文件名。文件名仅是为了方便人们的记忆和使用，系统或程序通过 inode 号寻找正确的文件数据块。<code>图 1.</code>展示了程序通过文件名获取文件内容的过程。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="图-1-通过文件名打开文件">图 1. 通过文件名打开文件<a href="#图-1-通过文件名打开文件" class="hash-link" aria-label="Direct link to 图 1. 通过文件名打开文件" title="Direct link to 图 1. 通过文件名打开文件">​</a></h4><p><img loading="lazy" src="http://120.24.251.209/content/images/2016/03/image001.jpg" alt="image" class="img_ev3q"></p><p>在 Linux 系统中查看 inode 号可使用命令 stat 或 ls -i（若是 AIX 系统，则使用命令 istat）。<code>清单 3.</code>中使用命令 mv 移动并重命名文件 glibc-2.16.0.tar.xz，其结果不影响文件的用户数据及 inode 号，文件移动前后 inode 号均为：2485677。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-3--移动或重命名文件">清单 3.  移动或重命名文件<a href="#清单-3--移动或重命名文件" class="hash-link" aria-label="Direct link to 清单 3.  移动或重命名文件" title="Direct link to 清单 3.  移动或重命名文件">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># stat /home/harris/source/glibc-2.16.0.tar.xz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  File: `/home/harris/source/glibc-2.16.0.tar.xz&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Size: </span><span class="token number">9990512</span><span class="token plain">     Blocks: </span><span class="token number">19520</span><span class="token plain">      IO Block: </span><span class="token number">4096</span><span class="token plain">   regular </span><span class="token function" style="color:rgb(80, 250, 123)">file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Device: 807h/2055d   Inode: </span><span class="token number">2485677</span><span class="token plain">     Links: </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Access: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">0600/-rw-------</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  Uid: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"> </span><span class="token number">1000</span><span class="token plain">/  harris</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">   Gid: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"> </span><span class="token number">1000</span><span class="token plain">/  harris</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 经网友指出，使用mv移动时不跨磁盘inode号不变，如果跨磁盘inode会改变。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># mv /home/harris/source/glibc-2.16.0.tar.xz /home/harris/Desktop/glibc.tar.xz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># ls -i -F /home/harris/Desktop/glibc.tar.xz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2485677</span><span class="token plain"> /home/harris/Desktop/glibc.tar.xz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>为解决文件的共享使用，Linux 系统引入了两种链接：硬链接 (hard link) 与软链接（又称符号链接，即 soft link 或 symbolic link）。链接为 Linux 系统解决了文件的共享使用，还带来了隐藏文件路径、增加权限安全及节省存储等好处。若一个 inode 号对应多个文件名，则称这些文件为硬链接。换言之，硬链接就是同一个文件使用了多个别名（见 <code>图 2.</code>hard link 就是 file 的一个别名，他们有共同的 inode）。硬链接可由命令 link 或 ln 创建。如下是对文件 oldfile 创建硬链接。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">link</span><span class="token plain"> oldfile newfile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ln</span><span class="token plain"> oldfile newfile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>由于硬链接是有着相同 inode 号仅文件名不同的文件，因此硬链接存在以下几点特性：</p><ul><li>文件有相同的 inode 及 data block；</li><li>只能对已存在的文件进行创建；</li><li>不能交叉文件系统进行硬链接的创建；</li><li>不能对目录进行创建，只可对文件创建；</li><li>删除一个硬链接文件并不影响其他有相同 inode 号的文件。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-4--硬链接特性展示">清单 4.  硬链接特性展示<a href="#清单-4--硬链接特性展示" class="hash-link" aria-label="Direct link to 清单 4.  硬链接特性展示" title="Direct link to 清单 4.  硬链接特性展示">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># ls -li</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> total </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> // 只能对已存在的文件创建硬连接</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># link old.file hard.link</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> link: cannot create </span><span class="token function" style="color:rgb(80, 250, 123)">link</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">hard.link&#x27; to </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain">old.file</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;: No such file or directory</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="display:inline-block;color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)"> # echo &quot;This is an original file&quot; &gt; old.file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)"> # cat old.file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)"> This is an original file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)"> # stat old.file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">  File: `old.file&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Size: </span><span class="token number">25</span><span class="token plain">          Blocks: </span><span class="token number">8</span><span class="token plain">          IO Block: </span><span class="token number">4096</span><span class="token plain">   regular </span><span class="token function" style="color:rgb(80, 250, 123)">file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Device: 807h/2055d   Inode: </span><span class="token number">660650</span><span class="token plain">      Links: </span><span class="token number">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Access: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">0644/-rw-r--r--</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  Uid: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">    </span><span class="token number">0</span><span class="token plain">/    root</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">   Gid: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">    </span><span class="token number">0</span><span class="token plain">/    root</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> // 文件有相同的 inode 号以及 data block</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># link old.file hard.link | ls -li</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> total </span><span class="token number">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">660650</span><span class="token plain"> -rw-r--r-- </span><span class="token number">2</span><span class="token plain"> root root </span><span class="token number">25</span><span class="token plain"> Sep  </span><span class="token number">1</span><span class="token plain"> </span><span class="token number">17</span><span class="token plain">:44 hard.link</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">660650</span><span class="token plain"> -rw-r--r-- </span><span class="token number">2</span><span class="token plain"> root root </span><span class="token number">25</span><span class="token plain"> Sep  </span><span class="token number">1</span><span class="token plain"> </span><span class="token number">17</span><span class="token plain">:44 old.file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> // 不能交叉文件系统</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># ln /dev/input/event5 /root/bfile.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ln: failed to create hard </span><span class="token function" style="color:rgb(80, 250, 123)">link</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">/root/bfile.txt&#x27; </span><span class="token variable operator" style="color:rgb(189, 147, 249);font-style:italic">=</span><span class="token variable operator" style="color:rgb(189, 147, 249);font-style:italic">&gt;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain">/dev/input/event5</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)"> Invalid cross-device link</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="display:inline-block;color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)"> // 不能对目录进行创建硬连接</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)"> # mkdir -p old.dir/test</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)"> # ln old.dir/ hardlink.dir</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)"> ln: `old.dir/&#x27;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> hard </span><span class="token function" style="color:rgb(80, 250, 123)">link</span><span class="token plain"> not allowed </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> directory</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># ls -iF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">660650</span><span class="token plain"> hard.link  </span><span class="token number">657948</span><span class="token plain"> old.dir/  </span><span class="token number">660650</span><span class="token plain"> old.file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>文件 old.file 与 hard.link 有着相同的 inode 号：660650 及文件权限，inode 是随着文件的存在而存在，因此只有当文件存在时才可创建硬链接，即当 inode 存在且链接计数器（link count）不为 0 时。inode 号仅在各文件系统下是唯一的，当 Linux 挂载多个文件系统后将出现 inode 号重复的现象（如<code>清单 5.</code>展示了使用命令 df 查看当前系统中挂载的文件系统类型、各文件系统 inode 使用情况及文件系统挂载点。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-5--查找有相同-inode-号的文件">清单 5.  查找有相同 inode 号的文件<a href="#清单-5--查找有相同-inode-号的文件" class="hash-link" aria-label="Direct link to 清单 5.  查找有相同 inode 号的文件" title="Direct link to 清单 5.  查找有相同 inode 号的文件">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># df -i --print-type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Filesystem     Type       Inodes  IUsed    IFree IUse% Mounted on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /dev/sda7      ext4      </span><span class="token number">3147760</span><span class="token plain"> </span><span class="token number">283483</span><span class="token plain">  </span><span class="token number">2864277</span><span class="token plain">   </span><span class="token number">10</span><span class="token plain">% /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> udev           devtmpfs   </span><span class="token number">496088</span><span class="token plain">    </span><span class="token number">553</span><span class="token plain">   </span><span class="token number">495535</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain">% /dev</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> tmpfs          tmpfs      </span><span class="token number">499006</span><span class="token plain">    </span><span class="token number">491</span><span class="token plain">   </span><span class="token number">498515</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain">% /run</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> none           tmpfs      </span><span class="token number">499006</span><span class="token plain">      </span><span class="token number">3</span><span class="token plain">   </span><span class="token number">499003</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain">% /run/lock</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> none           tmpfs      </span><span class="token number">499006</span><span class="token plain">     </span><span class="token number">15</span><span class="token plain">   </span><span class="token number">498991</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain">% /run/shm</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /dev/sda6      fuseblk  </span><span class="token number">74383900</span><span class="token plain">   </span><span class="token number">4786</span><span class="token plain"> </span><span class="token number">74379114</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain">% /media/DiskE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /dev/sda8      fuseblk  </span><span class="token number">29524592</span><span class="token plain">  </span><span class="token number">19939</span><span class="token plain"> </span><span class="token number">29504653</span><span class="token plain">    </span><span class="token number">1</span><span class="token plain">% /media/DiskF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># find / -inum 1114</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /media/DiskE/Pictures/t3.jpg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /media/DiskF/123.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /bin/sync</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>值得一提的是，Linux 系统存在 inode 号被用完但磁盘空间还有剩余的情况。我们创建一个 5M 大小的 ext4 类型的 mo.img 文件，并将其挂载至目录 /mnt。然后我们使用一个 shell 脚本将挂载在 /mnt 下 ext4 文件系统的 indoe 耗尽（见<code>清单 6.</code>）。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-6--测试文件系统-inode-耗尽但仍有磁盘空间的情景">清单 6.  测试文件系统 inode 耗尽但仍有磁盘空间的情景<a href="#清单-6--测试文件系统-inode-耗尽但仍有磁盘空间的情景" class="hash-link" aria-label="Direct link to 清单 6.  测试文件系统 inode 耗尽但仍有磁盘空间的情景" title="Direct link to 清单 6.  测试文件系统 inode 耗尽但仍有磁盘空间的情景">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># dd if=/dev/zero of=mo.img bs=5120k count=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ls -lh mo.img</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> -rw-r--r-- </span><span class="token number">1</span><span class="token plain"> root root </span><span class="token number">5</span><span class="token plain">.0M Sep  </span><span class="token number">1</span><span class="token plain"> </span><span class="token number">17</span><span class="token plain">:54 mo.img</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># mkfs -t ext4  -F ./mo.img</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> OS type: Linux</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Block </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">size</span><span class="token operator">=</span><span class="token number">1024</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">log</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Fragment </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">size</span><span class="token operator">=</span><span class="token number">1024</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">log</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">Stride</span><span class="token operator">=</span><span class="token number">0</span><span class="token plain"> blocks, Stripe </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">width</span><span class="token operator">=</span><span class="token number">0</span><span class="token plain"> blocks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">1280</span><span class="token plain"> inodes, </span><span class="token number">5120</span><span class="token plain"> blocks</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">256</span><span class="token plain"> blocks </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">5.00</span><span class="token plain">%</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> reserved </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> the super user</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Writing superblocks and filesystem accounting information: </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># mount -o loop ./mo.img /mnt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># cat /mnt/inode_test.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token variable punctuation" style="color:rgb(248, 248, 242);font-style:italic">((</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">i </span><span class="token variable operator" style="color:rgb(189, 147, 249);font-style:italic">=</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable number" style="color:rgb(189, 147, 249);font-style:italic">1</span><span class="token variable punctuation" style="color:rgb(248, 248, 242);font-style:italic">;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable punctuation" style="color:rgb(248, 248, 242);font-style:italic">;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> i</span><span class="token variable operator" style="color:rgb(189, 147, 249);font-style:italic">++</span><span class="token variable punctuation" style="color:rgb(248, 248, 242);font-style:italic">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$?</span><span class="token plain"> -eq </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;This is file_</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$i</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"> file_</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$i</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ./inode_test.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ./inode_test.sh: line </span><span class="token number">6</span><span class="token plain">: file_1269: No space left on device</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># df -iT /mnt/; du -sh /mnt/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Filesystem     Type Inodes IUsed IFree IUse% Mounted on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /dev/loop0     ext4   </span><span class="token number">1280</span><span class="token plain">  </span><span class="token number">1280</span><span class="token plain">     </span><span class="token number">0</span><span class="token plain">  </span><span class="token number">100</span><span class="token plain">% /mnt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">1</span><span class="token plain">.3M   /mnt/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>硬链接不能对目录创建是受限于文件系统的设计（见 <code>清单 4.</code>对目录创建硬链接将失败）。现 Linux 文件系统中的目录均隐藏了两个个特殊的目录：当前目录（.）与父目录（..）。查看这两个特殊目录的 inode 号可知其实这两目录就是两个硬链接（注意目录 /mnt/lost+found/ 的 inode 号）。若系统允许对目录创建硬链接，则会产生目录环。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># ls -aliF /mnt/lost+found</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> total </span><span class="token number">44</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">11</span><span class="token plain"> drwx------ </span><span class="token number">2</span><span class="token plain"> root root </span><span class="token number">12288</span><span class="token plain"> Sep  </span><span class="token number">1</span><span class="token plain"> </span><span class="token number">17</span><span class="token plain">:54 ./</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> drwxr-xr-x </span><span class="token number">3</span><span class="token plain"> root root </span><span class="token number">31744</span><span class="token plain"> Sep  </span><span class="token number">1</span><span class="token plain"> </span><span class="token number">17</span><span class="token plain">:57 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># stat  /mnt/lost+found/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  File: `/mnt/lost+found/&#x27;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Size: </span><span class="token number">12288</span><span class="token plain">       Blocks: </span><span class="token number">24</span><span class="token plain">         IO Block: </span><span class="token number">1024</span><span class="token plain">   directory</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Device: 700h/1792d   Inode: </span><span class="token number">11</span><span class="token plain">          Links: </span><span class="token number">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Access: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">0700/drwx------</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">  Uid: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">    </span><span class="token number">0</span><span class="token plain">/    root</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">   Gid: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">    </span><span class="token number">0</span><span class="token plain">/    root</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Access: </span><span class="token number">2012</span><span class="token plain">-09-01 </span><span class="token number">17</span><span class="token plain">:57:17.000000000 +0800</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Modify: </span><span class="token number">2012</span><span class="token plain">-09-01 </span><span class="token number">17</span><span class="token plain">:54:49.000000000 +0800</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Change: </span><span class="token number">2012</span><span class="token plain">-09-01 </span><span class="token number">17</span><span class="token plain">:54:49.000000000 +0800</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Birth: -</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>软链接与硬链接不同，若文件用户数据块中存放的内容是另一文件的路径名的指向，则该文件就是软连接。软链接就是一个普通文件，只是数据块内容有点特殊。软链接有着自己的 inode 号以及用户数据块（见 <code>图 2.</code>）。因此软链接的创建与使用没有类似硬链接的诸多限制：</p><ul><li>软链接有自己的文件属性及权限等；</li><li>可对不存在的文件或目录创建软链接；</li><li>软链接可交叉文件系统；</li><li>软链接可对文件或目录创建；</li><li>创建软链接时，链接计数 i_nlink 不会增加；</li><li>删除软链接并不影响被指向的文件，但若被指向的原文件被删除，则相关软连接被称为死链接（即 dangling link，若被指向路径文件被重新创建，死链接可恢复为正常的软链接）。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="图-2-软链接的访问">图 2. 软链接的访问<a href="#图-2-软链接的访问" class="hash-link" aria-label="Direct link to 图 2. 软链接的访问" title="Direct link to 图 2. 软链接的访问">​</a></h4><p><img loading="lazy" src="http://120.24.251.209/content/images/2016/03/image002.jpg" alt="image" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-7-软链接特性展示">清单 7. 软链接特性展示<a href="#清单-7-软链接特性展示" class="hash-link" aria-label="Direct link to 清单 7. 软链接特性展示" title="Direct link to 清单 7. 软链接特性展示">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># ls -li</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> total </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> // 可对不存在的文件创建软链接</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ln -s old.file soft.link</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ls -liF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> total </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">789467</span><span class="token plain"> lrwxrwxrwx </span><span class="token number">1</span><span class="token plain"> root root </span><span class="token number">8</span><span class="token plain"> Sep  </span><span class="token number">1</span><span class="token plain"> </span><span class="token number">18</span><span class="token plain">:00 soft.link -</span><span class="token operator">&gt;</span><span class="token plain"> old.file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> // 由于被指向的文件不存在，此时的软链接 soft.link 就是死链接</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># cat soft.link</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> cat: soft.link: No such </span><span class="token function" style="color:rgb(80, 250, 123)">file</span><span class="token plain"> or directory</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> // 创建被指向的文件 old.file，soft.link 恢复成正常的软链接</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># echo &quot;This is an original file_A&quot; &gt;&gt; old.file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># cat soft.link</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> This is an original file_A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> // 对不存在的目录创建软链接</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># ln -s old.dir soft.link.dir</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># mkdir -p old.dir/test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># tree . -F --inodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token number">789497</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">  old.dir/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">│   └── </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token number">789498</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">  test/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token number">789495</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">  old.file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">├── </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token number">789495</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">  soft.link -</span><span class="token operator">&gt;</span><span class="token plain"> old.file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">└── </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token number">789497</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain">  soft.link.dir -</span><span class="token operator">&gt;</span><span class="token plain"> old.dir/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当然软链接的用户数据也可以是另一个软链接的路径，其解析过程是递归的。但需注意：软链接创建时原文件的路径指向使用绝对路径较好。使用相对路径创建的软链接被移动后该软链接文件将成为一个死链接（如下所示的软链接 a 使用了相对路径，因此不宜被移动），因为链接数据块中记录的亦是相对路径指向。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> $ </span><span class="token function" style="color:rgb(80, 250, 123)">ls</span><span class="token plain"> -li</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> total </span><span class="token number">2136</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">656627</span><span class="token plain"> lrwxrwxrwx </span><span class="token number">1</span><span class="token plain"> harris harris       </span><span class="token number">8</span><span class="token plain"> Sep  </span><span class="token number">1</span><span class="token plain"> </span><span class="token number">14</span><span class="token plain">:37 a -</span><span class="token operator">&gt;</span><span class="token plain"> data.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">656662</span><span class="token plain"> lrwxrwxrwx </span><span class="token number">1</span><span class="token plain"> harris harris       </span><span class="token number">1</span><span class="token plain"> Sep  </span><span class="token number">1</span><span class="token plain"> </span><span class="token number">14</span><span class="token plain">:37 b -</span><span class="token operator">&gt;</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">656228</span><span class="token plain"> -rw------- </span><span class="token number">1</span><span class="token plain"> harris harris </span><span class="token number">2186738</span><span class="token plain"> Sep  </span><span class="token number">1</span><span class="token plain"> </span><span class="token number">14</span><span class="token plain">:37 data.txt </span><span class="token number">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="链接相关的命令">链接相关的命令<a href="#链接相关的命令" class="hash-link" aria-label="Direct link to 链接相关的命令" title="Direct link to 链接相关的命令">​</a></h3><p>在 Linux 中查看当前系统已挂着的文件系统类型，除上述使用的命令 df，还可使用命令 mount 或查看文件 /proc/mounts。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># mount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /dev/sda7 on / </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">type</span><span class="token plain"> ext4 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">rw,errors</span><span class="token operator">=</span><span class="token plain">remount-ro</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> proc on /proc </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">type</span><span class="token plain"> proc </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">rw,noexec,nosuid,nodev</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> sysfs on /sys </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">type</span><span class="token plain"> sysfs </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">rw,noexec,nosuid,nodev</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> none on /run/shm </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">type</span><span class="token plain"> tmpfs </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">rw,nosuid,nodev</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>命令 ls 或 stat 可帮助我们区分软链接与其他文件并查看文件 inode 号，但较好的方式还是使用 find 命令，其不仅可查找某文件的软链接，还可以用于查找相同 inode 的所有硬链接。（见 <code>清单 8.</code>）</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-8-使用命令-find-查找软链接与硬链接">清单 8. 使用命令 find 查找软链接与硬链接<a href="#清单-8-使用命令-find-查找软链接与硬链接" class="hash-link" aria-label="Direct link to 清单 8. 使用命令 find 查找软链接与硬链接" title="Direct link to 清单 8. 使用命令 find 查找软链接与硬链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 查找在路径 /home 下的文件 data.txt 的软链接</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># find /home -lname data.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /home/harris/debug/test2/a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> // 查看路径 /home 有相同 inode 的所有硬链接</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># find /home -samefile /home/harris/debug/test3/old.file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /home/harris/debug/test3/hard.link</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /home/harris/debug/test3/old.file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># find /home -inum 660650</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /home/harris/debug/test3/hard.link</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /home/harris/debug/test3/old.file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> // 列出路径 /home/harris/debug/ 下的所有软链接文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># find /home/harris/debug/ -type l -ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">656662</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> lrwxrwxrwx </span><span class="token number">1</span><span class="token plain"> harris harris </span><span class="token number">1</span><span class="token plain"> Sep </span><span class="token number">1</span><span class="token plain"> </span><span class="token number">14</span><span class="token plain">:37 /home/harris/debug/test2/b -</span><span class="token operator">&gt;</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">656627</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> lrwxrwxrwx </span><span class="token number">1</span><span class="token plain"> harris harris </span><span class="token number">8</span><span class="token plain"> Sep </span><span class="token number">1</span><span class="token plain"> </span><span class="token number">14</span><span class="token plain">:37 /home/harris/debug/test2/a -</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> data.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">789467</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> lrwxrwxrwx </span><span class="token number">1</span><span class="token plain"> root root </span><span class="token number">8</span><span class="token plain"> Sep </span><span class="token number">1</span><span class="token plain"> </span><span class="token number">18</span><span class="token plain">:00 /home/harris/debug/test/soft.link -</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> old.file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token number">789496</span><span class="token plain">    </span><span class="token number">0</span><span class="token plain"> lrwxrwxrwx   </span><span class="token number">1</span><span class="token plain"> root     root            </span><span class="token number">7</span><span class="token plain"> Sep  </span><span class="token number">1</span><span class="token plain"> </span><span class="token number">18</span><span class="token plain">:01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /home/harris/debug/test/soft.link.dir -</span><span class="token operator">&gt;</span><span class="token plain"> old.dir</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>系统根据磁盘的大小默认设定了 inode 的值（见<code>清单 9.</code>），如若必要，可在格式文件系统前对该值进行修改。如键入命令 mkfs -t ext4 -I 512/dev/sda4，将使磁盘设备 /dev/sda4 格式成 inode 大小是 512 字节的 ext4 文件系统。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-9-查看系统的-inode-值">清单 9. 查看系统的 inode 值<a href="#清单-9-查看系统的-inode-值" class="hash-link" aria-label="Direct link to 清单 9. 查看系统的 inode 值" title="Direct link to 清单 9. 查看系统的 inode 值">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> // 查看磁盘分区 /dev/sda7 上的 inode 值</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># dumpe2fs -h /dev/sda7 | grep &quot;Inode size&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> dumpe2fs </span><span class="token number">1.42</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">29</span><span class="token plain">-Nov-2011</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Inode size:            </span><span class="token number">256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># tune2fs -l /dev/sda7 | grep &quot;Inode size&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Inode size:            </span><span class="token number">256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux-vfs">Linux VFS<a href="#linux-vfs" class="hash-link" aria-label="Direct link to Linux VFS" title="Direct link to Linux VFS">​</a></h3><p>Linux 有着极其丰富的文件系统，大体上可分如下几类：</p><ol><li>网络文件系统，如 nfs、cifs 等；</li><li>磁盘文件系统，如 ext4、ext3 等；</li><li>特殊文件系统，如 proc、sysfs、ramfs、tmpfs 等。</li></ol><p>实现以上这些文件系统并在 Linux 下共存的基础就是 Linux VFS（Virtual File System 又称 Virtual Filesystem Switch），即虚拟文件系统。VFS 作为一个通用的文件系统，抽象了文件系统的四个基本概念：文件、目录项 (dentry)、索引节点 (inode) 及挂载点，其在内核中为用户空间层的文件系统提供了相关的接口（见 <code>图 3.</code>所示 VFS 在 Linux 系统的架构）。VFS 实现了 open()、read() 等系统调并使得 cp 等用户空间程序可跨文件系统。VFS 真正实现了上述内容中：在 Linux 中除进程之外一切皆是文件。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="图-3-vfs-在系统中的架构">图 3. VFS 在系统中的架构<a href="#图-3-vfs-在系统中的架构" class="hash-link" aria-label="Direct link to 图 3. VFS 在系统中的架构" title="Direct link to 图 3. VFS 在系统中的架构">​</a></h4><p><img loading="lazy" src="http://120.24.251.209/content/images/2016/03/image003.jpg" alt="image" class="img_ev3q"></p><p>Linux VFS 存在四个基本对象：超级块对象 (superblock object)、索引节点对象 (inode object)、目录项对象 (dentry object) 及文件对象 (file object)。超级块对象代表一个已安装的文件系统；索引节点对象代表一个文件；目录项对象代表一个目录项，如设备文件 event5 在路径 /dev/input/event5 中，其存在四个目录项对象：/ 、dev/ 、input/ 及 event5。文件对象代表由进程打开的文件。这四个对象与进程及磁盘文件间的关系如<code>图 4.</code> 所示，其中 d_inode 即为硬链接。为文件路径的快速解析，Linux VFS 设计了目录项缓存（Directory Entry Cache，即 dcache）。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="图-4-vfs-的对象之间的处理">图 4. VFS 的对象之间的处理<a href="#图-4-vfs-的对象之间的处理" class="hash-link" aria-label="Direct link to 图 4. VFS 的对象之间的处理" title="Direct link to 图 4. VFS 的对象之间的处理">​</a></h4><p><img loading="lazy" src="http://120.24.251.209/content/images/2016/03/image004.jpg" alt="image" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux-文件系统中的-inode">Linux 文件系统中的 inode<a href="#linux-文件系统中的-inode" class="hash-link" aria-label="Direct link to Linux 文件系统中的 inode" title="Direct link to Linux 文件系统中的 inode">​</a></h3><p>在 Linux 中，索引节点结构存在于系统内存及磁盘，其可区分成 VFS inode 与实际文件系统的 inode。VFS inode 作为实际文件系统中 inode 的抽象，定义了结构体 inode 与其相关的操作 inode_operations（见内核源码 include/linux/fs.h）。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-10-vfs-中的-inode-与-inode_operations-结构体">清单 10. VFS 中的 inode 与 inode_operations 结构体<a href="#清单-10-vfs-中的-inode-与-inode_operations-结构体" class="hash-link" aria-label="Direct link to 清单 10. VFS 中的 inode 与 inode_operations 结构体" title="Direct link to 清单 10. VFS 中的 inode 与 inode_operations 结构体">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">struct inode </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    const struct inode_operations   *i_op</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> // 索引节点操作</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    unsigned long           i_ino</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">      // 索引节点号</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    atomic_t                i_count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">    // 引用计数器</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    unsigned int            i_nlink</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">    // 硬链接数目</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> struct inode_operations </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    int </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">*create</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">struct inode*,struct dentry *,int, struct nameidata*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    int </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">*link</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">struct dentry*,struct inode *,struct dentry*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    int </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">*unlink</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">struct inode*,struct dentry *</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    int </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">*symlink</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">struct inode *,struct dentry*,const char *</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    int </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">*mkdir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">struct inode *,struct dentry*,int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    int </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">*rmdir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">struct inode*,struct dentry *</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如<code>清单 10.</code> 所见，每个文件存在两个计数器：i_count 与 i_nlink，即引用计数与硬链接计数。结构体 inode 中的 i_count 用于跟踪文件被访问的数量，而 i_nlink 则是上述使用 ls -l 等命令查看到的文件硬链接数。或者说 i_count 跟踪文件在内存中的情况，而 i_nlink 则是磁盘计数器。当文件被删除时，则 i_nlink 先被设置成 0。文件的这两个计数器使得 Linux 系统升级或程序更新变的容易。系统或程序可在不关闭的情况下（即文件 i_count 不为 0），将新文件以同样的文件名进行替换，新文件有自己的 inode 及 data block，旧文件会在相关进程关闭后被完整的删除。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-11-文件系统-ext4-中的-inode">清单 11. 文件系统 ext4 中的 inode<a href="#清单-11-文件系统-ext4-中的-inode" class="hash-link" aria-label="Direct link to 清单 11. 文件系统 ext4 中的 inode" title="Direct link to 清单 11. 文件系统 ext4 中的 inode">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">struct ext4_inode </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    __le32  i_atime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">        // 文件内容最后一次访问时间</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    __le32  i_ctime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">        // inode 修改时间</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    __le32  i_mtime</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">        // 文件内容最后一次修改时间</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    __le16  i_links_count</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">  // 硬链接计数</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    __le32  i_blocks_lo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">    // Block 计数</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    __le32  i_block</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">EXT4_N_BLOCKS</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">  // 指向具体的 block</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>清单 12.</code>的错误信息。因此实际文件系统的 inode 之间及与 VFS inode 相较是有差异的。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-12-文件系统-ext3-中-i_links_count-的限制">清单 12. 文件系统 ext3 中 i_links_count 的限制<a href="#清单-12-文件系统-ext3-中-i_links_count-的限制" class="hash-link" aria-label="Direct link to 清单 12. 文件系统 ext3 中 i_links_count 的限制" title="Direct link to 清单 12. 文件系统 ext3 中 i_links_count 的限制">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># ./dirtest.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> mkdir: cannot create directory </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">dir_31999&#x27;: Too many links</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token variable" style="display:inline-block;color:rgb(189, 147, 249);font-style:italic"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"></span><span class="token variable comment" style="color:rgb(98, 114, 164);font-style:italic"># ./linkcount.sh</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token variable" style="display:inline-block;color:rgb(189, 147, 249);font-style:italic"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> ln: failed to create hard </span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">link</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> to </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain">old.file&#x27;: Too many links</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="结束语">结束语<a href="#结束语" class="hash-link" aria-label="Direct link to 结束语" title="Direct link to 结束语">​</a></h3><p>本文最初描述了 Linux 系统中文件与目录被引入的原因及 Linux 处理文件的方式，然后我们通过区分硬链接与软链接的不同，了解 Linux 中的索引节点的相关知识，并以此引出了 inode 的结构体。索引节点结构体存在在于 Linux VFS 以及实际文件系统中，VFS 作为通用文件模型是 Linux 中“一切皆是文件”实现的基础。文章并未深入 Linux VFS，也没涉及实际文件系统的实现，文章只是从 inode 了解 Linux 的文件系统的相关内容。若想深入文件系统的内容，查看内核文档 Documentation/filesystems/ 是一个不错的方式。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/linux">Linux</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2014/03/27/wo-shi-yi-ge-zui-bu-hui-xie-biao-ti-de-ren">我是一个最不会写标题的人</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2014-03-27T10:34:54.000Z" itemprop="datePublished">March 27, 2014</time> · <!-- -->4 min read</div></header><div class="markdown" itemprop="articleBody"><p>之前一直我以为自己是在纠结到底哪里适合写 IT 学习的博文，新浪、网易亦或腾讯，折腾了许久，其实自己明白，不是在哪里写的问题，根本在于自己能否坚持下来，我本身是一个不怎么能耐下来性子的人，学习 Linux、C 还要考学历，总是做做这个，做做那个，没能认真研究，所以这么久时间还是停留在一个“初学者”的位置。</p><p>2014 年，这一年是一开始就让我悲痛到无以复加的一年，陷入迷茫让我不知道自己未来的路怎么走，能走多久，可是，我也清清楚楚地明白，我要努力改变，人生充满了太多的不可思议以及你无能为力的悲剧，今年已经过了近四个月份了，一直没能好好整理自己的心情，太沉溺过去的人是个弱者，人生会有很多我们无能为力的事，这让我们心生沮丧，可是不敢逃离还是面对，事情都已经发生在了过去，某一个时间点，是一个想起来都会让自己泪眼婆娑的时间点，我失去了一个生命中最最重要的人，往事只能回忆，也许到我将离去的时候，我才能够坦然面对人生旅途中走着走着就消失的人，我怀念，无时不刻。</p><p>谈恋爱，是我这个年纪最容易被提及的问题，我一直排斥去谈恋爱，很多人不明白为什么会是这样；其实，是因为害怕失去，所以不敢拥有，有过一段失败的经历，让我不敢再次尝试，因为我没有把握，也没有勇气，小心翼翼；我总是夸夸其谈着别人的经历，却对自己不敢触及，我所说的努力让自己变得更好，才配得上爱我的人，只是害怕因为自己不够好，致使爱我的人离我而去，不是不相信另一半，是不相信自己，这个现实到令人发指的社会，我不能自私的以为爱情可以战胜一切，这种人也许别人会感到可怜，但最终会被人鄙夷，好姑娘都应该有一个好的归宿，在我没有能力肩负起爱情的责任时，抱歉，我不能说“爱”。其实，我缺少的，钱只是一小部分，更多的是缺少的是一颗勇敢的心，不够成熟的自己，当我不能够做好自己时，如何能够不负责任地肆意冲进别人的生活，伤害了别人，也羞辱了自己。</p><p>生理年龄不代表心里年龄，明白自己想做什么，就应该努力去做，尽管我这么大了，这里也是一个开始，命运之轮是不可琢磨的，任何事在该发生的时候就会发生，早一点，晚一点，都是悲剧，如果我错过了一个深爱的姑娘，那么对不起，我想是我的修炼不够；生活在别处，我在这里，安静地学习，成长，成熟，对现实的忍耐，对未来的憧憬，不惊奇也不平淡，命运之轮不会偏移一丝一毫，我想做的只是让自己蜕变，尽量去做我想做的自己。</p><p>近期一直在看《德川家康》，还没看完，深刻感受到，在大势中人的渺小与乏力，如果想要成为你想要成为的人，那么首先，你要学会忍耐，坚持，是一个足以让人发疯的忍耐，一定要坚持，不然所有的努力都是笑话，在成为你想成为的人之前，需要舍弃很多东西，你必须足够理智，你必须谨小慎微，不然所有的努力还是成为笑话；但是，哪怕你所有的事儿都做了，你也只是有可能成功，毕竟，命运这事儿，谁有说的准呢？</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/linux">Linux</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div></div>
<script src="/assets/js/runtime~main.a4192aa2.js"></script>
<script src="/assets/js/main.be9b3ddb.js"></script>
</body>
</html>