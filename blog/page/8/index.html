<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Samzong | SAMZONG</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://samzong.me/blog/page/8"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Samzong | SAMZONG"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://samzong.me/blog/page/8"><link data-rh="true" rel="alternate" href="https://samzong.me/blog/page/8" hreflang="en"><link data-rh="true" rel="alternate" href="https://samzong.me/blog/page/8" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="SAMZONG RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="SAMZONG Atom Feed"><link rel="stylesheet" href="/assets/css/styles.44c5c7e5.css">
<link rel="preload" href="/assets/js/runtime~main.a4192aa2.js" as="script">
<link rel="preload" href="/assets/js/main.be9b3ddb.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/07/13/google-sou-suo-ji-qiao-zheng-li">Google 搜索技巧整理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/21/ketbrains-ji-huo-fu-wu-qi">在线服务器激活 Ketbrains</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/16/raycast">Raycast 你的年度报告已到达</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/15/Skoala-Install-Dce5">DCE5-Skoala 安装教程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/12/06/dce5">保姆式安装 DCE5.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/28/cskefu-opensource-project">春松客服</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/23/what-is-hukou">What is Hukou</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/20/Copy-To-Markdwon">Copy to Markdown</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/16/dubbo-ji-chu-zhi-shi">Dubbo 基础知识梳理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/11/10/panads-fill-nan-value-to-zero">Panads fill NaN value to Zero</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/10/22/redash-for-docker-bu-shu">Redash for Docker 部署</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/10/18/jwt-nei-zhi-de-fang-shi">JWT 内置的方式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/10/06/ji-ji-fu-ji-ji">唧唧复唧唧</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/10/04/zi-bei-yu-chao-yue">自卑与超越</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/28/gitlab-forked-ru-he-gen-sui-upstream-zhu-ku">GitLab Forked 如何跟随 upstream 主库</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/27/kafka-jing-pin-diao-yan-ji-gong-neng-she-ji">Kafka 调研及功能设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/22/poetry-shi-yong-bi-ji">Poetry 使用笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/20/skoala-bu-shu-jiao-cheng">Skoala 部署教程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/18/shi-yong-canal-jin-xing-shu-ju-ku-zeng-liang-tong-bu">使用 canal 进行数据库增量同步</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/09/12/k8s-xi-lie-nan-bei-liu-liang-he-dong-xi-liu-liang">K8s 系列 南北流量和东西流量</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/08/17/docker-for-mac-wang-luo-ji-qiao">Docker for Mac 网络技巧</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/08/15/wa-er-deng-hu">瓦尔登湖</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/08/10/contour-xue-xi-bi-ji">Contour 学习笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/24/tong-guo-pipreqs-huo-qu-dang-qian-xiang-mu-di-yi-lai-ku">通过 pipreqs 获取当前项目的依赖库</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/22/contour-envoy-zhi-biao">Contour和Envoy指标介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/22/jq-ming-ling-xing-json-chu-li-shen-qi">jq 命令行 Json 处理神器</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/21/wei-fu-wu-yin-qing-wang-guan-neng-li-jie-shao">微服务引擎网关能力介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/18/bi-guan-bei-zhan-11-yue">闭关备战 11 月</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/07/18/i18n-shi-yong-gou-jian">i18n 使用构建</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/29/mac-shang-an-zhuang-ruan-jian-de-fang-shi">Mac 上安装软件的方式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/06/18/httpproxy-api-chuang-jian">HTTPProxy API 创建</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/28/hexo-admonition">Hexo 增加 admonition 样式支持</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/18/gitlab-fa-song-qi-wei-ji-qi-ren-xiao-xi">Gitlab 发送企微机器人消息</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/17/guo-nei-huan-jing-da-jian-macos-k8s-kai-fa-huan-jing">国内环境搭建 MacOS K8s 开发环境</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/17/kubernetes-operator">Kubernetes Operator</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/11/contour-she-ji-li-nian">Contour 设计理念</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/07/macos-yin-cang-dock-lan-zhong-te-ding-ying-yong">MacOS 隐藏 Dock 栏中特定应用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/06/man-zu-yu-qi-de-wen-dang-zhan-mkdocs">满足预期的文档站 Mkdocs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/06/a-li-yun-yun-yuan-sheng-wang-guan">阿里云云原生网关</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/06/teng-xun-yun-wei-fu-wu-wang-guan">腾讯云微服务网关</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/03/alfred-workflow-tui-jian">Alfred Workflow 推荐</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/03/youtube-dl-xia-zai-youtube-shi-pin">youtube-dl 下载 YouTube 视频</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/03/tao-bao-python-sdk-you-hua-zhi-chi-python3">淘宝 Python SDK 优化支持 Python3</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/24/kubernetes-xue-xi-zhi-lu">kubernetes 学习之路</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/22/github-pages-de-miao-yong">GitHub Pages 的妙用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/21/kubernetes-bu-shu-cuo-wu-jie-jue-hui-zong">Kubernetes 部署错误解决汇总</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/19/xu-yao-liao-jie-de-jing-pin">需要了解的 K8s 发行版本</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/18/cka-kao-shi-zhun-bei">CKA 考试准备</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/17/Docker-Run-at-Apple-Silicon-M1">Dockerfile Run at M1 processor build failed</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/17/python-request-install-pip-error">python Request install pip error</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/16/metabase-shang-shou-shi-yong-jar">Metabase 上手 - 使用 Jar 运行</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/15/sql-dui-shi-jian-zheng-dian-de-chu-li">SQL 对时间整点的处理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/14/tao-bao-python-sdk-you-hua-zhi-chi-python3">淘宝 Python SDK 优化支持 Python3</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/14/python-pip-guo-nei-jia-su">Python Pip 国内加速</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/11/git-xiu-fu-li-shi-cuo-wu-de-author-xin-xi">Git 修复历史错误的 Author 信息</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/10/awsome-telegram-bot">Awsome Telegram Bot</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/28/Javascript-Tips">Javascript Tips</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/27/awesome-hexo-plugins">Awesome Hexo Plugin</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/27/poetry-shi-yong-bi-ji">Poetry 使用笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/27/python-duo-ban-ben-guan-li-gong-ju">Pyenv Python 多版本管理利器</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/03/11/xin-de-mu-biao">2022 新的目标</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/02/24/fastapi-shi-yong-wen-dang">FastAPI 使用文档</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/02/11/yi-ge-python-xiang-mu-di-mu-lu-jie-gou-she-ji">Python 项目的目录结构设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/21/python3-wen-ben-chu-li-strip-split">Python3 文本处理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/20/clickhouse-chang-yong-han-shu-shi-yong">ClickHouse 常用函数使用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/04/mysql-case-when">MySQL Case WHEN</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/03/apollo-ru-he-shi-xian-pei-zhi-re-fa-bu">Apollo 如何实现配置热发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/03/get-current-timestamp">get current timestamp</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/01/03/python-flask-form">python flask form</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/11/29/git-zhong-duan-clone-jia-su">Github 使用 SSH 拉取代码加速</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/11/19/ding-ding-nei-wang-chuan-tou-gong-ju">钉钉内网穿透工具</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/11/17/creating-dataframe-using-list">Creating DataFrame using list</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/11/17/shi-yong-ding-ding-san-fang-shou-quan-deng-lu">使用钉钉三方授权登录</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/11/03/metabase-cai-keng-tiao-zhuan-lian-jie-de-liu-lan-qi-huan-cun">Metabase 踩坑：跳转链接的浏览器缓存</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/10/19/python-version-manage-pyenv">Python Version Manage `pyenv`</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/10/12/macos-10.15-kai-qi-hidpi">MacOS 10.15 开启 HiDPI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/09/24/kuai-su-liao-jie-lian-jie-shu-ju-ku">快速了解连接数据库</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/09/24/node-nvm">node nvm</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/09/05/dataframe-pandas">dataframe - Pandas</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/09/05/shi-yong-python3-ge-shi-hua-da-xing-json-wen-jian">使用 Python3 格式化大型 json 文件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/08/25/python-zhua-chu-lai-sui-ji-xia-zai-ji-lu">Python 抓出来随机下载记录</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/08/09/mysql-regexp-huo-xue-huo-yong">MySQL REGEXP 活学活用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/08/08/chang-yong-sql">常用 SQL-拼接日期</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/07/22/zai-gu-ge-liu-lan-qi-zhong-an-zhuang-.crx-cha-jian">在谷歌浏览器中安装.crx 插件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/07/22/zhi-hu-zhou-kan-dan-shen-hui-shang-yin">知乎周刊・单身会上瘾</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/06/25/iphone-ipad-bu-yue-yu-an-zhuang-jiu-ban-cheng-xu">iPhone/iPad 不越狱安装旧版程序</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/06/12/mac-ru-he-kuai-su-lu-zhi-gif-xiao-shi-pin">Mac 如何快速录制 GiF 小视频</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/04/18/kuai-su-liao-jie-mysql-shi-jian-fan-wei-can-shu">快速了解 MySQL 时间范围参数</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/04/16/hql-sql-shi-jian-chu-li">HQL/SQL时间处理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/27/zhi-hu-zhou-kan-·-qiao-bu-si-wang-shi">知乎周刊·乔布斯往事</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/12/how-to-set-container-auto-restarting-with-docker">how to set container auto-restarting with docker</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/ai-ni-jiu-xiang-ai-sheng-ming">爱你就像爱生命</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/ju-ying-guo">巨婴国</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/macos-10.15-kai-qi-hidpi">macOS 10.15 开启 HiDPI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/qi-shi-ni-suo-zhi-dao-de-shi-jie-hen-mo-sheng">其实，你所知道的世界很陌生</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/ren-jian-shi-ge">人间失格</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/ren-sheng-de-jia-suo">人生的枷锁</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/san-sheng-san-shi-shi-li-tao-hua">三生三世十里桃花</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/wei-chuan-de-hong-jia-yi-chen-fu">未穿的红嫁衣·沉浮</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/wo-men-sheng-huo-zai-ju-da-de-cha-ju-li">我们生活在巨大的差距里</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/wo-suo-li-jie-de-sheng-huo">我所理解的生活</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/yuan-you-ren-pei-ni-dian-pei-liu-li">愿有人陪你颠沛流离</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/03/10/zui-hou-de-shua-hou-ren">最后的耍猴人</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/15/macos-terminal-san-jian-ke">macOs Terminal 三剑客</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/15/pprint-beautiful-json-format">pprint beautiful json format</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/15/python3-traceback">python3 traceback</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/15/requests-post-data-shi-dui-json-xu-yao-te-shu-zhu-yi">requests post data 时对 json 需要特殊注意</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/09/dingtalk-orgbot-sign-generate">dingtalk orgBot sign generate</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/02/07/python-django-bian-xie-gong-gong-mo-kuai-zai-app-zhong-yin-yong">python django 编写公共模块在 app 中引用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/01/20/python-xlsxwriter-xie-ru-excel">python xlsxwriter 写入 excel</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2021/01/01/year-the-new-start">2021 年 - 全新出发</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/25/jian-cha-nin-de-app-shi-fou-yi-zhi-chi-applesilicon">检查您的 App 是否已支持 AppleSilicon</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/25/mac-tiao-zheng-launchpad-tu-biao-da-xiao">Mac 调整 Launchpad 图标大小</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/13/learn-sqlalchemy">learn sqlalchemy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/09/covert-timestamp2datetime">covert timestamp2datetime</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/08/python-wan-cheng-dou-dian-api-shou-quan">python 完成抖店 API 授权</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/12/03/python3-str-qu-chu-te-ding-nei-rong">python3 str 去除特定内容</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/24/Check-You-Favorites-App-Is-Ready-Apple-Silicon">Check You App readyOnAppleSilicon</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/23/ru-he-zhong-zhi-mac-de-smc">如何重置 Mac 的 SMC</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/18/dai-ma-ge-shi-xiang-guan">代码格式相关</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/18/django-lian-shou-xiang-mu">Django 练手项目</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/17/python-re-zheng-ze-biao-da-shi">python re 正则表达式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/16/autoscraper-pa-chong-suo-jian-ji-suo-de">autoscraper 爬虫 所见即所得</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/09/django-chu-shi-hua-project">Django 初始化 project</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/06/django-xiu-gai-modules-shi-chu-cuo">Django 修改 modules 时出错</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/06/join-yu-format-bu-tong-de-yong-fa">join 与 format 不同的用法</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/05/beautiful-soup-4-shi-yong-ji-qiao">beautiful soup 4 使用技巧</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/11/04/python3-setup.py-help-commands">python3 setup.py --help-commands</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/10/23/use-devtools-encodeurl-&amp;-decodeurl">Use devtools encodeurl &amp; decodeurl</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2020/10/17/mac-shi-yong-ming-ling-guan-bi-he-qi-dong-airport">使用命令关闭和启动 AirPort</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/11/17/mac-jie-jue-oh-my-zsh-zai-zhong-duan-xia-da-kai-huan-man">Mac 下解决 oh-my-zsh 在终端下打开缓慢</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/07/22/mac-xia-homebrew-de-shi-yong">Mac 下 Homebrew 的使用</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/07/03/mysql-ming-ling-xing-fu-zhu-mycli">MySQL 命令行辅助 mycli</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2019/01/22/mac-ru-he-kuai-su-lu-zhi-gif-xiao-shi-pin">MacTips 如何快速录制 GiF 小视频</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2018/11/17/mactips-dan-du-she-zhi-cheng-xu-yu-yan">MacTips 单独设置程序语言</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2018/08/04/HowTo-Skip-Atlassian-Auth-for-SourceTree">HowTo Skip Atlassian Auth for SourceTree</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2018/02/28/shi-yong-guo-nei-pypi-yuan-jia-su-pip-an-zhuang">使用国内 pypi 源加速 pip 安装</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2018/01/09/git-shi-yong-gui-fan-liu-cheng">Git 使用规范流程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/12/02/Howto-Install-Redmine-on-Ubuntu-16.04">Howto Install Redmine on Ubuntu 16.04</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/11/15/Howto-use-ssr-on-mac">HowTo Use SSR Service on Mac</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/10/22/iphone:ipad-bu-yue-yu-an-zhuang-jiu-ban-cheng-xu">iPhone/iPad 不越狱安装旧版程序</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/08/12/blazemeter-recoding-jmx">Jmeter 使用 BlazeMeter 为 Jmeter 录制脚本</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/06/02/bai-du-wang-pan-python-ke-hu-duan">bypy 百度网盘 Python 客户端</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/08/04/dong-ping-guo-jia-sen-lin-gong-yuan">东平国家森林公园</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/05/20/wo-lai-dao-zhe-shi-shang">我来到这世上</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/05/15/wannacry-ru-chong-bing-du-shi-jian-ji-xiu-fu-fang-an">Wannacry 蠕虫病毒事件及修复方案</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/04/18/centos-zeng-jia-xin-ying-pan-gei-gen-wen-jian-xi-tong-kuo-rong">CentOS 增加新硬盘给根文件系统扩容</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/04/13/HowTo-Install-GitLab">HowTo Install GitLab</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/04/11/guan-yu-kao-shi">关于考试</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/04/05/HowTo-set-Tomcat-7-automatic-startup-with-CentOS-7">HowTo set Tomcat 7 automatic startup with CentOS 7</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/03/23/zai-linux-zhong-duan-shi-yong-ssr-fu-wu-shi-xian-ke-xue-shang-wang">在 Linux 终端使用 SSR 服务实现科学上网</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/03/06/HowTo-install-Zoomdata">HowTo install Zoomdata</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/03/04/si-jie-mo-fang-te-shu-qing-kuang-zhi-chu-li">四阶魔方特殊情况之处理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/27/mactips-shi-yong-ming-ling-guan-bi-he-qi-dong-airport">MacTips 使用命令关闭和启动 AirPort</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/27/HowTo-Install-NextCloud">HowTo Install NextCloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/22/HowTo-Install-Redmine">HowTo Install Redmine</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/20/HowTo-Upgrade-Your-Ghost-Version">HowTo Upgrade Your Ghost Version</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/19/HowTo-Automatic-Updates-CENTOS-RHEL-Using-YUM">HowTo Automatic Updates CENTOS/RHEL Using YUM</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/02/09/mysql-8-suo-yin-chuang-jian-shan-chu-he-cha-kan">MySQL 索引创建、删除和查看</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/01/18/HowTo-Monitor-Tomcat-Head-Memory-for-Zabbix">HowTo Monitor Tomcat HeadMemory for Zabbix</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/01/15/mei-ri-bei-fen-mysql-dan-biao-shu-ju">每日备份 MySQL 单表数据</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/01/10/sheng-huo-zai-bie-chu">生活在别处</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/01/07/docker-hub-guo-nei-jia-su">Docker Hub 国内加速</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/01/01/wo-de-2017">我的 2017</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/20/HowTo-Mount-OSS-Bucket-On-ECS">HowTo Mount OSS Bucket On ECS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/17/shang-hai-tian-leng-le">上海天冷了</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/17/gao-bie">告别</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/11/xue-zhan-gang-ju-ling">血战钢锯岭</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/08/HowTo-Install-Python3-on-CentOS-6-x">HowTo Install Python3 on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/04/HowTo-Reset-MySQL-Root-Password">HowTo Reset MySQL Root Password</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/12/03/tomcat-2-li-yong-jdk-zi-shen-keytool-shi-xian-https">Tomcat 利用 JDK 自身 keytool 实现 HTTPS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/30/aws-use-s3cmd-ming-ling-xing-guan-li-s3-cun-chu">AWS Use s3cmd 命令行管理 S3 存储</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/29/Tomcat-1-java-lang-OutOfMemoryError">Tomcat java.lang.OutOfMemoryError</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/28/HowTo-Install-LNMP-on-CentOS-6-x">HowTo Install LNMP on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/27/shi-jie-shang-zui-mei-yong-de-dong-xi">世界上最没用的东西</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/23/denyhosts-zeng-jia-fu-wu-qi-ssh-hei-ming-dan-ji-zhi">Denyhosts 增加服务器 SSH 黑名单机制</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/11/10/mysql-5-qing-kong-biao-ming-ling-zhi-truncate-yu-delete-qu-bie">MySQL 清空表命令之：truncate 与 delete 区别</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/10/29/SSH-LINUX-Security-Settings">SSH LINUX Security Settings</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/10/20/HowTo-Install-PostgreSQL-9-5-on-CentOS-6-x">HowTo Install PostgreSQL 9.5 on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/10/14/xie-de-wei-bo">微博随笔</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/10/14/xie-de-weibo">写的微博</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/09/22/HowTo-Use-pt-query-digest">HowTo Use pt-query-digest</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/09/20/sheng-zhe-gu-du">生者孤独</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/09/19/HowTo-Install-a-Tomcat-Server-7">HowTo Install a Tomcat Server 7</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/19/er-shi-si-sui">二十四岁</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/13/Script-Install-LNMP">Use Script Install LNMP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/04/HowTo-Setup-MariaDB-Galera-Cluster-10-On-CentOS-6-x">HowTo Setup MariaDB Galera Cluster 10 On CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/02/HowTo-Install-Openfire-on-CentOS">HowTo Install Openfire  on CentOS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/02/HowTo-Use-Docker-create-a-Tomcat-Project">HowTo Use Docker create a Tomcat Project</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/08/01/ni-hao-ba-yue">你好，八月</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/29/HowTo-Trun-Off-IPv6-in-CentOS-6-x">HowTo Trun Off IPv6 in CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/27/HowTo-Install-KVM-Manage-Server-webvirtmgr">HowTo Install KVM Manage Server webvirtmgr</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/27/yum-zhong-releasever-he-basearch-de-qu-zhi">Yum 中$releasever 和$basearch 的取值</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/27/Manage-Tomcat-Service-Use-Shell-Script">Manage Tomcat Service Use Shell Script</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/24/HowTo-Play-Pokemon-GO-in-China">HowTo Play Pokemon GO in China</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/10/HowTo-Reset-Azure-VM-Linux-Password">HowTo Reset Azure VM Linux Password</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/07/HowTo-Install-Docker-on-CentOS-6-x">HowTo Install Docker on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/07/HowTo-Install-MySQL-5-5-6-7-on-RHEL-CentOS-5-6-7">HowTo Install MySQL 5.5/6/7 on RHEL/CentOS 5/6/7</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/07/HowTo-Use-Remi-Install-Redis">HowTo Use Remi Install Redis</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/07/05/HowTo-Use-Fuse-sshfs-to-Mount-Remote-Filesystems">HowTo Use Fuse-sshfs to Mount Remote Filesystems</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/06/16/mysql-1-chang-yong-you-hua">MySQL 常用配置优化</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/06/16/shi-yong-mosh-dai-ti-ssh-lian-jie-fu-wu-qi">使用 mosh 代替 ssh 连接服务器</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/24/Azure-HowTo-Use-Azure-CLI-on-Mac">HowTo Use Azure CLI on Mac</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/24/Azure-3-HowTo-Use-Azure-CLI-on-Mac">Azure CLI Import AcountInfo</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/20/HowTo-Monitoring-MySQL-server-for-Zabbix">HowTo Monitoring MySQL server for Zabbix</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/18/HowTo-Install-CloudStack-4-8-on-CentOS-6-x">HowTo Install CloudStack 4.8 on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/15/openstak-jie-shao">OpenStak 介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/12/azure-4-chuang-jian-he-shi-yong-azure-redis-cache">创建和使用 Azure Redis Cache</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/05/HowTo-Install-Fabric-on-CentOS-7-x">HowTo Install Fabric on CentOS 7.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/05/centos-7-2-xi-tong-fu-wu-guan-li-fang-shi">CentOS 系统服务管理方式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/08/12/HowTo-Automatic-EasyBackup-MysqlDB">CentOS 修改系统主机名</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/05/centos-7-1-xiu-gai-xi-tong-zhu-ji-ming">CentOS 修改系统主机名</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/05/mysql-3-mysqldump-chang-yong-can-shu">mysqldump 常用参数</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/04/HowTo-Install-Python-2-7-8-on-CentOS-6-x">HowTo Install Python 2.7.8 on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/27/HowTo-Add-Piwik-Tracking-to-Ghost">HowTo Add Piwik Tracking to Ghost</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/27/HowTo-Install-piwik-with-nginx-on-centos-6-x">HowTo Install piwik with nginx on centos 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/20/shi-yong-sourecetree-guan-li-ni-de-git-xiang-mu">使用 SoureceTree 管理你的 git 项目</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/09/mac-1-tiao-zheng-launchpad-tu-biao-da-xiao">MacTips 调整 Launchpad 图标大小</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/08/mac-2-jie-jue-oh-my-zsh-zai-zhong-duan-xia-da-kai-huan-man">MacTips 解决 oh-my-zsh 在 Terminal 下打开缓慢</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/04/01/ru-he-zai-centos-6-an-zhuang-geng-gao-ban-ben-de-php">如何在 CentOS 6 安装更高版本的 PHP</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/29/mysql-4-mysql-shu-ju-ku-ji-chu">MySQL 数据库使用基础</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/29/linux-zhong-de-san-ge-te-shu-quan-xian">Linux 中的三个特殊权限</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/29/centos-6-1-shi-yong-createrepo-da-jian-ben-di-yuan">CentOS 使用 createrepo 搭建本地源</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/27/HowTo-Install-MongoDB-on-CentOS-6-x">HowTo Install MongoDB  on CentOS 6.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/24/zai-centos-zhong-pei-zhi-sftp-huan-jing">在 CentOS 中配置 SFTP 环境</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/24/mysql-6-li-yong-linux-ji-hua-ren-wu-ding-shi-tong-bu-mysql">利用 Linux 计划任务定时同步 MySQL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/23/linux-bi-shi-shi-ti">Linux 笔试试题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/22/mysql-2-kai-qi-man-ri-zhi-you-hua">MySQL 开启慢日志优化</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/19/centos-6-2-chu-shi-an-zhuang-ji-ben-you-hua-cao-zuo">CentOS 初始安装基本优化操作</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/18/li-jie-linux-de-ying-lian-jie-yu-ruan-lian-jie">理解 Linux 的硬链接与软链接</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/07/long-zu-lu-ming-fei">龙族路明非</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/04/2016-chun-jie-du-shu-bi-ji">2016 春节读书笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/02/12/HowTo-use-TortoiseGit-for-Windows">HowTo use TortoiseGit for Windows</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/01/22/install-mariadb10-centos7">How to install MariaDB 10.1 on CentOS 7.x</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/01/15/ru-he-zuo-yi-ge-cheng-shu-de-zi-ji">何余生说要感谢身边所有美好的人</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/12/31/Hello-2016">Hello 2016</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/11/17/ji-jian-zhu-yi">极简主义</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/07/18/wu-ti">无题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/06/04/min-yao-shi-sheng">民谣是生</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/04/12/zhe-shi-yi-dao-gui-men-guan">这是一道鬼门关</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/04/03/lu-tu-shang">路途上</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/02/23/xie-de-di-yi-ge-qian-duan-ye-mian">写的第一个前端页面</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2014/07/22/centos7-configure-bind-dns-server">CentOS 7 Configure DNS Server</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2014/03/27/wo-shi-yi-ge-zui-bu-hui-xie-biao-ti-de-ren">我是一个最不会写标题的人</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2012/07/30/ai-yu-tong-de-bian-yuan">爱与痛的边缘</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/10/22/iphone:ipad-bu-yue-yu-an-zhuang-jiu-ban-cheng-xu">iPhone/iPad 不越狱安装旧版程序</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-10-22T00:00:00.000Z" itemprop="datePublished">October 22, 2017</time> · <!-- -->4 min read</div></header><div class="markdown" itemprop="articleBody"><h4 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a href="#前言" class="hash-link" aria-label="Direct link to 前言" title="Direct link to 前言">​</a></h4><p>软件版本迭代是会带来新的功能和 BUG 修复，为给用户带来更好的使用体验，我也是乐于尝鲜的性格，所以在软件推出发布新版本时都会及时更新，但用户体验其实是一个玄学的话题，有时并不能给你带来更好的体验，在 iOS 上，由于苹果商店严格的管理机制导致我们在升级后，想要回退到之前版本变得十分困难。</p><p>虾米音乐升级到 6.0 版本之后，改变很大，作为一位老虾米非常不适应，所以就瞄准了 6.0 之前的最后一个版本：5.9.4。</p><p>解决办法是在 iTunes 下载程序时，使用抓包工具对与苹果应用商店服务器之间的请求进行分析，通过修改下载请求中程序版本识别序列号来下载旧版本。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="准备">准备<a href="#准备" class="hash-link" aria-label="Direct link to 准备" title="Direct link to 准备">​</a></h4><p>网上较多的解决办法是使用 Fiddler+iTunes 是在 Windows 平台，因为我只有 Mac，所以用 Charles 代替 Fiddler，这里需要注意的是 iTunes 的版本，在笔者写这篇教程的前一天 iTunes 更新到 12.7，在 12.7 中有一个很大的变化移除了 App store，所以请使用低于 12.7 版本的 iTunes。</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="charles-安装">Charles 安装<a href="#charles-安装" class="hash-link" aria-label="Direct link to Charles 安装" title="Direct link to Charles 安装">​</a></h5><p>对于 Charles 版本并没有特殊要求，我这边是通过 brew 安装，你也可以到 Charles 官网下载安装，Charles 是需要付费的软件，但是有 30 天免费使用期限，如果你有长期使用打算，建议购买正版授权。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/x4dkc.jpg" alt="image" class="img_ev3q"></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="charles-ssl-证书导入系统">Charles SSL 证书导入系统<a href="#charles-ssl-证书导入系统" class="hash-link" aria-label="Direct link to Charles SSL 证书导入系统" title="Direct link to Charles SSL 证书导入系统">​</a></h5><p>从 Charles 中导出证书文件</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/v815e.jpg" alt="image" class="img_ev3q"></p><p>在 KeyChain Access 中导入证书</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/883p7.jpg" alt="image" class="img_ev3q"></p><p>选中导入的证书，然后右键选择 &#x27;Get Info&#x27; ，设置证书信任状态</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/xoalz.jpg" alt="image" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="虾米音乐的三次下载">“虾米音乐”的三次下载<a href="#虾米音乐的三次下载" class="hash-link" aria-label="Direct link to “虾米音乐”的三次下载" title="Direct link to “虾米音乐”的三次下载">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="第一次下载">第一次下载<a href="#第一次下载" class="hash-link" aria-label="Direct link to 第一次下载" title="Direct link to 第一次下载">​</a></h5><p>打开 Charles，开启监听，然后使用搜索虾米音乐，点击 Downloads 按钮。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/6dt52.jpg" alt="image" class="img_ev3q"></p><p>点击下载后，在 Charles 会出现监听到信息，找到一条 &#x27;p<!-- -->[xx]<!-- -->-buy.itunes.apple.com&#x27; ，其中 xx 是一个随机的数字，选中它，然后右键菜单栏中勾选 &#x27;Enable SSL Proxying&#x27; 和 &#x27;Breakpoints&#x27; 。设置完成后，在 iTunes 下载中，清理下载记录。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/ea85i.jpg" alt="image" class="img_ev3q"></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="第二次下载">第二次下载<a href="#第二次下载" class="hash-link" aria-label="Direct link to 第二次下载" title="Direct link to 第二次下载">​</a></h5><p>重新搜索虾米音乐，并点击下载按钮，这时 Charles 会弹出窗口，然后在弹出窗口的右下三个按钮中选择 &#x27;Execute&#x27; ，这一步是我们请求服务器，紧接着出现的就是服务器给我们的响应，然后选择 &#x27;Edit Response&#x27; - &#x27;XML Text&#x27; ，然后向下滚动找到下图中的部分，这里是所有虾米音乐的版本的序列数字，但是这里没有办法直接看到版本号，越大的数字版本号越新。这里可以通过在手机 App store 中查看软件的版本记录，找到大概要回退多少个版本，然后数字从大到小找个半个序列数字记录下来，然后在下面三个按钮中选择 &#x27;Abort&#x27; ，这时 iTunes 会弹出一个报错窗口，关掉即可。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/27nit.jpg" alt="image" class="img_ev3q"></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="第三次下载">第三次下载<a href="#第三次下载" class="hash-link" aria-label="Direct link to 第三次下载" title="Direct link to 第三次下载">​</a></h5><p>再次重新搜索虾米音乐，并点击下载，在这次 Charles 弹出窗口中我们需要直接修改 &#x27;Edit Requset&#x27; - &#x27;XML Text&#x27; ，将如下图中的 &#x27;appExtVrsid&#x27; 对应的值修改为，我们上一步中记录的序列数字，然后就一直在每次弹出选择时，选择 &#x27;Execute&#x27; ，直到下载完成记录。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/h7zzu.jpg" alt="image" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="验证">验证<a href="#验证" class="hash-link" aria-label="Direct link to 验证" title="Direct link to 验证">​</a></h4><p>下载完成后，你的 iTunes App Library 中已经有了一个虾米音乐，连接上你的手机，将其安装到手机上即可，下图是我安装后的版本截图。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/ppy2m.jpg" alt="image" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/i-phone">iPhone</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/08/12/blazemeter-recoding-jmx">Jmeter 使用 BlazeMeter 为 Jmeter 录制脚本</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-08-12T00:00:00.000Z" itemprop="datePublished">August 12, 2017</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><p>之前一直使用阿里云的 PTS 服务作为测试，但是今天发现阿里云的 PTS 服务正在升级无法使用，所以打算用 Jmeter 来做压力测试，并使用 Chrome 插件 BlazeMeter 来录制.jmx 脚本。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装-blazemeter-插件">安装 BlazeMeter 插件<a href="#安装-blazemeter-插件" class="hash-link" aria-label="Direct link to 安装 BlazeMeter 插件" title="Direct link to 安装 BlazeMeter 插件">​</a></h4><p><a href="https://chrome.google.com/webstore/search/blazemeter" target="_blank" rel="noopener noreferrer">插件安装</a> , 需要能登录到Chrome应用商店，如果不能登录的话，可以在网上搜索下载crx包，手动加载到Chrome中即可。</p><p>安装成功之后，在 Chrome 插件栏可以看到程序入口，<img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/r0ps7.jpg" alt="image" class="img_ev3q"></p><p>BlazeMeter 限制需要登录才能导出 jmx 脚本，所以首先需要注册账号。成功登陆后，完整界面如图所示：</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/oamv4.png" alt="image" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="录制过程">录制过程<a href="#录制过程" class="hash-link" aria-label="Direct link to 录制过程" title="Direct link to 录制过程">​</a></h4><p>填写测试脚本名称后，点击开始录制，执行一系列操作后，点停止录制，然后到处 jmx 文件到本地。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="导入脚本到-jmeter">导入脚本到 Jmeter<a href="#导入脚本到-jmeter" class="hash-link" aria-label="Direct link to 导入脚本到 Jmeter" title="Direct link to 导入脚本到 Jmeter">​</a></h4><p>在 Jmeter 中&quot;File-Open&quot;导入你 jmx 脚本，为了方便观察结果，我们需要增加一些察看报告。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/uxe75.jpg" alt="image" class="img_ev3q"></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="聚合报告-aggregate-report">聚合报告 (Aggregate Report)<a href="#聚合报告-aggregate-report" class="hash-link" aria-label="Direct link to 聚合报告 (Aggregate Report)" title="Direct link to 聚合报告 (Aggregate Report)">​</a></h5><p>我们可以在聚合报告中一些非常有用的信息，这有助于对性能测试的分析。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/j93gs.png" alt="image" class="img_ev3q"></p><ul><li>Samples：一共完成了多少事务</li><li>Averge：平均响应时间</li><li>Median：统计意义上的响应时间的中值</li><li>90% Line：90% 的事务响应时间都小于 xx ms</li><li>Min：最小响应时间 ms</li><li>Max :  最大响应时间 ms</li><li>Eror %  : 出错率</li><li>Throughput：吞吐量，事务/秒</li><li>KB/sec：用流量来衡量的吞吐量</li></ul><blockquote><p>吞吐量=完成的事务数/完成这些事务数所需要的时间；</p><p>平均响应时间=所有响应时间的总和/完成的事务数；</p><p>失败率=失败的个数/事务数。</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="查看结果树-view-results-tree">查看结果树 (View Results Tree)<a href="#查看结果树-view-results-tree" class="hash-link" aria-label="Direct link to 查看结果树 (View Results Tree)" title="Direct link to 查看结果树 (View Results Tree)">​</a></h5><p>通过查看结果树，可以看到每个事务的返回结果，其中红色是出错，绿色则为正常。建议在测试开始前将 log/Display Only 中 Errors 打上勾即可，不然会输出很多东西，不方便查看。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/moo9h.png" alt="image" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/test">Test</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/06/02/bai-du-wang-pan-python-ke-hu-duan">bypy 百度网盘 Python 客户端</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-06-02T12:00:00.000Z" itemprop="datePublished">June 2, 2017</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/SAMZONG" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/SAMZONG.png" alt="Samzong Lu"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/SAMZONG" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Samzong Lu</span></a></div><small class="avatar__subtitle" itemprop="description">Product Designer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>最近在 GitHub 上发现一个有趣的项目，<a href="https://github.com/houtianze/bypy" target="_blank" rel="noopener noreferrer">百度网盘 Python 客户端</a>(bypy)，主要使用在 Linux 命令行下，这样很大的一个好处是可以利用到百度云盘 2TB 的存储空间 (如果你是会员有 6TB)；你可以在任何服务器上，利用自动化脚本实现一些数据文件、日志文件等等备份操作，同时也提供丰富的文件列表、上传、下载、对比、同步以及批量操作等。</p><blockquote><p>虽然百度网盘 Python 客户端提供很大的便利，但是我强烈不建议将一些重要数据放到百度云盘</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="实验目的">实验目的<a href="#实验目的" class="hash-link" aria-label="Direct link to 实验目的" title="Direct link to 实验目的">​</a></h2><p>数据库备份文件自动上传到百度网盘</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="环境依赖">环境依赖<a href="#环境依赖" class="hash-link" aria-label="Direct link to 环境依赖" title="Direct link to 环境依赖">​</a></h2><ul><li>Python 2.7 or 3.0 以上</li><li>Encoding UTF-8</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="python-环境">Python 环境<a href="#python-环境" class="hash-link" aria-label="Direct link to Python 环境" title="Direct link to Python 环境">​</a></h2><p>首先使用<code>python -V</code>检查你的 Python 版本，如果你的版本是 2.7 或以上，那么就不需要做任何操作，可以直接安装 bypy，但是如果你像我一样多数是 CentOS 6.x 那么就需要先升级 Python 版本。我这里是将 Python 升级到 2.7。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-python-27">Install Python 2.7<a href="#install-python-27" class="hash-link" aria-label="Direct link to Install Python 2.7" title="Direct link to Install Python 2.7">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Check current Python version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  ~ python -V</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Python 2.6.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Download python 2.7.13 or new packge.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  ~ wget http://www.python.org/ftp/python/2.7.13/Python-2.7.13.tar.xz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Extract and change in</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  ~ tar xf Python-2.7.13.tar.xz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  ~ cd Python-2.7.13</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Run the configure:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  Python-2.7.13 ./configure --prefix=/usr/local</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Compile and install it:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  Python-2.7.13 make &amp;&amp; make altinstall</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Check Python Version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  Python-2.7.13 python2.7 -V</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Python 2.7.13</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>虽然 Python2.7 已经安装成功了，但是默认的 Python 仍然是 2.6 版本，所以我们要替换默认 Python 命令指到 2.7</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Update bin python to python2.7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  ~ ll /usr/bin/python /usr/local/bin/python2.7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  ~ ll /usr/bin/python-config /usr/local/bin/python2.7-config</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  ~ python -V</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Python 2.7.13</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="can-not-use-yum-">Can not use Yum ?<a href="#can-not-use-yum-" class="hash-link" aria-label="Direct link to Can not use Yum ?" title="Direct link to Can not use Yum ?">​</a></h3><p>因为<code>yum</code>必须要使用 Python2.6，所以当升级成功之后，发现 yum 无法使用，这时我们要稍微修改下：</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  ~ which-command yum</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/usr/bin/yum</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#Update frist line &quot;#!/usr/bin/python&quot; to &quot;#!/usr/bin/python2.6&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  ~ vim /usr/bin/yum</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装bypy">安装<code>bypy</code><a href="#安装bypy" class="hash-link" aria-label="Direct link to 安装bypy" title="Direct link to 安装bypy">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-setuptools--requests">Install Setuptools &amp; requests<a href="#install-setuptools--requests" class="hash-link" aria-label="Direct link to Install Setuptools &amp; requests" title="Direct link to Install Setuptools &amp; requests">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  ~ wget --no-check-certificate https://pypi.python.org/packages/source/s/setuptools/setuptools-1.4.2.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tar xf setuptools-1.4.2.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  ~ python setup.py install</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  ~ pip2.7 install requests</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="clone---install">Clone &amp;  Install<a href="#clone---install" class="hash-link" aria-label="Direct link to Clone &amp;  Install" title="Direct link to Clone &amp;  Install">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  ~ git clone https://github.com/houtianze/bypy.git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  ~ cd bypy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">➜  bypy git:(master) python setup.py install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果安装失败，注意看报错，是否缺少 Python 依赖包，或者版本不对</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="基本操作">基本操作<a href="#基本操作" class="hash-link" aria-label="Direct link to 基本操作" title="Direct link to 基本操作">​</a></h3><p>在成功安装完成之后，以下需要注意：</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="授权">授权<a href="#授权" class="hash-link" aria-label="Direct link to 授权" title="Direct link to 授权">​</a></h4><p>首次安装之后，需要进行授权，只需要运行任何一个命令都可以，例如<code>bypy info</code>，然后根据提示，打开网页登录你的百度网盘账号，取得授权码，即可。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/2grhz.png" alt="image" class="img_ev3q"></p><p>复制上图中的链接到你的浏览器中，打开可以看到百度 API 授权页面，如下图，将授权码粘贴到命令行，然后回车等待验证通过即可。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/9zhdm.png" alt="image" class="img_ev3q"></p><p>然后再次运行命令时，就不需要进行身份验证了</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost bypy]# bypy info</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Quota: 6.103TB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Used: 180.074GB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>你可以看到我的百度网盘有 6.103TB 的空间，已经使用了 180.074GB</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="常用操作">常用操作<a href="#常用操作" class="hash-link" aria-label="Direct link to 常用操作" title="Direct link to 常用操作">​</a></h4><p>由于百度 PCS API 权限限制，程序只能存取百度云端/apps/bypy 目录下面的文件和目录。通过以下链接可以打开你的 bypy 默认路径：</p><p> <a href="https://pan.baidu.com/disk/home#list/vmode=list&amp;path=%2Fapps%2Fbypy" target="_blank" rel="noopener noreferrer">https://pan.baidu.com/disk/home#list/vmode=list&amp;path=%2Fapps%2Fbypy</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="查看">查看<a href="#查看" class="hash-link" aria-label="Direct link to 查看" title="Direct link to 查看">​</a></h4><p>我在百度网盘内增加了一个 v6 的文件夹，对应我服务器名称，这是我在服务器内利用命令即可看到。</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost bypy]# bypy list</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/apps/bypy ($t $f $s $m $d):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">D v6 0 2017-06-02, 10:28:41</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="创建文件夹">创建文件夹<a href="#创建文件夹" class="hash-link" aria-label="Direct link to 创建文件夹" title="Direct link to 创建文件夹">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# bypy mkdir v6/bypy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# bypy list v6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/apps/bypy/v6 ($t $f $s $m $d):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">D bypy 0 2017-06-02, 10:35:53</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="上传">上传<a href="#上传" class="hash-link" aria-label="Direct link to 上传" title="Direct link to 上传">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# bypy upload bypy.tgz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# bypy list</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/apps/bypy ($t $f $s $m $d):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">D v6 0 2017-06-02, 10:28:41</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">D v6_1 0 2017-06-02, 10:34:52</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F bypy.tgz 2867963 2017-06-02, 10:37:30 aa4160cdbf2f4eca9baf0fcd395241fe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="本地同步到百度网盘">本地同步到百度网盘<a href="#本地同步到百度网盘" class="hash-link" aria-label="Direct link to 本地同步到百度网盘" title="Direct link to 本地同步到百度网盘">​</a></h4><p>使用<code>syncup</code>参数将本地目录文件同步到百度网盘</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# bypy syncup ./bypy v6/bypy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# bypy list v6/bypy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/apps/bypy/v6/bypy ($t $f $s $m $d):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">D .git 0 2017-06-02, 10:45:31</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">D baidudoc 0 2017-06-02, 10:44:50</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">D build 0 2017-06-02, 10:45:11</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">D bypy 0 2017-06-02, 10:45:54</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">D bypy.egg-info 0 2017-06-02, 10:45:00</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">D dist 0 2017-06-02, 10:44:54</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">D update 0 2017-06-02, 10:45:08</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F .editorconfig 277 2017-06-02, 10:45:08 d9f71b00f908626ae68da571ca47cbe2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F .gitignore 484 2017-06-02, 10:45:00 833d8511a69044a1f1c6e0fe4b3c3117</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F .travis.yml 628 2017-06-02, 10:44:58 9f377251309ced0a55548c18896ebd7a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F CONTRIBUTING.md 683 2017-06-02, 10:44:52 f5e8a568937039e5853613ff0fe296ee</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F genrst.py 129 2017-06-02, 10:45:30 4565eddf226c2e8bed73d2c30dfae9f3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F HISTORY.md 2542 2017-06-02, 10:45:11 16605670a55a3dd9768d4c862543eac4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F HISTORY.rst 2639 2017-06-02, 10:44:57 7215fbd0a3be667fd7f9fda14f06c1a9</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F LICENSE 1078 2017-06-02, 10:44:59 ebd1a0c53ea3046f505b995629faf8fb</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F MANIFEST.in 116 2017-06-02, 10:44:50 c98e18e65329b318f13abd031a4397c4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F README.md 6276 2017-06-02, 10:46:15 d4b88fd543d93c6b63863d28f5c4e716</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F release.sh 1795 2017-06-02, 10:45:53 c086eb283e9554bbcd23daf0888e2819</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F requirements.txt 42 2017-06-02, 10:44:54 28b314f2f2d2ed79957a7a7e6d3f7c17</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F setup.cfg 70 2017-06-02, 10:45:11 b23579970dcedbcaeaaa00636d601335</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F setup.py 2377 2017-06-02, 10:44:58 34d63d5143ab02d3db7808321a7f9df4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# bypy syncup ./bypy v6/bypy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="搜索">搜索<a href="#搜索" class="hash-link" aria-label="Direct link to 搜索" title="Direct link to 搜索">​</a></h4><p><code>bypy</code> 同样支持搜索，根据文件名检索，自动递归所有目录</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# bypy search release.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Found:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F /apps/bypy/v6/bypy/release.sh 1795 2017-06-02, 10:45:53 2017-06-02, 10:45:53 c086eb283e9554bbcd23daf0888e2819</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="比较本地与百度网盘">比较本地与百度网盘<a href="#比较本地与百度网盘" class="hash-link" aria-label="Direct link to 比较本地与百度网盘" title="Direct link to 比较本地与百度网盘">​</a></h4><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 先删除本地一个文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# rm ./bypy/release.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 对比</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# bypy compare v6/bypy ./bypy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">==== Same files ===</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F - MANIFEST.in</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">... omit ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F - bypy/monkey.py</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F - README.md</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">==== Different files ===</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">==== Local only ====</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">==== Remote only ====</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">F - release.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Statistics:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--------------------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Same: 131</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Different: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Local only: 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Remote only: 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过以上可以看到，相同文件 131，远程目录多了一个文件。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="其他">其他<a href="#其他" class="hash-link" aria-label="Direct link to 其他" title="Direct link to 其他">​</a></h4><p><code>bypy</code>支持的操作很多，使用<code>bypy help</code>即可以看到，若要调试，使用以下参数可以打开对应调试信息：</p><ul><li>运行时添加<code>-v</code>参数，会显示进度详情。</li><li>运行时添加<code>-d</code>，会显示一些调试信息。</li><li>运行时添加<code>-ddd</code>，还会会显示 HTTP 通讯信息（<strong>警告：非常多</strong>）</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="数据库备份自动上传到百度网盘">数据库备份自动上传到百度网盘<a href="#数据库备份自动上传到百度网盘" class="hash-link" aria-label="Direct link to 数据库备份自动上传到百度网盘" title="Direct link to 数据库备份自动上传到百度网盘">​</a></h2><p>之前也写过很多关于 Mysql 备份的文章，如果要详细查看，请打开以下链接：<a href="https://samzong.me/categories/MySQL/" target="_blank" rel="noopener noreferrer">分类 MySQL</a></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># create back script.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@localhost ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># touch mysql_back.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># add executable permissions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@localhost ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chmod +x mysql_back.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@localhost ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># vim mysql_back.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># backup mysqldump file to baidu yunPan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># filepath: /usr/local/bin/mysql_back.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Author: samzong</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(80, 250, 123)">upload_file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">TIME</span><span class="token operator">=</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">date</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable string" style="color:rgb(255, 121, 198);font-style:italic">&quot;+%Y%m%d%H%M%S&quot;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">folder</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/mysqlbak&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">filename</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;db_</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$TIME</span><span class="token string" style="color:rgb(255, 121, 198)">.sql&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">filePath</span><span class="token operator">=</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$folder</span><span class="token plain">/</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$filename</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token operator">!</span><span class="token plain"> -f </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$filePath</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;[ERROR][&quot;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">date</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> +%Y-%m-%d</span><span class="token variable string" style="color:rgb(255, 121, 198);font-style:italic">&#x27; &#x27;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">%H:%M:%S</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;] </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$folder</span><span class="token string" style="color:rgb(255, 121, 198)">/</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$filename</span><span class="token string" style="color:rgb(255, 121, 198)"> not found.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;[INFO][&quot;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">date</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> +%Y-%m-%d</span><span class="token variable string" style="color:rgb(255, 121, 198);font-style:italic">&#x27; &#x27;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">%H:%M:%S</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;] </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$folder</span><span class="token string" style="color:rgb(255, 121, 198)">/</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$filename</span><span class="token string" style="color:rgb(255, 121, 198)"> has been found. Start uploading ......&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                bypy upload </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$filePath</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;v6/mysql_backup/</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$filename</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;[INFO][&quot;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">date</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> +%Y-%m-%d</span><span class="token variable string" style="color:rgb(255, 121, 198);font-style:italic">&#x27; &#x27;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">%H:%M:%S</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;] Uploading end.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#  set TIME variable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">TIME</span><span class="token operator">=</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">date</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable string" style="color:rgb(255, 121, 198);font-style:italic">&quot;+%Y%m%d%H%M%S&quot;</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># backup db ghost to /mysqlbak/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysqldump --single-transaction -h localhost -u ghost_backuser -pbackupPass ghost  </span><span class="token operator">&gt;</span><span class="token plain"> /mysqlbak/db_</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$TIME</span><span class="token plain">.sql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># tar sql file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> czvf /mysqlbak/ghost_</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$TIME</span><span class="token plain">.sql.tgz /mysqlbak/ghost_</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$TIME</span><span class="token plain">.sql --remove-files</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># upload sql file to baidu yunPan.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">upload_file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># send mial to admin&#x27;mial</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$?</span><span class="token plain"> -eq </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ghost SQL dump is successfully. At time: </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token string variable function" style="color:rgb(80, 250, 123);font-style:italic">date</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token string" style="color:rgb(255, 121, 198)"> &quot;</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> mail -s ghost-dump-successfully  samzong.lu@gmail.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot; Error Error ghost SQL dump is Error. At time: </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token string variable function" style="color:rgb(80, 250, 123);font-style:italic">date</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token string" style="color:rgb(255, 121, 198)"> &quot;</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> mail -s ghost-dump-error samzong.lu@gmail.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="添加计划任务">添加计划任务<a href="#添加计划任务" class="hash-link" aria-label="Direct link to 添加计划任务" title="Direct link to 添加计划任务">​</a></h2><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ~ crontab -e</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00 00 * * * sh /usr/local/bin/mysql_back.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/python">Python</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/08/04/dong-ping-guo-jia-sen-lin-gong-yuan">东平国家森林公园</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-06-02T12:00:00.000Z" itemprop="datePublished">June 2, 2017</time> · <!-- -->One min read</div></header><div class="markdown" itemprop="articleBody"><p>繁星闪烁，好美的夜空，你有多久没有静下来抬头去看看美好的星空，生活在大都市里的人都习惯了低头的忙碌和匆匆的脚步，远离喧嚣，坐在河边，享受微风拂面的舒适，空气里自由的气息，好喜欢这样的夜晚，不去管工作的繁忙，生活的压力，肥胖的困扰，躺在地上，放眼望去，整个星空映入眼帘，喜欢这样的生活，这样的美好，这样的简单，感谢这次旅程，感谢生命中每一个出彩的人，感谢每一个让我心动的人和事物，是你们让我发现世间的诸多美好，发现自己的不足，给予我为之努力的目标，人生不苦，只是为了美好的而奋斗。干了这碗鸡汤，大家好好入眠，晚安。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/随笔">随笔</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/05/20/wo-lai-dao-zhe-shi-shang">我来到这世上</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-05-20T02:03:54.000Z" itemprop="datePublished">May 20, 2017</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><p>我也没有等你，只是还没找不到一个比你还让我更喜欢的人。</p><p><a href="https://www.zhihu.com/question/25401683/answer/157581428" target="_blank" rel="noopener noreferrer">知乎</a> @七万</p><p>苦涩困在胸中，日夜锥心刺骨，却如鲠在喉。</p><p>有人说：“你不必等我。”</p><p>我觉得话已经说的很明白了，
再多问一句，都是作践自己。</p><p>我到底还是喜欢的，可是喜欢的情绪从心里涌出嘴的时候，自尊就会死死的掐着脖子，根本不能说话，能好好呼吸都是享受。</p><p>我得自己走了，谢谢你带我来山顶看烟花。</p><p>你说，这事儿得怪谁呢？</p><p>该怨你吗？怨字说不口。
终究是我一个人的梦，没理由非得拽你一起圆。</p><p>该怨我吗？实在是不忍心。
我心里住了两个小人儿。
一个跪在地上，涕零如雨，边哭边求。
另一个站他旁边，气冲斗牛，边骂边羞。
它们撕扯着我，片刻不停。</p><p>真他妈难受。</p><p>最后还是得走啊。来生，要是有来生。
我就做你的影子吧，你不必一定爱我，你也赶不走我。
或者做你手边的一本书，咱们能心平气和的聊聊天。
再不济就做你床头柜里的成人玩具，你知我长短，我知你深浅……
这辈子，是什么都不行了。</p><p>小的时候，觉得女儿国国王就是个小贱婊，
妈的，勾搭大和尚！各种挽留，留你妈哔啊，赶紧让人办正事去得了。</p><p>长大后才知道，
这个电视剧里最可怜的不是历尽艰险的唐僧，
不是一次又一次被赶走的孙猴儿，
不是被傲娇玉帝罚的一脸懵逼的凤仙郡百姓，
不是那群刚出场就被孙悟空打死的智障炮灰，
是女儿国王啊，
这娘们把能给的都给出去了，那和尚瞅都没瞅，一句女施主请自重，断绝了她所有的念想。</p><p>唉，你没来之前我也是个要脸的人啊。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/随笔">随笔</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/05/15/wannacry-ru-chong-bing-du-shi-jian-ji-xiu-fu-fang-an">Wannacry 蠕虫病毒事件及修复方案</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-05-15T00:00:00.000Z" itemprop="datePublished">May 15, 2017</time> · <!-- -->4 min read</div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/3d0jo.png" alt="image" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="事件背景">事件背景<a href="#事件背景" class="hash-link" aria-label="Direct link to 事件背景" title="Direct link to 事件背景">​</a></h3><p>5 月 12 日晚，WannaCry 蠕虫病毒在全球大肆爆发。据 BBC、CNN 等媒体报道，恶意攻击者利用 NSA（美国国家安全局）泄露的 Windows 0day 利用工具对 99 个国家实施了超过 75000 次攻击，主要影响 SMB 和 RDP 服务，主要影响了 137、138、139、445 端口。</p><p>目前已知已知的 Windows 版本包括但不限于一下都受影响：</p><ul><li>Windows NT</li><li>Windows 2000</li><li>Windows XP</li><li>Windows 2003</li><li>Windows Vista</li><li>Windows 7</li><li>Windows 8</li><li>Windows 10</li><li>Windows 2008</li><li>Windows 2008 R2</li><li>Windows Server 2012 SP0</li></ul><p>勒索者源头来自暗网，攻击具备兼容性、多语言支持，多个行业受到影响，国内高校网络系统沦为感染重灾区。据有关机构统计，目前国内每天有数万台机器遭到该蠕虫病毒袭击，国内的 ATM 机、火车站、自助终端、邮政、医院、政府办事终端、视频监控都可能遭受攻击。据报道，今日全国多地的中石油加油站无法进行网络支付，只能进行现金支付。中石油有关负责人表示，怀疑受到病毒攻击，具体情况还在核查。而截至目前，一些公安系统已经遭到入侵。</p><p>如果你也遇到了这样的问题，请不要担心，我在下面给出了如何修复这个漏洞的建议。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/9y7cc.jpg" alt="image" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="什么是比特币蠕虫病毒">什么是比特币蠕虫病毒？<a href="#什么是比特币蠕虫病毒" class="hash-link" aria-label="Direct link to 什么是比特币蠕虫病毒？" title="Direct link to 什么是比特币蠕虫病毒？">​</a></h3><p>这次攻击的始作俑者是一款名为“WannaCry”（中文名：想哭）的勒索病毒，带有加密功能，它利用 Windows 在 445 端口的安全漏洞潜入电脑并对多种文件类型加密并添加后缀 (.onion) 使用户无法打开，用户电脑存在文档被加密的情况，攻击者称需支付比特币解锁。(比特币是一种全球通用的互联网加密货币)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="漏洞验证">漏洞验证<a href="#漏洞验证" class="hash-link" aria-label="Direct link to 漏洞验证" title="Direct link to 漏洞验证">​</a></h3><ol><li><p>使用<code>Win</code>+<code>R</code>按键打开运行窗口，输入 cmd，进入命令行工具，然后输入<code>netstat -an</code> 查看是否开放了对应的端口。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/3m1jm.png" alt="image" class="img_ev3q"></p><p>上图中的服务器就是开放了 445 端口，这有很大的风险可能会 WannaCry 蠕虫病毒被攻击到，所以我们应该关掉对应端口，并修复漏洞。</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="漏洞修复">漏洞修复<a href="#漏洞修复" class="hash-link" aria-label="Direct link to 漏洞修复" title="Direct link to 漏洞修复">​</a></h3><ol><li>目前微软已发布补丁 MS17-010 修复了“永恒之蓝”攻击的系统漏洞，请尽快为电脑安装此补丁，网址为<a href="https://laod.cn/go.php?url=https://technet.microsoft.com/zh-cn/library/security/MS17-010" target="_blank" rel="noopener noreferrer">https://technet.microsoft.com/zh-cn/library/security/MS17-010</a></li><li>对于 XP、2003 等微软已不再提供安全更新的机器，推荐使用 360“NSA 武器库免疫工具”检测系统是否存在漏洞，并关闭受到漏洞影响的端口，可以避免遭到勒索软件等病毒的侵害，可以在 360 电脑安全管家中找到。</li><li>开启系统防火墙，利用系统防火墙的“高级设置”阻止外部对 445 端口进的访问（存在一定影响，该操作会影响使用 445 端口的服务）。</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="修复脚本">修复脚本<a href="#修复脚本" class="hash-link" aria-label="Direct link to 修复脚本" title="Direct link to 修复脚本">​</a></h3><p>如果以上方式都不能修复漏洞，大家可以使用我以下的批处理脚本文件来尝试关闭端口及服务，批处理禁用该漏洞可能利用到的端口，全版本通用，右键管理员启动即可，注意这需要打开 Windows 的防火墙。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">net stop SCardSvr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">net stop SCPolicySvc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sc config SCardSvr </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">start</span><span class="token operator">=</span><span class="token plain">disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sc config SCPolicySvc </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">start</span><span class="token operator">=</span><span class="token plain">disabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">net start MpsSvc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sc config MpsSvc </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">start</span><span class="token operator">=</span><span class="token plain">auto</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">netsh advfirewall </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">set</span><span class="token plain"> allprofiles state on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">netsh advfirewall firewall </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> rule </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">name</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;deny udp 137&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">dir</span><span class="token operator">=</span><span class="token plain">in </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">protocol</span><span class="token operator">=</span><span class="token plain">udp </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">localport</span><span class="token operator">=</span><span class="token number">137</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">action</span><span class="token operator">=</span><span class="token plain">block</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">netsh advfirewall firewall </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> rule </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">name</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;deny tcp 137&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">dir</span><span class="token operator">=</span><span class="token plain">in </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">protocol</span><span class="token operator">=</span><span class="token plain">tcp </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">localport</span><span class="token operator">=</span><span class="token number">137</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">action</span><span class="token operator">=</span><span class="token plain">block</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">netsh advfirewall firewall </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> rule </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">name</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;deny udp 138&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">dir</span><span class="token operator">=</span><span class="token plain">in </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">protocol</span><span class="token operator">=</span><span class="token plain">udp </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">localport</span><span class="token operator">=</span><span class="token number">138</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">action</span><span class="token operator">=</span><span class="token plain">block</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">netsh advfirewall firewall </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> rule </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">name</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;deny tcp 138&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">dir</span><span class="token operator">=</span><span class="token plain">in </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">protocol</span><span class="token operator">=</span><span class="token plain">tcp </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">localport</span><span class="token operator">=</span><span class="token number">138</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">action</span><span class="token operator">=</span><span class="token plain">block</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">netsh advfirewall firewall </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> rule </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">name</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;deny udp 139&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">dir</span><span class="token operator">=</span><span class="token plain">in </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">protocol</span><span class="token operator">=</span><span class="token plain">udp </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">localport</span><span class="token operator">=</span><span class="token number">139</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">action</span><span class="token operator">=</span><span class="token plain">block</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">netsh advfirewall firewall </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> rule </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">name</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;deny tcp 139&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">dir</span><span class="token operator">=</span><span class="token plain">in </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">protocol</span><span class="token operator">=</span><span class="token plain">tcp </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">localport</span><span class="token operator">=</span><span class="token number">139</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">action</span><span class="token operator">=</span><span class="token plain">block</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">netsh advfirewall firewall </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> rule </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">name</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;deny udp 445&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">dir</span><span class="token operator">=</span><span class="token plain">in </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">protocol</span><span class="token operator">=</span><span class="token plain">udp </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">localport</span><span class="token operator">=</span><span class="token number">445</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">action</span><span class="token operator">=</span><span class="token plain">block</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">netsh advfirewall firewall </span><span class="token function" style="color:rgb(80, 250, 123)">add</span><span class="token plain"> rule </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">name</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;deny tcp 445&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">dir</span><span class="token operator">=</span><span class="token plain">in </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">protocol</span><span class="token operator">=</span><span class="token plain">tcp </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">localport</span><span class="token operator">=</span><span class="token number">445</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">action</span><span class="token operator">=</span><span class="token plain">block</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pause</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我已经将脚本上传到百度云盘中，大家可以自行下载运行，注意解压缩 Zip 包之后的 fix_WannaCry.bat</p><p>下载链接：<a href="https://pan.baidu.com/s/1gfceNRH" target="_blank" rel="noopener noreferrer">https://pan.baidu.com/s/1gfceNRH</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="添加防火规则">添加防火规则<a href="#添加防火规则" class="hash-link" aria-label="Direct link to 添加防火规则" title="Direct link to 添加防火规则">​</a></h3><ol><li><p>打开控制面板中的 Windows 防火墙，并保证防火墙处于启用状态；</p></li><li><p>打开防火墙的高级设置；</p></li><li><p>在“入站规则”中新建一条规则，本地端口号选择 445，操作选择阻止连接。</p><p><img loading="lazy" src="https://pic3.zhimg.com/v2-85f14330cdba1fbf89369b26b9e48f52_b.png" alt="image" class="img_ev3q"></p><p><img loading="lazy" src="https://pic2.zhimg.com/v2-1bbe08395ec8ef8d0e2028cbccb01055_b.png" alt="image" class="img_ev3q"></p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="手动导入安全策略">手动导入安全策略<a href="#手动导入安全策略" class="hash-link" aria-label="Direct link to 手动导入安全策略" title="Direct link to 手动导入安全策略">​</a></h3><p>下载策略文件</p><p><a href="https://share.weiyun.com/15b7bbd3f86c493a66721dd948a81c54" target="_blank" rel="noopener noreferrer">https://share.weiyun.com/15b7bbd3f86c493a66721dd948a81c54</a></p><p>打开控制面板--管理工具 - 本地安全策略--IP 安全策略 --&gt;所有任务--&gt;导入策略：</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/hj9f4.jpg" alt="image" class="img_ev3q"></p><p>或者，通过<code>Win</code>+<code>R</code>，输入<code>gpedit.msc</code></p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/9vsqx.jpg" alt="image" class="img_ev3q"></p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/tosjk.jpg" alt="image" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/windows">Windows</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/04/18/centos-zeng-jia-xin-ying-pan-gei-gen-wen-jian-xi-tong-kuo-rong">CentOS 增加新硬盘给根文件系统扩容</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-04-18T17:48:57.000Z" itemprop="datePublished">April 18, 2017</time> · <!-- -->4 min read</div></header><div class="markdown" itemprop="articleBody"><p>由于刚开始做磁盘空间规划时，失误给根分区分配磁盘较小，导致后续实验环境无法进行，所以在经过研究后，决定尝试增加根分区的磁盘空间，注意这仅适用于创建在 LVM 上的文件系统。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="实验环境">实验环境<a href="#实验环境" class="hash-link" aria-label="Direct link to 实验环境" title="Direct link to 实验环境">​</a></h2><ul><li>Parallels Desktop 12</li><li>CentOS 6.9</li><li>根分区空间 6.5GB</li><li>已使用 5.8GB</li><li>预计 增加 12G 磁盘空间</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="增加一块物理磁盘">增加一块物理磁盘<a href="#增加一块物理磁盘" class="hash-link" aria-label="Direct link to 增加一块物理磁盘" title="Direct link to 增加一块物理磁盘">​</a></h2><p>Parallels Desktop 不能在线增加磁盘，所以要先将 VM 关闭，然后添加：
<img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/m5e1d.jpg" alt="image" class="img_ev3q">
增加 12G 的磁盘
<img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/prgyd.jpg" alt="image" class="img_ev3q"></p><p>然后启动 VM，这时可以通过<code>fdisk -l</code>查看当前已经增加了一块 12G 的磁盘</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/tat9r.jpg" alt="image" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="格式化磁盘并加入到-vgroup-组内">格式化磁盘并加入到 VGroup 组内<a href="#格式化磁盘并加入到-vgroup-组内" class="hash-link" aria-label="Direct link to 格式化磁盘并加入到 VGroup 组内" title="Direct link to 格式化磁盘并加入到 VGroup 组内">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看当前pvdisplay磁盘列表将devsdb创建-pv-块">查看当前<code>pvdisplay</code>磁盘列表，将<code>/dev/sdb</code>创建 pv 块<a href="#查看当前pvdisplay磁盘列表将devsdb创建-pv-块" class="hash-link" aria-label="Direct link to 查看当前pvdisplay磁盘列表将devsdb创建-pv-块" title="Direct link to 查看当前pvdisplay磁盘列表将devsdb创建-pv-块">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@centos ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># pvdisplay</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --- Physical volume ---</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  PV Name               /dev/sda2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG Name               vg_hadoop01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  PV Size               </span><span class="token number">7.51</span><span class="token plain"> GiB / not usable </span><span class="token number">3.00</span><span class="token plain"> MiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Allocatable           </span><span class="token function" style="color:rgb(80, 250, 123)">yes</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">but full</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  PE Size               </span><span class="token number">4.00</span><span class="token plain"> MiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Total PE              </span><span class="token number">1922</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Free PE               </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Allocated PE          </span><span class="token number">1922</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  PV UUID               MUCrDa-eJpZ-EXwE-YwwM-S2Az-p2m7-K9q3Fo</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@centos ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># pvcreate /dev/sdb</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Physical volume </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;/dev/sdb&quot;</span><span class="token plain"> successfully created</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@centos ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># pvdisplay</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --- Physical volume ---</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  PV Name               /dev/sda2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG Name               vg_hadoop01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  PV Size               </span><span class="token number">7.51</span><span class="token plain"> GiB / not usable </span><span class="token number">3.00</span><span class="token plain"> MiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Allocatable           </span><span class="token function" style="color:rgb(80, 250, 123)">yes</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">but full</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  PE Size               </span><span class="token number">4.00</span><span class="token plain"> MiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Total PE              </span><span class="token number">1922</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Free PE               </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Allocated PE          </span><span class="token number">1922</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  PV UUID               MUCrDa-eJpZ-EXwE-YwwM-S2Az-p2m7-K9q3Fo</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --- Physical volume ---</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  PV Name               /dev/sdb</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG Name               vg_hadoop01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  PV Size               </span><span class="token number">12.00</span><span class="token plain"> GiB / not usable </span><span class="token number">4.00</span><span class="token plain"> MiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Allocatable           </span><span class="token function" style="color:rgb(80, 250, 123)">yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  PE Size               </span><span class="token number">4.00</span><span class="token plain"> MiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Total PE              </span><span class="token number">3071</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Free PE               </span><span class="token number">3071</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Allocated PE          </span><span class="token number">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  PV UUID               XTpaBR-512W-vQIV-fwwz-So7L-ZCa3-yjDccQ</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看当前vgdisplayvgroup-组将devsdb加入根目录所在-vgroup">查看当前<code>vgdisplay</code>VGroup 组，将<code>/dev/sdb</code>加入根目录所在 VGroup<a href="#查看当前vgdisplayvgroup-组将devsdb加入根目录所在-vgroup" class="hash-link" aria-label="Direct link to 查看当前vgdisplayvgroup-组将devsdb加入根目录所在-vgroup" title="Direct link to 查看当前vgdisplayvgroup-组将devsdb加入根目录所在-vgroup">​</a></h3><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@centos ~]# vgdisplay</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --- Volume group ---</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG Name               vg_hadoop01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  System ID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Format                lvm2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Metadata Areas        1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Metadata Sequence No  3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG Access             read/write</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG Status             resizable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  MAX LV                0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Cur LV                2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Open LV               2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Max PV                0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Cur PV                1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Act PV                1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG Size               7.51 GiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  PE Size               4.00 MiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Total PE              1922</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Alloc PE / Size       1922 / 7.51 GiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Free  PE / Size       0 / 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG UUID               szQ4fH-Sr1Z-V6c2-KVMp-ZUik-oUDP-rU8dQS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@centos ~]# vgextend vg_hadoop01 /dev/sdb</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Volume group &quot;vg_hadoop01&quot; successfully extended</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@centos ~]# vgdisplay</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --- Volume group ---</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG Name               vg_hadoop01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  System ID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Format                lvm2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Metadata Areas        2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Metadata Sequence No  4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG Access             read/write</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG Status             resizable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  MAX LV                0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Cur LV                2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Open LV               2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Max PV                0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Cur PV                2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Act PV                2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG Size               19.50 GiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  PE Size               4.00 MiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Total PE              4993</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Alloc PE / Size       1922 / 7.51 GiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Free  PE / Size       3071 / 12.00 GiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG UUID               szQ4fH-Sr1Z-V6c2-KVMp-ZUik-oUDP-rU8dQS</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="查看lvdisplay根卷的名称将磁盘加入根卷的-lv">查看<code>lvdisplay</code>根卷的名称，将磁盘加入根卷的 LV<a href="#查看lvdisplay根卷的名称将磁盘加入根卷的-lv" class="hash-link" aria-label="Direct link to 查看lvdisplay根卷的名称将磁盘加入根卷的-lv" title="Direct link to 查看lvdisplay根卷的名称将磁盘加入根卷的-lv">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@centos ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># lvdisplay</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --- Logical volume ---</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Path                /dev/vg_hadoop01/lv_root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Name                lv_root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG Name                vg_hadoop01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV UUID                tJDetu-Theq-BQ5g-3ZFe-Gan7-1SSv-OHeYrH</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Write Access        read/write</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Creation host, </span><span class="token function" style="color:rgb(80, 250, 123)">time</span><span class="token plain"> hadoop01, </span><span class="token number">2017</span><span class="token plain">-04-18 07:09:58 +0800</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Status              available</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># open                 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Size                </span><span class="token number">6.71</span><span class="token plain"> GiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Current LE             </span><span class="token number">1718</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Segments               </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Allocation             inherit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Read ahead sectors     auto</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - currently </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">set</span><span class="token plain"> to     </span><span class="token number">256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Block device           </span><span class="token number">253</span><span class="token plain">:0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --- Logical volume ---</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Path                /dev/vg_hadoop01/lv_swap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Name                lv_swap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG Name                vg_hadoop01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV UUID                D4K7I6-tPO0-HMbC-VWkR-2HV4-WjAe-M82wYq</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Write Access        read/write</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Creation host, </span><span class="token function" style="color:rgb(80, 250, 123)">time</span><span class="token plain"> hadoop01, </span><span class="token number">2017</span><span class="token plain">-04-18 07:09:59 +0800</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Status              available</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># open                 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Size                </span><span class="token number">816.00</span><span class="token plain"> MiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Current LE             </span><span class="token number">204</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Segments               </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Allocation             inherit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Read ahead sectors     auto</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - currently </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">set</span><span class="token plain"> to     </span><span class="token number">256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Block device           </span><span class="token number">253</span><span class="token plain">:1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@centos ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># lvextend -l +100%FREE /dev/vg_hadoop01/lv_root</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Size of logical volume vg_hadoop01/lv_root changed from </span><span class="token number">6.71</span><span class="token plain"> GiB </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">1718</span><span class="token plain"> extents</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> to </span><span class="token number">18.71</span><span class="token plain"> GiB </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">4789</span><span class="token plain"> extents</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Logical volume lv_root successfully resized.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@centos ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># lvdisplay</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --- Logical volume ---</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Path                /dev/vg_hadoop01/lv_root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Name                lv_root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG Name                vg_hadoop01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV UUID                tJDetu-Theq-BQ5g-3ZFe-Gan7-1SSv-OHeYrH</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Write Access        read/write</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Creation host, </span><span class="token function" style="color:rgb(80, 250, 123)">time</span><span class="token plain"> hadoop01, </span><span class="token number">2017</span><span class="token plain">-04-18 07:09:58 +0800</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Status              available</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># open                 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Size                </span><span class="token number">18.71</span><span class="token plain"> GiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Current LE             </span><span class="token number">4789</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Segments               </span><span class="token number">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Allocation             inherit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Read ahead sectors     auto</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - currently </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">set</span><span class="token plain"> to     </span><span class="token number">256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Block device           </span><span class="token number">253</span><span class="token plain">:0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --- Logical volume ---</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Path                /dev/vg_hadoop01/lv_swap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Name                lv_swap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  VG Name                vg_hadoop01</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV UUID                D4K7I6-tPO0-HMbC-VWkR-2HV4-WjAe-M82wYq</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Write Access        read/write</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Creation host, </span><span class="token function" style="color:rgb(80, 250, 123)">time</span><span class="token plain"> hadoop01, </span><span class="token number">2017</span><span class="token plain">-04-18 07:09:59 +0800</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Status              available</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)"># open                 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  LV Size                </span><span class="token number">816.00</span><span class="token plain"> MiB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Current LE             </span><span class="token number">204</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Segments               </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Allocation             inherit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Read ahead sectors     auto</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  - currently </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">set</span><span class="token plain"> to     </span><span class="token number">256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Block device           </span><span class="token number">253</span><span class="token plain">:1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="更新磁盘分区表">更新磁盘分区表<a href="#更新磁盘分区表" class="hash-link" aria-label="Direct link to 更新磁盘分区表" title="Direct link to 更新磁盘分区表">​</a></h2><p>当你增加完成之后，这时使用<code>df -h</code>查看的磁盘空间仍然没有变化，因为我们还需要将根卷的分区表刷新。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用resize2fs刷新根卷信息">使用<code>resize2fs</code>刷新根卷信息<a href="#使用resize2fs刷新根卷信息" class="hash-link" aria-label="Direct link to 使用resize2fs刷新根卷信息" title="Direct link to 使用resize2fs刷新根卷信息">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@centos ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># resize2fs /dev/vg_hadoop01/lv_root</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resize2fs </span><span class="token number">1.41</span><span class="token plain">.12 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">17</span><span class="token plain">-May-2010</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Filesystem at /dev/vg_hadoop01/lv_root is mounted on /</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> on-line resizing required</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">old desc_blocks </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">, new_desc_blocks </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Performing an on-line resize of /dev/vg_hadoop01/lv_root to </span><span class="token number">4903936</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">4k</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> blocks.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">The filesystem on /dev/vg_hadoop01/lv_root is now </span><span class="token number">4903936</span><span class="token plain"> blocks long.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@centos ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># df -h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Filesystem            Size  Used Avail Use% Mounted on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/dev/mapper/vg_hadoop01-lv_root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                       19G  </span><span class="token number">5</span><span class="token plain">.8G   12G  </span><span class="token number">33</span><span class="token plain">% /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tmpfs                 244M     </span><span class="token number">0</span><span class="token plain">  244M   </span><span class="token number">0</span><span class="token plain">% /dev/shm</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/dev/sda1             477M   52M  400M  </span><span class="token number">12</span><span class="token plain">% /boot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cent-os">CentOS</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/04/13/HowTo-Install-GitLab">HowTo Install GitLab</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-04-13T11:18:17.000Z" itemprop="datePublished">April 13, 2017</time> · <!-- -->5 min read</div></header><div class="markdown" itemprop="articleBody"><p>目前最为主流的在线 Git 版本控制系统可以说是非 GitHub 莫属，对于个人开发者和开源项目可以直接选择 GitHub 作为 Git 版本控制系统即可，但是，对于企业内部开发管理的 Git 版本控制系统，在对保密性有高要求时 GitHub 就不合适了，这时 GitLab 作为一个可以完全搭建在企业内部的 Git 版本控制系统，而且基本囊括了 GitHub 的所有功能。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="目前-gitlab-已经整合的功能">目前 GitLab 已经整合的功能<a href="#目前-gitlab-已经整合的功能" class="hash-link" aria-label="Direct link to 目前 GitLab 已经整合的功能" title="Direct link to 目前 GitLab 已经整合的功能">​</a></h2><ol><li>Repository access</li><li>Administration</li><li>Issues</li><li>Forks</li><li>Code review</li><li>Wiki</li><li>Merge Requests</li><li>Web Editor</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="测试环境">测试环境<a href="#测试环境" class="hash-link" aria-label="Direct link to 测试环境" title="Direct link to 测试环境">​</a></h2><ul><li>2 core 4GB</li><li>50GB HDD</li><li>CentOS 6.8</li><li>Gitlab</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装需求">安装需求<a href="#安装需求" class="hash-link" aria-label="Direct link to 安装需求" title="Direct link to 安装需求">​</a></h2><p>关于 GitLab 的安装需求，主要是针对用户量然后评估出服务器及相关资源的配置，<a href="https://docs.gitlab.com.cn/ce/install/requirements.html" target="_blank" rel="noopener noreferrer">查看</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gitlab-安装">GitLab 安装<a href="#gitlab-安装" class="hash-link" aria-label="Direct link to GitLab 安装" title="Direct link to GitLab 安装">​</a></h3><h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装配置依赖项">安装配置依赖项<a href="#安装配置依赖项" class="hash-link" aria-label="Direct link to 安装配置依赖项" title="Direct link to 安装配置依赖项">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> yum </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> openssh-server openssh-clients postfix cronie</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> postfix start</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">chkconfig</span><span class="token plain"> postfix on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> lokkit -s http -s </span><span class="token function" style="color:rgb(80, 250, 123)">ssh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="添加-gitlab-仓库并安装到服务器上">添加 GitLab 仓库，并安装到服务器上<a href="#添加-gitlab-仓库并安装到服务器上" class="hash-link" aria-label="Direct link to 添加 GitLab 仓库，并安装到服务器上" title="Direct link to 添加 GitLab 仓库，并安装到服务器上">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -sS http://packages.gitlab.cc/install/gitlab-ce/script.rpm.sh </span><span class="token operator">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> yum </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> gitlab-ce</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="启动-gitlab-并初始化">启动 GitLab 并初始化<a href="#启动-gitlab-并初始化" class="hash-link" aria-label="Direct link to 启动 GitLab 并初始化" title="Direct link to 启动 GitLab 并初始化">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> gitlab-ctl reconfigure</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>默认登录账号是：root，你可以在首次打开时设置密码。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gitlab-初始化">GitLab 初始化<a href="#gitlab-初始化" class="hash-link" aria-label="Direct link to GitLab 初始化" title="Direct link to GitLab 初始化">​</a></h3><h2 class="anchor anchorWithStickyNavbar_LWe7" id="开机自启动">开机自启动<a href="#开机自启动" class="hash-link" aria-label="Direct link to 开机自启动" title="Direct link to 开机自启动">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">vi</span><span class="token plain"> /etc/rc.local</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> /opt/gitlab/bin/gitlab-ctl start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="gitlab-配置文件">GitLab 配置文件<a href="#gitlab-配置文件" class="hash-link" aria-label="Direct link to GitLab 配置文件" title="Direct link to GitLab 配置文件">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">/etc/gitlab/gitlab.rb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="smtp-邮箱配置">SMTP 邮箱配置<a href="#smtp-邮箱配置" class="hash-link" aria-label="Direct link to SMTP 邮箱配置" title="Direct link to SMTP 邮箱配置">​</a></h2><p>如果想使用 SMTP 代替 sendmail 来发送邮件，应该在 gitlab.rb 中启用对应的配置，然后运行<code>gitlab-ctl reconfigure</code>使修改生效。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="qq-企业邮箱配置示例">QQ 企业邮箱配置示例<a href="#qq-企业邮箱配置示例" class="hash-link" aria-label="Direct link to QQ 企业邮箱配置示例" title="Direct link to QQ 企业邮箱配置示例">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_enable&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_address&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;smtp.exmail.qq.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_port&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">465</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_user_name&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;xxxx@xx.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_password&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;password&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_authentication&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;login&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_enable_starttls_auto&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_tls&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;gitlab_email_from&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;xxxx@xx.com&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gmail-邮箱配置示例">Gmail 邮箱配置示例<a href="#gmail-邮箱配置示例" class="hash-link" aria-label="Direct link to Gmail 邮箱配置示例" title="Direct link to Gmail 邮箱配置示例">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_enable&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_address&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;smtp.gmail.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_port&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">587</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_user_name&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;my.email@gmail.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_password&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;my-gmail-password&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_domain&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;smtp.gmail.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_authentication&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;login&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_enable_starttls_auto&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_tls&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_openssl_verify_mode&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;peer&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="outlook-邮箱配置示例">Outlook 邮箱配置示例<a href="#outlook-邮箱配置示例" class="hash-link" aria-label="Direct link to Outlook 邮箱配置示例" title="Direct link to Outlook 邮箱配置示例">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_enable&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_address&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;smtp-mail.outlook.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_port&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">587</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_user_name&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;username@outlook.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_password&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;password&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_domain&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;smtp-mail.outlook.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_authentication&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;login&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_enable_starttls_auto&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;smtp_openssl_verify_mode&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;peer&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>​⚠️ &#x27;smtp_password&#x27;字段不应包含任何 Ruby或者YAML语法中的分隔符 (如<code>&#x27;</code>),以避免处理配置文件的过程中发生不必要的意外。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="gitlab-日常维护">GitLab 日常维护<a href="#gitlab-日常维护" class="hash-link" aria-label="Direct link to GitLab 日常维护" title="Direct link to GitLab 日常维护">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-查看服务状态">1. 查看服务状态<a href="#1-查看服务状态" class="hash-link" aria-label="Direct link to 1. 查看服务状态" title="Direct link to 1. 查看服务状态">​</a></h3><p>使用 gitlab-ctl status 查看服务状态</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@6 ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># sudo gitlab-ctl status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">run: gitaly: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">15055</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 23089s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> run: log: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">3142</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 55379s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">run: gitlab-monitor: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">15060</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 23088s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> run: log: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">3325</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 55357s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">run: gitlab-workhorse: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">15063</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 23088s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> run: log: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">3156</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 55377s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">run: logrotate: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">17867</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 1487s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> run: log: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">3197</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 55369s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">run: nginx: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">15077</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 23087s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> run: log: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">3169</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 55375s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">run: node-exporter: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">15083</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 23087s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> run: log: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">3247</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 55366s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">run: postgres-exporter: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">15088</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 23086s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> run: log: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">3311</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 55358s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">run: postgresql: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">15093</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 23086s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> run: log: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">2988</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 55412s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">run: prometheus: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">15101</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 23085s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> run: log: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">3230</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 55368s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">run: redis: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">15109</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 23085s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> run: log: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">2931</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 55419s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">run: redis-exporter: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">15113</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 23085s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> run: log: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">3290</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 55364s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">run: sidekiq: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">17029</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 22450s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> run: log: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">3131</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 55380s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">run: unicorn: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">17001</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 22460s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> run: log: </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">pid </span><span class="token number">3100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> 55386s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-启动关闭重启">2. 启动、关闭、重启<a href="#2-启动关闭重启" class="hash-link" aria-label="Direct link to 2. 启动、关闭、重启" title="Direct link to 2. 启动、关闭、重启">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 启动Gitlab所有组件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> gitlab-ctl start</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 停止Gitlab所有组件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> gitlab-ctl stop</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 重启Gitlab所有组件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> gitlab-ctl restart</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 重启单个组件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> gitlab-ctl restart sidekiq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-控制台实时查看日志">3. 控制台实时查看日志<a href="#3-控制台实时查看日志" class="hash-link" aria-label="Direct link to 3. 控制台实时查看日志" title="Direct link to 3. 控制台实时查看日志">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 查看所有的logs; 按 Ctrl-C 退出</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> gitlab-ctl </span><span class="token function" style="color:rgb(80, 250, 123)">tail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 拉取/var/log/gitlab下子目录的日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> gitlab-ctl </span><span class="token function" style="color:rgb(80, 250, 123)">tail</span><span class="token plain"> gitlab-rails</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 拉取某个指定的日志文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> gitlab-ctl </span><span class="token function" style="color:rgb(80, 250, 123)">tail</span><span class="token plain"> nginx/gitlab_error.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gitlab-安装后优化">GitLab 安装后优化<a href="#gitlab-安装后优化" class="hash-link" aria-label="Direct link to GitLab 安装后优化" title="Direct link to GitLab 安装后优化">​</a></h3><h2 class="anchor anchorWithStickyNavbar_LWe7" id="启用-https">启用 HTTPS<a href="#启用-https" class="hash-link" aria-label="Direct link to 启用 HTTPS" title="Direct link to 启用 HTTPS">​</a></h2><p>首先，你需要提供一个有可信任 CA 证书，默认情况下 GitLab 是没有启用 HTTPS 的，如果要启用 HTTPS 时，首先要修改<code>/etc/gitlab/gitlab.rb</code>中的<code>external_url</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 修改为https</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">external_url </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://git.ultraera.org&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 设置默认将http重定向到https</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nginx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;redirect_http_to_https&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果你暂时没有 https 证书，那么你可以临时自己颁发一个证书，注意这个证书是不受信任的。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain"> -p /etc/nginx/ssl/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> /etc/nginx/ssl/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> openssl req -newkey rsa:2048 -x509 -nodes -days </span><span class="token number">3560</span><span class="token plain"> -out gitlab.crt -keyout gitlab.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> o-r gitlab.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">mv</span><span class="token plain"> gitlab.key gitlab.crt /etc/ssl/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>另外，还需要在 gitlab-shell 中的 config.yml 中将 self_signed_cert 修改为启用：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">self_signed_cert </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="设置延迟启动">设置延迟启动<a href="#设置延迟启动" class="hash-link" aria-label="Direct link to 设置延迟启动" title="Direct link to 设置延迟启动">​</a></h2><p>为保证服务质量，我们可以设置让 omnibus-gitlab 的服务 (Nginx, Redis, Unicorn 等) 在指定的文件系统挂载成功后再启动，在<code>/etc/gitlab/gitlab.rb</code> 文件中添加如下内容：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 等待/var/opt/gitlab 先被挂载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">high_availability</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;mountpoint&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;/var/opt/gitlab&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意在修改配置之后，要使用重新 reconfigure 配置</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="backups-备份还原">Backups 备份还原<a href="#backups-备份还原" class="hash-link" aria-label="Direct link to Backups 备份还原" title="Direct link to Backups 备份还原">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="备份">备份<a href="#备份" class="hash-link" aria-label="Direct link to 备份" title="Direct link to 备份">​</a></h3><p>Gitlab 的配置也非常简单，使用一条命令即可创建完整的 Gitlab 备份：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab-rake gitlab:backup:create</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>该命令会在<code>/var/opt/gitlab/backups</code>目录下创建一个名称类似为<code>1491989249_2017_04_12_gitlab_backup.tar</code>的压缩包，这个压缩包就是 Gitlab 整个的完整部分，其中开头的<code>1491989249_2017_04_12</code>是备份创建的日期，这也是我们等下恢复是要用的字段。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="修改默认备份路径">修改默认备份路径<a href="#修改默认备份路径" class="hash-link" aria-label="Direct link to 修改默认备份路径" title="Direct link to 修改默认备份路径">​</a></h3><p>如果你像我一样，是使用 yum 安装的，那么 GitLab 默认的备份目录应该在<code>/var/opt/gitlab/backups</code>，我建议将备份目录修改为其他位置，并添加定时自动备份脚本，可以通过修改<code>/etc/gitlab/gitlab.rb</code>来修改默认位置：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab_rails</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;backup_path&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;/mnt/backups&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用-crontab-添加自动备份">使用 crontab 添加自动备份<a href="#使用-crontab-添加自动备份" class="hash-link" aria-label="Direct link to 使用 crontab 添加自动备份" title="Direct link to 使用 crontab 添加自动备份">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 每天凌晨00:00 自动备份</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">00 00 * * * /opt/gitlab/bin/gitlab-rake gitlab:backup:create</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="备份恢复">备份恢复<a href="#备份恢复" class="hash-link" aria-label="Direct link to 备份恢复" title="Direct link to 备份恢复">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 停止相关数据连接服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab-ctl stop unicorn</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab-ctl stop sidekiq</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 从1491989249_2017_04_12编号备份中恢复</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gitlab-rake gitlab:backup:restore </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">BACKUP</span><span class="token operator">=</span><span class="token plain">1491989249_2017_04_12</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 启动Gitlab</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> gitlab-ctl start unicorn</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> gitlab-ctl start sidekiq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gitlab-迁移">GitLab 迁移<a href="#gitlab-迁移" class="hash-link" aria-label="Direct link to GitLab 迁移" title="Direct link to GitLab 迁移">​</a></h3><p>只需将原服务器<code>/var/opt/gitlab/backups</code>目录下的备份文件拷贝到新服务器上的<code>/var/opt/gitlab/backups</code>上即可 (如果你没修改过默认备份目录的话)，但是需要注意的是新服务器上的 Gitlab 的版本必须与创建备份时的 Gitlab 版本号相同，比如新服务器安装的是最新的 9.0.5 版本的 Gitlab, 那么迁移之前，最好将老服务器的 Gitlab 升级为 9.0.5 在进行备份。</p><p>/Users/Alex/Documents/Hexo/source/_posts/</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/git">Git</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/04/11/guan-yu-kao-shi">关于考试</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-04-11T21:34:54.000Z" itemprop="datePublished">April 11, 2017</time> · <!-- -->3 min read</div></header><div class="markdown" itemprop="articleBody"><blockquote><p>时光飞逝，那大概是世界上最糟糕的一种感觉了吧。</p></blockquote><p>有点记不大清楚，上一次为了考试是什么时间了。</p><p>我说的考试不是各种面试等无形的考试，而是，你坐在四四方方的台子前，给你纸笔，限定时间，那种紧张的感觉，那种备考的心态。</p><p>所以时光会消磨人的斗志，让你不大能聚精会神的准备考试，让你变得懒散，让你变得不再有血性；所以，时间这种东西，不仅会在你的身上刻下斑驳印记，还会磨去你内心的棱角，一旦这样，你就会停下了脚步，大家的生活成了日复一日的重复，日子也过得索然无味，好像很多很多你想做的事，最后都是选择 plan B。</p><p>促使我写这篇的动力来自于，最近 AWS 助理级系统架构师的考试，而就在年前的时候，第一次去参加考试，没有通过，而且我一直在想到底是哪里出了问题，尽管我不愿意承认，问题根本是，我根本没有静下心来去准备考试，其实是，现在真的很难去静下心来去做考试这种事情，心气浮躁，要做的事情很多堆积在面前，你可能会被这些事情唬到，所以你很焦虑，光顾着去焦虑了，却没想着去解决这些问题，所以难道你的不是这些看起来很困难的问题，而是，你丧失了解决这些问题的勇气很血性；一方面反映在这里，另一方面也反映在你生活的各个方面，你好像没有动力去处理这些事情，总是在最后关头，勉勉强强叫上一份拼拼凑凑的答卷，这不会是你想要的样子，这是一种病，拖延。</p><p><a href="https://www.youtube.com/watch?v=Q6ZgU7KyQsM" target="_blank" rel="noopener noreferrer">每個人的遺憾，都大抵相似</a></p><iframe width="560" height="315" src="https://www.youtube.com/embed/Q6ZgU7KyQsM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe><p>之前看到过的一个视频，讲述的是在 New York 的街头方一块黑板，让你写下最后悔的事，很多都是自己真正想要做的，却未曾努力去做的事，“最后总是选择 plan B”，“未曾跳出自己的舒适圈”，人生总是带有遗憾，总是想象着自己会多么的闪耀，却没有勇气付出真心努力，对我是这样，学习，考试，减肥，很多自己想做的事，如果不能够鼓足勇气去做，人生过着便没有意义。</p><p>所以，很多事情，并非要你一定做到，而是，你是否真的努力去付出过，还是假意的敷衍，拖延妥协，这种感觉只有你自己真的知道，最后的遗憾，也只有自己知道，为什么要放手自己想要的。</p><p>不要怀疑，不要犹豫，努力去做自己想做的事，努力成为那个，你想要成为的人，永远怀揣着梦想，永远热泪盈眶。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/随笔">随笔</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/04/05/HowTo-set-Tomcat-7-automatic-startup-with-CentOS-7">HowTo set Tomcat 7 automatic startup with CentOS 7</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-04-05T15:21:03.000Z" itemprop="datePublished">April 5, 2017</time> · <!-- -->One min read</div></header><div class="markdown" itemprop="articleBody"><p>因 CentOS7 与 6 在系统上，变化较大，所以在之前的文章中讲到的使用 Tomcat7 开机自启动的方式在 CentOS7 是是无法使用的，所以这篇文章的目的是如何在 CentOS7 上将 Tomcat7 设置为开机自启动。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装-java-环境">安装 JAVA 环境<a href="#安装-java-环境" class="hash-link" aria-label="Direct link to 安装 JAVA 环境" title="Direct link to 安装 JAVA 环境">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@7 ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># curl -LO -H &quot;Cookie: oraclelicense=accept-securebackup-cookie&quot; \</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&quot;http://download.oracle.com/otn-pub/java/jdk/7u75-b13/jdk-7u75-linux-x64.rpm&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@7 ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># rpm -Uvh jdk-7u75-linux-x64.rpm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Preparing</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.                </span><span class="token comment" style="color:rgb(98, 114, 164)">####################### [100%]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token number">1</span><span class="token plain">:jdk                    </span><span class="token comment" style="color:rgb(98, 114, 164)">####################### [100%]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Unpacking JAR files</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rt.jar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        jsse.jar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        charsets.jar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        tools.jar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        localedata.jar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        jfxrt.jar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@7 ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># vi /etc/profile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># add follows to the end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">JAVA_HOME</span><span class="token operator">=</span><span class="token plain">/usr/java/default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:rgb(189, 147, 249);font-style:italic">PATH</span><span class="token operator">=</span><span class="token environment constant" style="color:rgb(189, 147, 249)">$PATH</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$JAVA_HOME</span><span class="token plain">/bin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">CLASSPATH</span><span class="token operator">=</span><span class="token plain">.:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$JAVA_HOME</span><span class="token plain">/jre/lib:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$JAVA_HOME</span><span class="token plain">/lib:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$JAVA_HOME</span><span class="token plain">/lib/tools.jar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@7 ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># source /etc/profile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="安装-tomcat7">安装 Tomcat7<a href="#安装-tomcat7" class="hash-link" aria-label="Direct link to 安装 Tomcat7" title="Direct link to 安装 Tomcat7">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@7 ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># wget http://ftp.riken.jp/net/apache/tomcat/tomcat-7/v7.0.77/bin/apache-tomcat-7.0.77.tar.gz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@7 ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># tar zxvf apache-tomcat-7.0.77.tar.gz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@7 ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># mv apache-tomcat-7.0.77 /usr/tomcat7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@7 ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># useradd -M -d /usr/tomcat7 tomcat7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@7 ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chown -R tomcat7. /usr/tomcat7</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="创建开机自启动脚本">创建开机自启动脚本<a href="#创建开机自启动脚本" class="hash-link" aria-label="Direct link to 创建开机自启动脚本" title="Direct link to 创建开机自启动脚本">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@7 ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># cat /usr/lib/systemd/system/tomcat7.service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># create new</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Unit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">Description</span><span class="token operator">=</span><span class="token plain">Apache Tomcat </span><span class="token number">7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">After</span><span class="token operator">=</span><span class="token plain">network.target</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Service</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">Type</span><span class="token operator">=</span><span class="token plain">oneshot</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ExecStart</span><span class="token operator">=</span><span class="token plain">/usr/tomcat7/bin/startup.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">ExecStop</span><span class="token operator">=</span><span class="token plain">/usr/tomcat7/bin/shutdown.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">RemainAfterExit</span><span class="token operator">=</span><span class="token plain">yes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">User</span><span class="token operator">=</span><span class="token plain">tomcat7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">Group</span><span class="token operator">=</span><span class="token plain">tomcat7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">Install</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">WantedBy</span><span class="token operator">=</span><span class="token plain">multi-user.target</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="启动-tomcat7">启动 Tomcat7<a href="#启动-tomcat7" class="hash-link" aria-label="Direct link to 启动 Tomcat7" title="Direct link to 启动 Tomcat7">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@7 ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># systemctl start tomcat7.service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@7 ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># systemctl enable tomcat7.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tomcat">Tomcat</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/03/23/zai-linux-zhong-duan-shi-yong-ssr-fu-wu-shi-xian-ke-xue-shang-wang">在 Linux 终端使用 SSR 服务实现科学上网</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-03-23T00:00:00.000Z" itemprop="datePublished">March 23, 2017</time> · <!-- -->4 min read</div></header><div class="markdown" itemprop="articleBody"><p>昨天在群内看到有朋友在询问如何在 Linux 终端内使用 SSR 来实现科学上网，所以抽空研究了下在 Linux 中如何使用，本文参考了<a href="https://www.zfl9.com/" target="_blank" rel="noopener noreferrer">Otokaze</a> 和 <a href="https://www.djangoz.com" target="_blank" rel="noopener noreferrer">Django</a> 两位的博客，文章链接在博文最后；SSR 服务提供商依然采用了<a href="http://ssglobal.co/wp" target="_blank" rel="noopener noreferrer">ssGlobal</a>，在 Google 的过程中，找了不少解决方案，这里仅做一种简单整理，实验操作系统有 CentOS 7.4 &amp; Ubuntu 16.04.3。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ssr-代理服务">ssr 代理服务<a href="#ssr-代理服务" class="hash-link" aria-label="Direct link to ssr 代理服务" title="Direct link to ssr 代理服务">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="下载">下载<a href="#下载" class="hash-link" aria-label="Direct link to 下载" title="Direct link to 下载">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 需要本地git 环境</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yum </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y </span><span class="token function" style="color:rgb(80, 250, 123)">git</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">git</span><span class="token plain"> clone https://github.com/SAMZONG/gfwlist2privoxy.git</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> gfwlist2privoxy/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">mv</span><span class="token plain"> ssr /usr/local/bin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> +x /usr/local/bin/ssr</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="安装配置">安装配置<a href="#安装配置" class="hash-link" aria-label="Direct link to 安装配置" title="Direct link to 安装配置">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@localhost ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># ssr install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Cloning into </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;/usr/local/share/shadowsocksr&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">remote: Counting objects: </span><span class="token number">5490</span><span class="token plain">, done.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">remote: Total </span><span class="token number">5490</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">delta </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">, reused </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">delta </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">, pack-reused </span><span class="token number">5490</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Receiving objects: </span><span class="token number">100</span><span class="token plain">% </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">5490</span><span class="token plain">/5490</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">, </span><span class="token number">1.71</span><span class="token plain"> MiB </span><span class="token operator">|</span><span class="token plain"> </span><span class="token number">410.00</span><span class="token plain"> KiB/s, done.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Resolving deltas: </span><span class="token number">100</span><span class="token plain">% </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">3799</span><span class="token plain">/3799</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">, done.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@localhost ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># ssr config   # 配置文件路径 /usr/local/share/shadowsocksr/config.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;server&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;0..0.0.0&quot;</span><span class="token plain">, // ssr服务器ip</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;server_ipv6&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;::&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;server_port&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">8080</span><span class="token plain">, // ssr服务器端口</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;local_address&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;127.0.0.1&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;local_port&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">1080</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;password&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;123456&quot;</span><span class="token plain">,  // 对应password</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;method&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;none&quot;</span><span class="token plain">,   // 这里对应SSGlobal配置中的Encryption</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;protocol&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;auth_chain_a&quot;</span><span class="token plain">,  //对应protocl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;protocol_param&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;obfs&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;http_simple&quot;</span><span class="token plain">,  //对应obfs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;obfs_param&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;hello.world&quot;</span><span class="token plain">, //对应obfs_param</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;speed_limit_per_con&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;speed_limit_per_user&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;additional_ports&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain">, // only works under multi-user mode</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;additional_ports_only&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> false, // only works under multi-user mode</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;timeout&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">120</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;udp_timeout&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">60</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;dns_ipv6&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;connect_verbose_info&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;redirect&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;fast_open&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="启动关闭">启动/关闭<a href="#启动关闭" class="hash-link" aria-label="Direct link to 启动/关闭" title="Direct link to 启动/关闭">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ssr start</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ssr stop </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="卸载">卸载<a href="#卸载" class="hash-link" aria-label="Direct link to 卸载" title="Direct link to 卸载">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ssr uninstall </span><span class="token comment" style="color:rgb(98, 114, 164)"># 这里操作会删除/usr/local/share/shadowsocksr</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以上，本地监听服务已经配置完成了，在填写的过程中，要注意你的本地监听地址和监听端口，默认是 127.0.0.1:1080，如果你修改了设置，那么在后续配置中也要配合修改。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="privoxy-配置">Privoxy 配置<a href="#privoxy-配置" class="hash-link" aria-label="Direct link to Privoxy 配置" title="Direct link to Privoxy 配置">​</a></h2><p>首先，需要安装 privoxy</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="centos-74">CentOS 7.4<a href="#centos-74" class="hash-link" aria-label="Direct link to CentOS 7.4" title="Direct link to CentOS 7.4">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">yum </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y epel-release</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">yum </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y privoxy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ubuntu-1604">Ubuntu 16.04<a href="#ubuntu-1604" class="hash-link" aria-label="Direct link to Ubuntu 16.04" title="Direct link to Ubuntu 16.04">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y privoxy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="全局模式">全局模式<a href="#全局模式" class="hash-link" aria-label="Direct link to 全局模式" title="Direct link to 全局模式">​</a></h3><p>代理模式同其他平台上方式，将所有 http/https 请求走代理服务，如果需要全局代理的话按照如下操作即可，如果要使用 PAC 模式，请跳过此部分。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 添加本地ssr服务到配置文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;forward-socks5 / 127.0.0.1:1080 .&#x27;</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token plain"> /etc/privoxy/config</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Privoxy 默认监听端口是是8118</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">http_proxy</span><span class="token operator">=</span><span class="token plain">http://127.0.0.1:8118</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">https_proxy</span><span class="token operator">=</span><span class="token plain">http://127.0.0.1:8118</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">no_proxy</span><span class="token operator">=</span><span class="token plain">localhost</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 启动服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl start privoxy.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pac-模式">PAC 模式<a href="#pac-模式" class="hash-link" aria-label="Direct link to PAC 模式" title="Direct link to PAC 模式">​</a></h3><p>使用 GFWList 是由 AutoProxy 官方维护，由众多网民收集整理的一个中国大陆防火长城的屏蔽列表，这里感谢<a href="https://www.zfl9.com/" target="_blank" rel="noopener noreferrer">@Otokaze</a> 为我们提供了转换 shell 自动转换脚本，为了方便修改，我 fork 了这个项目，将这篇教程所用到的资源进行了汇总，你可以在最开始<code>git clone</code>的目录中找到执行脚本。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@localhost ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># cd gfwlist2privoxy/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@localhost gfwlist2privoxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gfw.action  gfwlist2privoxy  README.md  ssr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@localhost gfwlist2privoxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># bash gfwlist2privoxy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">socks5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">: </span><span class="token number">127.0</span><span class="token plain">.0.1:1080  </span><span class="token comment" style="color:rgb(98, 114, 164)"># 注意，如果你修改了ssr本地监听端口是需要设置对应的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">+forward-override</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">forward-socks5 </span><span class="token number">127.0</span><span class="token plain">.0.1:1080 .</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&quot;cp -af /root/gfwlist2privoxy/gfw.action /etc/privoxy/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@localhost ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># cp -af gfw.action /etc/privoxy/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@localhost ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># echo &#x27;actionsfile gfw.action&#x27; &gt;&gt; /etc/privoxy/config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Privoxy 默认监听端口是是8118</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">http_proxy</span><span class="token operator">=</span><span class="token plain">http://127.0.0.1:8118</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">https_proxy</span><span class="token operator">=</span><span class="token plain">http://127.0.0.1:8118</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">no_proxy</span><span class="token operator">=</span><span class="token plain">localhost</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 启动服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">systemctl start privoxy.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="proxy-环境变量">proxy 环境变量<a href="#proxy-环境变量" class="hash-link" aria-label="Direct link to proxy 环境变量" title="Direct link to proxy 环境变量">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># privoxy默认监听端口为8118</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">http_proxy</span><span class="token operator">=</span><span class="token plain">http://127.0.0.1:8118</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">https_proxy</span><span class="token operator">=</span><span class="token plain">http://127.0.0.1:8118</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">no_proxy</span><span class="token operator">=</span><span class="token plain">localhost</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># no_proxy是不经过privoxy代理的地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 只能填写具体的ip、域名后缀，多个条目之间使用&#x27;,&#x27;逗号隔开</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 比如: export no_proxy=&quot;localhost, 192.168.1.1, ip.cn, chinaz.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 访问 localhost、192.168.1.1、ip.cn、*.ip.cn、chinaz.com、*.chinaz.com 将不使用代理</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="代理测试">代理测试<a href="#代理测试" class="hash-link" aria-label="Direct link to 代理测试" title="Direct link to 代理测试">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># 访问各大网站，如果都有网页源码输出说明代理没问题</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -sL www.baidu.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -sL www.google.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -sL www.google.com.hk</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -sL www.google.co.jp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -sL www.youtube.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -sL mail.google.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -sL facebook.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -sL twitter.com</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -sL www.wikipedia.org</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 获取当前 IP 地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 如果使用 privoxy 全局模式，则应该显示 ss 服务器的 IP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 如果使用 privoxy gfwlist模式，则应该显示本地公网 IP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -sL ip.chinaz.com/getip.aspx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="管理脚本">管理脚本<a href="#管理脚本" class="hash-link" aria-label="Direct link to 管理脚本" title="Direct link to 管理脚本">​</a></h3><p>在以上部署操作完成后，应该已经可以正常科学上网了，但是如果需要进行管理时，需要分别管理 ssr 和 privoxy，为了方便管理，这里写了一个 shell 脚本方便管理：ssr_manager</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Author Samzong.lu</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">case</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$1</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> start</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ssr start </span><span class="token operator">&amp;&gt;</span><span class="token plain"> /var/log/ssr-local.log</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  systemctl start privoxy.service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">http_proxy</span><span class="token operator">=</span><span class="token plain">http://127.0.0.1:8118</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">https_proxy</span><span class="token operator">=</span><span class="token plain">http://127.0.0.1:8118</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">no_proxy</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;localhost, ip.cn, chinaz.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> stop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">unset</span><span class="token plain"> http_proxy https_proxy no_proxy</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  systemctl stop privoxy.service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ssr stop </span><span class="token operator">&amp;&gt;</span><span class="token plain"> /var/log/ssr-log.log</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> autostart</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ssr start&quot;</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token plain"> /etc/rc.local</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  systemctl </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">enable</span><span class="token plain"> privoxy.service</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;http_proxy=http://127.0.0.1:8118&quot;</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token plain"> /etc/bashrc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https_proxy=http://127.0.0.1:8118&quot;</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token plain"> /etc/bashrc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;no_proxy=&#x27;localhost, ip.cn, chinaz.com&#x27;&quot;</span><span class="token plain"> </span><span class="token operator">&gt;&gt;</span><span class="token plain"> /etc/bashrc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> *</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;usage: source </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$0</span><span class="token string" style="color:rgb(255, 121, 198)"> start|stop|autostart&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exit</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">esac</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用">使用<a href="#使用" class="hash-link" aria-label="Direct link to 使用" title="Direct link to 使用">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">mv</span><span class="token plain"> gfwlist2privoxy/ssr_manager /usr/local/bin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> +x ssr_manager</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 启动服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ssr_manager start</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 关闭服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ssr_manager stop </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 添加开机自启动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ssr_manager autostart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考链接">参考链接<a href="#参考链接" class="hash-link" aria-label="Direct link to 参考链接" title="Direct link to 参考链接">​</a></h2><ul><li><a href="https://www.zfl9.com/ss-local.html" target="_blank" rel="noopener noreferrer">https://www.zfl9.com/ss-local.html</a></li><li><a href="https://www.djangoz.com/2017/08/16/linux_setup_ssr/" target="_blank" rel="noopener noreferrer">https://www.djangoz.com/2017/08/16/linux_setup_ssr/</a></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/google">Google</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/03/06/HowTo-install-Zoomdata">HowTo install Zoomdata</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-03-06T09:44:47.000Z" itemprop="datePublished">March 6, 2017</time> · <!-- -->One min read</div></header><div class="markdown" itemprop="articleBody"><p>Zoomdata 是一个大数据可视化展示的工具，由 ZoomData 企业创建，是为数不多的同时支持移动端的数据分析公司，Zoomdata 的可视化可将大数据流转化为触屏友好的，艺术感十足的三维形态，Zoomdata 的定位是非 ETL(传统的提取、转换和加载的数据处理过程) 工具，Zoomdata 支持多种数据源，包括社交媒体等，其中应用最主流是大数据平台的展示工具，并且 Zoomdata 对 Cloudera Impala 做了很好的支持，所以我们做了 Zoomdata+Cloudera 技术实施。<sup id="fnref-1-1ac1ac"><a href="#fn-1-1ac1ac" class="footnote-ref">1</a></sup></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="系统要求"><strong>系统要求</strong><a href="#系统要求" class="hash-link" aria-label="Direct link to 系统要求" title="Direct link to 系统要求">​</a></h4><p>Zoomdata 最新版是 v2.4，支持常见主流的操作系统，并且有非常友好的安装帮助，但是 Zoomdata 不支持安装在 32 位的操作系统之上</p><table><thead><tr><th>biaoti</th><th>biaoti</th><th>baiiti</th></tr></thead><tbody><tr><td>list</td><td>file</td><td>china</td></tr><tr><td>letian</td><td>zhong</td><td>hongkong</td></tr></tbody></table><div class="footnotes"><hr><ol><li id="fn-1-1ac1ac">这是一个示意的文档<a href="#fnref-1-1ac1ac" class="footnote-backref">↩</a></li></ol></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/microservice">Microservice</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/03/04/si-jie-mo-fang-te-shu-qing-kuang-zhi-chu-li">四阶魔方特殊情况之处理</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-03-04T00:00:00.000Z" itemprop="datePublished">March 4, 2017</time> · <!-- -->2 min read</div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="https://source.unsplash.com/random/480x480/?Rubik&#x27;s-Cube" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a href="#前言" class="hash-link" aria-label="Direct link to 前言" title="Direct link to 前言">​</a></h2><blockquote><p>注意，本文不是四阶魔方的还原教程。</p></blockquote><p>在还原高阶魔方 (四阶及以上) 时，采用的处理方法是，将魔方降级为三阶魔方，然后按照三阶魔方的技巧进行还原即可，但是在还原四阶魔方时会遇到 2 个不可能出现在三阶魔方的特殊情况，下面是针对这两个特殊情况的公式。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="特殊情况顶层黄色无法形成十或l">特殊情况：顶层黄色无法形成“十”或“L”<a href="#特殊情况顶层黄色无法形成十或l" class="hash-link" aria-label="Direct link to 特殊情况：顶层黄色无法形成“十”或“L”" title="Direct link to 特殊情况：顶层黄色无法形成“十”或“L”">​</a></h3><ul><li>1.手势：黄色面朝上</li><li>2.右边两层旋转 180&#x27;（这时应该黄色面有右面两层为白色）</li><li>3.后面一层旋转 180&#x27;</li><li>4.上面一层旋转 180&#x27;</li><li>5.左边两层靠近你身体旋转 90&#x27;</li><li>6.上面一层旋转 180&#x27;</li><li>7.右面两层靠近你身体旋转 90&#x27;</li><li>8.上面一层旋转 180&#x27;</li><li>9.右面两层远离你身体旋转 90&#x27;</li><li>10.上面一层旋转 180&#x27;</li><li>11.前面一层旋转 180&#x27;</li><li>12.右面两层远离你身体旋转 90&#x27;</li><li>13.前面一层旋转 180&#x27;</li><li>14.左边两层远离你身体旋转 90&#x27;</li><li>15.后面一层旋转 180&#x27;</li><li>16.右边两层旋转 180&#x27;</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="特殊情况最后四对棱角只有两对还原">特殊情况：最后四对棱角只有两对还原<a href="#特殊情况最后四对棱角只有两对还原" class="hash-link" aria-label="Direct link to 特殊情况：最后四对棱角只有两对还原" title="Direct link to 特殊情况：最后四对棱角只有两对还原">​</a></h3><ul><li>1.黄色面已经还原的情况下，黄色面朝上</li><li>2.右面夹层旋转 180&#x27;</li><li>3.上面一层旋转 180‘</li><li>4.右面夹层旋转 180&#x27;</li><li>5.上面两层旋转 180&#x27;</li><li>6.右面夹层旋转 180&#x27;</li><li>7.上面两层旋转 180&#x27;</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/随笔">随笔</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/02/27/mactips-shi-yong-ming-ling-guan-bi-he-qi-dong-airport">MacTips 使用命令关闭和启动 AirPort</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-02-27T23:40:29.000Z" itemprop="datePublished">February 27, 2017</time> · <!-- -->One min read</div></header><div class="markdown" itemprop="articleBody"><p>今天在给妹妹调试新的 MacBookAir 13’时遇到一个问题，无法检测到她家的 WiFi，一开始怀疑是不是无线路由器长时间未重启导致，所以重启了路由器，但是问题依然没有解决，于是我们将问题转向排查设备，因我们基本正好有 iPad，iPhone，MacBook 这些设备，发现唯独他的这个 Macbook 无法识别 WiFi，后来在 Google 的帮助下，发现多个版本的 Mac OS X 都出现了类似的问题，可以通过重启 AirPort 解决问题，但是 AirPort 在 System Preferences 找不到选项，所以需要使用命令行来重启。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="查看网络接口">查看网络接口<a href="#查看网络接口" class="hash-link" aria-label="Direct link to 查看网络接口" title="Direct link to 查看网络接口">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">ifconfig</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">en0: </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">flags</span><span class="token operator">=</span><span class="token number">886</span><span class="token operator file-descriptor important">3</span><span class="token operator">&lt;</span><span class="token plain">UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST</span><span class="token operator">&gt;</span><span class="token plain"> mtu </span><span class="token number">1500</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> ether </span><span class="token number">60</span><span class="token plain">:f8:1d:ad:85:76</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> inet6 fe80::18a9:fa23:b02f:5d8a%en0 prefixlen </span><span class="token number">64</span><span class="token plain"> secured scopeid 0x4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> inet </span><span class="token number">192.168</span><span class="token plain">.199.200 netmask 0xffffff00 broadcast </span><span class="token number">192.168</span><span class="token plain">.199.255</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> nd6 </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">options</span><span class="token operator">=</span><span class="token number">20</span><span class="token operator file-descriptor important">1</span><span class="token operator">&lt;</span><span class="token plain">PERFORMNUD,DAD</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> media: autoselect</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> status: active</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="关闭-airport">关闭 AirPort<a href="#关闭-airport" class="hash-link" aria-label="Direct link to 关闭 AirPort" title="Direct link to 关闭 AirPort">​</a></h2><p>有时候设备的名称是 en0、en1 这样，所以，可以用过设备名称来重启 airport，例如 en0</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">networksetup -setairportpower en0 off</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="查看状态">查看状态<a href="#查看状态" class="hash-link" aria-label="Direct link to 查看状态" title="Direct link to 查看状态">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">networksetup -getairportpower en0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="关闭-airport-networksetup">关闭 AirPort networksetup<a href="#关闭-airport-networksetup" class="hash-link" aria-label="Direct link to 关闭 AirPort networksetup" title="Direct link to 关闭 AirPort networksetup">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">networksetup -setairportpower en0 on</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/mac">Mac</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/02/27/HowTo-Install-NextCloud">HowTo Install NextCloud</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-02-27T14:57:00.000Z" itemprop="datePublished">February 27, 2017</time> · <!-- -->7 min read</div></header><div class="markdown" itemprop="articleBody"><p>随着最近一个云盘厂家不再提供个人服务，或者开始各种收费限速，自己存放在第三方云盘厂商的数据被盗取，数据的安全性和数据的稳定性都得不到保证，而且随着智能终端的普及，我也有一些更加高质量的图片文件需要大量储存，所以我想到了自建存储服务的方式，在甄别了 OwnCloud，Seafiles 和 NextCloud，最后选择了 NextCloud 作为自己今后数据存储节点，NextCloud 源自 OwnCloud，但是近些年来 OwnCloud 的发展进度几乎停滞，多数开发者也转战 NextCloud，当然 NextCloud 也继承了搭建简单，依赖于 PHP 环境的特性。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="运行环境">运行环境<a href="#运行环境" class="hash-link" aria-label="Direct link to 运行环境" title="Direct link to 运行环境">​</a></h2><ul><li>阿里云 ECS CentOS 6.x</li><li>免费 SSL 证书 (腾讯云申请)</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="搭建-lnmp-环境">搭建 LNMP 环境<a href="#搭建-lnmp-环境" class="hash-link" aria-label="Direct link to 搭建 LNMP 环境" title="Direct link to 搭建 LNMP 环境">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="软件版本">软件版本<a href="#软件版本" class="hash-link" aria-label="Direct link to 软件版本" title="Direct link to 软件版本">​</a></h3><ul><li>PHP 5.6.30   <a href="https://samzong.me/php54-centos6/" target="_blank" rel="noopener noreferrer">安装教程</a></li><li>MySQL 5.6.35  <a href="https://samzong.me/how-to-install-mysql-5-6-on-centos/" target="_blank" rel="noopener noreferrer">安装教程</a></li><li>Nginx 1.10.2</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="基础环境安装">基础环境安装<a href="#基础环境安装" class="hash-link" aria-label="Direct link to 基础环境安装" title="Direct link to 基础环境安装">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum update -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum groupinstall -y &quot;Base&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum groupinstall -y &quot;Development tools&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Install epel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum install -y epel-release</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Install remi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum install http://rpms.famillecollet.com/enterprise/remi-release-6.rpm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Install mysql-community</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum install http://repo.mysql.com/yum/mysql-5.6-community/el/6/x86_64/mysql-community-release-el6-7.noarch.rpm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-lnmp">Install LNMP<a href="#install-lnmp" class="hash-link" aria-label="Direct link to Install LNMP" title="Direct link to Install LNMP">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># Install MySQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum --enablerepo=mysql-community install -y mysql-server mysql-libs mysql-devel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service mysqld start</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># mysql_secure_installation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chkconfig mysqld on</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Install Nginx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum --enablerepo=epel install -y nginx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service nginx start</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chkconfig nginx on</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Install PHP and php-fpm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum --enablerepo=remi-php56 install php php-fpm php-mysql php-gd php-xml php-redis php-libs php-devel php-zlib</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service php-fpm start</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chkconfig php-fpm on</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service nginx restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="下载-nextcloud">下载 NextCloud<a href="#下载-nextcloud" class="hash-link" aria-label="Direct link to 下载 NextCloud" title="Direct link to 下载 NextCloud">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># wget https://download.nextcloud.com/server/releases/nextcloud-11.0.1.tar.bz2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># tar xf nextcloud-11.0.1.tar.bz2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># mv nextcloud-11.0.1 /opt/nextcloud</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置-nginx-和-php-fpm">配置 Nginx 和 php-fpm<a href="#配置-nginx-和-php-fpm" class="hash-link" aria-label="Direct link to 配置 Nginx 和 php-fpm" title="Direct link to 配置 Nginx 和 php-fpm">​</a></h3><p>因为 php-fpm 默认运行的用户身份是 apache，我们这里使用的环境是 nginx，所有要修改 php-fpm 配置文件的用户和组，注意不要为了省事直接改为 root，这在 php-fpm 中是不允许的</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># vim /etc/php-fpm.d/www.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">user</span><span class="token operator">=</span><span class="token plain">nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">group</span><span class="token operator">=</span><span class="token plain">nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service php-fpm restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因为 NextCloud 默认是以 Apache 的身份运行的，所以我们需要单独配置 NextCloud 的 Nginx 配置文件，以下配置文件，你可以直接拿去用，注意在文件中说明了，需要修改的地方：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># vim /etc/nginx/conf.d/nextcloud.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> upstream php-handler </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)"># 这里是你php-fpm的服务端口，默认是9000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    server </span><span class="token number">127.0</span><span class="token plain">.0.1:9000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#server unix:/var/run/php5-fpm.sock;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)"># 你的域名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    listen pan.ultraera.org:80</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    server_name pan.ultraera.org</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># enforce https</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">return</span><span class="token plain"> </span><span class="token number">301</span><span class="token plain"> https://</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$server_name</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$request_uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># 你的域名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    listen pan.ultraera.org:443 ssl</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    server_name pan.ultraera.org</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)"># 以下是你的ssl证书文件存放路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ssl_certificate /etc/nginx/ssl/1_pan.ultraera.org_bundle.crt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ssl_certificate_key /etc/nginx/ssl/2_pan.ultraera.org.key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Add headers to serve security related headers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Before enabling Strict-Transport-Security headers please read into this</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># topic first.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># add_header Strict-Transport-Security &quot;max-age=15768000;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># includeSubDomains; preload;&quot;;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    add_header X-Content-Type-Options nosniff</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    add_header X-Frame-Options </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;SAMEORIGIN&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    add_header X-XSS-Protection </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1; mode=block&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    add_header X-Robots-Tag none</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    add_header X-Download-Options noopen</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    add_header X-Permitted-Cross-Domain-Policies none</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> add_header Strict-Transport-Security </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;max-age=15552000; includeSubdomains; &quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># 设定你的NextCloud的根目录，请根据实际修改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    root /opt/nextcloud/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location </span><span class="token operator">=</span><span class="token plain"> /robots.txt </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        allow all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        log_not_found off</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        access_log off</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># The following 2 rules are only needed for the user_webfinger app.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Uncomment it if you&#x27;re planning to use this app.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#rewrite ^/.well-known/host-meta /public.php?service=host-meta last;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#rewrite ^/.well-known/host-meta.json /public.php?service=host-meta-json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># last;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location </span><span class="token operator">=</span><span class="token plain"> /.well-known/carddav </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">return</span><span class="token plain"> </span><span class="token number">301</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$scheme</span><span class="token plain">://</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$host</span><span class="token plain">/remote.php/dav</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location </span><span class="token operator">=</span><span class="token plain"> /.well-known/caldav </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">return</span><span class="token plain"> </span><span class="token number">301</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$scheme</span><span class="token plain">://</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$host</span><span class="token plain">/remote.php/dav</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># set max upload size</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    client_max_body_size 512M</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    fastcgi_buffers </span><span class="token number">64</span><span class="token plain"> 4K</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Disable gzip to avoid the removal of the ETag header</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token function" style="color:rgb(80, 250, 123)">gzip</span><span class="token plain"> off</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Uncomment if your server is build with the ngx_pagespeed module</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># This module is currently not supported.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#pagespeed off;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    error_page </span><span class="token number">403</span><span class="token plain"> /core/templates/403.php</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    error_page </span><span class="token number">404</span><span class="token plain"> /core/templates/404.php</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location / </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rewrite ^ /index.php</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$uri</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location ~ ^/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:build</span><span class="token operator">|</span><span class="token plain">tests</span><span class="token operator">|</span><span class="token plain">config</span><span class="token operator">|</span><span class="token plain">lib</span><span class="token operator">|</span><span class="token plain">3rdparty</span><span class="token operator">|</span><span class="token plain">templates</span><span class="token operator">|</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">/ </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        deny all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location ~ ^/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">.</span><span class="token operator">|</span><span class="token plain">autotest</span><span class="token operator">|</span><span class="token plain">occ</span><span class="token operator">|</span><span class="token plain">issue</span><span class="token operator">|</span><span class="token plain">indie</span><span class="token operator">|</span><span class="token plain">db_</span><span class="token operator">|</span><span class="token plain">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        deny all</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location ~ ^/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:index</span><span class="token operator">|</span><span class="token plain">remote</span><span class="token operator">|</span><span class="token plain">public</span><span class="token operator">|</span><span class="token function" style="color:rgb(80, 250, 123)">cron</span><span class="token operator">|</span><span class="token plain">core/ajax/update</span><span class="token operator">|</span><span class="token plain">status</span><span class="token operator">|</span><span class="token plain">ocs/v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">12</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token operator">|</span><span class="token plain">updater/.+</span><span class="token operator">|</span><span class="token plain">ocs-provider/.+</span><span class="token operator">|</span><span class="token plain">core/templates/40</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token number">34</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">.php</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:$</span><span class="token operator">|</span><span class="token plain">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        include fastcgi_params</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_split_path_info ^</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">.+</span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">.php</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">/.*</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">$</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_param SCRIPT_FILENAME </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$document_root</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$fastcgi_script_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_param PATH_INFO </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$fastcgi_path_info</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_param HTTPS on</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">#Avoid sending the security headers twice</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_param modHeadersAvailable </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_param front_controller_active </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_pass php-handler</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_intercept_errors on</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fastcgi_request_buffering off</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location ~ ^/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:updater</span><span class="token operator">|</span><span class="token plain">ocs-provider</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:$</span><span class="token operator">|</span><span class="token plain">/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try_files </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$uri</span><span class="token plain">/ </span><span class="token operator">=</span><span class="token number">404</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        index index.php</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Adding the cache control header for js and css files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># Make sure it is BELOW the PHP block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location ~* </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:css</span><span class="token operator">|</span><span class="token plain">js</span><span class="token operator">|</span><span class="token plain">woff</span><span class="token operator">|</span><span class="token plain">svg</span><span class="token operator">|</span><span class="token plain">gif</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">$ </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try_files </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$uri</span><span class="token plain"> /index.php</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$uri</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$is_args</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$args</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header Cache-Control </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;public, max-age=7200&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Add headers to serve security related headers (It is intended to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># have those duplicated to the ones above)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Before enabling Strict-Transport-Security headers please read into</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># this topic first.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># add_header Strict-Transport-Security &quot;max-age=15768000;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">#  includeSubDomains; preload;&quot;;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header X-Content-Type-Options nosniff</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header X-Frame-Options </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;SAMEORIGIN&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header X-XSS-Protection </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;1; mode=block&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header X-Robots-Tag none</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header X-Download-Options noopen</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        add_header X-Permitted-Cross-Domain-Policies none</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Optional: Don&#x27;t log access to assets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        access_log off</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    location ~* </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain">.</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">?:png</span><span class="token operator">|</span><span class="token plain">html</span><span class="token operator">|</span><span class="token plain">ttf</span><span class="token operator">|</span><span class="token plain">ico</span><span class="token operator">|</span><span class="token plain">jpg</span><span class="token operator">|</span><span class="token plain">jpeg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">$ </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try_files </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$uri</span><span class="token plain"> /index.php</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$uri</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$is_args</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$args</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># Optional: Don&#x27;t log access to other assets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        access_log off</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service nginx restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="文件权限调整">文件权限调整<a href="#文件权限调整" class="hash-link" aria-label="Direct link to 文件权限调整" title="Direct link to 文件权限调整">​</a></h3><p>因为 NextCloud 运行是以 nginx 程序，注意修改目录所属用户和组为 nginx</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chown -R nginx:nginx /opt/nextcloud</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建-mysql-数据库">创建 MySQL 数据库<a href="#创建-mysql-数据库" class="hash-link" aria-label="Direct link to 创建 MySQL 数据库" title="Direct link to 创建 MySQL 数据库">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> CREATE DATABASE nextcloud CHARACTER SET UTF-8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> GRANT ALL PRIVILEGES ON nextcloud.* TO </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;nextcloud&#x27;</span><span class="token plain">@</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;localhost&#x27;</span><span class="token plain"> IDENTIFIED BY </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;your_password&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql</span><span class="token operator">&gt;</span><span class="token plain"> FLUSH PRIVILEGES</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="初始化-nextcloud">初始化 NextCloud<a href="#初始化-nextcloud" class="hash-link" aria-label="Direct link to 初始化 NextCloud" title="Direct link to 初始化 NextCloud">​</a></h2><p>在浏览器打开你在 nginx 中配置的域名，NextCloud 初始化非常简单，设定一个管理员账户和密码，然后设定数据库即可，按照我们上一步针对 MySQL 的设定，你会非常清楚地知道你的数据库信息：</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/jjkqh.png" alt="image" class="img_ev3q"></p><p>登录之后的界面是这样：</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/7n28v.png" alt="image" class="img_ev3q"></p><p>你可以在登录之后，在你的右上角点击头像选择 Admin 进入管理界面查看和修改你的服务器设置，你还可以在浏览器上方看到你的服务器现有哪些问题，会有对应文档提醒你如何解决这些问题。</p><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/yx34e.png" alt="image" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="other">Other<a href="#other" class="hash-link" aria-label="Direct link to Other" title="Direct link to Other">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="修改默认-data-目录">修改默认 data 目录<a href="#修改默认-data-目录" class="hash-link" aria-label="Direct link to 修改默认 data 目录" title="Direct link to 修改默认 data 目录">​</a></h3><p>在我们首次打开 NextCloud 网页时，需要我们设定 datadir 目录，这里有个默认目录在 nextcloud 项目包，这其实是不安全的，我们最后将目录路径修改为其他位置：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># mkdir /nextcloud_files/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chown -R nginx:nginx /nextcloud_files/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 修改datadirectory的路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># vim /opt/nextcloud/config/config.php</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">datadirectory</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27; =&gt; &#x27;</span><span class="token plain">/nextcloud/data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="无法登陆到个人用户界面">无法登陆到个人用户界面<a href="#无法登陆到个人用户界面" class="hash-link" aria-label="Direct link to 无法登陆到个人用户界面" title="Direct link to 无法登陆到个人用户界面">​</a></h3><p>我在安装时碰到这个问题，折腾了很久才解决，因为我们是使用 nginx 程序，但是 php-fpm 默认用户身份为 apache，所以<code>/var/lib/php/session</code>目录的所属用户和组都是 apache，导致我们没有权限去写入 session，所以无法登入系统，报错信息可以在 NextCloud 的 log 文件下看到：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># tail -n 1 /usr/nextcloud/data/nextcloud.log</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;reqId&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;NNnIwMCCPDMQtzZW5Ndc&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;remoteAddr&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;180.166.66.226&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;app&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;PHP&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;message&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;session_write_close(): Failed to write session data (files). Please verify that the current setting of session.save_path is correct (\/var\/lib\/php\/session) at \/usr\/nextcloud\/lib\/private\/Session\/Internal.php#104&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;level&quot;</span><span class="token plain">:3,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;time&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;2017-02-24T10:46:13+00:00&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;method&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;POST&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;url&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;\/index.php&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;user&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;samzong&quot;</span><span class="token plain">,</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;version&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;11.0.0.10&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 修改/var/lib/php/的属组为nginx即可</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># chgrp -R nginx /var/lib/php</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="增加-redis-组件提高性能">增加 redis 组件，提高性能<a href="#增加-redis-组件提高性能" class="hash-link" aria-label="Direct link to 增加 redis 组件，提高性能" title="Direct link to 增加 redis 组件，提高性能">​</a></h3><p>关于如何安装 redis 我在之前的文章中也有讲到，大家可以去看下 <a href="https://samzong.me/redis01/" target="_blank" rel="noopener noreferrer">安装教程</a></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum --enablerepo=remi install -y redis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 增加php的redis插件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># yum --enablerepo=remi-php56 install php-redis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 配置文件增加redis</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;memcache.local&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;\\OC\\Memcache\\Redis&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;memcache.locking&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;\\OC\\Memcache\\Redis&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;redis&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   array </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;host&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;localhost&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;port&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">6379</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 重启令服务生效</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service php-fpm restart</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@ultraera ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># service nginx restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我的 NextCloud 配置如下：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token operator">&lt;</span><span class="token plain">?php</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$CONFIG</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> array </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;memcache.local&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;\\OC\\Memcache\\Redis&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;memcache.locking&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;\\OC\\Memcache\\Redis&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;redis&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  array </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;host&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;localhost&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;port&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">6379</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;enable_previews&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> false,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;instanceid&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;ockhup01dxbf&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;passwordsalt&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;TlJgWGrE0N7vOrRfZkOojwdYh/BixL&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;secret&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;/IQh0LioZp5eYFQJhicY7n324Q80WQUYOzWL+8OcxcXVw3Ef&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;trusted_domains&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  array </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">0</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;pan.ultraera.org&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;datadirectory&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;/nextcloud&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;overwrite.cli.url&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;https://pan.ultraera.org&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dbtype&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;mysql&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;version&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;11.0.0.10&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dbname&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;nextcloud&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dbhost&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;localhost&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dbport&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dbtableprefix&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;oc_&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dbuser&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;nextcloud&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;dbpassword&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;nextcloud&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;logtimezone&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;CST&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;installed&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> true,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;mail_from_address&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;luchuanjia&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;mail_smtpmode&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;php&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;mail_domain&#x27;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;msn.com&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ssl-证书">SSL 证书<a href="#ssl-证书" class="hash-link" aria-label="Direct link to SSL 证书" title="Direct link to SSL 证书">​</a></h3><p>现国内提供免费的 SSL 证书的服务商很多，作为个人站点，免费 SSL 证书是个挺不错的选择，我在之前 nginx 配置时将 ssl 的配置方式写在了配置文件中了，注意如果不启用 ssl 时，不要启用 https 的虚拟主机，当然你可以自己生成一个 ssl 证书来提供服务，但这样在别人访问你的网站时，会不提示不受信任的证书，具体如何获取的证书的方式，因各个厂家方式有些区别，这里就不赘述，可以联系对应的厂商的技术人员咨询。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用现状">使用现状<a href="#使用现状" class="hash-link" aria-label="Direct link to 使用现状" title="Direct link to 使用现状">​</a></h2><p>在将服务搭建完成之后，对于存储的文件加密，现在通过 jobs，每日凌晨将文件推送到 oss 内，保存 2 天的数据，避免因为服务器宕机导致文件丢失；使用端，自己的电脑和手机，还有家人的手机，都安装了应用，后台自动将拍照图片等自动上传到云盘，使用起来目前很稳定，只是 iOS 应用是收费的，因为 NextCloud 源于 OwnCloud，如果你之前购买了 OwnCloud 的 App 也可以直接使用，当然 NextCloud 也有很多其他功能，可以根据你的实际需求发掘。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/02/22/HowTo-Install-Redmine">HowTo Install Redmine</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-02-22T12:30:36.000Z" itemprop="datePublished">February 22, 2017</time> · <!-- -->3 min read</div></header><div class="markdown" itemprop="articleBody"><h4 class="anchor anchorWithStickyNavbar_LWe7" id="runtime-environment">Runtime environment<a href="#runtime-environment" class="hash-link" aria-label="Direct link to Runtime environment" title="Direct link to Runtime environment">​</a></h4><ul><li>CentOS 6.x</li><li>Redmine 3.3.2</li><li>Ruby 2.2.6</li><li>rails 4.2</li><li>MySQL 5.1</li><li>Nginx 1.10</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装-rvm">安装 rvm<a href="#安装-rvm" class="hash-link" aria-label="Direct link to 安装 rvm" title="Direct link to 安装 rvm">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="导入公钥">导入公钥<a href="#导入公钥" class="hash-link" aria-label="Direct link to 导入公钥" title="Direct link to 导入公钥">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# curl -sSL https://rvm.io/mpapis.asc | gpg --import</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="安装">安装<a href="#安装" class="hash-link" aria-label="Direct link to 安装" title="Direct link to 安装">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# curl -L https://get.rvm.io | bash -s stable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="加载-rvm-环境并安装基础依赖包">加载 rvm 环境并安装基础依赖包<a href="#加载-rvm-环境并安装基础依赖包" class="hash-link" aria-label="Direct link to 加载 rvm 环境并安装基础依赖包" title="Direct link to 加载 rvm 环境并安装基础依赖包">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# source /etc/profile.d/rvm.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# rvm requirements</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装-ruby">安装 ruby<a href="#安装-ruby" class="hash-link" aria-label="Direct link to 安装 ruby" title="Direct link to 安装 ruby">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# rvm install 2.2.6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# rvm use 2.2.6 --default</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装-rails">安装 rails<a href="#安装-rails" class="hash-link" aria-label="Direct link to 安装 rails" title="Direct link to 安装 rails">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="更换-gem-源">更换 gem 源<a href="#更换-gem-源" class="hash-link" aria-label="Direct link to 更换 gem 源" title="Direct link to 更换 gem 源">​</a></h5><p>默认 gem 的源站点是<a href="https://rubygems.org" target="_blank" rel="noopener noreferrer">https://rubygems.org</a> 由于国内的网络原因导致无法连接，所以导致无法使用 gem 安装，这里换成国内淘宝的 gem 镜像站点</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# gem sources -l</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*** CURRENT SOURCES ***</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">https://rubygems.org/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# gem sources --remove https://rubygems.org/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# gem sources -a https://ruby.taobao.org/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# gem sources -l</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*** CURRENT SOURCES ***</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">https://ruby.taobao.org/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="安装-1">安装<a href="#安装-1" class="hash-link" aria-label="Direct link to 安装" title="Direct link to 安装">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# gem install rails -v=4.2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装-mysql">安装 MySQL<a href="#安装-mysql" class="hash-link" aria-label="Direct link to 安装 MySQL" title="Direct link to 安装 MySQL">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# yum install -y mysql-server mysql-libs mysql-devel mysql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# service mysqld start</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# mysql_secure_installation</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装-redmine">安装 redmine<a href="#安装-redmine" class="hash-link" aria-label="Direct link to 安装 redmine" title="Direct link to 安装 redmine">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="下载-redmine-332">下载 Redmine 3.3.2<a href="#下载-redmine-332" class="hash-link" aria-label="Direct link to 下载 Redmine 3.3.2" title="Direct link to 下载 Redmine 3.3.2">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# wget http://www.redmine.org/releases/redmine-3.3.2.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# tar xf redmine-3.3.2.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# mv redmine-3.3.2 /opt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="安装管理-ruby-的包管理工具-bundler">安装管理 ruby 的包管理工具 bundler<a href="#安装管理-ruby-的包管理工具-bundler" class="hash-link" aria-label="Direct link to 安装管理 ruby 的包管理工具 bundler" title="Direct link to 安装管理 ruby 的包管理工具 bundler">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 注意，一定要在redmine目录下操作</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# cd /opt/redmine-3.3.2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# gem install bundler</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="安装-redmine-运行所需要的依赖包">安装 redmine 运行所需要的依赖包<a href="#安装-redmine-运行所需要的依赖包" class="hash-link" aria-label="Direct link to 安装 redmine 运行所需要的依赖包" title="Direct link to 安装 redmine 运行所需要的依赖包">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# bundle install --without development test rmagick</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="为-rails-生产-cookies-秘钥">为 rails 生产 cookies 秘钥<a href="#为-rails-生产-cookies-秘钥" class="hash-link" aria-label="Direct link to 为 rails 生产 cookies 秘钥" title="Direct link to 为 rails 生产 cookies 秘钥">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# rake generate_secret_token</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="创建-redmine-的数据库">创建 redmine 的数据库<a href="#创建-redmine-的数据库" class="hash-link" aria-label="Direct link to 创建 redmine 的数据库" title="Direct link to 创建 redmine 的数据库">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; create database redmine character set utf8;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; grant all privileges on redmine.* to &#x27;redmine&#x27;@&#x27;localhost&#x27; identified by &#x27;redmine_pass&#x27;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="修改-redmine-的-databaseyml">修改 redmine 的 database.yml<a href="#修改-redmine-的-databaseyml" class="hash-link" aria-label="Direct link to 修改 redmine 的 database.yml" title="Direct link to 修改 redmine 的 database.yml">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# cp config/database.yml.example config/database.yml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# vim config/database.yml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">production:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  adapter: mysql2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  database: redmine</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  host: localhost</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  username: redmine</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  password: &quot;redmine_pass&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  encoding: utf8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="创建数据库结构">创建数据库结构<a href="#创建数据库结构" class="hash-link" aria-label="Direct link to 创建数据库结构" title="Direct link to 创建数据库结构">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# RAILS_ENV=production bundle exec rake db:migrate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="生产缺省数据">生产缺省数据<a href="#生产缺省数据" class="hash-link" aria-label="Direct link to 生产缺省数据" title="Direct link to 生产缺省数据">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# RAILS_ENV=production bundle exec rake redmine:load_default_data</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 选择默认语言，之后可更改，初始为en</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="测试是否安装成功">测试是否安装成功<a href="#测试是否安装成功" class="hash-link" aria-label="Direct link to 测试是否安装成功" title="Direct link to 测试是否安装成功">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# bundle exec rails server webrick -e production -b 0.0.0.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>默认运行 3000 端口，默认管理员 admin/admin</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="配置-redmine-在-nginx-上运行">配置 Redmine 在 Nginx 上运行<a href="#配置-redmine-在-nginx-上运行" class="hash-link" aria-label="Direct link to 配置 Redmine 在 Nginx 上运行" title="Direct link to 配置 Redmine 在 Nginx 上运行">​</a></h4><p>Redmine 常用的解决办法是使用 passenger+nginx，但是 Nginx 不支持装载模块，所以需要重新编译安装 Nginx，安装 Nginx 的 Passenger 有两种方式</p><ul><li>采用 Passenger 提供的脚本进行安装，适合新环境</li><li>手动编译安装 Nginx 增加 Passenger 模块，适合已存在 Nginx 环境</li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="采用-passenger-提供脚本安装">采用 Passenger 提供脚本安装<a href="#采用-passenger-提供脚本安装" class="hash-link" aria-label="Direct link to 采用 Passenger 提供脚本安装" title="Direct link to 采用 Passenger 提供脚本安装">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# gem install passenger</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# passenger-install-nginx-module --auto --prefix=/opt/nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="采用重新编译-nginx-增加-passenger-模块">采用重新编译 Nginx 增加 Passenger 模块<a href="#采用重新编译-nginx-增加-passenger-模块" class="hash-link" aria-label="Direct link to 采用重新编译 Nginx 增加 Passenger 模块" title="Direct link to 采用重新编译 Nginx 增加 Passenger 模块">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 获取passenger的安装路径</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# passenger-config --root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 重新编译Nginx并添加模块</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# wget http://nginx.org/download/nginx-1.10.3.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# tar xf nginx-1.10.3.tar.gz</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# cd nginx-1.10.3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost nginx-1.10.3]# ./configure ... -add-module=/usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="增加-http-模块内以下配置">增加 HTTP 模块内以下配置<a href="#增加-http-模块内以下配置" class="hash-link" aria-label="Direct link to 增加 HTTP 模块内以下配置" title="Direct link to 增加 HTTP 模块内以下配置">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">passenger_root /usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="配置-nginxconf-修改-server-模块中-location-的配置">配置 nginx.conf 修改 server 模块中 location 的配置<a href="#配置-nginxconf-修改-server-模块中-location-的配置" class="hash-link" aria-label="Direct link to 配置 nginx.conf 修改 server 模块中 location 的配置" title="Direct link to 配置 nginx.conf 修改 server 模块中 location 的配置">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  # ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  passenger_enabled on;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  location / {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    root /opt/redmine-3.3.2/public;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    index index.html index.htm;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="启动-nginx">启动 Nginx<a href="#启动-nginx" class="hash-link" aria-label="Direct link to 启动 Nginx" title="Direct link to 启动 Nginx">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost ~]# /root/nginx-1.10.3/sbin/nginx -c /root/nginx-1.10.3/conf/nginx.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="其他">其他<a href="#其他" class="hash-link" aria-label="Direct link to 其他" title="Direct link to 其他">​</a></h4><p>到这里，所有的安装都完成了，过程中我遇到这些问题，你也注意下：</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="71-could-not-find-gem-mysql2--0311-in-any-of-the-gem-sources-listed-in-your-gemfile">7.1 Could not find gem &#x27;mysql2 (~&gt; 0.3.11)&#x27; in any of the gem sources listed in your Gemfile<a href="#71-could-not-find-gem-mysql2--0311-in-any-of-the-gem-sources-listed-in-your-gemfile" class="hash-link" aria-label="Direct link to 7.1 Could not find gem &#x27;mysql2 (~&gt; 0.3.11)&#x27; in any of the gem sources listed in your Gemfile" title="Direct link to 7.1 Could not find gem &#x27;mysql2 (~&gt; 0.3.11)&#x27; in any of the gem sources listed in your Gemfile">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# rm -f Gemfile.lock</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@localhost redmine-3.3.2]# bundle install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="72-curl-tools">7.2 curl-tools<a href="#72-curl-tools" class="hash-link" aria-label="Direct link to 7.2 curl-tools" title="Direct link to 7.2 curl-tools">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">yum install libcurl-devel</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/02/20/HowTo-Upgrade-Your-Ghost-Version">HowTo Upgrade Your Ghost Version</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-02-20T14:39:15.000Z" itemprop="datePublished">February 20, 2017</time> · <!-- -->One min read</div></header><div class="markdown" itemprop="articleBody"><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-下载最新版的-ghost">1. 下载最新版的 Ghost<a href="#1-下载最新版的-ghost" class="hash-link" aria-label="Direct link to 1. 下载最新版的 Ghost" title="Direct link to 1. 下载最新版的 Ghost">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">curl -LOk https://ghost.org/zip/ghost-latest.zip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-创建临时目录并解压-ghost-latestzip-到此">2. 创建临时目录，并解压 ghost-latest.zip 到此<a href="#2-创建临时目录并解压-ghost-latestzip-到此" class="hash-link" aria-label="Direct link to 2. 创建临时目录，并解压 ghost-latest.zip 到此" title="Direct link to 2. 创建临时目录，并解压 ghost-latest.zip 到此">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir /usr/ghost-tmp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">unzip ghost-latest.zip -d /usr/ghost-tmp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-进入到原-ghost-目录删除-core">3. 进入到原 ghost 目录，删除 core<a href="#3-进入到原-ghost-目录删除-core" class="hash-link" aria-label="Direct link to 3. 进入到原 ghost 目录，删除 core" title="Direct link to 3. 进入到原 ghost 目录，删除 core">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd  /usr/ghost</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rm -rf core</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4进入到新版本的-ghost-临时目录">4.进入到新版本的 ghost 临时目录<a href="#4进入到新版本的-ghost-临时目录" class="hash-link" aria-label="Direct link to 4.进入到新版本的 ghost 临时目录" title="Direct link to 4.进入到新版本的 ghost 临时目录">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd /usr/ghost-tmp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-拷贝所需文件到-ghost-升级目录">5. 拷贝所需文件到 ghost 升级目录<a href="#5-拷贝所需文件到-ghost-升级目录" class="hash-link" aria-label="Direct link to 5. 拷贝所需文件到 ghost 升级目录" title="Direct link to 5. 拷贝所需文件到 ghost 升级目录">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cp -R core /usr/ghost</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cp index.js *.json /usr/ghost</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="6-可选-升级-casperghost-默认主题">6. (可选) 升级 casper，ghost 默认主题<a href="#6-可选-升级-casperghost-默认主题" class="hash-link" aria-label="Direct link to 6. (可选) 升级 casper，ghost 默认主题" title="Direct link to 6. (可选) 升级 casper，ghost 默认主题">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cp -R content/themes/casper /usr/ghost/content/themes/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="7-切换回到-ghost-安装目录">7. 切换回到 ghost 安装目录<a href="#7-切换回到-ghost-安装目录" class="hash-link" aria-label="Direct link to 7. 切换回到 ghost 安装目录" title="Direct link to 7. 切换回到 ghost 安装目录">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd /usr/ghost</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="8-修改文件目录所有者和所属组为-ghost">8. 修改文件目录所有者和所属组为 ghost<a href="#8-修改文件目录所有者和所属组为-ghost" class="hash-link" aria-label="Direct link to 8. 修改文件目录所有者和所属组为 ghost" title="Direct link to 8. 修改文件目录所有者和所属组为 ghost">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">chown -R ghost:ghost ./*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="9-重新安装环境">9. 重新安装环境<a href="#9-重新安装环境" class="hash-link" aria-label="Direct link to 9. 重新安装环境" title="Direct link to 9. 重新安装环境">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">npm install --production</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="10-重启-ghost">10. 重启 Ghost<a href="#10-重启-ghost" class="hash-link" aria-label="Direct link to 10. 重启 Ghost" title="Direct link to 10. 重启 Ghost">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pm2 restart ghost</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ghost">Ghost</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/02/19/HowTo-Automatic-Updates-CENTOS-RHEL-Using-YUM">HowTo Automatic Updates CENTOS/RHEL Using YUM</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-02-19T09:56:42.000Z" itemprop="datePublished">February 19, 2017</time> · <!-- -->One min read</div></header><div class="markdown" itemprop="articleBody"><p>大家若工作遇到需要管理的 Linux 集群机器较多时，同时我们知道系统的安全更新补丁维护这些非常重要，无论你在安装时优化维护做的再好，随着时间的推移，如果不去更新的话，系统早晚都会不安全，所以定期更新我们的系统补丁是一个运维人员的基本工作内容</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-yum-cron">Install yum-cron<a href="#install-yum-cron" class="hash-link" aria-label="Direct link to Install yum-cron" title="Direct link to Install yum-cron">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> yum </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> -y yum-cron</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因为我的服务器系统多为 CentOS 6，6 的配置文件在<code>/etc/sysconfig/yum-cron</code>，你可以用以下命令查看配置文件位置：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">rpm</span><span class="token plain"> -ql yum-cron</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/etc/cron.daily/0yum.cron</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/etc/rc.d/init.d/yum-cron</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/etc/sysconfig/yum-cron</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/etc/yum/yum-daily.yum</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/etc/yum/yum-weekly.yum</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/usr/share/doc/yum-cron-3.2.29</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/usr/share/doc/yum-cron-3.2.29/COPYING</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/usr/share/man/man8/yum-cron.8.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-etcsysconfigyum-cron">Configure “/etc/sysconfig/yum-cron”<a href="#configure-etcsysconfigyum-cron" class="hash-link" aria-label="Direct link to Configure “/etc/sysconfig/yum-cron”" title="Direct link to Configure “/etc/sysconfig/yum-cron”">​</a></h3><p>yum-cron 的默认设置是会在每天自动检查和安装系统更新包，在安装完成后有些配置需要注意下：</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="1-对于不需要更新的可以忽略掉">1. 对于不需要更新的可以忽略掉<a href="#1-对于不需要更新的可以忽略掉" class="hash-link" aria-label="Direct link to 1. 对于不需要更新的可以忽略掉" title="Direct link to 1. 对于不需要更新的可以忽略掉">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">YUM_PARAMETER=&quot;--exclude=&#x27;kernel*&#x27; --exclude=&#x27;php*&#x27;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="2-设置管理员邮箱">2. 设置管理员邮箱<a href="#2-设置管理员邮箱" class="hash-link" aria-label="Direct link to 2. 设置管理员邮箱" title="Direct link to 2. 设置管理员邮箱">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">MAILTO=&quot;luchuanjia@msn.com&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="3-不自动安装仅检查通知管理邮箱">3. 不自动安装，仅检查，通知管理邮箱<a href="#3-不自动安装仅检查通知管理邮箱" class="hash-link" aria-label="Direct link to 3. 不自动安装，仅检查，通知管理邮箱" title="Direct link to 3. 不自动安装，仅检查，通知管理邮箱">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CHECK_ONLY=yes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="4-不自动安装仅下载">4. 不自动安装，仅下载<a href="#4-不自动安装仅下载" class="hash-link" aria-label="Direct link to 4. 不自动安装，仅下载" title="Direct link to 4. 不自动安装，仅下载">​</a></h5><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">DOWNLOAD_ONLY=yes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="automatic-starting-yum-cron">Automatic Starting yum-cron<a href="#automatic-starting-yum-cron" class="hash-link" aria-label="Direct link to Automatic Starting yum-cron" title="Direct link to Automatic Starting yum-cron">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">chkconfig yum-cron on</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cent-os">CentOS</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/02/09/mysql-8-suo-yin-chuang-jian-shan-chu-he-cha-kan">MySQL 索引创建、删除和查看</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-02-09T18:29:50.000Z" itemprop="datePublished">February 9, 2017</time> · <!-- -->3 min read</div></header><div class="markdown" itemprop="articleBody"><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-索引的作用"><strong>1. 索引的作用</strong><a href="#1-索引的作用" class="hash-link" aria-label="Direct link to 1-索引的作用" title="Direct link to 1-索引的作用">​</a></h4><p>   在索引列上，数据库利用各种各样的快速定位技术，能够大大的提高查询效率，特别是当数据量非常大和查询设计到多个表时，索引的利用能够将效率提高成千上万倍，当然要合理的利用索引。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-创建索引"><strong>2. 创建索引</strong><a href="#2-创建索引" class="hash-link" aria-label="Direct link to 2-创建索引" title="Direct link to 2-创建索引">​</a></h4><p>​ 在执行 CREATE TABLE 时可以创建索引，也可以在之后单独使用 CREATE INDEX 或 ALTER TABLE 来为表增加索引。</p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="21-alter-table">2.1 ALTER TABLE<a href="#21-alter-table" class="hash-link" aria-label="Direct link to 2.1 ALTER TABLE" title="Direct link to 2.1 ALTER TABLE">​</a></h6><p>​ ALTER TABLE 用来创建普通索引、UNIQUE 索引或 PRIMARY KEY 索引。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE tb_name ADD INDEX index_Name (column_list);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE tb_name ADD UNIQUE (column_list);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE tb_name ADD PRIMARY KEY (column_list);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>​ tb_name 是要增加索引的表名，column_list 是要增加索引的列，多列用逗号隔开，index_Name 是可选，缺省为第一个索引列赋名称，ALTER TABLE 允许在单个语句中更改多个表，因此可以也可以同时创建多个索引。</p><h6 class="anchor anchorWithStickyNavbar_LWe7" id="22-create-index">2.2 CREATE INDEX<a href="#22-create-index" class="hash-link" aria-label="Direct link to 2.2 CREATE INDEX" title="Direct link to 2.2 CREATE INDEX">​</a></h6><p>​ CREATE INDEX 可对表增加普通索引或者 UNIQUE 索引。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE INDEX index_Name ON tb_name(column_list);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATE UNIQUE INDEX index_Name ON tb_name(column_list);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>​ tb_name、index_Name 和 column_list 具有 ALTER TABLE 语句中相同的含义，索引名称不可自定义，也不能创建 PRIMARY KEY。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-索引类型"><strong>3. 索引类型</strong><a href="#3-索引类型" class="hash-link" aria-label="Direct link to 3-索引类型" title="Direct link to 3-索引类型">​</a></h4><p>​ 在创建索引时，可以规定索引能否包含重复的值，如果不包含，则索引应该为 PRIMARY KEY 或 UNIQUE 索引，对于单列唯一索引，这能保证单列不包含重复的值，对于多列唯一索引，保证多值的组合不重复。</p><p>​ PRIMAY KEY 索引与 UNIQUE 索引非常类似，实际上 PRIMAY KEY 索引仅是一个具有名称 PRIMAY 的 UNIQUE 索引，这表示一个表只能包含一个 PRIMAY KEY 索引，因为一个表中不可能具有两个同名的索引。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-删除索引"><strong>4. 删除索引</strong><a href="#4-删除索引" class="hash-link" aria-label="Direct link to 4-删除索引" title="Direct link to 4-删除索引">​</a></h4><p>​ 可以使用 ALTER TABLE 或 DROP INDEX 语句来删除索引：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">DROP INDEX index_Name On tb_name;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE tb_Name DROP TABLE index_Name;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ALTER TABLE tb_Name DROP PRIMAY KEY;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>​ 第一条和第二条作用是一样的，删除 tb_Name 中 index_Name 索引；第三条仅适用于删除 PRIMAY KEY 时，因为一个只可能有一个 PRIMAY KEY 索引。</p><p>​ 另外，如果在表中删除了某列，则索引会受到影响，对于多列组合的索引，如果删除其中某列，则该列也会在索引中删除，如果删除所有列，则该索引也会被删除。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-查看索引"><strong>5. 查看索引</strong><a href="#5-查看索引" class="hash-link" aria-label="Direct link to 5-查看索引" title="Direct link to 5-查看索引">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; show index from tb_name;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql&gt; show keys from tb_name;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Table : 表名</li><li>Non_unique：如果索引不能包含重复值为 0，如果可以为 1</li><li>Key_name：索引的名称</li><li>Seq_in_index：索引中列的序号，从 1 开始</li><li>Column_name：列的名称</li><li>Collation：列以什么方式存储在索引中，在 MySQL 中有值‘A’(升序) 和 NULL(无分类)</li><li>Cardinality：索引中唯一值的数量估计值，通过运行 ANALYZE TABLE 或者 myisamchk -a 可以更新，基数根据被存储的整数的统计数据来计数，所以，即使对于小型表，该值也没有必要是精确的，基数越大，当进行联合时，MySQL 使用该索引的机会就越大。</li><li>Sub_part：如果列只是被部分编入，则为编入索引的字符数目，如果整列被编入索引，则为 NULL</li><li>Packed：关键字如何被压缩，没有压缩为 NULL</li><li>Null：如果列含有 NULL 为 YES，如果没有则为 NO</li><li>Index_type：用过的索引方法，BTREE，FULLTEXT，HASH，RTREE</li><li>Comment：备注</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/my-sql">MySQL</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2017/01/18/HowTo-Monitor-Tomcat-Head-Memory-for-Zabbix">HowTo Monitor Tomcat HeadMemory for Zabbix</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-01-18T23:28:44.000Z" itemprop="datePublished">January 18, 2017</time> · <!-- -->5 min read</div></header><div class="markdown" itemprop="articleBody"><p>最近项目上由于 BUG 问题导致 Tomcat 程序在运行过程中经常内存泄漏，而本身监控系统之中没有更好的检测到 Tomcat 堆空间 (Head Memory) 的使用情况导致报警频发，这篇文章主要讲述，如何在 Zabbix 之中调用 jmx 监控服务器上 Tomcat 堆空间的使用情况并增加对应报警功能。</p><blockquote><p>测试环境：
CentOS 6.8
Zabbix 2.4
Tomcat 7.0</p></blockquote><p>实验前提默认是各位已经安装 Zabbix Server 服务器，并且至少有一台 Zabbix agent 服务器正常监控。关于如何搭建 Zabbix 监控集群，会有专门文章描述。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="zabbix-java-gateway-的工作机制">zabbix-java-gateway 的工作机制<a href="#zabbix-java-gateway-的工作机制" class="hash-link" aria-label="Direct link to zabbix-java-gateway 的工作机制" title="Direct link to zabbix-java-gateway 的工作机制">​</a></h4><ul><li>首先我们需要配置我们的 Tomcat 服务启用监控服务，这个是默认不启用的</li><li>之后需要在 Zabbix 的管理页面添加对应 Tomcat 服务器的 jmx 监控接口</li><li>最后 zabbix 端会自动获取 zabbix-java-gateway 的数据并根据相应模板进行展
示</li><li>工作流：<!-- -->[Zabbix-Server]<!-- -->--&gt;(port:10053 on zabbix server)--&gt; <!-- -->[zabbix-java-gateway]<!-- --> --(port:12345 on tomcatserver)--&gt; <!-- -->[JMX enabled]</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-install-zabbix-java-gateway-on-zabbix-server">1. Install zabbix-java-gateway on Zabbix Server<a href="#1-install-zabbix-java-gateway-on-zabbix-server" class="hash-link" aria-label="Direct link to 1. Install zabbix-java-gateway on Zabbix Server" title="Direct link to 1. Install zabbix-java-gateway on Zabbix Server">​</a></h4><p>因为我的 zabbix 是使用 zabbix 2.4 官方源安装，所以只需要用 yum 在安装即可：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 ~]# sudo  yum install -y zabbix-java-gateway</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果你没有官方源可能先安装该源，注意我的服务器 zabbix 版本是 2.4 如果你是不同的版本，请到[<a href="http://repo.zabbix.com/zabbix/" target="_blank" rel="noopener noreferrer">这里</a>] 查找对应版本。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 查看zabbix server版本</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 ~]# zabbix_server --version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Zabbix server v2.4.8 (revision 59539) (20 April 2016)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Compilation time: May  4 2016 01:32:12</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在使用 yum 安装 zabbix-java-gateway 源时，会自动关联安装 openjdk，尽管这段程序没多大影响，如果你想保证系统 JAVA 环境不受到改变的话，可以在/etc/profile 文件最后，增加如下内容：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># add follows to the end</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">export JAVA_HOME=/usr/java/default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">export PATH=$PATH:$JAVA_HOME/bin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">export CLASSPATH=.:$JAVA_HOME/jre/lib:$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-confiure-tomcat-host-with-enable-jmx">2. Confiure Tomcat host with enable jmx<a href="#2-confiure-tomcat-host-with-enable-jmx" class="hash-link" aria-label="Direct link to 2. Confiure Tomcat host with enable jmx" title="Direct link to 2. Confiure Tomcat host with enable jmx">​</a></h4><p>首先在$tomcatdir/bin/catalina.sh 文件开头处增加如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#!/bin/sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CATALINA_OPTS=&quot;-Dcom.sun.management.jmxremote \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-Dcom.sun.management.jmxremote.authenticate=false \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-Dcom.sun.management.jmxremote.ssl=false \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-Dcom.sun.management.jmxremote.port=12345&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后，启动 Tomcat，你会发现多了一个 12345 端口，这就是 jmx 的监听端口，请保证 zabbix-java-gateway 可以访问到这台服务器。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 ~]# /tomcat7/bin/startup.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Starting Tomcat7:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CATALINA_BASE:   /tomcat7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CATALINA_HOME:   /tomcat7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CATALINA_TMPDIR: /tomcat7/temp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using JRE_HOME:        /usr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CLASSPATH:       /tomcat7/bin/bootstrap.jar:/tomcat7/bin/tomcat-juli.jar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Tomcat started.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 ~]# netstat -ntlp | grep 12345</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tcp  0      0 :::12345   :::*     LISTEN      8793/java</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 ~]#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fix-1---zabbix-agent-与-server-存在复杂网络环境">==<em>fix 1</em> == : zabbix agent 与 server 存在复杂网络环境<a href="#fix-1---zabbix-agent-与-server-存在复杂网络环境" class="hash-link" aria-label="Direct link to fix-1---zabbix-agent-与-server-存在复杂网络环境" title="Direct link to fix-1---zabbix-agent-与-server-存在复杂网络环境">​</a></h4><p>这里疏忽了 1 个问题，如果您的 zabbix server 与 agent 端之间有防火墙规则，而按照我上面的所述只是增加了 12345 这个端口，那么很可能，您在/var/log/zabbix/zabbix_java_gateway.log 中会看到“No route to host”的报错，这是因为 JMX 不光开启了 12345 端口，还开启了另外两个随机端口，而在获取监控数据时会使用到其中一个，这就导致了无法通过固定的防火墙规则来开放该端口。其实有另外一个替代方式来使该监听端口固定下来——使用 Tomcat 提供的额外组件 catalina-jmx-remote.jar，这个组件是需要另外下载的：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 查看当前Tomcat版本.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 bin]# ./catalina.sh version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CATALINA_BASE:   /tomcat7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CATALINA_HOME:   /tomcat7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CATALINA_TMPDIR: /tomcat7/temp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using JRE_HOME:        /usr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Using CLASSPATH:       /tomcat7/bin/bootstrap.jar:/tomcat7/bin/tomcat-juli.jar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Server version: Apache Tomcat/7.0.64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Server built:   Aug 19 2015 17:18:06 UTC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Server number:  7.0.64.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">OS Name:        Linux</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">OS Version:     2.6.32-642.11.1.el6.x86_64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Architecture:   amd64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">JVM Version:    1.8.0_111-b15</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">JVM Vendor:     Oracle Corporation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 下载 catalina-jmx-remote.jar # 请注意下载版本不要高于当前tomcat版本.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wget http://mirror.bit.edu.cn/apache/tomcat/tomcat-7/v7.0.57/bin/extras/catalina-jmx-remote.jar -O lib/catalina-jmx-remote.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>增加如下内容，在 conf/server.xml 中：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;Listener className=&quot;org.apache.catalina.mbeans.JmxRemoteLifecycleListener&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          rmiRegistryPortPlatform=&quot;12345&quot; rmiServerPortPlatform=&quot;12346&quot; /&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因为我们已经在conf/server.xml定义了rmiRegistryPortPlatform，所以要将bin/catalina.sh中CATALINA_OPTS的com.sun.management.jmxremote.port去掉，否则会因为jmxremote.port配置有优先级更高而导致配置失效。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">CATALINA_OPTS=&quot;-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>完成之后，重启 tomcat 这时会发现 jmx 默认端口已经固定为 12345 何 12346，而 server 依然可以正常获取监控数据。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-configure-zabbix-server">3. Configure Zabbix Server<a href="#3-configure-zabbix-server" class="hash-link" aria-label="Direct link to 3. Configure Zabbix Server" title="Direct link to 3. Configure Zabbix Server">​</a></h4><p>首先需要修改 zabbix_server.conf 启用 zabbix-java-gateway，让 zabbix 可以检测到服务，修改如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">### Option: JavaGateway</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> #       IP address (or hostname) of Zabbix Java gateway.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> #       Only required if Java pollers are started.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> #</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> # Mandatory: no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> # Default:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">JavaGateway=10.211.55.4 # 设置为你的zabbixsever IP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">### Option: JavaGatewayPort</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Port that Zabbix Java gateway listens on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Mandatory: no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Range: 1024-32767</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> JavaGatewayPort=10053 # 设置服务端监听接口</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">### Option: StartJavaPollers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Number of pre-forked instances of Java pollers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Mandatory: no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Range: 0-1000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> StartJavaPollers=5 # 设置多线程启动</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>然后修改 zabbix<!-- -->_<!-- -->java<!-- -->_<!-- -->gateway.conf 配置如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">### Option: zabbix.listenIP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># IP address to listen on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Mandatory: no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> LISTEN_IP=&quot;10.211.55.4&quot; # 配置监听IP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">### Option: zabbix.listenPort</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Port to listen on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Mandatory: no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Range: 1024-32767</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> LISTEN_PORT=10053 # 配置监听端口</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">### Option: zabbix.pidFile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Name of PID file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># If omitted, Zabbix Java Gateway is started as a console application</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Mandatory: no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># PID_FILE=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> PID_FILE=&quot;/var/run/zabbix/zabbix_java.pid&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">### Option: zabbix.startPollers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Number of worker threads to start</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Mandatory: no</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Range: 1-1000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 不能大于zabbix_server.conf的值，否则可能导致当连接Java gateway时没有多余的线程进行处理</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> START_POLLERS=5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最后启动启动 zabbix-java-gateway，并重启 zabbix-server</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 ~]# service zabbix-java-gateway start</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Starting zabbix java gateway:              [  OK  ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 ~]# service zabbix-server restart</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Stopping zabbix server:              [  OK  ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Starting zabbix server:              [  OK  ]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我在尝试重启发现一问题，zabbix-java-gateway 通过 service 命令管理 stop 不能删除 pid 文件导致服务无法启动，如果你也碰到，解决办法如下：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[root@6 zabbix]# vim /etc/rc.d/init.d/zabbix-java-gateway</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># line 97, 注释修改为如下</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># kill `cat $PID_FILE` &amp;&amp; rm $PID_FILE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        rm -f $PID_FILE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-adding-jmx-host-on-zabbix-web-consloe">4. Adding jmx host on Zabbix Web consloe<a href="#4-adding-jmx-host-on-zabbix-web-consloe" class="hash-link" aria-label="Direct link to 4. Adding jmx host on Zabbix Web consloe" title="Direct link to 4. Adding jmx host on Zabbix Web consloe">​</a></h4><p>首先，上传 Template Tomcat Head Memory 模板，这个我做了一个简单的模板，只针对了堆内存空间的监控，并针对使用率超过 60% 以及 80%，不同的警报。需要的同学可以直接从我这里下载，然后在 Configuration-Templates 导入到 zabbix 模板库内。
下载请点击：<a href="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zbx_template_app_tomcat_head_memory.xml" target="_blank" rel="noopener noreferrer">Template App Tomcat Head Memory</a></p><p>然后，增加服务器的 jmx 监控
<img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-jmx-settings.png" alt="image" class="img_ev3q"></p><p>关联模板
<img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-host-select-template.png" alt="image" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-view-the-head-memory-monitoring">5. View the Head Memory Monitoring<a href="#5-view-the-head-memory-monitoring" class="hash-link" aria-label="Direct link to 5. View the Head Memory Monitoring" title="Direct link to 5. View the Head Memory Monitoring">​</a></h4><p><img loading="lazy" src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-view-monitor.png" alt="image" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/microservice">Microservice</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tools">Tools</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/page/7"><div class="pagination-nav__label">Newer Entries</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/page/9"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div></div>
<script src="/assets/js/runtime~main.a4192aa2.js"></script>
<script src="/assets/js/main.be9b3ddb.js"></script>
</body>
</html>