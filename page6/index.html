
<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Blog">
  <head>
    <meta charset="utf-8">
	<link rel="manifest" href="/pwa/manifest.json">
	<title> Home | SAMZONG </title>
    
		
    <meta name="author" content="Samzong Lu">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="theme-color" content="#2196F3">
	<meta name="google-site-verification" content="puZt0ZyqB-t67BYdYAgLUyIPBeismG68J0dmEc01QeY" />

	
    <script>
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', function () {
				navigator.serviceWorker
										.register('/sw.js')
										.then(function(registration) {
											console.log("Successfully registered service worker", registration.scope);
										}).catch(function(err) {
											console.log("Service worker registration failed: ", err);
										});
				//navigator.serviceWorker.ready always resolve
				navigator.serviceWorker.ready.then(function (registration) {
					console.log('Service worker successfully registered on scope', registration.scope);
				});
			});
		}
    </script>
	<script type="text/javascript" src="/assets/themes/evjekylltheme/jquery-3.6.0.slim.min.js"></script>

	<link href="/assets/themes/evjekylltheme/google-code-prettify/desert.css" type="text/css" rel="stylesheet" />

    <!-- Le styles -->
    <link href="/assets/themes/evjekylltheme/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/evjekylltheme/css/style.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/images/favicon.ico">

    <!-- atom & rss feed -->
    <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Jekyll auto generate ATOM Feed">
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Site ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Site RSS Feed">
	<link rel="stylesheet" href="/assets/themes/evjekylltheme/font-awesome-4.4.0/css/font-awesome.min.css">
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-W2LDG64');</script>
		<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8529425670069509"
						crossorigin="anonymous"></script>
	<script async src="https://cdn.splitbee.io/sb.js"></script>
  </head>

  <body>
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W2LDG64"
	height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div class="navbar navbar-default navbar-fixed-top">
				<div class="container">
          <div class="row mobilepadding">
					<a class="navbar-brand" href="/">SAMZONG</a>
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="collapse navbar-collapse" id="mNavbar">
  					<ul class="nav navbar-nav">
  						
  						
  						


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/friends.html">Friends</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  



						  <li class="dropdown">
							  <a class="dropdown-toggle" data-toggle="dropdown" href="#">Other</a>
							  <ul class="dropdown-menu">
									<li><a href="/about.html">About</a></li>
									<li><a href="https://yuque.com/samzong/note" target="_blank">船长的课记</a></li>
									<li><a href="https://yuque.com/samzong/ap" target="_blank">果粉日记</a></li>
									<li><a href="https://yuque.com/samzong/code" target="_blank">Code Snippet</a></li>
									<li><a href="https://www.yuque.com/samzong/mcx" target="_blank">集</a></li>
									<li><a href="https://www.yuque.com/zooka" target="_blank">藏金阁</a></li>
								</ul>
						  </li>
  					</ul>
  					<form id="search-form" class="navbar-form navbar-right" role="search">
  						<div class="form-group">
  						<input type="text" class="form-control input-sm" placeholder="Search" id="query">
  						</div>
  					</form>
  					<div class="nav-icon">
  						<a href="/feed.xml"><i class="fa fa-rss fa-2x"></i></a>
  					</div>
          </div>
				</div>
      </div>
    </div>

    <div class="container">
			<div class="row mobilepadding">
        <div class="row">
					<div class="col-md-12">
						<div class="searchresult">
						</div>
						<div id="search-loader" class="img-wrap">
						</div>
					</div>
        </div>
				<meta itemprop="image" content="https://lh5.googleusercontent.com/-hnukhkmD--I/V4m8XAu5yCI/AAAAAAABAAE/M4l0oJTVFoIOZoY4hSG7-rgFwbgym5H5wCL0B/w512-h439-no/IMG_20160715_125428.jpg">
<div class="row">
  <div class="col-xs-12 col-md-8">
    
    
    <h1><a class="title" href="/post/2017/02/HowTo-Install-Redmine.html">HowTo Install Redmine</a></h1>
    <div class="post_at_index">
      <h4 id="runtime-environment">Runtime environment</h4>

<ul>
  <li>CentOS 6.x</li>
  <li>Redmine 3.3.2</li>
  <li>Ruby 2.2.6</li>
  <li>rails 4.2</li>
  <li>MySQL 5.1</li>
  <li>Nginx 1.10</li>
</ul>

<h4 id="安装rvm">安装rvm</h4>

<h5 id="导入公钥">导入公钥</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# curl -sSL https://rvm.io/mpapis.asc | gpg --import
</code></pre></div></div>

<h5 id="安装">安装</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# curl -L https://get.rvm.io | bash -s stable
</code></pre></div></div>

<h5 id="加载rvm环境并安装基础依赖包">加载rvm环境并安装基础依赖包</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# source /etc/profile.d/rvm.sh
[root@localhost ~]# rvm requirements
</code></pre></div></div>

<h4 id="安装ruby">安装ruby</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# rvm install 2.2.6
...
[root@localhost ~]# rvm use 2.2.6 --default
</code></pre></div></div>

<h4 id="安装rails">安装rails</h4>

<h5 id="更换gem源">更换gem源</h5>

<p>默认gem的源站点是https://rubygems.org 由于国内的网络原因导致无法连接，所以导致无法使用gem安装，这里换成国内淘宝的gem镜像站点</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# gem sources -l
*** CURRENT SOURCES ***

https://rubygems.org/
[root@localhost ~]# gem sources --remove https://rubygems.org/
[root@localhost ~]# gem sources -a https://ruby.taobao.org/
[root@localhost ~]# gem sources -l
*** CURRENT SOURCES ***

https://ruby.taobao.org/
</code></pre></div></div>

<h5 id="安装-1">安装</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# gem install rails -v=4.2
</code></pre></div></div>

<h4 id="安装mysql">安装MySQL</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# yum install -y mysql-server mysql-libs mysql-devel mysql
[root@localhost ~]# service mysqld start
[root@localhost ~]# mysql_secure_installation
</code></pre></div></div>

<h4 id="安装redmine">安装redmine</h4>

<h5 id="下载redmine-332">下载Redmine 3.3.2</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# wget http://www.redmine.org/releases/redmine-3.3.2.tar.gz
[root@localhost ~]# tar xf redmine-3.3.2.tar.gz
[root@localhost ~]# mv redmine-3.3.2 /opt
</code></pre></div></div>

<h5 id="安装管理ruby的包管理工具bundler">安装管理ruby的包管理工具bundler</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 注意，一定要在redmine目录下操作
[root@localhost ~]# cd /opt/redmine-3.3.2
[root@localhost redmine-3.3.2]# gem install bundler
</code></pre></div></div>

<h5 id="安装redmine运行所需要的依赖包">安装redmine运行所需要的依赖包</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# bundle install --without development test rmagick
</code></pre></div></div>

<h5 id="为rails生产cookies秘钥">为rails生产cookies秘钥</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# rake generate_secret_token
</code></pre></div></div>

<h5 id="创建redmine的数据库">创建redmine的数据库</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; create database redmine character set utf8;
mysql&gt; grant all privileges on redmine.* to 'redmine'@'localhost' identified by 'redmine_pass';
</code></pre></div></div>

<h5 id="修改redmine的databaseyml">修改redmine的database.yml</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# cp config/database.yml.example config/database.yml
[root@localhost redmine-3.3.2]# vim config/database.yml
production:
  adapter: mysql2
  database: redmine
  host: localhost
  username: redmine
  password: "redmine_pass"
  encoding: utf8
</code></pre></div></div>

<h5 id="创建数据库结构">创建数据库结构</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# RAILS_ENV=production bundle exec rake db:migrate
</code></pre></div></div>

<h5 id="生产缺省数据">生产缺省数据</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# RAILS_ENV=production bundle exec rake redmine:load_default_data
# 选择默认语言，之后可更改，初始为en
</code></pre></div></div>

<h5 id="测试是否安装成功">测试是否安装成功</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# bundle exec rails server webrick -e production -b 0.0.0.0
</code></pre></div></div>

<blockquote>
  <p>默认运行3000端口，默认管理员admin/admin</p>
</blockquote>

<h4 id="配置redmine在nginx上运行">配置Redmine在Nginx上运行</h4>

<p>Redmine常用的解决办法是使用passenger+nginx，但是Nginx不支持装载模块，所以需要重新编译安装Nginx，安装Nginx的Passenger有两种方式</p>

<ul>
  <li>采用Passenger提供的脚本进行安装，适合新环境</li>
  <li>手动编译安装Nginx增加Passenger模块，适合已存在Nginx环境</li>
</ul>

<h5 id="采用passenger提供脚本安装">采用Passenger提供脚本安装</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# gem install passenger
[root@localhost redmine-3.3.2]# passenger-install-nginx-module --auto --prefix=/opt/nginx
</code></pre></div></div>

<h5 id="采用重新编译nginx增加passenger模块">采用重新编译Nginx增加Passenger模块</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 获取passenger的安装路径
[root@localhost ~]# passenger-config --root
/usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2

# 重新编译Nginx并添加模块
[root@localhost ~]# wget http://nginx.org/download/nginx-1.10.3.tar.gz
[root@localhost ~]# tar xf nginx-1.10.3.tar.gz
[root@localhost ~]# cd nginx-1.10.3
[root@localhost nginx-1.10.3]# ./configure ... -add-module=/usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2
</code></pre></div></div>

<h5 id="增加http模块内以下配置">增加HTTP模块内以下配置</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>passenger_root /usr/local/rvm/gems/ruby-2.2.6/gems/passenger-5.1.2
</code></pre></div></div>

<h5 id="配置nginxconf-修改server模块中location的配置">配置nginx.conf 修改server模块中location的配置</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ...
server	{
  # ...
  passenger_enabled on;
  location / {
    root /opt/redmine-3.3.2/public;
    index index.html index.htm;
  }
}
# ...
</code></pre></div></div>

<h5 id="启动nginx">启动Nginx</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost ~]# /root/nginx-1.10.3/sbin/nginx -c /root/nginx-1.10.3/conf/nginx.conf
</code></pre></div></div>

<h4 id="其他">其他</h4>

<p>到这里，所有的安装都完成了，过程中我遇到这些问题，你也注意下：</p>

<h5 id="71-could-not-find-gem-mysql2--0311-in-any-of-the-gem-sources-listed-in-your-gemfile">7.1 Could not find gem ‘mysql2 (~&gt; 0.3.11)’ in any of the gem sources listed in your Gemfile.</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@localhost redmine-3.3.2]# rm -f Gemfile.lock
[root@localhost redmine-3.3.2]# bundle install
</code></pre></div></div>

<h5 id="72-curl-tools">7.2 curl-tools</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install libcurl-devel
</code></pre></div></div>


      
    </div>
    <br/>
    <div>
      <cite>2017-02-22</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Redmine">Redmine</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/02/HowTo-Upgrade-Your-Ghost-Version.html">HowTo Upgrade Your Ghost Version</a></h1>
    <div class="post_at_index">
      <p><br /></p>
<h4 id="1-下载最新版的ghost">1. 下载最新版的Ghost</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -LOk https://ghost.org/zip/ghost-latest.zip
</code></pre></div></div>

<h4 id="2-创建临时目录并解压ghost-latestzip到此">2. 创建临时目录，并解压ghost-latest.zip到此</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /usr/ghost-tmp
unzip ghost-latest.zip -d /usr/ghost-tmp
</code></pre></div></div>

<h4 id="3-进入到原ghost目录删除core">3. 进入到原ghost目录，删除core</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd  /usr/ghost
rm -rf core
</code></pre></div></div>

<h4 id="4进入到新版本的ghost临时目录">4.进入到新版本的ghost临时目录</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /usr/ghost-tmp
</code></pre></div></div>

<h4 id="5-拷贝所需文件到ghost升级目录">5. 拷贝所需文件到ghost升级目录</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp -R core /usr/ghost
cp index.js *.json /usr/ghost
</code></pre></div></div>

<h4 id="6-可选升级casperghost默认主题">6. (可选)升级casper，ghost默认主题</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp -R content/themes/casper /usr/ghost/content/themes/
</code></pre></div></div>

<h4 id="7-切换回到ghost安装目录">7. 切换回到ghost安装目录</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /usr/ghost
</code></pre></div></div>

<h4 id="8-修改文件目录所有者和所属组为ghost">8. 修改文件目录所有者和所属组为ghost</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chown -R ghost:ghost ./*
</code></pre></div></div>

<h4 id="9-重新安装环境">9. 重新安装环境</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm install --production
</code></pre></div></div>

<h4 id="10-重启ghost">10. 重启Ghost</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pm2 restart ghost
</code></pre></div></div>


      
    </div>
    <br/>
    <div>
      <cite>2017-02-20</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Ghost">Ghost</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/02/HowTo-Automatic-Updates-CENTOS-RHEL-Using-YUM.html">HowTo Automatic Updates CENTOS/RHEL Using YUM</a></h1>
    <div class="post_at_index">
      <p>大家若工作遇到需要管理的Linux集群机器较多时，同时我们知道系统的安全更新补丁维护这些非常重要，无论你在安装时优化维护做的再好，随着时间的推移，如果不去更新的话，系统早晚都会不安全，所以定期更新我们的系统补丁是一个运维人员的基本工作内容</p>

<h3 id="install-yum-cron">Install yum-cron</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo yum install -y yum-cron
</code></pre></div></div>

<p>因为我的服务器系统多为CentOS 6，6的配置文件在<code>/etc/sysconfig/yum-cron</code>，你可以用以下命令查看配置文件位置：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rpm -ql yum-cron
/etc/cron.daily/0yum.cron
/etc/rc.d/init.d/yum-cron
/etc/sysconfig/yum-cron
/etc/yum/yum-daily.yum
/etc/yum/yum-weekly.yum
/usr/share/doc/yum-cron-3.2.29
/usr/share/doc/yum-cron-3.2.29/COPYING
/usr/share/man/man8/yum-cron.8.gz
</code></pre></div></div>

<h3 id="configure-etcsysconfigyum-cron">Configure “/etc/sysconfig/yum-cron”</h3>

<p>yum-cron的默认设置是会在每天自动检查和安装系统更新包，在安装完成后有些配置需要注意下：</p>

<h5 id="1-对于不需要更新的可以忽略掉">1. 对于不需要更新的可以忽略掉</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>YUM_PARAMETER="--exclude='kernel*' --exclude='php*'"
</code></pre></div></div>

<h5 id="2-设置管理员邮箱">2. 设置管理员邮箱</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MAILTO="luchuanjia@msn.com"
</code></pre></div></div>

<h5 id="3-不自动安装仅检查通知管理邮箱">3. 不自动安装，仅检查，通知管理邮箱</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CHECK_ONLY=yes
</code></pre></div></div>

<h5 id="4-不自动安装仅下载">4. 不自动安装，仅下载</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DOWNLOAD_ONLY=yes
</code></pre></div></div>

<h3 id="automatic-starting-yum-cron">Automatic Starting yum-cron</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chkconfig yum-cron on
</code></pre></div></div>


      
    </div>
    <br/>
    <div>
      <cite>2017-02-19</cite> <i class="icon-tag"></i>
      <a href="/tags.html#CentOS">CentOS</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/02/MySQL-8-%E7%B4%A2%E5%BC%95%E5%88%9B%E5%BB%BA-%E5%88%A0%E9%99%A4%E5%92%8C%E6%9F%A5%E7%9C%8B.html">MySQL 索引创建、删除和查看</a></h1>
    <div class="post_at_index">
      <h4 id="1-索引的作用"><strong>1. 索引的作用</strong></h4>

<p>在索引列上，数据库利用各种各样的快速定位技术，能够大大的提高查询效率，特别是当数据量非常大和查询设计到多个表时，索引的利用能够将效率提高成千上万倍，当然要合理的利用索引。</p>

<h4 id="2-创建索引"><strong>2. 创建索引</strong></h4>

<p>​	在执行CREATE TABLE时可以创建索引，也可以在之后单独使用CREATE INDEX或ALTER TABLE来为表增加索引。</p>

<h6 id="21-alter-table">2.1 ALTER TABLE</h6>

<p>​	ALTER TABLE用来创建普通索引、UNIQUE索引或PRIMARY KEY索引。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ALTER TABLE tb_name ADD INDEX index_Name (column_list);
ALTER TABLE tb_name ADD UNIQUE (column_list);
ALTER TABLE tb_name ADD PRIMARY KEY (column_list);
</code></pre></div></div>

<p>​	tb_name 是要增加索引的表名，column_list 是要增加索引的列，多列用逗号隔开，index_Name 是可选，缺省为第一个索引列赋名称，ALTER TABLE允许在单个语句中更改多个表，因此可以也可以同时创建多个索引。</p>

<h6 id="22-create-index">2.2 CREATE INDEX</h6>

<p>​	CREATE INDEX 可对表增加普通索引或者UNIQUE索引。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE INDEX index_Name ON tb_name(column_list);
CREATE UNIQUE INDEX index_Name ON tb_name(column_list);
</code></pre></div></div>

<p>​	tb_name、index_Name和column_list具有ALTER TABLE语句中相同的含义，索引名称不可自定义，也不能创建PRIMARY KEY。</p>

<h4 id="3-索引类型"><strong>3. 索引类型</strong></h4>

<p>​	在创建索引时，可以规定索引能否包含重复的值，如果不包含，则索引应该为PRIMARY KEY或UNIQUE索引，对于单列唯一索引，这能保证单列不包含重复的值，对于多列唯一索引，保证多值的组合不重复。</p>

<p>​	PRIMAY KEY索引与UNIQUE索引非常类似，实际上PRIMAY KEY索引仅是一个具有名称PRIMAY的UNIQUE索引，这表示一个表只能包含一个PRIMAY KEY索引，因为一个表中不可能具有两个同名的索引。</p>

<h4 id="4-删除索引"><strong>4. 删除索引</strong></h4>

<p>​	可以使用ALTER TABLE或DROP INDEX语句来删除索引：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DROP INDEX index_Name On tb_name;
ALTER TABLE tb_Name DROP TABLE index_Name;
ALTER TABLE tb_Name DROP PRIMAY KEY;
</code></pre></div></div>

<p>​	第一条和第二条作用是一样的，删除tb_Name中index_Name索引；第三条仅适用于删除PRIMAY KEY时，因为一个只可能有一个PRIMAY KEY索引。</p>

<p>​	另外，如果在表中删除了某列，则索引会受到影响，对于多列组合的索引，如果删除其中某列，则该列也会在索引中删除，如果删除所有列，则该索引也会被删除。</p>

<h4 id="5-查看索引"><strong>5. 查看索引</strong></h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; show index from tb_name;
mysql&gt; show keys from tb_name;
</code></pre></div></div>

<ul>
  <li>Table : 表名</li>
  <li>Non_unique： 如果索引不能包含重复值为0，如果可以为1</li>
  <li>Key_name： 索引的名称</li>
  <li>Seq_in_index：索引中列的序号，从1开始</li>
  <li>Column_name： 列的名称</li>
  <li>Collation：列以什么方式存储在索引中，在MySQL中有值‘A’(升序)和NULL(无分类)</li>
  <li>Cardinality： 索引中唯一值的数量估计值，通过运行ANALYZE TABLE或者 myisamchk -a 可以更新，基数根据被存储的整数的统计数据来计数，所以，即使对于小型表，该值也没有必要是精确的，基数越大，当进行联合时，MySQL使用该索引的机会就越大。</li>
  <li>Sub_part： 如果列只是被部分编入，则为编入索引的字符数目，如果整列被编入索引，则为NULL</li>
  <li>Packed：关键字如何被压缩，没有压缩为NULL</li>
  <li>Null： 如果列含有NULL为YES，如果没有则为NO</li>
  <li>Index_type： 用过的索引方法，BTREE，FULLTEXT，HASH，RTREE</li>
  <li>Comment： 备注</li>
</ul>

      
    </div>
    <br/>
    <div>
      <cite>2017-02-09</cite> <i class="icon-tag"></i>
      <a href="/tags.html#MySQL">MySQL</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/01/HowTo-Monitor-Tomcat-Head-Memory-for-Zabbix.html">HowTo Monitor Tomcat HeadMemory for Zabbix</a></h1>
    <div class="post_at_index">
      <p>最近项目上由于BUG问题导致Tomcat程序在运行过程中经常内存泄漏,而本身监控系统之中没有更好的检测到Tomcat堆空间(Head Memory)的使用情况导致报警频发，这篇文章主要讲述，如何在Zabbix之中调用jmx监控服务器上Tomcat堆空间的使用情况并增加对应报警功能。</p>

<blockquote>
  <p>测试环境: <br />
CentOS 6.8 <br />
Zabbix 2.4 <br />
Tomcat 7.0 <br /></p>
</blockquote>

<p>实验前提默认是各位已经安装Zabbix Server服务器，并且至少有一台Zabbix agent服务器正常监控。关于如何搭建Zabbix监控集群，会有专门文章描述。</p>

<h4 id="zabbix-java-gateway的工作机制">zabbix-java-gateway的工作机制</h4>
<ul>
  <li>首先我们需要配置我们的Tomcat服务启用监控服务，这个是默认不启用的</li>
  <li>之后需要在Zabbix的管理页面添加对应Tomcat服务器的jmx监控接口</li>
  <li>最后zabbix端会自动获取zabbix-java-gateway的数据并根据相应模板进行展
示</li>
  <li>工作流: [Zabbix-Server]–&gt;(port:10053 on zabbix server)–&gt; [zabbix-java-gateway] –(port:12345 on tomcatserver)–&gt; [JMX enabled]</li>
</ul>

<h4 id="1-install-zabbix-java-gateway-on-zabbix-server">1. Install zabbix-java-gateway on Zabbix Server</h4>
<p>因为我的zabbix是使用zabbix 2.4官方源安装，所以只需要用yum在安装即可:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@6 ~]# sudo  yum install -y zabbix-java-gateway
</code></pre></div></div>
<p>如果你没有官方源可能先安装该源，注意我的服务器zabbix版本是2.4 如果你是不同的版本，请到[<a href="http://repo.zabbix.com/zabbix/">这里</a>]查找对应版本。</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 查看zabbix server版本
[root@6 ~]# zabbix_server --version
Zabbix server v2.4.8 (revision 59539) (20 April 2016)
Compilation time: May  4 2016 01:32:12
</code></pre></div></div>

<p>在使用yum安装zabbix-java-gateway源时,会自动关联安装openjdk，尽管这段程序没多大影响，如果你想保证系统JAVA环境不受到改变的话，可以在/etc/profile文件最后，增加如下内容:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># add follows to the end
export JAVA_HOME=/usr/java/default
export PATH=$PATH:$JAVA_HOME/bin
export CLASSPATH=.:$JAVA_HOME/jre/lib:$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar
</code></pre></div></div>

<h4 id="2-confiure-tomcat-host-with-enable-jmx">2. Confiure Tomcat host with enable jmx</h4>
<p>首先在$tomcatdir/bin/catalina.sh文件开头处增加如下：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/sh

CATALINA_OPTS="-Dcom.sun.management.jmxremote \
-Dcom.sun.management.jmxremote.authenticate=false \
-Dcom.sun.management.jmxremote.ssl=false \
-Dcom.sun.management.jmxremote.port=12345"
</code></pre></div></div>
<p>然后,启动Tomcat，你会发现多了一个12345端口，这就是jmx的监听端口，请保证zabbix-java-gateway可以访问到这台服务器。</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@6 ~]# /tomcat7/bin/startup.sh
Starting Tomcat7:
Using CATALINA_BASE:   /tomcat7
Using CATALINA_HOME:   /tomcat7
Using CATALINA_TMPDIR: /tomcat7/temp
Using JRE_HOME:        /usr
Using CLASSPATH:       /tomcat7/bin/bootstrap.jar:/tomcat7/bin/tomcat-juli.jar
Tomcat started.

[root@6 ~]# netstat -ntlp | grep 12345
tcp  0      0 :::12345   :::*     LISTEN      8793/java
[root@6 ~]#
</code></pre></div></div>
<hr />

<h4 id="fix-1---zabbix-agent与server存在复杂网络环境">==<em>fix 1</em> == : zabbix agent与server存在复杂网络环境</h4>

<p>这里疏忽了1个问题，如果您的zabbix server与agent端之间有防火墙规则，而按照我上面的所述只是增加了12345这个端口，那么很可能，您在/var/log/zabbix/zabbix_java_gateway.log 中会看到“No route to host”的报错，这是因为JMX不光开启了12345端口，还开启了另外两个随机端口，而在获取监控数据时会使用到其中一个，这就导致了无法通过固定的防火墙规则来开放该端口。其实有另外一个替代方式来使该监听端口固定下来——使用Tomcat提供的额外组件 catalina-jmx-remote.jar，这个组件是需要另外下载的：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 查看当前Tomcat版本.
[root@6 bin]# ./catalina.sh version
Using CATALINA_BASE:   /tomcat7
Using CATALINA_HOME:   /tomcat7
Using CATALINA_TMPDIR: /tomcat7/temp
Using JRE_HOME:        /usr
Using CLASSPATH:       /tomcat7/bin/bootstrap.jar:/tomcat7/bin/tomcat-juli.jar
Server version: Apache Tomcat/7.0.64
Server built:   Aug 19 2015 17:18:06 UTC
Server number:  7.0.64.0
OS Name:        Linux
OS Version:     2.6.32-642.11.1.el6.x86_64
Architecture:   amd64
JVM Version:    1.8.0_111-b15
JVM Vendor:     Oracle Corporation

# 下载 catalina-jmx-remote.jar # 请注意下载版本不要高于当前tomcat版本.
wget http://mirror.bit.edu.cn/apache/tomcat/tomcat-7/v7.0.57/bin/extras/catalina-jmx-remote.jar -O lib/catalina-jmx-remote.jar
</code></pre></div></div>

<p>增加如下内容，在conf/server.xml中：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Listener className="org.apache.catalina.mbeans.JmxRemoteLifecycleListener"
          rmiRegistryPortPlatform="12345" rmiServerPortPlatform="12346" /&gt;
</code></pre></div></div>

<p>因为我们已经在conf/server.xml定义了rmiRegistryPortPlatform，所以要将bin/catalina.sh中CATALINA_OPTS的com.sun.management.jmxremote.port去掉，否则会因为jmxremote.port配置有优先级更高而导致配置失效。</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CATALINA_OPTS="-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false"
</code></pre></div></div>

<p>完成之后，重启tomcat这时会发现jmx默认端口已经固定为12345何12346，而server依然可以正常获取监控数据.</p>

<hr />

<h4 id="3-configure-zabbix-server">3. Configure Zabbix Server</h4>
<p>首先需要修改zabbix_server.conf启用zabbix-java-gateway，让zabbix可以检测到服务,修改如下:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>### Option: JavaGateway
 #       IP address (or hostname) of Zabbix Java gateway.
 #       Only required if Java pollers are started.
 #
 # Mandatory: no
 # Default:
JavaGateway=10.211.55.4 # 设置为你的zabbixsever IP

 ### Option: JavaGatewayPort
 #       Port that Zabbix Java gateway listens on.
 #
 # Mandatory: no
 # Range: 1024-32767
 # Default:
 JavaGatewayPort=10053 # 设置服务端监听接口

 ### Option: StartJavaPollers
 #       Number of pre-forked instances of Java pollers.
 #
 # Mandatory: no
 # Range: 0-1000
 # Default:
 StartJavaPollers=5 # 设置多线程启动
</code></pre></div></div>
<p>然后修改zabbix_java_gateway.conf 配置如下:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ### Option: zabbix.listenIP
 #       IP address to listen on.
 #
 # Mandatory: no
 # Default:
 LISTEN_IP="10.211.55.4" # 配置监听IP

 ### Option: zabbix.listenPort
 #       Port to listen on.
 #
 # Mandatory: no
 # Range: 1024-32767
 # Default:
 LISTEN_PORT=10053 # 配置监听端口

 ### Option: zabbix.pidFile
 #       Name of PID file.
 #       If omitted, Zabbix Java Gateway is started as a console application.
 #
 # Mandatory: no
 # Default:
 # PID_FILE=

 PID_FILE="/var/run/zabbix/zabbix_java.pid"

 ### Option: zabbix.startPollers
 #       Number of worker threads to start.
 #
 # Mandatory: no
 # Range: 1-1000
 # Default:
# 不能大于zabbix_server.conf的值，否则可能导致当连接Java gateway时没有多余的线程进行处理
 START_POLLERS=5
</code></pre></div></div>

<p>最后启动启动zabbix-java-gateway，并重启zabbix-server</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@6 ~]# service zabbix-java-gateway start
Starting zabbix java gateway:              [  OK  ]
[root@6 ~]# service zabbix-server restart
Stopping zabbix server:              [  OK  ]
Starting zabbix server:              [  OK  ]
</code></pre></div></div>

<p>我在尝试重启发现一问题，zabbix-java-gateway通过service命令管理stop不能删除pid文件导致服务无法启动，如果你也碰到，解决办法如下:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@6 zabbix]# vim /etc/rc.d/init.d/zabbix-java-gateway
# line 97, 注释修改为如下：
#       kill `cat $PID_FILE` &amp;&amp; rm $PID_FILE
        rm -f $PID_FILE
</code></pre></div></div>

<h4 id="4-adding-jmx-host-on-zabbix-web-consloe">4. Adding jmx host on Zabbix Web consloe</h4>
<p>首先，上传Template Tomcat Head Memory模板，这个我做了一个简单的模板，只针对了堆内存空间的监控，并针对使用率超过60%以及80%，不同的警报。需要的同学可以直接从我这里下载，然后在Configuration-Templates导入到zabbix模板库内。<br />
下载请点击:<a href="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zbx_template_app_tomcat_head_memory.xml">Template App Tomcat Head Memory</a></p>

<p>然后，增加服务器的jmx监控<br />
<img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-jmx-settings.png" alt="" />
<br />
关联模板<br />
<img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-host-select-template.png" alt="" /></p>

<h4 id="5-view-the-head-memory-monitoring">5. View the Head Memory Monitoring.</h4>
<p><img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/12/zabbix-view-monitor.png" alt="" /></p>


      
    </div>
    <br/>
    <div>
      <cite>2017-01-18</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Zabbix">Zabbix</a>
      , 
      <a href="/tags.html#Tomcat">Tomcat</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/01/%E6%AF%8F%E6%97%A5%E5%A4%87%E4%BB%BDMySQL%E5%8D%95%E8%A1%A8%E6%95%B0%E6%8D%AE.html">每日备份MySQL单表数据</a></h1>
    <div class="post_at_index">
      <p>最近愈近年底，客户业务涉及对账操作，所以同事提出需求需要单独备份某张表数据，并且每日备份；思考之后解决办法如下：</p>

<ol>
  <li>mysqldump导出单张表的表结构及数据</li>
  <li>新增数据库，专做临时每日数据备份库</li>
  <li>导入该表数据到新增数据库内</li>
  <li>重命名导入的表名（预防计划任务下次导入时数据覆盖）</li>
  <li>编写脚本，添加Linux计划任务</li>
</ol>

<h4 id="1-mysqldump导出但张表的表结构及数据">1. mysqldump导出但张表的表结构及数据</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysqldump -h dbServer -PdbServerPort -u db_user -p -d dbName tbName &gt; tbName.sql
</code></pre></div></div>

<h4 id="2-新增数据库专做临时每日数据备份库">2. 新增数据库，专做临时每日数据备份库</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># loginTo your DBserver
mysql&gt; create database bakdbName character set utf8;
</code></pre></div></div>

<h4 id="3-导入该表数据到新增数据库内">3. 导入该表数据到新增数据库内</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -h dbServer -P dbServerPort -u db_user -p bakdbName &lt; tbName.sql
</code></pre></div></div>

<h4 id="4--重命名导入的表名">4 . 重命名导入的表名</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql -u db_user -p -e "rename table bakdbName.tbName to bakdbName.tbName_$DATE"
</code></pre></div></div>

<h4 id="5-编写脚本">5. 编写脚本</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@testServer01 ~]# cat /usr/local/bin/bakTable.sh
#!/bin/bash

#Create by SAMZONG

DATE=`date +%Y%m%d`
TMPDIR=/tmp/baksql

# modify your DB configure
DBSERVER1=localhost
DBSERVER1_PORT=3306
DBSERVER1_USER=root
DBSERVER1_PASSWORD=password
MASTER_DBNAME=zabbix
MASTER_TBNAME=users

DBSERVER2=localhost
DBSERVER2_PORT=3306
DBSERVER2_USER=root
DBSERVER2_PASSWORD=password
BAKDBNAME=z3

# creat tmp folder
if [ ! -d $TMPDIR ]; then
	mkdir $TMPDIR
fi

# dump tbName
mysqldump -h $DBSERVER1 -P $DBSERVER1_PORT -u $DBSERVER1_USER -p"$DBSERVER1_PASSWORD" -d $MASTER_DBNAME  $MASTER_TBNAME &gt; $TMPDIR/$MASTER_TBNAME.sql


# insert tbNAME to bakdbName
if [ $? -eq 0  ]; then
	mysql -h $DBSERVER2 -P $DBSERVER2_PORT -u $DBSERVER2_USER -p"$DBSERVER2_PASSWORD" $BAKDBNAME &lt; $TMPDIR/$MASTER_TBNAME.sql

	if [ $? -eq 0 ]; then
		# rename tbName
		mysql -h $DBSERVER2 -P $DBSERVER2_PORT -u $DBSERVER2_USER -p"$DBSERVER2_PASSWORD" -e "rename table "$BAKDBNAME"."$MASTER_TBNAME" to "$BAKDBNAME"."$MASTER_TBNAME"_"$DATE";"
	fi

fi
</code></pre></div></div>

<h4 id="6-添加到linux计划任务">6. 添加到Linux计划任务</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>00 00 * * * /usr/local/bin/bakTable.sh
</code></pre></div></div>


      
    </div>
    <br/>
    <div>
      <cite>2017-01-15</cite> <i class="icon-tag"></i>
      <a href="/tags.html#MySQL">MySQL</a>
      , 
      <a href="/tags.html#Shell">Shell</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/01/%E7%94%9F%E6%B4%BB%E5%9C%A8%E5%88%AB%E5%A4%84.html">生活在别处</a></h1>
    <div class="post_at_index">
      <p>生活在别处，第一次看到这句话的时候是初中，便在之后的许多年间未曾忘记。</p>

<p>第一我不懂为何“生活在别处”，生活如何在别处？生活不应再当下？生活如影随行，在你忙忙碌碌烦烦烦烦时，生活就在这里，在你快快乐乐时，生活还在这里，我一直以为所见所行就是生活；可是，随着生长，你依旧在这里，而生活早已飘落别处。</p>

<p>“生活在别处”是法国诗人兰波的一句名言，而他用一生践行了这句话，他一生都在出走，从法国到英国而后非洲，兰波一生都在出走，直到最后死去；他是一位无法被归类的诗人，放荡不羁，与魏尔伦的爱情，新世界的开创者，兰波一生都在尝试不同的人生，就像他说的：“我愿成为任何人”。</p>

<blockquote>
  <p><em>《全蝕狂愛》 1995 ，描述了兰波的故事，与魏尔伦的爱情。由李奥纳多扮演。</em></p>
</blockquote>

<p>我不会写故事，更多的用来记录我的生活，本来今天晚上准备写些什么，如何关于整理笔记之类，下班日常刷知乎，看到《这个杀手不太冷》中一句话，“生活一直是那么艰难吗？还是只有小时候是这样？” “一直是。”脑海里就浮现了“生活在别处”这句话，随着人生阅历的成长，对这几句话的理解，也是不断加深； 所以，回来写下这段文字。</p>

<p>我一直试着找出自身的问题，我一直努力和生活更好地相处，我其实并不知道如何规划，我能感受到生命中特别重要的东西，要拼尽所有力气去抓住；我不喜欢去做承诺，我所能做的就是一直努力去做；在我们的人生中肯定会存在一些望不到顶的大山，可能我穷尽一生也无法看到山顶的景色和山的那边的一切，这的确是一件想想就很难过的事情，并且这一切无法逃避，听起来是那么地令人绝望，但是，亲爱的，我们总要去面对，或是大步向前，冲向那满是荆棘望不到顶的大山，要打败可以吃掉我们的大老虎，一次又一次，我们会经常失败，摔倒，伤痕累累，可是我总要爬起来，一次又一次，每次都像是用尽整个生命的力量，也许我们真的最后跌倒爬不起来了，也许我们最后真的无法凝聚一丝力量，那至少，我们明白我是真的做不到，而不是说从一开始就放弃，努力让自己变更好；嗯，方向也很重要。</p>

<p>好了，我还要去整理笔记，然后早点睡觉，今天心情不太好，可身边总有些美丽的人，谢谢！</p>

<p>最后，生活一直是那么艰难吗？</p>

      
    </div>
    <br/>
    <div>
      <cite>2017-01-10</cite> <i class="icon-tag"></i>
      <a href="/tags.html#我给你讲个故事吧">我给你讲个故事吧</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2017/01/Docker-Hub-%E5%9B%BD%E5%86%85%E5%8A%A0%E9%80%9F.html">Docker Hub 国内加速</a></h1>
    <div class="post_at_index">
      <p>因为Docker Hub没有在国内部署站点或者增加了国内的CDN，这导致国内的开发者在使用docker pull 获取images的时候速度非常的慢，甚至于因为网络的原因会失败。</p>

<p>但是Docker Hub有着非常丰富的镜像资源，所以我这一直是个问题困扰着我，一次偶然机会发现了<a href="https://www.daocloud.io">DaoCloud</a>提供了国内镜像加速服务，并且提供的Docker Hub Mirror详细的文档。</p>

<h4 id="1-注册daocloud账号">1. 注册DaoCloud账号</h4>
<p>首先，你需要到一DaoCloud账号，注册很方便，点击地址：<a href="https://account.daocloud.io/signup">signup</a>
<img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/o6wh3.jpg" alt="" /></p>

<h4 id="2-登录到你的daocloud账号内然后入下图操作">2. 登录到你的DaoCloud账号内，然后入下图操作</h4>
<p><img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/n9mt7.jpg" alt="" /></p>

<h4 id="3-查看你的daocloud加速器地址">3. 查看你的DaoCloud加速器地址</h4>
<p><a href="https://www.daocloud.io/mirror#accelerator-doc">链接</a></p>

<p>选择你相对应平台的的加速器设置
<img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/blog/4wuea.jpg" alt="" /></p>

      
    </div>
    <br/>
    <div>
      <cite>2017-01-07</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Docker">Docker</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2016/12/HowTo-Mount-OSS-Bucket-On-ECS.html">HowTo Mount OSS Bucket On ECS</a></h1>
    <div class="post_at_index">
      <blockquote>
  <p>From <a href="https://github.com/aliyun/ossfs">阿里云官方Github</a></p>
</blockquote>

<blockquote>
  <p>Demo: CentOS 6.8 on ECS</p>
</blockquote>

<p>ossfs 是通过磁盘挂载的形式，将oss存储挂载到linux、类unix等操作系统，而且不仅仅可以挂载阿里云内的ECS上，理论上所有网络能到达oss的都可以挂载，但还是要以实际问题为准。</p>

<h5 id="1download--install">1.Download &amp; Install</h5>
<p><a href="https://github.com/aliyun/ossfs/releases">官方版本发布页面</a>，请根据你的系统类型进行选择，我这演示的环境是CentOS 6.8；ossfs目前最新的版本是v1.79.9，您可以根据自己当时版本进行选择，建议选择最新版本。</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 请先将包上传到服务器上
 sudo yum localinstall ossfs_1.79.9_centos6.5_x86_64.rpm
</code></pre></div></div>
<blockquote>
  <p>注意使用localinstall，因为在安装过程，yum 可以很好的解决依赖关系，会节省我们很多时间</p>
</blockquote>

<h5 id="2-oss--bucket">2. OSS &amp; Bucket</h5>

<p>需要获取以下信息，在后面我们都会用到的：<br /></p>
<ol>
  <li>Bucket 名称
  <img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/QQ20161111-0.jpg" alt="" />
  <br /></li>
  <li>Access Key ID</li>
  <li>Access Key Secret
  <img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/0256A9CB-A0FA-43BC-82AF-4DE17D4852B6.png" alt="" /></li>
</ol>

<p><img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/QQ20161111-2.jpg" alt="" />
<br /></p>
<ol>
  <li>Location，这需要注意点，不要加上Bucket的名字，区域对应表如下，注意你的Bucket所在区域:</li>
</ol>
<div><table><thead><tr><th style="color:green">Region中文名称</th><th style="text-align:left;color: green;">Region英文表示</th><th style="text-align:left;color: green;">外网Endpoint</th><th style="text-align:left;color: green;">ECS访问的内网Endpoint</th></tr></thead><tbody><tr><td>华东 1</td><td style="text-align:left">oss-cn-hangzhou</td><td style="text-align:left">oss-cn-hangzhou.aliyuncs.com</td><td style="text-align:left">oss-cn-hangzhou-internal.aliyuncs.com</td></tr><tr><td>华东 2</td><td style="text-align:left">oss-cn-shanghai</td><td style="text-align:left">oss-cn-shanghai.aliyuncs.com</td><td style="text-align:left">oss-cn-shanghai-internal.aliyuncs.com</td></tr><tr><td>华北 1</td><td style="text-align:left">oss-cn-qingdao</td><td style="text-align:left">oss-cn-qingdao.aliyuncs.com</td><td style="text-align:left">oss-cn-qingdao-internal.aliyuncs.com</td></tr><tr><td>华北 2</td><td style="text-align:left">oss-cn-beijing</td><td style="text-align:left">oss-cn-beijing.aliyuncs.com</td><td style="text-align:left">oss-cn-beijing-internal.aliyuncs.com</td></tr><tr><td>华南 1</td><td style="text-align:left">oss-cn-shenzhen</td><td style="text-align:left">oss-cn-shenzhen.aliyuncs.com</td><td style="text-align:left">oss-cn-shenzhen-internal.aliyuncs.com</td></tr><tr><td>香港数据中心</td><td style="text-align:left">oss-cn-hongkong</td><td style="text-align:left">oss-cn-hongkong.aliyuncs.com</td><td style="text-align:left">oss-cn-hongkong-internal.aliyuncs.com</td></tr><tr><td>美国硅谷数据中心</td><td style="text-align:left">oss-us-west-1</td><td style="text-align:left">oss-us-west-1.aliyuncs.com</td><td style="text-align:left">oss-us-west-1-internal.aliyuncs.com</td></tr><tr><td>美国弗吉尼亚数据中心</td><td style="text-align:left">oss-us-east-1</td><td style="text-align:left">oss-us-east-1.aliyuncs.com</td><td style="text-align:left">oss-us-east-1-internal.aliyuncs.com</td></tr><tr><td>亚太（新加坡）数据中心</td><td style="text-align:left">oss-ap-southeast-1</td><td style="text-align:left">oss-ap-southeast-1.aliyuncs.com</td><td style="text-align:left">oss-ap-southeast-1-internal.aliyuncs.com</td></tr><tr><td>亚太东北 1（日本）数据中心</td><td style="text-align:left">oss-ap-northeast-1</td><td style="text-align:left">oss-ap-northeast-1.aliyuncs.com</td><td style="text-align:left">oss-ap-northeast-1-internal.aliyuncs.com</td></tr></tbody></table></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 设置bucket/access key/id的信息，将其存放在/etc/passwd-ossfs 文件中
# 注意这个文件的权限必须正确设置，建议设为640
sudo echo my-bucket:my-access-key-id:my-access-key-secret &gt; /etc/passwd-ossfs
sudo chmod 640 /etc/passwd-ossfs
</code></pre></div></div>
<p><br /></p>
<h5 id="3-mount--uasge">3. Mount &amp; Uasge</h5>
<p>将oss bucket mount到指定目录:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 我碰到安装后找不到ossfs命令，查看下因为ossfs没有x权限，目录路径为/usr/local/bin，如果您也碰到这个问题，可以增加x权限后再测试
sudo ossfs my-bucket /mnt/ossdir -ourl=http://oss-location.aliyuncs.com

# 如果使用ossfs的机器是阿里云ECS，可以使用内网域名来避免流量收费和 提高速度：
sudo ossfs my-bucket /tmp/ossfs -ourl=http://oss-location-internal.aliyuncs.com
</code></pre></div></div>
<p>磁盘空间达到上百T：
<img src="https://samzong.oss-cn-shenzhen.aliyuncs.com/2016/11/0B78E099-5488-4839-AE48-09A074E7415D.png" alt="" />
<br /></p>

<p>umount：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 注意用户身份
umount /tmp/ossfs # root user
sudo fusermount -u /tmp/ossfs # non-root user
</code></pre></div></div>
<p><br /></p>
<h5 id="4-debug--faq">4. Debug &amp; FAQ</h5>
<p>当遇到错误的时候，可以试着打开Debug日志信息，然后分析问题原因：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 使用 -o dbglevel=debug -f -d参数打印日志信息
sudo ossfs my-bucket /tmp/ossfs -ourl=http://oss-location-internal.aliyuncs.com -o dbglevel=debug -f -d &gt; /mnt/ossfs.log 2&gt;&amp;1
</code></pre></div></div>

<p>更多的问题，请移步查看<a href="https://github.com/aliyun/ossfs/wiki/FAQ">官方的FAQ文档</a>。</p>

<p><br /></p>
<h5 id="5-about">5. About</h5>
<p>ossfs提供的功能和性能和本地文件系统相比，具有一些局限性。具体包括：</p>

<ul>
  <li>随机或者追加写文件会导致整个文件的重写。</li>
  <li>元数据操作，例如list directory，性能较差，因为需要远程访问oss服务器。</li>
  <li>文件/文件夹的rename操作不是原子的。</li>
  <li>多个客户端挂载同一个oss bucket时，依赖用户自行协调各个客户端的行为。例如避免多个客户端写同一个文件等等。</li>
  <li>不支持hard link。</li>
  <li>不适合用在高并发读/写的场景，这样会让系统的load升高</li>
</ul>

<blockquote>
  <p>另外，ossfs的稳定性很大一部分依赖于网络环境，建议的使用场景更多是作为临时数据迁移或定期备份，虽然ossfs挂载到系统中会有着几百TB的空间，但是稳定性并不高。</p>
</blockquote>

      
    </div>
    <br/>
    <div>
      <cite>2016-12-20</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Aliyun">Aliyun</a>
      , 
      <a href="/tags.html#CentOS">CentOS</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2016/12/%E4%B8%8A%E6%B5%B7%E5%A4%A9%E5%86%B7%E4%BA%86.html">上海天冷了</a></h1>
    <div class="post_at_index">
      <p>上海天冷了啊！上海天冷了啊啊！！上海天冷了啊啊！！！</p>

<p>重要的事情说三遍，这是一个好习惯，有了冬天的感觉，早上起床的时候有感觉，下班路上有感觉，现在坐在键盘前打字也很有感觉；前几天在微博上写了几句话:如今算是最好的季节，褪去夏日的燥热与汗渍，又不像冬日那么干冷凛冽，穿的衣服也是刚刚好，单条牛仔裤加个风衣或冲锋衣既藏住身上的赘肉，又不失潇洒，正是装逼好时节，而最最好的是这个季节的女子，美丽更胜其它季节。朋友嘲笑说其实想看黑丝，哈哈！谁知才过几天，就感受到了那种“干冷凛冽”。但是，我喜欢这种感觉，就像我喜欢这座城市，我说我喜欢冬天，自小就喜欢，我说我喜欢这座城市，就像自小就喜欢；我说不出来为什么喜欢，就像很多说不出来为什么喜欢，就像有些人，就像有些事，就像有些讨厌，人终是要顺了自己的心意，不然不会开心，但是要懂事，不懂事就不可爱了。</p>

<!-- more -->

<p>最近一直比较忙，弄得心烦意乱。</p>

<p>生活上，最近外公有生病，母亲十分挂念，原本外公外婆年岁已高且身体不好，家里几位舅父却又不有作为，也令母亲十分苦恼，本来她身体也有不好，我却不能帮上她一二，内心也是颇为着急挂念，只能尽力安慰。说起外公外婆，也是难过不已，近两年，因些事每年都要回去两三趟，而又匆忙，故无多时间陪陪他们，外婆已多年卧病在床，起居生活全有外公照顾，我一次尝试想搀扶外婆起床，是异常艰难，可外公80多岁老人一扶就是8年多。有时，自己也想，若是自己到了这般年纪，该如何处置，想想也难过不已，想二位老人，到了这个年纪，早已不在乎吃穿用度如何如何，多年孤苦在家，更想要的子女多多陪伴，所以每次母亲打电话回去都哭泣不止；最怕“子欲养而亲不待”的事，我也劝说母亲有空就多多回老家陪陪，而母亲却担心我的婚娶生活，更令我难过不已，暗恨自己无用；昨今两日，父母又相继回老家，也希望外公身体早日恢复。</p>

<p>工作上，自从去年与领导夸下豪言便一直不敢懈怠，但实际做下来的确是要比想象中困难许多，本来自己就不是聪明，这段时间做项目需求，改了许多稿总算通过，开心，感叹领导是好性格，如此耐心指导我；而前段时间，这个项目好几处也是几近失控，和其他公司的人沟通协调处理等一团糟，还好如今都渐回正轨；第一项目还未做完，就打退堂鼓，幸亏领导的指导，同事的帮助，当然还有我的好妹妹，每次感觉扛不住的找她聊聊发发牢骚，都能耐心听并给我加油打气。感谢这些人，当然也感谢自己，总有各种办法给自己恢复元气，今早，用思维导图把最近的烦心事要做的事全部写出来，然后一条一条的分析处理，最后恢复了好心情，又一如既往的工作生活。</p>

<p>又23点过半了，要抓紧早睡了，调整正常作息才能更充沛的工作生活，记录走出了这一段不好的日子，恢复元气的自己，但是不能懈怠，毕竟“革命尚未成功，同志仍需努力”。</p>

      
    </div>
    <br/>
    <div>
      <cite>2016-12-17</cite> <i class="icon-tag"></i>
      <a href="/tags.html#我给你讲个故事吧">我给你讲个故事吧</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    

    <!-- Pagination links -->
    <nav>
      <ul class="pagination hidden-xs">
        
        
        <li>
          <a href="/page5">&laquo; Previous</a>
        </li>
        
        

        
        <li>
          <a href="/">1</a>
        </li>
        

        
          
            
            <li>
              <a href="/page2">2</a>
            </li>
            
            <li>
              <a href="/page3">3</a>
            </li>
            
            <li>
              <a href="/page4">4</a>
            </li>
            
            <li>
              <a href="/page5">5</a>
            </li>
            
            <li class="disabled"><span>...</span></li>
            <li class="active"><a>6</a></li>
          
          <li class="disabled"><span>...</span></li>
          <li><a href="/page14">14</a></li>
        

        
        

        
        <li>
          <a href="/page7">Next &raquo;</a>
        </li>
        
      </ul>
    </nav>
  </div>
  <div class="col-xs-12 col-md-4">
		<div>
			<a class="twitter-timeline" data-width="390" data-height="640" data-theme="light" href="https://twitter.com/samzong_lu?ref_src=twsrc%5Etfw">Tweets by SAMZONG</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
		</div>
    <div>
      <h2>我的网站</h2>
      <ul>
        <li><a href="https://yuque.com/samzong">语雀-花园</a></li>
        <li><a href="https://github.com/samzong">Github</a></li>
      </ul>
    </div>
    <div class="categories">
      <h2>文章分类</h2>
      <ul class="tag_box">
        
        


  
     
    	<li><a href="/categories.html#Linux">
    		Linux <span>21</span>
    	</a></li>
     
    	<li><a href="/categories.html#CentOS">
    		CentOS <span>14</span>
    	</a></li>
     
    	<li><a href="/categories.html#Tools">
    		Tools <span>4</span>
    	</a></li>
     
    	<li><a href="/categories.html#VPN">
    		VPN <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#HTML">
    		HTML <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#数据库">
    		数据库 <span>19</span>
    	</a></li>
     
    	<li><a href="/categories.html#MySQL">
    		MySQL <span>15</span>
    	</a></li>
     
    	<li><a href="/categories.html#Git">
    		Git <span>5</span>
    	</a></li>
     
    	<li><a href="/categories.html#TortoiseGit">
    		TortoiseGit <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#MongoDB">
    		MongoDB <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#PHP">
    		PHP <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#Mac">
    		Mac <span>6</span>
    	</a></li>
     
    	<li><a href="/categories.html#SourceTree">
    		SourceTree <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#OpenSource">
    		OpenSource <span>11</span>
    	</a></li>
     
    	<li><a href="/categories.html#Piwik">
    		Piwik <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#Python">
    		Python <span>7</span>
    	</a></li>
     
    	<li><a href="/categories.html#云服务">
    		云服务 <span>6</span>
    	</a></li>
     
    	<li><a href="/categories.html#Azure">
    		Azure <span>4</span>
    	</a></li>
     
    	<li><a href="/categories.html#虚拟化">
    		虚拟化 <span>7</span>
    	</a></li>
     
    	<li><a href="/categories.html#OpenStack">
    		OpenStack <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#CloudStack">
    		CloudStack <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#Zabbix">
    		Zabbix <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#Tomcat">
    		Tomcat <span>5</span>
    	</a></li>
     
    	<li><a href="/categories.html#Redis">
    		Redis <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#Docker">
    		Docker <span>4</span>
    	</a></li>
     
    	<li><a href="/categories.html#Shell">
    		Shell <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#Blog">
    		Blog <span>4</span>
    	</a></li>
     
    	<li><a href="/categories.html#Ghost">
    		Ghost <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#PostgreSQL">
    		PostgreSQL <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#AWS">
    		AWS <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#Aliyun">
    		Aliyun <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#Redmine">
    		Redmine <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#Bigdata">
    		Bigdata <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#Windows">
    		Windows <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#Jmeter">
    		Jmeter <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#随笔">
    		随笔 <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#闲聊">
    		闲聊 <span>3</span>
    	</a></li>
     
    	<li><a href="/categories.html#Hexo">
    		Hexo <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#Javascript">
    		Javascript <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#Telegram">
    		Telegram <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#Metabase">
    		Metabase <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#学习">
    		学习 <span>2</span>
    	</a></li>
     
    	<li><a href="/categories.html#Github">
    		Github <span>1</span>
    	</a></li>
    
  



      </ul>
    </div>
    <div>
      <h2>最近文章</h2>
      <ul>
        
        <li>
          <a href="/post/2022/09/K8s%E7%B3%BB%E5%88%97-%E5%8D%97%E5%8C%97%E6%B5%81%E9%87%8F%E5%92%8C%E4%B8%9C%E8%A5%BF%E6%B5%81%E9%87%8F.html">K8s系列 南北流量和东西流量</a>
          南北流量和东西流量 是什么意思？


        </li>
        
        <li>
          <a href="/post/2022/07/jq-%E5%91%BD%E4%BB%A4%E8%A1%8C-Json-%E5%A4%84%E7%90%86%E7%A5%9E%E5%99%A8.html">jq 命令行 Json 处理神器</a>
          
  https://mozillazg.com/2018/01/jq-use-examples-cookbook.htm-



        </li>
        
        <li>
          <a href="/post/2022/07/%E9%97%AD%E5%85%B3%E5%A4%87%E6%88%98-11%E6%9C%88.html">闭关备战 11月</a>
          title: 闭关备战 11月
toc: true
author: samzong.lu
author_id: defaultAuthorId
language: zh
abbrlink: 13757
tags: []
categories: []
date: 2022-07-18 00:35:00
—
目标


        </li>
        
        <li>
          <a href="/post/2022/05/hexo-admonition.html">Hexo 增加admonition样式支持</a>
          背景


        </li>
        
        <li>
          <a href="/post/2022/05/%E5%9B%BD%E5%86%85%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-MacOS-K8s-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83.html">国内环境搭建 MacOS K8s 开发环境</a>
          Minikube


        </li>
        
      </ul>
    </div>
  </div>
</div>

			</div>

		</div>

    <footer>
      <div class="container">
        <div class="row mobilepadding">
          			<hr>
      &copy; 2022 Samzong Lu. Powered by <a href="http://jekyllrb.com" target="_blank" title="The simple, blog-aware, static site generator.">Jekyll</a>. Theme Creator <a href="https://github.com/einverne" target="_blank" title="Ein Verne's GitHub Repos">Ein Verne</a> . Host on <a href="https://github.com/samzong/samzong.me" target="_blank" title="Samzong's GitHub Repos">Github</a> .
      <br><br>
      </div>
    </div>
    </footer>

    




	<script async type="text/javascript" src="/assets/themes/evjekylltheme/bootstrap-3.3.5/js/bootstrap.min.js"></script>
	<script async type="text/javascript" src="/assets/themes/evjekylltheme/webcore.js"></script>

 </body>
</html>

