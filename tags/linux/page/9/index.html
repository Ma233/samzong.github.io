<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">10 篇博文 含有标签「Linux」 | SAMZONG</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://samzong.me/tags/linux/page/9"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="keywords" content="kubernetes, blog"><meta data-rh="true" property="og:title" content="10 篇博文 含有标签「Linux」 | SAMZONG"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://samzong.me/tags/linux/page/9"><link data-rh="true" rel="alternate" href="https://samzong.me/tags/linux/page/9" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://samzong.me/tags/linux/page/9" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://QHUDGE595D-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="SAMZONG RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="SAMZONG Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="SAMZONG" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.757af0c1.css">
<link rel="preload" href="/assets/js/runtime~main.60be52c9.js" as="script">
<link rel="preload" href="/assets/js/main.3a3c6585.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://samzong.me" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logo.png" alt="Samzong" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Samzong" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">SAMZONG</b></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/samzong/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/tags">Tags</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/07/13/google-sou-suo-ji-qiao-zheng-li">Google 搜索技巧整理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2023/02/21/ketbrains-ji-huo-fu-wu-qi">在线服务器激活 Ketbrains</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/12/16/raycast">Raycast 你的年度报告已到达</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/12/15/Skoala-Install-Dce5">DCE5-Skoala 安装教程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/12/06/dce5">保姆式安装 DCE5.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/11/28/cskefu-opensource-project">春松客服</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/11/23/what-is-hukou">What is Hukou</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/11/20/Copy-To-Markdwon">Copy to Markdown</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/11/16/dubbo-ji-chu-zhi-shi">Dubbo 基础知识梳理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/11/10/panads-fill-nan-value-to-zero">Panads fill NaN value to Zero</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/10/22/redash-for-docker-bu-shu">Redash for Docker 部署</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/10/18/jwt-nei-zhi-de-fang-shi">JWT 内置的方式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/10/06/ji-ji-fu-ji-ji">唧唧复唧唧</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/10/04/zi-bei-yu-chao-yue">自卑与超越</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/09/28/gitlab-forked-ru-he-gen-sui-upstream-zhu-ku">GitLab Forked 如何跟随 upstream 主库</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/09/27/kafka-jing-pin-diao-yan-ji-gong-neng-she-ji">Kafka 调研及功能设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/09/22/poetry-shi-yong-bi-ji">Poetry 使用笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/09/20/skoala-bu-shu-jiao-cheng">Skoala 部署教程</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/09/18/shi-yong-canal-jin-xing-shu-ju-ku-zeng-liang-tong-bu">使用 canal 进行数据库增量同步</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/09/12/k8s-xi-lie-nan-bei-liu-liang-he-dong-xi-liu-liang">K8s 系列 南北流量和东西流量</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/08/17/docker-for-mac-wang-luo-ji-qiao">Docker for Mac 网络技巧</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/08/15/wa-er-deng-hu">瓦尔登湖</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/08/10/contour-xue-xi-bi-ji">Contour 学习笔记</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/07/24/tong-guo-pipreqs-huo-qu-dang-qian-xiang-mu-di-yi-lai-ku">通过 pipreqs 获取当前项目的依赖库</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/07/22/contour-envoy-zhi-biao">Contour和Envoy指标介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/07/22/jq-ming-ling-xing-json-chu-li-shen-qi">jq 命令行 Json 处理神器</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/07/21/wei-fu-wu-yin-qing-wang-guan-neng-li-jie-shao">微服务引擎网关能力介绍</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/07/18/bi-guan-bei-zhan-11-yue">闭关备战 11 月</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/07/18/i18n-shi-yong-gou-jian">i18n 使用构建</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/2022/06/29/mac-shang-an-zhuang-ruan-jian-de-fang-shi">Mac 上安装软件的方式</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>10 篇博文 含有标签「Linux」</h1><a href="/tags">查看所有标签</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/2016/03/18/li-jie-linux-de-ying-lian-jie-yu-ruan-lian-jie">理解 Linux 的硬链接与软链接</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2016-03-18T14:52:13.000Z" itemprop="datePublished">2016年3月18日</time> · <!-- -->阅读需 15 分钟</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="从-inode-了解-linux-文件系统">从 inode 了解 Linux 文件系统<a href="#从-inode-了解-linux-文件系统" class="hash-link" aria-label="从 inode 了解 Linux 文件系统的直接链接" title="从 inode 了解 Linux 文件系统的直接链接">​</a></h2><p>硬链接与软链接是 Linux 文件系统中的一个重要概念，其涉及文件系统中的索引节点 (index node 又称 inode)，而索引节点对象是 Linux 虚拟文件系统 (VFS) 的四个基本概念之一。通过剖析硬链接与软链接的联系与区别，我们可更好的了解 Linux 中 VFS 这一通用文件模型。并让 Linux 普通用户和系统管理员正确使用硬链接与软链接，帮助文件系统开发者获取 inode 的相关知识。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux-的文件系统与目录">Linux 的文件系统与目录<a href="#linux-的文件系统与目录" class="hash-link" aria-label="Linux 的文件系统与目录的直接链接" title="Linux 的文件系统与目录的直接链接">​</a></h3><p>现代操作系统为解决信息能独立于进程之外被长期存储引入了文件，文件作为进程创建信息的逻辑单元可被多个进程并发使用。在 UNIX 系统中，操作系统为磁盘上的文本与图像、鼠标与键盘等输入设备及网络交互等 I/O 操作设计了一组通用 API，使他们被处理时均可统一使用字节流方式。换言之，UNIX 系统中除进程之外的一切皆是文件，而 Linux 保持了这一特性。为了便于文件的管理，Linux 还引入了目录（有时亦被称为文件夹）这一概念。目录使文件可被分类管理，且目录的引入使 Linux 的文件系统形成一个层级结构的目录树。<code>清单 1</code>. 所示的是普通 Linux 系统的顶层目录结构，其中 /dev 是存放了设备相关文件的目录。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-1-linux-系统的顶层目录结构">清单 1. Linux 系统的顶层目录结构<a href="#清单-1-linux-系统的顶层目录结构" class="hash-link" aria-label="清单 1. Linux 系统的顶层目录结构的直接链接" title="清单 1. Linux 系统的顶层目录结构的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> /              根目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── bin     存放用户二进制文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── boot    存放内核引导配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── dev     存放设备文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── etc     存放系统配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── home    用户主目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── lib     动态共享库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── lost+found  文件系统恢复时的恢复文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── media   可卸载存储介质挂载点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── mnt     文件系统临时挂载点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── opt     附加的应用程序包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── proc    系统内存的映射目录，提供内核与进程信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── root    root 用户主目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sbin    存放系统二进制文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── srv     存放服务相关数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sys     sys 虚拟文件系统挂载点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── tmp     存放临时文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── usr     存放用户应用程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── var     存放邮件、系统日志等变化文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Linux 将设备当做文件进行处理，<code>清单 2</code>展示了如何打开设备文件 /dev/input/event5 并读取文件内容。文件 event5 表示一种输入设备，其可能是鼠标或键盘等。查看文件 /proc/bus/input/devices 可知 event5 对应设备的类型。设备文件 /dev/input/event5 使用 read() 以字符流的方式被读取。结构体 input_event 被定义在内核头文件 linux/input.h 中。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-2--打开并读取设备文件">清单 2.  打开并读取设备文件<a href="#清单-2--打开并读取设备文件" class="hash-link" aria-label="清单 2.  打开并读取设备文件的直接链接" title="清单 2.  打开并读取设备文件的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> int fd</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> struct input_event ie</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> fd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/dev/input/event5&quot;</span><span class="token plain">, O_RDONLY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fd, </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ie, sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">struct input_event</span><span class="token punctuation" style="color:#393A34">))</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;type = %d  code = %d  value = %d</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ie.type, ie.code, ie.value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="硬链接与软链接的联系与区别">硬链接与软链接的联系与区别<a href="#硬链接与软链接的联系与区别" class="hash-link" aria-label="硬链接与软链接的联系与区别的直接链接" title="硬链接与软链接的联系与区别的直接链接">​</a></h3><p>我们知道文件都有文件名与数据，这在 Linux 上被分成两个部分：用户数据 (user data) 与元数据 (metadata)。用户数据，即文件数据块 (data block)，数据块是记录文件真实内容的地方；而元数据则是文件的附加属性，如文件大小、创建时间、所有者等信息。在 Linux 中，元数据中的 inode 号（inode 是文件元数据的一部分但其并不包含文件名，inode 号即索引节点号）才是文件的唯一标识而非文件名。文件名仅是为了方便人们的记忆和使用，系统或程序通过 inode 号寻找正确的文件数据块。<code>图 1.</code>展示了程序通过文件名获取文件内容的过程。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="图-1-通过文件名打开文件">图 1. 通过文件名打开文件<a href="#图-1-通过文件名打开文件" class="hash-link" aria-label="图 1. 通过文件名打开文件的直接链接" title="图 1. 通过文件名打开文件的直接链接">​</a></h4><p><img loading="lazy" src="http://120.24.251.209/content/images/2016/03/image001.jpg" alt="image" class="img_ev3q"></p><p>在 Linux 系统中查看 inode 号可使用命令 stat 或 ls -i（若是 AIX 系统，则使用命令 istat）。<code>清单 3.</code>中使用命令 mv 移动并重命名文件 glibc-2.16.0.tar.xz，其结果不影响文件的用户数据及 inode 号，文件移动前后 inode 号均为：2485677。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-3--移动或重命名文件">清单 3.  移动或重命名文件<a href="#清单-3--移动或重命名文件" class="hash-link" aria-label="清单 3.  移动或重命名文件的直接链接" title="清单 3.  移动或重命名文件的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># stat /home/harris/source/glibc-2.16.0.tar.xz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File: `/home/harris/source/glibc-2.16.0.tar.xz&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Size: </span><span class="token number" style="color:#36acaa">9990512</span><span class="token plain">     Blocks: </span><span class="token number" style="color:#36acaa">19520</span><span class="token plain">      IO Block: </span><span class="token number" style="color:#36acaa">4096</span><span class="token plain">   regular </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Device: 807h/2055d   Inode: </span><span class="token number" style="color:#36acaa">2485677</span><span class="token plain">     Links: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Access: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0600/-rw-------</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  Uid: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain">/  harris</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   Gid: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain">/  harris</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 经网友指出，使用mv移动时不跨磁盘inode号不变，如果跨磁盘inode会改变。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># mv /home/harris/source/glibc-2.16.0.tar.xz /home/harris/Desktop/glibc.tar.xz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># ls -i -F /home/harris/Desktop/glibc.tar.xz</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">2485677</span><span class="token plain"> /home/harris/Desktop/glibc.tar.xz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>为解决文件的共享使用，Linux 系统引入了两种链接：硬链接 (hard link) 与软链接（又称符号链接，即 soft link 或 symbolic link）。链接为 Linux 系统解决了文件的共享使用，还带来了隐藏文件路径、增加权限安全及节省存储等好处。若一个 inode 号对应多个文件名，则称这些文件为硬链接。换言之，硬链接就是同一个文件使用了多个别名（见 <code>图 2.</code>hard link 就是 file 的一个别名，他们有共同的 inode）。硬链接可由命令 link 或 ln 创建。如下是对文件 oldfile 创建硬链接。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> oldfile newfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">ln</span><span class="token plain"> oldfile newfile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>由于硬链接是有着相同 inode 号仅文件名不同的文件，因此硬链接存在以下几点特性：</p><ul><li>文件有相同的 inode 及 data block；</li><li>只能对已存在的文件进行创建；</li><li>不能交叉文件系统进行硬链接的创建；</li><li>不能对目录进行创建，只可对文件创建；</li><li>删除一个硬链接文件并不影响其他有相同 inode 号的文件。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-4--硬链接特性展示">清单 4.  硬链接特性展示<a href="#清单-4--硬链接特性展示" class="hash-link" aria-label="清单 4.  硬链接特性展示的直接链接" title="清单 4.  硬链接特性展示的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ls -li</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> total </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> // 只能对已存在的文件创建硬连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># link old.file hard.link</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> link: cannot create </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">hard.link&#x27; to </span><span class="token variable" style="color:#36acaa">`</span><span class="token plain">old.file</span><span class="token string" style="color:#e3116c">&#x27;: No such file or directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"> # echo &quot;This is an original file&quot; &gt; old.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"> # cat old.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"> This is an original file</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"> # stat old.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  File: `old.file&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Size: </span><span class="token number" style="color:#36acaa">25</span><span class="token plain">          Blocks: </span><span class="token number" style="color:#36acaa">8</span><span class="token plain">          IO Block: </span><span class="token number" style="color:#36acaa">4096</span><span class="token plain">   regular </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Device: 807h/2055d   Inode: </span><span class="token number" style="color:#36acaa">660650</span><span class="token plain">      Links: </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Access: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0644/-rw-r--r--</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  Uid: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/    root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   Gid: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/    root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> // 文件有相同的 inode 号以及 data block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># link old.file hard.link | ls -li</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> total </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">660650</span><span class="token plain"> -rw-r--r-- </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> root root </span><span class="token number" style="color:#36acaa">25</span><span class="token plain"> Sep  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">17</span><span class="token plain">:44 hard.link</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">660650</span><span class="token plain"> -rw-r--r-- </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> root root </span><span class="token number" style="color:#36acaa">25</span><span class="token plain"> Sep  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">17</span><span class="token plain">:44 old.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> // 不能交叉文件系统</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># ln /dev/input/event5 /root/bfile.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ln: failed to create hard </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">/root/bfile.txt&#x27; </span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable operator" style="color:#393A34">&gt;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token plain">/dev/input/event5</span><span class="token string" style="color:#e3116c">&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"> Invalid cross-device link</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"> // 不能对目录进行创建硬连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"> # mkdir -p old.dir/test</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"> # ln old.dir/ hardlink.dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c"> ln: `old.dir/&#x27;</span><span class="token builtin class-name">:</span><span class="token plain"> hard </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> not allowed </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># ls -iF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">660650</span><span class="token plain"> hard.link  </span><span class="token number" style="color:#36acaa">657948</span><span class="token plain"> old.dir/  </span><span class="token number" style="color:#36acaa">660650</span><span class="token plain"> old.file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>文件 old.file 与 hard.link 有着相同的 inode 号：660650 及文件权限，inode 是随着文件的存在而存在，因此只有当文件存在时才可创建硬链接，即当 inode 存在且链接计数器（link count）不为 0 时。inode 号仅在各文件系统下是唯一的，当 Linux 挂载多个文件系统后将出现 inode 号重复的现象（如<code>清单 5.</code>展示了使用命令 df 查看当前系统中挂载的文件系统类型、各文件系统 inode 使用情况及文件系统挂载点。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-5--查找有相同-inode-号的文件">清单 5.  查找有相同 inode 号的文件<a href="#清单-5--查找有相同-inode-号的文件" class="hash-link" aria-label="清单 5.  查找有相同 inode 号的文件的直接链接" title="清单 5.  查找有相同 inode 号的文件的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># df -i --print-type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Filesystem     Type       Inodes  IUsed    IFree IUse% Mounted on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /dev/sda7      ext4      </span><span class="token number" style="color:#36acaa">3147760</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">283483</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">2864277</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">% /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> udev           devtmpfs   </span><span class="token number" style="color:#36acaa">496088</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">553</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">495535</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">% /dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> tmpfs          tmpfs      </span><span class="token number" style="color:#36acaa">499006</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">491</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">498515</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">% /run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> none           tmpfs      </span><span class="token number" style="color:#36acaa">499006</span><span class="token plain">      </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">499003</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">% /run/lock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> none           tmpfs      </span><span class="token number" style="color:#36acaa">499006</span><span class="token plain">     </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">498991</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">% /run/shm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /dev/sda6      fuseblk  </span><span class="token number" style="color:#36acaa">74383900</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">4786</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">74379114</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">% /media/DiskE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /dev/sda8      fuseblk  </span><span class="token number" style="color:#36acaa">29524592</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">19939</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">29504653</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">% /media/DiskF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># find / -inum 1114</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /media/DiskE/Pictures/t3.jpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /media/DiskF/123.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /bin/sync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>值得一提的是，Linux 系统存在 inode 号被用完但磁盘空间还有剩余的情况。我们创建一个 5M 大小的 ext4 类型的 mo.img 文件，并将其挂载至目录 /mnt。然后我们使用一个 shell 脚本将挂载在 /mnt 下 ext4 文件系统的 indoe 耗尽（见<code>清单 6.</code>）。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-6--测试文件系统-inode-耗尽但仍有磁盘空间的情景">清单 6.  测试文件系统 inode 耗尽但仍有磁盘空间的情景<a href="#清单-6--测试文件系统-inode-耗尽但仍有磁盘空间的情景" class="hash-link" aria-label="清单 6.  测试文件系统 inode 耗尽但仍有磁盘空间的情景的直接链接" title="清单 6.  测试文件系统 inode 耗尽但仍有磁盘空间的情景的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># dd if=/dev/zero of=mo.img bs=5120k count=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ls -lh mo.img</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> -rw-r--r-- </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">.0M Sep  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">17</span><span class="token plain">:54 mo.img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># mkfs -t ext4  -F ./mo.img</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> OS type: Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Block </span><span class="token assign-left variable" style="color:#36acaa">size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Fragment </span><span class="token assign-left variable" style="color:#36acaa">size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">Stride</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> blocks, Stripe </span><span class="token assign-left variable" style="color:#36acaa">width</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> blocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">1280</span><span class="token plain"> inodes, </span><span class="token number" style="color:#36acaa">5120</span><span class="token plain"> blocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token plain"> blocks </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5.00</span><span class="token plain">%</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> reserved </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> the super user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Writing superblocks and filesystem accounting information: </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># mount -o loop ./mo.img /mnt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># cat /mnt/inode_test.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token variable punctuation" style="color:#393A34">((</span><span class="token variable" style="color:#36acaa">i </span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable number" style="color:#36acaa">1</span><span class="token variable punctuation" style="color:#393A34">;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable punctuation" style="color:#393A34">;</span><span class="token variable" style="color:#36acaa"> i</span><span class="token variable operator" style="color:#393A34">++</span><span class="token variable punctuation" style="color:#393A34">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$?</span><span class="token plain"> -eq </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;This is file_</span><span class="token string variable" style="color:#36acaa">$i</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> file_</span><span class="token variable" style="color:#36acaa">$i</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">exit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ./inode_test.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ./inode_test.sh: line </span><span class="token number" style="color:#36acaa">6</span><span class="token plain">: file_1269: No space left on device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># df -iT /mnt/; du -sh /mnt/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Filesystem     Type Inodes IUsed IFree IUse% Mounted on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /dev/loop0     ext4   </span><span class="token number" style="color:#36acaa">1280</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1280</span><span class="token plain">     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">100</span><span class="token plain">% /mnt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">.3M   /mnt/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>硬链接不能对目录创建是受限于文件系统的设计（见 <code>清单 4.</code>对目录创建硬链接将失败）。现 Linux 文件系统中的目录均隐藏了两个个特殊的目录：当前目录（.）与父目录（..）。查看这两个特殊目录的 inode 号可知其实这两目录就是两个硬链接（注意目录 /mnt/lost+found/ 的 inode 号）。若系统允许对目录创建硬链接，则会产生目录环。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ls -aliF /mnt/lost+found</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> total </span><span class="token number" style="color:#36acaa">44</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> drwx------ </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> root root </span><span class="token number" style="color:#36acaa">12288</span><span class="token plain"> Sep  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">17</span><span class="token plain">:54 ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> drwxr-xr-x </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> root root </span><span class="token number" style="color:#36acaa">31744</span><span class="token plain"> Sep  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">17</span><span class="token plain">:57 </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># stat  /mnt/lost+found/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  File: `/mnt/lost+found/&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Size: </span><span class="token number" style="color:#36acaa">12288</span><span class="token plain">       Blocks: </span><span class="token number" style="color:#36acaa">24</span><span class="token plain">         IO Block: </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain">   directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Device: 700h/1792d   Inode: </span><span class="token number" style="color:#36acaa">11</span><span class="token plain">          Links: </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Access: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0700/drwx------</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  Uid: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/    root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">   Gid: </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/    root</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Access: </span><span class="token number" style="color:#36acaa">2012</span><span class="token plain">-09-01 </span><span class="token number" style="color:#36acaa">17</span><span class="token plain">:57:17.000000000 +0800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Modify: </span><span class="token number" style="color:#36acaa">2012</span><span class="token plain">-09-01 </span><span class="token number" style="color:#36acaa">17</span><span class="token plain">:54:49.000000000 +0800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Change: </span><span class="token number" style="color:#36acaa">2012</span><span class="token plain">-09-01 </span><span class="token number" style="color:#36acaa">17</span><span class="token plain">:54:49.000000000 +0800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Birth: -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>软链接与硬链接不同，若文件用户数据块中存放的内容是另一文件的路径名的指向，则该文件就是软连接。软链接就是一个普通文件，只是数据块内容有点特殊。软链接有着自己的 inode 号以及用户数据块（见 <code>图 2.</code>）。因此软链接的创建与使用没有类似硬链接的诸多限制：</p><ul><li>软链接有自己的文件属性及权限等；</li><li>可对不存在的文件或目录创建软链接；</li><li>软链接可交叉文件系统；</li><li>软链接可对文件或目录创建；</li><li>创建软链接时，链接计数 i_nlink 不会增加；</li><li>删除软链接并不影响被指向的文件，但若被指向的原文件被删除，则相关软连接被称为死链接（即 dangling link，若被指向路径文件被重新创建，死链接可恢复为正常的软链接）。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="图-2-软链接的访问">图 2. 软链接的访问<a href="#图-2-软链接的访问" class="hash-link" aria-label="图 2. 软链接的访问的直接链接" title="图 2. 软链接的访问的直接链接">​</a></h4><p><img loading="lazy" src="http://120.24.251.209/content/images/2016/03/image002.jpg" alt="image" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-7-软链接特性展示">清单 7. 软链接特性展示<a href="#清单-7-软链接特性展示" class="hash-link" aria-label="清单 7. 软链接特性展示的直接链接" title="清单 7. 软链接特性展示的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ls -li</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> total </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> // 可对不存在的文件创建软链接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ln -s old.file soft.link</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ls -liF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> total </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">789467</span><span class="token plain"> lrwxrwxrwx </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> Sep  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token plain">:00 soft.link -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> old.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> // 由于被指向的文件不存在，此时的软链接 soft.link 就是死链接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># cat soft.link</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> cat: soft.link: No such </span><span class="token function" style="color:#d73a49">file</span><span class="token plain"> or directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> // 创建被指向的文件 old.file，soft.link 恢复成正常的软链接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># echo &quot;This is an original file_A&quot; &gt;&gt; old.file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># cat soft.link</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> This is an original file_A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> // 对不存在的目录创建软链接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ln -s old.dir soft.link.dir</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># mkdir -p old.dir/test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># tree . -F --inodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">789497</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  old.dir/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">789498</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  test/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">789495</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  old.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">789495</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  soft.link -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> old.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">789497</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  soft.link.dir -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> old.dir/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当然软链接的用户数据也可以是另一个软链接的路径，其解析过程是递归的。但需注意：软链接创建时原文件的路径指向使用绝对路径较好。使用相对路径创建的软链接被移动后该软链接文件将成为一个死链接（如下所示的软链接 a 使用了相对路径，因此不宜被移动），因为链接数据块中记录的亦是相对路径指向。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> $ </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> -li</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> total </span><span class="token number" style="color:#36acaa">2136</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">656627</span><span class="token plain"> lrwxrwxrwx </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> harris harris       </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> Sep  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:37 a -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> data.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">656662</span><span class="token plain"> lrwxrwxrwx </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> harris harris       </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> Sep  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:37 b -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">656228</span><span class="token plain"> -rw------- </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> harris harris </span><span class="token number" style="color:#36acaa">2186738</span><span class="token plain"> Sep  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:37 data.txt </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="链接相关的命令">链接相关的命令<a href="#链接相关的命令" class="hash-link" aria-label="链接相关的命令的直接链接" title="链接相关的命令的直接链接">​</a></h3><p>在 Linux 中查看当前系统已挂着的文件系统类型，除上述使用的命令 df，还可使用命令 mount 或查看文件 /proc/mounts。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># mount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /dev/sda7 on / </span><span class="token builtin class-name">type</span><span class="token plain"> ext4 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rw,errors</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">remount-ro</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> proc on /proc </span><span class="token builtin class-name">type</span><span class="token plain"> proc </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rw,noexec,nosuid,nodev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> sysfs on /sys </span><span class="token builtin class-name">type</span><span class="token plain"> sysfs </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rw,noexec,nosuid,nodev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> none on /run/shm </span><span class="token builtin class-name">type</span><span class="token plain"> tmpfs </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rw,nosuid,nodev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>命令 ls 或 stat 可帮助我们区分软链接与其他文件并查看文件 inode 号，但较好的方式还是使用 find 命令，其不仅可查找某文件的软链接，还可以用于查找相同 inode 的所有硬链接。（见 <code>清单 8.</code>）</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-8-使用命令-find-查找软链接与硬链接">清单 8. 使用命令 find 查找软链接与硬链接<a href="#清单-8-使用命令-find-查找软链接与硬链接" class="hash-link" aria-label="清单 8. 使用命令 find 查找软链接与硬链接的直接链接" title="清单 8. 使用命令 find 查找软链接与硬链接的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 查找在路径 /home 下的文件 data.txt 的软链接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># find /home -lname data.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /home/harris/debug/test2/a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> // 查看路径 /home 有相同 inode 的所有硬链接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># find /home -samefile /home/harris/debug/test3/old.file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /home/harris/debug/test3/hard.link</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /home/harris/debug/test3/old.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># find /home -inum 660650</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /home/harris/debug/test3/hard.link</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /home/harris/debug/test3/old.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> // 列出路径 /home/harris/debug/ 下的所有软链接文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># find /home/harris/debug/ -type l -ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">656662</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> lrwxrwxrwx </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> harris harris </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> Sep </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:37 /home/harris/debug/test2/b -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">656627</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> lrwxrwxrwx </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> harris harris </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> Sep </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:37 /home/harris/debug/test2/a -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> data.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">789467</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> lrwxrwxrwx </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root root </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> Sep </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token plain">:00 /home/harris/debug/test/soft.link -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> old.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token number" style="color:#36acaa">789496</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> lrwxrwxrwx   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> root     root            </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> Sep  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token plain">:01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> /home/harris/debug/test/soft.link.dir -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> old.dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>系统根据磁盘的大小默认设定了 inode 的值（见<code>清单 9.</code>），如若必要，可在格式文件系统前对该值进行修改。如键入命令 mkfs -t ext4 -I 512/dev/sda4，将使磁盘设备 /dev/sda4 格式成 inode 大小是 512 字节的 ext4 文件系统。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-9-查看系统的-inode-值">清单 9. 查看系统的 inode 值<a href="#清单-9-查看系统的-inode-值" class="hash-link" aria-label="清单 9. 查看系统的 inode 值的直接链接" title="清单 9. 查看系统的 inode 值的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> // 查看磁盘分区 /dev/sda7 上的 inode 值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># dumpe2fs -h /dev/sda7 | grep &quot;Inode size&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> dumpe2fs </span><span class="token number" style="color:#36acaa">1.42</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">29</span><span class="token plain">-Nov-2011</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Inode size:            </span><span class="token number" style="color:#36acaa">256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># tune2fs -l /dev/sda7 | grep &quot;Inode size&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Inode size:            </span><span class="token number" style="color:#36acaa">256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux-vfs">Linux VFS<a href="#linux-vfs" class="hash-link" aria-label="Linux VFS的直接链接" title="Linux VFS的直接链接">​</a></h3><p>Linux 有着极其丰富的文件系统，大体上可分如下几类：</p><ol><li>网络文件系统，如 nfs、cifs 等；</li><li>磁盘文件系统，如 ext4、ext3 等；</li><li>特殊文件系统，如 proc、sysfs、ramfs、tmpfs 等。</li></ol><p>实现以上这些文件系统并在 Linux 下共存的基础就是 Linux VFS（Virtual File System 又称 Virtual Filesystem Switch），即虚拟文件系统。VFS 作为一个通用的文件系统，抽象了文件系统的四个基本概念：文件、目录项 (dentry)、索引节点 (inode) 及挂载点，其在内核中为用户空间层的文件系统提供了相关的接口（见 <code>图 3.</code>所示 VFS 在 Linux 系统的架构）。VFS 实现了 open()、read() 等系统调并使得 cp 等用户空间程序可跨文件系统。VFS 真正实现了上述内容中：在 Linux 中除进程之外一切皆是文件。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="图-3-vfs-在系统中的架构">图 3. VFS 在系统中的架构<a href="#图-3-vfs-在系统中的架构" class="hash-link" aria-label="图 3. VFS 在系统中的架构的直接链接" title="图 3. VFS 在系统中的架构的直接链接">​</a></h4><p><img loading="lazy" src="http://120.24.251.209/content/images/2016/03/image003.jpg" alt="image" class="img_ev3q"></p><p>Linux VFS 存在四个基本对象：超级块对象 (superblock object)、索引节点对象 (inode object)、目录项对象 (dentry object) 及文件对象 (file object)。超级块对象代表一个已安装的文件系统；索引节点对象代表一个文件；目录项对象代表一个目录项，如设备文件 event5 在路径 /dev/input/event5 中，其存在四个目录项对象：/ 、dev/ 、input/ 及 event5。文件对象代表由进程打开的文件。这四个对象与进程及磁盘文件间的关系如<code>图 4.</code> 所示，其中 d_inode 即为硬链接。为文件路径的快速解析，Linux VFS 设计了目录项缓存（Directory Entry Cache，即 dcache）。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="图-4-vfs-的对象之间的处理">图 4. VFS 的对象之间的处理<a href="#图-4-vfs-的对象之间的处理" class="hash-link" aria-label="图 4. VFS 的对象之间的处理的直接链接" title="图 4. VFS 的对象之间的处理的直接链接">​</a></h4><p><img loading="lazy" src="http://120.24.251.209/content/images/2016/03/image004.jpg" alt="image" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux-文件系统中的-inode">Linux 文件系统中的 inode<a href="#linux-文件系统中的-inode" class="hash-link" aria-label="Linux 文件系统中的 inode的直接链接" title="Linux 文件系统中的 inode的直接链接">​</a></h3><p>在 Linux 中，索引节点结构存在于系统内存及磁盘，其可区分成 VFS inode 与实际文件系统的 inode。VFS inode 作为实际文件系统中 inode 的抽象，定义了结构体 inode 与其相关的操作 inode_operations（见内核源码 include/linux/fs.h）。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-10-vfs-中的-inode-与-inode_operations-结构体">清单 10. VFS 中的 inode 与 inode_operations 结构体<a href="#清单-10-vfs-中的-inode-与-inode_operations-结构体" class="hash-link" aria-label="清单 10. VFS 中的 inode 与 inode_operations 结构体的直接链接" title="清单 10. VFS 中的 inode 与 inode_operations 结构体的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct inode </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const struct inode_operations   *i_op</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> // 索引节点操作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned long           i_ino</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">      // 索引节点号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    atomic_t                i_count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    // 引用计数器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int            i_nlink</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    // 硬链接数目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> struct inode_operations </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*create</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">struct inode*,struct dentry *,int, struct nameidata*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*link</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">struct dentry*,struct inode *,struct dentry*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*unlink</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">struct inode*,struct dentry *</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*symlink</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">struct inode *,struct dentry*,const char *</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*mkdir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">struct inode *,struct dentry*,int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">*rmdir</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">struct inode*,struct dentry *</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如<code>清单 10.</code> 所见，每个文件存在两个计数器：i_count 与 i_nlink，即引用计数与硬链接计数。结构体 inode 中的 i_count 用于跟踪文件被访问的数量，而 i_nlink 则是上述使用 ls -l 等命令查看到的文件硬链接数。或者说 i_count 跟踪文件在内存中的情况，而 i_nlink 则是磁盘计数器。当文件被删除时，则 i_nlink 先被设置成 0。文件的这两个计数器使得 Linux 系统升级或程序更新变的容易。系统或程序可在不关闭的情况下（即文件 i_count 不为 0），将新文件以同样的文件名进行替换，新文件有自己的 inode 及 data block，旧文件会在相关进程关闭后被完整的删除。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-11-文件系统-ext4-中的-inode">清单 11. 文件系统 ext4 中的 inode<a href="#清单-11-文件系统-ext4-中的-inode" class="hash-link" aria-label="清单 11. 文件系统 ext4 中的 inode的直接链接" title="清单 11. 文件系统 ext4 中的 inode的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct ext4_inode </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __le32  i_atime</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">        // 文件内容最后一次访问时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __le32  i_ctime</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">        // inode 修改时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __le32  i_mtime</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">        // 文件内容最后一次修改时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __le16  i_links_count</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  // 硬链接计数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __le32  i_blocks_lo</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    // Block 计数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __le32  i_block</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EXT4_N_BLOCKS</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  // 指向具体的 block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>清单 12.</code>的错误信息。因此实际文件系统的 inode 之间及与 VFS inode 相较是有差异的。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="清单-12-文件系统-ext3-中-i_links_count-的限制">清单 12. 文件系统 ext3 中 i_links_count 的限制<a href="#清单-12-文件系统-ext3-中-i_links_count-的限制" class="hash-link" aria-label="清单 12. 文件系统 ext3 中 i_links_count 的限制的直接链接" title="清单 12. 文件系统 ext3 中 i_links_count 的限制的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ./dirtest.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> mkdir: cannot create directory </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">dir_31999&#x27;: Too many links</span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="display:inline-block;color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa"></span><span class="token variable comment" style="color:#999988;font-style:italic"># ./linkcount.sh</span><span class="token variable" style="color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="display:inline-block;color:#36acaa"></span><br></span><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa"> ln: failed to create hard </span><span class="token variable function" style="color:#d73a49">link</span><span class="token variable" style="color:#36acaa"> to </span><span class="token variable" style="color:#36acaa">`</span><span class="token plain">old.file&#x27;: Too many links</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="结束语">结束语<a href="#结束语" class="hash-link" aria-label="结束语的直接链接" title="结束语的直接链接">​</a></h3><p>本文最初描述了 Linux 系统中文件与目录被引入的原因及 Linux 处理文件的方式，然后我们通过区分硬链接与软链接的不同，了解 Linux 中的索引节点的相关知识，并以此引出了 inode 的结构体。索引节点结构体存在在于 Linux VFS 以及实际文件系统中，VFS 作为通用文件模型是 Linux 中“一切皆是文件”实现的基础。文章并未深入 Linux VFS，也没涉及实际文件系统的实现，文章只是从 inode 了解 Linux 的文件系统的相关内容。若想深入文件系统的内容，查看内核文档 Documentation/filesystems/ 是一个不错的方式。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/tags/linux">Linux</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="博文列表分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/tags/linux/page/8"><div class="pagination-nav__label">较新的博文</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tags/linux/page/10"><div class="pagination-nav__label">较旧的博文</div></a></nav></main></div></div></div></div>
<script src="/assets/js/runtime~main.60be52c9.js"></script>
<script src="/assets/js/main.3a3c6585.js"></script>
</body>
</html>