
<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Blog">
  <head>
    <meta charset="utf-8">
	<link rel="manifest" href="/static/pwa/manifest.json">
	<title> Home | 船长的课记 </title>
    
		
    <meta name="author" content="船长">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="theme-color" content="#2196F3">
	<meta name="google-site-verification" content="puZt0ZyqB-t67BYdYAgLUyIPBeismG68J0dmEc01QeY" />

	
    <script>
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', function () {
				navigator.serviceWorker
										.register('/sw.js')
										.then(function(registration) {
											console.log("Successfully registered service worker", registration.scope);
										}).catch(function(err) {
											console.log("Service worker registration failed: ", err);
										});
				//navigator.serviceWorker.ready always resolve
				navigator.serviceWorker.ready.then(function (registration) {
					console.log('Service worker successfully registered on scope', registration.scope);
				});
			});
		}
    </script>
	<script type="text/javascript" src="/assets/themes/evjekylltheme/jquery-3.6.0.slim.min.js"></script>

	<link href="/assets/themes/evjekylltheme/google-code-prettify/desert.css" type="text/css" rel="stylesheet" />

    <!-- Le styles -->
    <link href="/assets/themes/evjekylltheme/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/evjekylltheme/css/style.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/images/favicon.ico">

    <!-- atom & rss feed -->
    <link href="" type="application/atom+xml" rel="alternate" title="Jekyll auto generate ATOM Feed">
    <link href="" type="application/atom+xml" rel="alternate" title="Site ATOM Feed">
    <link href="" type="application/rss+xml" rel="alternate" title="Site RSS Feed">
	<link rel="stylesheet" href="/assets/themes/evjekylltheme/font-awesome-4.4.0/css/font-awesome.min.css">
	<!-- <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-W2LDG64');</script> -->
		<!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8529425670069509"
						crossorigin="anonymous"></script> -->
	<!-- <script async src="https://cdn.splitbee.io/sb.js"></script> -->
  </head>

  <body>
	<!-- <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W2LDG64"
	height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> -->
    <div class="navbar navbar-default navbar-fixed-top">
				<div class="container">
          <div class="row mobilepadding">
					<!-- <a class="navbar-brand" href="/">船长的课记</a> -->
					<a class="navbar-brand" href="/">SAMZONG</a>
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="collapse navbar-collapse" id="mNavbar">
  					<ul class="nav navbar-nav">
  						
  						
  						


  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/friends.html">Friends</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
  
    
  
    
  
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  



						  <li class="dropdown">
							  <a class="dropdown-toggle" data-toggle="dropdown" href="#">Other</a>
							  <ul class="dropdown-menu">
									<li><a href="/about.html">About</a></li>
									<li><a href="https://yuque.com/samzong/note" target="_blank">船长的课记</a></li>
									<li><a href="https://yuque.com/samzong/ap" target="_blank">果粉日记</a></li>
									<li><a href="https://yuque.com/samzong/code" target="_blank">Code Snippet</a></li>
									<li><a href="https://www.yuque.com/samzong/mcx" target="_blank">集</a></li>
									<li><a href="https://www.yuque.com/zooka" target="_blank">藏金阁</a></li>
								</ul>
						  </li>
  					</ul>
  					<form id="search-form" class="navbar-form navbar-right" role="search">
  						<div class="form-group">
  						<input type="text" class="form-control input-sm" placeholder="Search's Bad" id="query">
  						</div>
  					</form>
  					<div class="nav-icon">
  						<a href="/feed.xml"><i class="fa fa-rss fa-2x"></i></a>
  					</div>
          </div>
				</div>
      </div>
    </div>

    <div class="container">
			<div class="row mobilepadding">
        <div class="row">
					<div class="col-md-12">
						<div class="searchresult">
						</div>
						<div id="search-loader" class="img-wrap">
						</div>
					</div>
        </div>
				<meta itemprop="image" content="https://ipic-typora-samzong.oss-cn-qingdao.aliyuncs.com/uPic/telegram-cloud-photo-size-4-5971176114485308439-x.jpg">
<div class="row">
  <div class="col-xs-12 col-md-8">
    
    
    <h1><a class="title" href="/post/2016/12/HowTo-Install-Python3-on-CentOS-6-x.html">HowTo Install Python3 on CentOS 6.x</a></h1>
    <div class="post_at_index">
      <p>接触过 Python2.x 与 Python3.x 的应该知道，它们二者的区别也是蛮大的，而随着 Python3.x 的盛行，越来越多的应用运行与 Python3.x 的环境之上，但是我们的 CentOS 的系列，目前都默认安装时 Python2.x（CentOS 7.x 也是），所以不得不我们需要自己行动手安装 Python 3.x 的环境。</p>

<p>Mirosoft 平台与 Mac 平台，不在考虑范围，他们都有相应的软件包与图形化安装工具，可以很好的解决这个问题，所以今天我们的环境是在 CentOS 6.x 系列上进行。</p>

<blockquote>
  <p>Demo : CentOS 6.8</p>
</blockquote>

<h2 id="method-1-build--install-from-source-file">Method 1. Build &amp; Install From Source-File</h2>

<ul>
  <li>Python3.x 源码文件下载，请选择适合的版本。 <a href="https://www.python.org/ftp/python/">下载页面</a></li>
  <li>我这里使用版本 Python 3.5</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>cent@demo ~]<span class="nv">$ </span>wget https://www.python.org/ftp/python/3.5.0/Python-3.5.0.tgz
</code></pre></div></div>

<p>安装系统基本工具：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># yum-utils</span>
<span class="o">[</span>cent@demo ~]<span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> yum-utils

<span class="c"># 构建python 编译环境</span>
<span class="o">[</span>cent@demo ~]<span class="nv">$ </span><span class="nb">sudo </span>yum-builddep python
</code></pre></div></div>

<p>开始编译 &amp; 安装</p>

<p>并且源码安装的同时，会将 pip3 与 setuptools 一同安装。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>cent@demo ~]<span class="nv">$ </span><span class="nb">tar </span>xf Python-3.5.0.tgz
<span class="o">[</span>cent@demo ~]<span class="nv">$ </span><span class="nb">cd </span>Python-3.5.0
<span class="o">[</span>cent@demo ~]<span class="nv">$ </span>./configure
<span class="o">[</span>cent@demo ~]<span class="nv">$ </span>make
<span class="o">[</span>cent@demo ~]<span class="nv">$ </span><span class="nb">sudo </span>make <span class="nb">install</span>
</code></pre></div></div>

<p>检查版本</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>cent@demo ~]<span class="nv">$ </span>python3 <span class="nt">-V</span>
Python 3.5.0

<span class="c"># 如果希望系统默认为Python3</span>
<span class="o">[</span>cent@demo ~]<span class="nv">$ </span><span class="nb">alias </span><span class="nv">python</span><span class="o">=</span><span class="s1">'usr/bin/python3.5'</span>
</code></pre></div></div>

<h2 id="method-2-install-from-epel-repos">Method 2. Install From EPEL repos</h2>

<p>也许有的同学会说，编译安装，那是上古时期的做法了，yum 在线安装才是王道，当然这种说法也有可取之处，所以接下来讲下如何使用 yum 安装，需要注意的是 yum 安装是需要时间测试和增加到相应的源仓库，一般会稍慢于源码安装的方式，这里采用 EPEL 源，这是一个非常棒的第三方源仓库，之前的文章中也多次提到，这里就不做过多描述，请看下面的命令：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>cent@demo ~]<span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> epel-release
<span class="o">[</span>cent@demo ~]<span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> python34

<span class="c"># 因为yum安装时没能同时安装pip与setuptools，所以我们要手动安装，这里采用拿第三方包解决问题</span>

<span class="o">[</span>cent@demo ~]<span class="nv">$ </span>curl <span class="nt">-O</span> https://bootstrap.pypa.io/get-pip.py
<span class="o">[</span>cent@demo ~]<span class="nv">$ </span><span class="nb">sudo </span>python3 get-pip.py

<span class="o">[</span>cent@demo ~]<span class="nv">$ </span> python3 <span class="nt">-V</span>
Python 3.4.3
</code></pre></div></div>

      
    </div>
    <br/>
    <div>
      <cite>2016-12-08</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Python">Python</a>
      , 
      <a href="/tags.html#CentOS">CentOS</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2016/12/HowTo-Reset-MySQL-Root-Password.html">HowTo Reset MySQL Root Password</a></h1>
    <div class="post_at_index">
      <h4 id="1-处理的状态">1. 处理的状态</h4>

<p>首先确认服务器出于安全的状态，也就是没有人能够任意地连接 MySQL 数据库。
因为在重新设置 MySQL 的 root 密码的期间，MySQL 数据库完全出于没有密码保护的
状态下，其他的用户也可以任意地登录和修改 MySQL 的信息。可以采用将 MySQL 对
外的端口封闭，并且停止 Apache 以及所有的用户进程的方法实现服务器的准安全
状态。最安全的状态是到服务器的 Console 上面操作，并且拔掉网线。</p>

<h4 id="2-重置密码">2. 重置密码</h4>

<p>修改 mysql 配置文件，增加 skip-grant-tables</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@demo ~]# vim /etc/my.cnf
<span class="o">[</span>mysqld]
skip-grant-tables
</code></pre></div></div>

<p>重启 mysqld</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@demo ~]# service mysqld restart
Stopping mysqld:                                           <span class="o">[</span>  OK  <span class="o">]</span>
Starting mysqld:                                           <span class="o">[</span>  OK  <span class="o">]</span>
</code></pre></div></div>

<p>登录 mysql，并修改 root 密码。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@demo ~]# mysql <span class="nt">-u</span> root
Welcome to the MySQL monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MySQL connection <span class="nb">id </span>is 3
Server version: 5.5.53 MySQL Community Server <span class="o">(</span>GPL<span class="o">)</span>

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

mysql&gt; use mysql
Reading table information <span class="k">for </span>completion of table and column names
You can turn off this feature to get a quicker startup with <span class="nt">-A</span>

Database changed
mysql&gt; update user <span class="nb">set </span><span class="nv">password</span><span class="o">=</span>password<span class="o">(</span><span class="s1">'new-pass'</span><span class="o">)</span> where <span class="nv">user</span><span class="o">=</span><span class="s1">'root'</span><span class="p">;</span>
Query OK, 5 rows affected <span class="o">(</span>0.00 sec<span class="o">)</span>
Rows matched: 5  Changed: 5  Warnings: 0
</code></pre></div></div>

<p>配置文件去除 skip-grant-tables，并重启服务器。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@demo ~]# vim /etc/my.cnf
<span class="o">[</span>root@demo ~]# service mysqld restart
</code></pre></div></div>

<p>使用新密码登录到 mysql</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@demo ~]# mysql <span class="nt">-h</span> localhost <span class="nt">-u</span> root <span class="nt">-p</span>
</code></pre></div></div>

      
    </div>
    <br/>
    <div>
      <cite>2016-12-04</cite> <i class="icon-tag"></i>
      <a href="/tags.html#MySQL">MySQL</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2016/12/Tomcat-2-%E5%88%A9%E7%94%A8JDK%E8%87%AA%E8%BA%ABkeytool%E5%AE%9E%E7%8E%B0HTTPS.html">Tomcat 利用 JDK 自身 keytool 实现 HTTPS</a></h1>
    <div class="post_at_index">
      <p>因为一个偶然机会，想把自己的 webserver 通过 https 加密访问，这里就采用 JDK 自带的 keytool 工具实现，tomcat 官方也推荐这种方式，英文好的同学走这里：<a href="https://tomcat.apache.org/tomcat-7.0-doc/ssl-howto.html">官方配置</a></p>

<blockquote>
  <p>demo: CentOS 6.6 &amp; Tomcat 7 &amp; JDK 1.7</p>
</blockquote>

<h2 id="生成-keystore">生成 keystore</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@test conf]# keytool <span class="nt">-genkey</span> <span class="nt">-v</span> <span class="nt">-alias</span> tomcat <span class="nt">-keyalg</span> RSA <span class="nt">-keystore</span> mykeystore
Enter keystore password:              <span class="c">#设置密码</span>
Re-enter new password:                <span class="c">#重复一次</span>
What is your first and last name?
  <span class="o">[</span>Unknown]:  Alex Lu                <span class="c">#随便填</span>
What is the name of your organizational unit?
  <span class="o">[</span>Unknown]:  visionet                <span class="c">#随便填</span>
What is the name of your organization?
  <span class="o">[</span>Unknown]:  visionet                <span class="c">#随便填</span>
What is the name of your City or Locality?
  <span class="o">[</span>Unknown]:  SH                <span class="c">#随便填</span>
What is the name of your State or Province?
  <span class="o">[</span>Unknown]:  SH                <span class="c">#随便填</span>
What is the two-letter country code <span class="k">for </span>this unit?
  <span class="o">[</span>Unknown]:  ZH                <span class="c">#随便填</span>
Is <span class="nv">CN</span><span class="o">=</span>Alex Lu, <span class="nv">OU</span><span class="o">=</span>visionet, <span class="nv">O</span><span class="o">=</span>visionet, <span class="nv">L</span><span class="o">=</span>SH, <span class="nv">ST</span><span class="o">=</span>SH, <span class="nv">C</span><span class="o">=</span>ZH correct?
  <span class="o">[</span>no]:  Y                    <span class="c">#这里要Y，确认前面信息。</span>

Generating 2,048 bit RSA key pair and self-signed certificate <span class="o">(</span>SHA256withRSA<span class="o">)</span> with a validity of 90 days
    <span class="k">for</span>: <span class="nv">CN</span><span class="o">=</span>Alex Lu, <span class="nv">OU</span><span class="o">=</span>visionet, <span class="nv">O</span><span class="o">=</span>visionet, <span class="nv">L</span><span class="o">=</span>SH, <span class="nv">ST</span><span class="o">=</span>SH, <span class="nv">C</span><span class="o">=</span>ZH
Enter key password <span class="k">for</span> &lt;tomcat&gt;
    <span class="o">(</span>RETURN <span class="k">if </span>same as keystore password<span class="o">)</span>:        <span class="c">#默认回车即可，不需要设置太多密码</span>
<span class="o">[</span>Storing mykeystore]
<span class="o">[</span>root@test conf]# <span class="nb">ls
</span>Catalina  catalina.policy  catalina.properties  context.xml  logging.properties  mykeystore  server.xml  tomcat-users.xml  web.xml
</code></pre></div></div>

<blockquote>
  <p>注意：-keystore 是用来指定 keystore 保存位置，如果不加参数默认保存的当前用户家目录为~/.keystore
       -validity 可以用来指定证书有效期，单位为天，缺省值为 90 天。</p>
</blockquote>

<h2 id="2-备份tomcatdirconfserverxml">2. 备份$tomcatdir/conf/server.xml</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> <span class="nv">$tomcatdir</span>/conf/server.xml <span class="nv">$tomcatdir</span>/conf/server.xml
</code></pre></div></div>

<h2 id="3-修改-serverxml">3. 修改 server.xml</h2>

<h3 id="a-注释以下tomcat-注释用---xxxx----如何也想保留-http-访问可以不注释">a. 注释以下：（tomcat 注释用：&lt;!-- XXXX --&gt; ）,如何也想保留 http 访问，可以不注释</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--
&lt;Connector executor="tomcatThreadPool"
                port="80" protocol="HTTP/1.1"
                connectionTimeout="20000"
                redirectPort="8443" /&gt;
--&gt;</span>
</code></pre></div></div>

<h3 id="b-取消下面注释">b. 取消下面注释</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Connector</span> <span class="na">port=</span><span class="s">"443"</span> <span class="na">protocol=</span><span class="s">"HTTP/1.1"</span> <span class="na">SSLEnabled=</span><span class="s">"true"</span>
                <span class="na">maxThreads=</span><span class="s">"150"</span> <span class="na">scheme=</span><span class="s">"https"</span> <span class="na">secure=</span><span class="s">"true"</span>
                <span class="na">clientAuth=</span><span class="s">"false"</span> <span class="na">sslProtocol=</span><span class="s">"TLS"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<h3 id="c-增加-keystorefile-和-keystorepass">c. 增加 keystoreFile 和 keystorePass</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Connector</span> <span class="na">port=</span><span class="s">"443"</span> <span class="na">protocol=</span><span class="s">"HTTP/1.1"</span> <span class="na">SSLEnabled=</span><span class="s">"true"</span>
               <span class="na">maxThreads=</span><span class="s">"150"</span> <span class="na">scheme=</span><span class="s">"https"</span> <span class="na">secure=</span><span class="s">"true"</span>
               <span class="na">clientAuth=</span><span class="s">"false"</span> <span class="na">sslProtocol=</span><span class="s">"TLS"</span>
               <span class="na">keystoreFile=</span><span class="s">"conf/mykeystore"</span> <span class="na">keystorePass=</span><span class="s">"123456"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>keystoreFile=跟 keystore 文件位置
keystorePass=跟当时 keytool 命令执行时输入的密码</p>
</blockquote>

<h2 id="4-重启-tomcat">4. 重启 tomcat</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@test conf]# ../bin/catalina.sh stop <span class="o">&amp;&amp;</span> ../bin/catalina.sh start
Using CATALINA_BASE:   /home/pms/apache-tomcat-6.0.44
Using CATALINA_HOME:   /home/pms/apache-tomcat-6.0.44
Using CATALINA_TMPDIR: /home/pms/apache-tomcat-6.0.44/temp
Using JRE_HOME:        /home/pms/jdk1.7.0_65
Using CLASSPATH:       /home/pms/apache-tomcat-6.0.44/bin/bootstrap.jar
Using CATALINA_BASE:   /home/pms/apache-tomcat-6.0.44
Using CATALINA_HOME:   /home/pms/apache-tomcat-6.0.44
Using CATALINA_TMPDIR: /home/pms/apache-tomcat-6.0.44/temp
Using JRE_HOME:        /home/pms/jdk1.7.0_65
Using CLASSPATH:       /home/pms/apache-tomcat-6.0.44/bin/bootstrap.jar
<span class="o">[</span>root@test conf]# netstat <span class="nt">-ntlup</span> | <span class="nb">grep</span> <span class="nt">-e</span> <span class="s2">"80</span><span class="se">\|</span><span class="s2">443"</span>
tcp        0      0 0.0.0.0:80         0.0.0.0:<span class="k">*</span>          LISTEN      21960/java
tcp        0      0 0.0.0.0:443        0.0.0.0:<span class="k">*</span>          LISTEN      21960/java
tcp        0      0 127.0.0.1:8005     0.0.0.0:<span class="k">*</span>          LISTEN      21960/java
tcp        0      0 0.0.0.0:8009       0.0.0.0:<span class="k">*</span>          LISTEN      21960/java
<span class="o">[</span>root@test conf]#
</code></pre></div></div>

<p>OK !</p>

      
    </div>
    <br/>
    <div>
      <cite>2016-12-03</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Tomcat">Tomcat</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2016/11/AWS-Use-s3cmd%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%AE%A1%E7%90%86S3%E5%AD%98%E5%82%A8.html">AWS Use s3cmd 命令行管理 S3 存储</a></h1>
    <div class="post_at_index">
      <p>S3 是 AWS 公有云服务提供的云存储服务，提供海量数据存储服务，同时基于 AWS S3 提供的一系列网络服务接口，也有大量已经开发完成的工具供我们使用，以利用起 AWS 庞大的存储资源，这篇文章的目录选取了其中一个用 Linux 命令行工具<a href="http://s3tools.org">s3cmd</a>来管理 AWS S3 云存储其中的数据。</p>

<p>s3cmd 是非常优秀的 S3 命令行管理工具，用 python 编写，支持 python 2.6 &amp; 2.7，但是尚不支持 python3，但是目前绝大多数的 Linux 发行版默认都是 python2.x 系列。</p>

<blockquote>
  <p>Demo CentOS 6.x</p>
</blockquote>

<h2 id="install-s3cmd"><strong>Install s3cmd</strong></h2>

<h3 id="1-无论是-denbian-系还是-rehat-系列软件仓库内已经加入了-s3cmd">1. 无论是 Denbian 系还是 Rehat 系列，软件仓库内已经加入了 s3cmd</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1.1 Ubuntu &amp; Debian</span>
<span class="nv">$ </span><span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> s3cmd

<span class="c"># 1.2 RHEL &amp; CentOS</span>
<span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nb">install </span>s3cmd
</code></pre></div></div>

<h3 id="2-如果您的系统比较特殊软件仓库内找不到-s3cmd还有-s3cmd-的-github-上去获取相关安装信息链接">2. 如果您的系统比较特殊，软件仓库内找不到 s3cmd，还有 s3cmd 的 Github 上去获取相关安装信息：<a href="https://github.com/s3tools/s3cmd">链接</a></h3>

<h2 id="configure-s3cmd"><strong>Configure s3cmd</strong></h2>

<h3 id="1-第一次运行-s3cmd-需要首先预配置相关-s3-信息">1. 第一次运行 s3cmd 需要首先预配置相关 s3 信息</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>s3cmd <span class="nt">--configure</span>
</code></pre></div></div>

<p>它会问你一系列问题：</p>

<ul>
  <li>AWS S3 中 IAM 账户的 Access Key 以及 Secret Key (建议单独创建 IAM)</li>
  <li>对 AWS S3 双向传输的加密密码（自行设定不要忘记）</li>
  <li>为加密数据设定 GPG 程序的路径（默认即可）</li>
  <li>是否使用 https 协议（默认即可）</li>
  <li>如果不是 https 协议，需要设定名字和端口
配置完成之后，配置信息以普通文本保存在~/.s3cfg</li>
</ul>

<h3 id="2-china-与-global-的区别">2. China 与 Global 的区别</h3>

<p>笔者在第一次运行时，始终无法添加成功，报错信息如下：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ERROR: Test failed: 403 <span class="o">(</span>InvalidAccessKeyId<span class="o">)</span>: The AWS Accecc Key Id you provided does not exist <span class="k">in </span>our records.
</code></pre></div></div>

<p>起初以为是 Access Key 不对，在经过多次测试之后，才发现问题，这是因为 s3cmd 内置 s3 的 Domain 为 Global 的信息，而中国与 Global 是独立存在的所以查找不到我们的 Access Key。所以，如果你使用的 Global AWS 那么上面一步应该已经配置好了你的 s3cmd，如果你是 AWS China 的用户，那么你要做以下操作。</p>

<ul>
  <li>在 Retry configuration? [Y/n]选择“n”</li>
  <li>Save settings? [y/N] 选择“y”</li>
  <li>保存设置之后，编辑配置文件（~/.s3cfg ) 修改其中的如下字段，并将其中%(bucket)s 用您实际的某一个存储桶名字代替掉</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bucket_location <span class="o">=</span> %<span class="o">(</span>location<span class="o">)</span>
host_base <span class="o">=</span> s3.cn-north-1.amazonaws.com.cn
host_bucket <span class="o">=</span> %<span class="o">(</span>bucket<span class="o">)</span>s.s3.cn-north-1.amazonaws.com.cn
website_endpoint <span class="o">=</span> http://%<span class="o">(</span>bucket<span class="o">)</span>s.s3-website-%<span class="o">(</span>location<span class="o">)</span>s.amazonaws.com.cn/
</code></pre></div></div>

<p>例如，你的存储桶的名字为 s3chinatest: 地域为北京。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bucket_location <span class="o">=</span> cn-north-1
host_base <span class="o">=</span> s3.cn-north-1.amazonaws.com.cn
host_bucket <span class="o">=</span> s3chinatest.s3.cn-north-1.amazonaws.com.cn
website_endpoint <span class="o">=</span> http://s3chinatest.s3-website.amazonaws.com.cn/
</code></pre></div></div>

<h3 id="3-保存配置文件然后用命令测试一下确认-s3cmd-可以正常工作">3. 保存配置文件，然后用命令测试一下，确认 s3cmd 可以正常工作</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>s3cmd <span class="nb">ls
</span>2016-11-18 22:30 s3://s3chinatest
2016-10-29 00:14 s3://bucket2
</code></pre></div></div>

<h2 id="s3cmd-的基本使用"><strong>s3cmd 的基本使用</strong></h2>

<h3 id="1-查看当前账户下所有现有的桶-bucket">1. 查看当前账户下所有现有的桶 (bucket)</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>s3cmd <span class="nb">ls
</span>2016-11-18 22:30 s3://s3chinatest
2016-10-29 00:14 s3://bucket2
</code></pre></div></div>

<h3 id="2-创建新的-bucket">2. 创建新的 bucket</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>s3cmd mb s3://s3chinatest2

Bucket ’s3://s3chinatest2/’ created
</code></pre></div></div>

<h3 id="3-上传文件到-bucket">3. 上传文件到 bucket</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>s3cmd put file1.txt file2.txt file3.txt s3://s3chinatest2
upload: <span class="s1">'file1.txt'</span> -&gt; <span class="s1">'s3://s3chinatest2/file1.txt'</span>  <span class="o">[</span>1 of 3]
 2432 of 2432   100% <span class="k">in    </span>0s    43.27 kB/s  <span class="k">done
</span>upload: <span class="s1">'file2.txt'</span> -&gt; <span class="s1">'s3://s3chinatest2/file2.txt'</span>  <span class="o">[</span>2 of 3]
 2432 of 2432   100% <span class="k">in    </span>0s    59.83 kB/s  <span class="k">done
</span>upload: <span class="s1">'file3.txt'</span> -&gt; <span class="s1">'s3://s3chinatest2/file3.txt'</span>  <span class="o">[</span>3 of 3]
 2432 of 2432   100% <span class="k">in    </span>0s    58.93 kB/s  <span class="k">done</span>

 <span class="nv">$ </span>s3cmd <span class="nb">ls </span>s3://s3chinatest2
 2016-11-18 15:11      2432   s3://s3chinatest2/file1.txt
2016-11-18 15:11      2432   s3://s3chinatest2/file2.txt
2016-11-18 15:11      2432   s3://s3chinatest2/file3.txt
</code></pre></div></div>

<p>上传的文件默认访问权限为私有 (private)，只能用户自己可以访问，使用正确的访问和安全密码即可。
如果要上传公开访问权限的文件，需要添加 –acl-public 参数。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>s3cmd put  <span class="nt">--acl-public</span> file4.txt s3://s3chinatest2
upload: <span class="s1">'file4.txt'</span> -&gt; <span class="s1">'s3://s3chinatest2/file1.txt'</span>  <span class="o">[</span>1 of 1]
 2432 of 2432   100% <span class="k">in    </span>0s    43.27 kB/s  <span class="k">done</span>
</code></pre></div></div>

<h3 id="4-下载-bucket-内的文件">4. 下载 bucket 内的文件</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>s3cmd get s3://s3chinatest2/file1.txt
download: <span class="s1">'s3://s3chinatest2/file1.txt'</span> -&gt; <span class="s1">'./file1.txt'</span>  <span class="o">[</span>1 of 1]
 2432 of 2432   100% <span class="k">in    </span>0s    27.65 kB/s  <span class="k">done</span>

 <span class="c"># 支持 " * "匹配任意字符</span>
 <span class="nv">$ </span>s3cmd get s3://s3chinatest2/file<span class="k">*</span>.txt
download: <span class="s1">'s3://s3chinatest2/file1.txt'</span> -&gt; <span class="s1">'./file1.txt'</span>  <span class="o">[</span>1 of 3]
 2432 of 2432   100% <span class="k">in    </span>0s    48.11 kB/s  <span class="k">done
</span>download: <span class="s1">'s3://s3chinatest2/file2.txt'</span> -&gt; <span class="s1">'./file2.txt'</span>  <span class="o">[</span>2 of 3]
 2432 of 2432   100% <span class="k">in    </span>0s    84.76 kB/s  <span class="k">done
</span>download: <span class="s1">'s3://s3chinatest2/file3.txt'</span> -&gt; <span class="s1">'./file3.txt'</span>  <span class="o">[</span>3 of 3]
 2432 of 2432   100% <span class="k">in    </span>0s    75.28 kB/s  <span class="k">done</span>
</code></pre></div></div>

<blockquote>
  <p>注意若当前目录有相同文件时，可以使用–skip-existing 参数跳过这些文件。</p>
</blockquote>

<h3 id="5-删除-bucket-内的文件">5. 删除 bucket 内的文件</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># del 与 rm 都可以使用.</span>
<span class="nv">$ </span>s3cmd del s3://s3chinatest2/file1.txt
delete: <span class="s1">'s3://s3chinatest2/file1.txt'</span>
</code></pre></div></div>

<h3 id="6-获取当前-bucket-信息">6. 获取当前 bucket 信息</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># bucket的存储位置及访问权限设置</span>
s3cmd info s3://s3chinatest2
s3://s3chinatest2/ <span class="o">(</span>bucket<span class="o">)</span>:
   Location:  cn-north-1
   Payer:     BucketOwner
   Expiration Rule: none
   policy:    none
   cors:      none
   ACL:       2fe63da8137b85d9868d240869945287b285a58b5d7e07e21ac813b486dcabea: FULL_CONTROL
</code></pre></div></div>

<h3 id="7-上传文件到-bucket-时加密">7. 上传文件到 bucket 时加密</h3>

<p>当用 s3cmd 下载一个加密过的文件时，它会自动检测加密并在下载过程解密，因此下载和访问加密文件时，就像通常所做的一样</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>s3cmd <span class="nt">-e</span> put t_result.java s3://s3chinatest2
upload: <span class="s1">'/tmp/tmpfile-S9lUXERAEUdnNaz5zHba'</span> -&gt; <span class="s1">'s3://s3chinatest2/t_result.java'</span>  <span class="o">[</span>1 of 1]
 3355 of 3355   100% <span class="k">in    </span>0s    39.25 kB/s  <span class="k">done</span>
</code></pre></div></div>

<h3 id="8-查看-bucket-使用情况">8. 查看 bucket 使用情况</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>s3cmd <span class="nb">du </span>s3://s3chinatest2
8219     3 objects s3://s3chinatest2/
</code></pre></div></div>

<h3 id="9-删除一个-bucket">9. 删除一个 bucket</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>s3cmd rb s3://s3chinatest2
ERROR: S3 error: 409 <span class="o">(</span>BucketNotEmpty<span class="o">)</span>: The bucket you tried to delete is not empty
<span class="c"># 默认不能删除非空的bucket，所以要先清空存储桶内数据</span>

<span class="nv">$ </span>s3cmd <span class="nb">rm </span>s3://s3chinatest2/<span class="k">*</span>
delete: <span class="s1">'s3://s3chinatest2/file2.txt'</span>
delete: <span class="s1">'s3://s3chinatest2/file3.txt'</span>
delete: <span class="s1">'s3://s3chinatest2/t_result.java'</span>

<span class="nv">$ </span>s3cmd rb s3://s3chinatest2
Bucket <span class="s1">'s3://s3chinatest2/'</span> removed
</code></pre></div></div>

<h2 id="other"><em>Other</em></h2>

<ol>
  <li>关于 s3cmd 还有非常多的功能，这里只是列举简单的一部分，有兴趣的同学，可以使用 man s3cmd 查看详细的帮助文档。</li>
  <li>s3cmd 适用的场景主要利用脚本做 cron 任务，例如定时备份，然后推送到 s3，降低成本，持久保存。</li>
  <li>Windows 平台也支持 s3cmd 哦，有兴趣的同学可以去研究下。</li>
</ol>

      
    </div>
    <br/>
    <div>
      <cite>2016-11-30</cite> <i class="icon-tag"></i>
      <a href="/tags.html#AWS">AWS</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2016/11/Tomcat-1-java-lang-OutOfMemoryError.html">Tomcat java.lang.OutOfMemoryError</a></h1>
    <div class="post_at_index">
      <h3 id="1-什么是-permgen-space-">1. 什么是 <em>PermGen space</em> ?</h3>

<p>PermGen space 的全称是 Permanent Generation space，是指内存的永久保存区域，这块内存主要是被 JVM 存放 Class 和 Meta 信息的，Class 在被 Loader 时就会被放到 PermGen space 中，它和存放类实例 (Instance) 的 Heap 区域不同，GC(Garbage Collection) 不会在主程序运行期对 PermGen space 进行清理，所以如果你的应用中有很 CLASS 的话，就很可能出现 PermGen space 错误，这种错误常见在 web 服务器对 JSP 进行 pre compile 的时候。如果你的 WEB APP 下都用了大量的第三方 jar，其大小超过了 jvm 默认的大小 (4M) 那么就会产生此错误信息了。</p>

<h3 id="2-解决方法">2. 解决方法</h3>

<h4 id="21-手动设置-maxpermsize-大小">2.1 手动设置 MaxPermSize 大小</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 修改$TOMCAT_HOME/bin/catalina.sh，在“echo "Using CATALINA_BASE:   $CATALINA_BASE"”上面加入以下行：</span>
<span class="nv">JAVA_OPTS</span><span class="o">=</span><span class="s2">"-server -Xms256m -Xmx512m -XX:PermSize=64M -XX:MaxPermSize=128m"</span>
</code></pre></div></div>

<h3 id="3-java-heap-space">3. Java heap space</h3>

<h4 id="解释">解释</h4>

<p>Heap size 设置
JVM 堆的设置是指 java 程序运行过程中 JVM 可以调配使用的内存空间的设置.JVM 在启动的时候会自动设置 Heap size 的值，其初始空间 (即-Xms) 是物理内存的 1/64，最大空间 (-Xmx) 是物理内存的 1/4。可以利用 JVM 提供的-Xmn -Xms -Xmx 等选项可进行设置。Heap size 的大小是 Young Generation 和 Tenured Generaion 之和。</p>

<ul>
  <li>提示：在 JVM 中如果 98％的时间是用于 GC 且可用的 Heap size 不足 2％的时候将抛出此异常信息。</li>
  <li>提示：Heap Size 最大不要超过可用物理内存的 80％，一般的要将-Xms 和-Xmx 选项设置为相同，而-Xmn 为 1/4 的-Xmx 值。</li>
</ul>

<blockquote>
  <p>修改设置方法如 PermGen space</p>
</blockquote>

      
    </div>
    <br/>
    <div>
      <cite>2016-11-28</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Tomcat">Tomcat</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2016/11/HowTo-Install-LNMP-on-CentOS-6-x.html">HowTo Install LNMP on CentOS 6.x</a></h1>
    <div class="post_at_index">
      <blockquote>
  <table>
    <tbody>
      <tr>
        <td>egrep -v “^ *#</td>
        <td>^*$”     去除所有以#号开头的文件</td>
      </tr>
    </tbody>
  </table>
</blockquote>

<h4 id="demo-system">Demo system</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Alex@Test01 ~]<span class="nv">$ </span><span class="nb">uname</span> <span class="nt">-a</span>
Linux Test01 2.6.32-504.el6.x86_64 <span class="c">#1 SMP Wed Oct 15 04:27:16 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux</span>
<span class="o">[</span>Alex@Test01 ~]<span class="nv">$ </span>ip addr | <span class="nb">grep </span>eth0
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
    inet 10.0.2.128/24 brd 10.0.2.255 scope global eth0
</code></pre></div></div>

<h4 id="install-httpd">Install httpd</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Alex@Test01 yum.repos.d]<span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> httpd
<span class="o">[</span>Alex@Test01 ~]<span class="nv">$ </span>rpm <span class="nt">-qa</span> | <span class="nb">grep </span>httpd
httpd-2.2.15-39.el6.centos.x86_64
httpd-tools-2.2.15-39.el6.centos.x86_64

<span class="c"># remove welcome page</span>
<span class="o">[</span>Alex@Test01 yum.repos.d]<span class="nv">$ </span><span class="nb">sudo rm</span> <span class="nt">-f</span> /etc/httpd/conf.d/welcome.conf
<span class="c"># remove default error page</span>
<span class="o">[</span>Alex@Test01 yum.repos.d]<span class="nv">$ </span><span class="nb">sudo rm</span> <span class="nt">-f</span> /var/www/error/noindex.html
</code></pre></div></div>

<h4 id="configure-httpd--replace-the-server-name-to-you-own-one">Configure httpd . Replace the server name to you own one</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Alex@Test01 ~]# <span class="nb">sudo </span>vi /etc/httpd/conf/httpd.conf
<span class="c"># line 44: change</span>
 ServerTokens Prod
<span class="c"># line 76: change to ON</span>
 KeepAlive On
<span class="c"># line 262: Admin's address</span>
 ServerAdmin luchuanjia@msn.com
<span class="c"># line 338: change</span>
 AllowOverride All
<span class="c"># line 276: change to your server's name</span>
 ServerName www.ultraera.org:80
<span class="c"># line 402: add file name that it can access only with directory's name</span>
 DirectoryIndex index.html index.htm
<span class="c"># line 536: change</span>
 ServerSignature Off
<span class="c"># line 759: comment out</span>
<span class="c"># AddDefaultCharset UTF-8</span>
<span class="o">[</span>Alex@Test01 ~]# <span class="nb">sudo</span> /etc/init.d/httpd start
 Starting httpd:[  OK  <span class="o">]</span>
<span class="o">[</span>Alex@Test01 ~]# <span class="nb">sudo </span>chkconfig httpd on     <span class="c"># set httpd start with system.</span>
</code></pre></div></div>

<h4 id="create-a-html-test-page">create a HTML test page</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Alex@Test01 ~]# <span class="nb">sudo </span>vi /var/www/html/index.html
it<span class="s1">'s ok.
</span></code></pre></div></div>

<p><img src="http://s3.51cto.com/wyfs02/M00/70/DE/wKioL1XAUfuQoFfwAACC5LJWQgg039.jpg" alt="image" /></p>

<h4 id="install-php">Install PHP</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Alex@Test01 ~]<span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> php php-mbstring php-pear
<span class="o">[</span>Alex@Test01 ~]<span class="nv">$ </span>rpm <span class="nt">-qa</span> | <span class="nb">grep </span>php
php-common-5.3.3-46.el6_6.x86_64
php-5.3.3-46.el6_6.x86_64
php-mbstring-5.3.3-46.el6_6.x86_64
php-cli-5.3.3-46.el6_6.x86_64
php-pear-1.9.4-4.el6.noarch

<span class="o">[</span>Alex@Test01 ~]<span class="nv">$ </span><span class="nb">sudo </span>vi /etc/httpd/conf/httpd.conf
<span class="c"># line 402 add file name that it can access only with directory's name</span>
  DirectoryIndex index.html index.htm index.php
<span class="o">[</span>Alex@Test01 ~]<span class="nv">$ </span><span class="nb">sudo </span>vi /etc/php.ini
<span class="c"># line 946 set your timezone</span>
date.timezone <span class="o">=</span> <span class="s2">"Asia/Shanghai"</span>
<span class="o">[</span>Alex@Test01 ~]<span class="nv">$ </span><span class="nb">sudo</span> /etc/init.d/httpd restart
 Stopping httpd:[  OK  <span class="o">]</span>
 Starting httpd:[  OK  <span class="o">]</span>
</code></pre></div></div>

<h4 id="create-a-php-test-page">create a php test page</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Alex@Test01 ~]# <span class="nb">sudo </span>vi /var/www/html/index.php

&lt;?php
    phpinfo<span class="o">()</span><span class="p">;</span>
?&gt;
</code></pre></div></div>

<p><img src="http://s3.51cto.com/wyfs02/M02/70/DE/wKioL1XAUguwJCl2AARE16t4hyw682.jpg" alt="image" /></p>

<h4 id="install-mysql">Install MySQL</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Alex@Test01 ~]<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-y</span> <span class="nb">install </span>mysql-server
<span class="o">[</span>Alex@Test01 ~]<span class="nv">$ </span>rpm <span class="nt">-qa</span> | <span class="nb">grep </span>mysql-server
mysql-server-5.1.73-5.el6_6.x86_64

<span class="o">[</span>Alex@Test01 ~]<span class="nv">$ </span><span class="nb">sudo </span>vi /etc/my.cnf
<span class="o">[</span>mysqld]
<span class="nv">datadir</span><span class="o">=</span>/var/lib/mysql
<span class="nv">socket</span><span class="o">=</span>/var/lib/mysql/mysql.sock
<span class="nv">user</span><span class="o">=</span>mysql
<span class="c"># Disabling symbolic-links is recommended to prevent assorted security risks</span>
symbolic-links<span class="o">=</span>0
<span class="c"># add</span>
character-set-server<span class="o">=</span>utf8

<span class="o">[</span>Alex@Test01 ~]<span class="nv">$ </span><span class="nb">sudo</span> /etc/rc.d/init.d/mysqld start

Initializing MySQL database:  WARNING: The host <span class="s1">'www.ultraera.org'</span> could not be looked up with resolveip.
This probably means that your libc libraries are not 100 % compatible
with this binary MySQL version. The MySQL daemon, mysqld, should work
normally with the exception that host name resolving will not work.
This means that you should use IP addresses instead of hostnames
when specifying MySQL privileges <span class="o">!</span>
Installing MySQL system tables...
OK
Filling <span class="nb">help </span>tables...
OK
...
...
...
You can <span class="nb">test </span>the MySQL daemon with mysql-test-run.pl
<span class="nb">cd</span> /usr/mysql-test <span class="p">;</span> perl mysql-test-run.pl

Please report any problems with the /usr/bin/mysqlbug script!

                                              <span class="o">[</span>  OK  <span class="o">]</span>
Starting mysqld:                      <span class="o">[</span>  OK  <span class="o">]</span>
<span class="o">[</span>Alex@Test01 ~]<span class="nv">$ </span><span class="nb">sudo </span>chkconfig mysqld on
</code></pre></div></div>

<h4 id="initial-settings-for-mysql">Initial settings for MySQL</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@www ~]#mysql_secure_installation
NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MySQL
      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!

In order to log into MySQL to secure it, we<span class="s1">'ll need the current
password for the root user.  If you'</span>ve just installed MySQL, and
you haven<span class="s1">'t set the root password yet, the password will be blank,
so you should just press enter here.

# Enter
 Enter current password for root (enter for none):
OK, successfully used password, moving on...

Setting the root password ensures that nobody can log into the MySQL
root user without the proper authorisation.

# set root password
 Set root password? [Y/n]y
 New password:    # input any password
 Re-enter new password:
Password updated successfully!
Reloading privilege tables..
 ... Success!

By default, a MySQL installation has an anonymous user, allowing anyone
to log into MySQL without having to have a user account created for
them.  This is intended only for testing, and to make the installation
go a bit smoother.  You should remove them before moving into a
production environment.

# remove anonymous users
 Remove anonymous users? [Y/n]y

 ... Success!

Normally, root should only be allowed to connect from '</span>localhost<span class="s1">'.  This
ensures that someone cannot guess at the root password from the network.

# disallow root login remotely
 Disallow root login remotely? [Y/n]y

 ... Success!

By default, MySQL comes with a database named '</span><span class="nb">test</span><span class="s1">' that anyone can
access.  This is also intended only for testing, and should be removed
before moving into a production environment.

# remove test database
 Remove test database and access to it? [Y/n]y

 - Dropping test database...
 ... Success!
 - Removing privileges on test database...
 ... Success!

Reloading the privilege tables will ensure that all changes made so far
will take effect immediately.

# reload privilege tables
 Reload privilege tables now? [Y/n]y

 ... Success!

Cleaning up...

All done!  If you'</span>ve completed all of the above steps, your MySQL
installation should now be secure.

Thanks <span class="k">for </span>using MySQL!

<span class="c"># try to connect with root</span>
 <span class="o">[</span>root@www ~]#mysql <span class="nt">-u</span> root <span class="nt">-p</span>
 Enter password:# MySQL root password
Welcome to the MySQL monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MySQL connection <span class="nb">id </span>is 10
Server version: 5.1.73 Source distribution

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2013, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

<span class="c"># display user list</span>
 mysql&gt;select user,host,password from mysql.user<span class="p">;</span>
+------+-----------+-------------------------------------------+
| user | host      | password                                  |
+------+-----------+-------------------------------------------+
| root | localhost | <span class="k">*****************************************</span> |
| root | 127.0.0.1 | <span class="k">*****************************************</span> |
+------+-----------+-------------------------------------------+
2 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>

<span class="c"># display database list</span>
 mysql&gt;show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
+--------------------+
2 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
mysql&gt;exit
Bye
</code></pre></div></div>

      
    </div>
    <br/>
    <div>
      <cite>2016-11-28</cite> <i class="icon-tag"></i>
      <a href="/tags.html#LNMP">LNMP</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2016/11/%E4%B8%96%E7%95%8C%E4%B8%8A%E6%9C%80%E6%B2%A1%E7%94%A8%E7%9A%84%E4%B8%9C%E8%A5%BF.html">世界上最没用的东西</a></h1>
    <div class="post_at_index">
      <p><a href="https://www.zhihu.com/question/21905681/answer/93684468">知乎</a></p>

<p>@匿名用户</p>

<p>旧手机的充电器</p>

<p>暗恋时的独角戏</p>

<p>情人节后的鲜花</p>

<p>单身狗的第二杯半价</p>

<p>政客上任的许诺</p>

<p>渴望理解的诉说</p>

<p>花前月下的誓言</p>

<p>回忆里微笑的脸</p>

<p>过期的悔恨</p>

<p>懦弱的容忍</p>

<p>寒假前的作息表</p>

<p>满街的宣传口号</p>

<p>天赋不足的认真</p>

<p>无疾而终的情深</p>

<p>所谓寂寞空虚冷</p>

<p>不可说与人知的疼</p>

<p>失败后的借口</p>

<p>酒桌上的朋友</p>

<p>年轻时为你写的诗</p>

<p>心血来潮时的雄心壮志</p>

<p>收藏夹里的心灵鸡汤</p>

<p>总结汇报的官样文章</p>

<p>额度不够的信用卡</p>

      
    </div>
    <br/>
    <div>
      <cite>2016-11-27</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Zero">Zero</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2016/11/Denyhosts%E5%A2%9E%E5%8A%A0%E6%9C%8D%E5%8A%A1%E5%99%A8SSH%E9%BB%91%E5%90%8D%E5%8D%95%E6%9C%BA%E5%88%B6.html">Denyhosts 增加服务器 SSH 黑名单机制</a></h1>
    <div class="post_at_index">
      <h2 id="查看当前服务器失败登录的统计">查看当前服务器失败登录的统计</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> /var/log/secure | <span class="nb">awk</span> <span class="s1">'/Failed/{print $(NF-3)}'</span> | <span class="nb">sort</span> | <span class="nb">uniq</span> <span class="nt">-c</span> | <span class="nb">sort</span> <span class="nt">-n</span> |  <span class="nb">awk</span> <span class="s1">'{print $2" = "$1}'</span>
</code></pre></div></div>

<h2 id="install-denyhosts">Install denyhosts</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 需要预先安装epel源</span>
<span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> epel-release
<span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> denyhosts
</code></pre></div></div>

<h2 id="配置文件解析">配置文件解析</h2>

<p>默认配置文件/etc/denyhosts。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 查看的sshd日志文件</span>
SECURE_LOG <span class="o">=</span> /var/log/secure

<span class="c"># 将阻止IP写入的配置文件</span>
HOSTS_DENY <span class="o">=</span> /etc/hosts.deny

<span class="c"># 过多久之后清除，其中w代表周，d代表天，h代表小时，s代表秒，m代表分钟。</span>
PURGE_DENY <span class="o">=</span> 4h

<span class="c"># 阻止的服务名称</span>
BLOCK_SERVICE  <span class="o">=</span> sshd

<span class="c"># 允许无效用户（在/etc/passwd未列出）登录失败次数,允许无效用户登录失败的次数.</span>
DENY_THRESHOLD_INVALID <span class="o">=</span> 1

<span class="c"># 允许普通用户登录失败的次数</span>
DENY_THRESHOLD_VALID <span class="o">=</span> 5

<span class="c"># 允许root登录失败的次数</span>
DENY_THRESHOLD_ROOT <span class="o">=</span> 2
DENY_THRESHOLD_RESTRICTED <span class="o">=</span> 1

<span class="c"># 设定 deny host 写入到该资料夹</span>
WORK_DIR <span class="o">=</span> /var/lib/denyhosts

<span class="c"># 将deny的host或ip纪录到Work_dir中</span>
<span class="nv">SUSPICIOUS_LOGIN_REPORT_ALLOWED_HOSTS</span><span class="o">=</span>YES

<span class="c"># 是否做域名反解</span>
<span class="nv">HOSTNAME_LOOKUP</span><span class="o">=</span>YES

<span class="c"># 将DenyHOts启动的pid纪录到LOCK_FILE中，已确保服务正确启动，防止同时启动多个服务。</span>
LOCK_FILE <span class="o">=</span> /var/lock/subsys/denyhosts

<span class="c"># 设置管理员邮件地址</span>
ADMIN_EMAIL <span class="o">=</span> luchuanjia@msn.com
SMTP_HOST <span class="o">=</span> localhost
SMTP_PORT <span class="o">=</span> 25
SMTP_FROM <span class="o">=</span> DenyHosts &lt;nobody@localhost&gt;
SMTP_SUBJECT <span class="o">=</span> DenyHosts Report from <span class="nv">$[</span>HOSTNAME]

<span class="c"># 有效用户登录失败计数归零的时间</span>
<span class="nv">AGE_RESET_VALID</span><span class="o">=</span>1d

<span class="c"># root用户登录失败计数归零的时间</span>
<span class="nv">AGE_RESET_ROOT</span><span class="o">=</span>25d

<span class="c"># 用户的失败登录计数重置为0的时间(/usr/share/denyhosts/data/restricted-usernames)</span>
<span class="nv">AGE_RESET_RESTRICTED</span><span class="o">=</span>25d

<span class="c"># 无效用户登录失败计数归零的时间</span>
<span class="nv">AGE_RESET_INVALID</span><span class="o">=</span>10d

<span class="c"># denyhosts的日志文件位置</span>
DAEMON_LOG <span class="o">=</span> /var/log/denyhosts

<span class="c"># denyhosts的轮询时间</span>
DAEMON_SLEEP <span class="o">=</span> 30s

<span class="c"># 该项与PURGE_DENY 设置一样，也是清除hosts.deny中 ssh用户的时间</span>
DAEMON_PURGE <span class="o">=</span> 1h
</code></pre></div></div>

<h2 id="faq">FAQ</h2>

<ol>
  <li>如果想删除一个已经禁止的主机 IP，并加入到允许主机例表，只在 /etc/hosts.deny 删除是没用的，还需要以下：</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/lib/denyhosts 目录，进入以下操作：
<span class="c"># 停止denyhosts服务</span>
<span class="nb">sudo </span>service denyhosts stop

<span class="c"># 进入denyhosts的目录</span>
<span class="nb">cd</span> /var/lib/denyhosts

<span class="c"># 查看哪些文件添加了ssh限制,将IP_addr替换成你的IP</span>
<span class="nb">sudo grep </span>IP_addr /usr/share/denyhosts/data/<span class="k">*</span>

<span class="c"># 然后一个个删除文件中你想取消的主机IP所在的行:</span>
/usr/share/denyhosts/data/hosts
/usr/share/denyhosts/data/hosts-restricted
/usr/share/denyhosts/data/hosts-root
/usr/share/denyhosts/data/hosts-valid
/usr/share/denyhosts/data/users-hosts

<span class="c"># 添加你想允许的主机IP地址到allowed-hosts:</span>
<span class="nb">sudo echo </span>IP_addr <span class="o">&gt;&gt;</span>/usr/share/denyhosts/data/allowed-hostsps

<span class="c"># 启动 DenyHosts服务：</span>
 service denyhosts start
</code></pre></div></div>

<h2 id="tips">Tips</h2>

<ul>
  <li>尽量是用 key 验证登录服务器</li>
  <li>尽量从固定 IP 点登录服务器，然后将该地址加入白名单</li>
</ul>

      
    </div>
    <br/>
    <div>
      <cite>2016-11-23</cite> <i class="icon-tag"></i>
      <a href="/tags.html#DenyHosts">DenyHosts</a>
      , 
      <a href="/tags.html#CentOS">CentOS</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2016/11/Python-1-%E5%9F%BA%E7%A1%80.html">Python 基础</a></h1>
    <div class="post_at_index">
      <p>&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;
&lt;!DOCTYPE html PUBLIC “-//W3C//DTD XHTML 1.0 Transitional//EN” “http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd”&gt;</p>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="exporter-version" content="Evernote Mac 6.10 (454269)" /><meta name="author" content="Alex LU" /><meta name="created" content="2016-09-29 02:27:16 +0000" /><meta name="source" content="desktop.mac" /><meta name="updated" content="2016-09-29 06:27:40 +0000" /><title>Python 学习笔记 (1) --Python 基础</title></head><body>
<ol>
<li>输出：print
<ol>
<li>python2: print 'Hello Python'</li>
<li>python3: print('Hello Python')</li>
<li>python(‘10+20=‘,10+20)</li>
</ol>
</li>
<li>输入：
<ol>
<li>python2：raw_input()</li>
<li>python3: input()</li>
</ol>
</li>
<li>python 的语法比较简单，采用缩进的方式：</li>
</ol>
<div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">
<div>a = 100</div>
<div>if a &gt;= 0:</div>
<div>     print(a)</div>
<div>else:</div>
<div>     print(-a)</div>
<div><br /></div>
<div>&amp; diff &amp;</div>
<div>a = 100</div>
<div>if a &gt;=0:</div>
<div>print(a)</div>
<div>else:</div>
<div>print(-a)</div>
</div>
<ol start="4">
<li># 开头为注释；: 结尾，缩进的语句视为代码块；Python 大小写是敏感的，约定俗成：4 个空格的缩进，可以吧 tab 设置为 4 个空格。</li>
<li>Python 的数据类型
<ol>
<li>整数：python 可以处理任意大小的整数</li>
<li>浮点数：也就是小数，之所以称之为浮点数，因为按照科学计数法表示时，一个浮点数的小数点位置是可变的</li>
<li>字符串：字符串是以’’和””包括起来的任意文本，例如’abc’,”xyz”；如果字符内部同时包含’和”，可以使用\转义字符来标识。
<ol>
<li>如果字符串内部有很多换行，用\n不好阅读，python 支持使用’’’…’’' 的格式表示多行‘</li>
<li>r’…'  python 可以使用 r’’表示’'以内的字符不转义;多行：r’’’…’''</li>
</ol>
</li>
<li>布尔值：布尔值和布尔代数表示的完全一致，一个布尔值只有 True 和 False，python 支持直接使用 True 和 False 表示布尔值，注意大小写，另外最好不要生命变量时使用 True 等，布尔值，经常用于在条件判断之中。
<ol>
<li>and : 与运算，所有运算结果都是 True，and 的结果才是 True</li>
<li>or：或运算，只有 1 个运算结果为 True，or 的结果就是 True</li>
<li>not：他是一个单目运算符，取相反的值</li>
</ol>
</li>
<li>空值：python 里的一个特殊值，用 None 表示，注意 None 不能理解为 0，因为 0 是有意义的，而 None 是一个特殊的空值</li>
</ol>
</li>
<li>python 的变量
<ol>
<li>命名规则：必须是大小写英文，数字和_的组合，且不能用数字开头；</li>
<li>赋值符号：’=’；等于的符号是’==’</li>
<li>动态语言：变量本身类型不固定的语言称之为动态语言，反之是静态语言，静态语言在定义变量时必须制定变量的数据类型，如果赋值的时候类型不匹配，就会报错；</li>
<li>变量在计算机内存中的表示：a=1，指的是 python 在内存中创建了整数 1，然后在内存创建了变量 a，并把它指向了整数 1</li>
</ol>
</li>
<li>python 的常量
<ol>
<li>定义：常量就是不能改变的变量，在 python 中，通常使用全部大写的变量名表示常量</li>
<li>整数的除法是精确的，因为除法计算结果是浮点数，例如 9/3 结果为 3.0 ; 另外一种除法是’//‘地板除，两个整数的除法任然是整数；余数运算’%’</li>
</ol>
</li>
<li>字符编码：字符串是一种数据类型，但是字符串还涉及到一个编码问题，Python3 的字符串是支持多语言的
<ol>
<li>ord(‘') 函数 获取字符的整数表示；</li>
<li>chr(‘') 函数 把编码转换成对应的字符；</li>
<li>python 的字符串类型是 str，在内存中以 Unicode 表示，一个字符对应若干字节，但是如果要在网络传输或者保存到磁盘，就要把 str 转化为单位的 bytes；
<ol>
<li>python 对于 bytes 的数据类型用带 b 前缀的单引号或双引号表示：</li>
<li>另外，Unicode 表示的 str 可用 encode() 函数，指定编码为 bytes。 ‘ABC’ .encode(‘utf-8')</li>
<li>decode() 可以吧 bytes 转变为 str。b'ABC' .decode('ascii')</li>
<li>要计算 str 包含了多少个字符使用 len() 函数：len(‘hello’) ,结果为 5</li>
</ol>
</li>
<li style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;">#!/usr/bin/env python3<br />
# -*- coding: utf-8 -*-</li>
</ol>
</li>
<li>格式化：如何处理格式化输出字符串，在 python 中使用的格式化方式和 C 语言是一致的，用’%’实现：
<ol>
<li>%d 表示整数</li>
<li>%f 表示浮点数</li>
<li>%s 表示字符串，如果不确定用什么，用%s，它会把任何数据类型转换为字符串</li>
<li>%x 表示十六进制整数</li>
<li>%% 表示一个普通的%</li>
</ol>
</li>
<li>数据类型 list 和 tuple
<ol>
<li>list 是 python 内置的一种数据类型：列表，list 是一个有序的集合，可以随时添加和删除其中元素。
<ol>
<li>classmates = [‘Michael’,’Bob’,’Tracy’]， 可以用len() 函数获取这个 list 的元素的个数</li>
<li>可以用索引来访问 list 中的每一个位置的元素，记住索引的第一个位置是 0：</li>
<li>当索引超出范围的时候，python 会报出 IndexError 错误，记得最后一个索引是 len(classmates) -1</li>
<li>如果直接取出最后一个索引可用 classmates[-1],以此类推</li>
</ol>
</li>
<li>list 是一个可变的有序列表，所以可以去追加，插入指定位置，删除，替换等操作，支持不同数据类型，支持嵌套 list
<ol>
<li>追加：classmates.append(‘Adam')</li>
<li>插入指定位置: classmates.insert(2,’Jack')</li>
<li>删除 list 末尾的元素：classmates.pop()</li>
<li>删除指定位置的元素：classmates.pop(1)</li>
<li>替换元素：classmates[1]=‘Sarch’ ， 直接给相应位置的元素重新赋值即可</li>
<li>list 的元素支持不同的数据类型，L = [‘abc’,23,23.4]</li>
<li>list 的元素支持嵌套另外一个 list：s = [‘abc',123,[‘XYZ’,2.34]]，注意这个时候len(s) 的元素是 3 个</li>
<li>list 也可以没有元素，就是一个空的 list，它的长度为 0</li>
</ol>
</li>
<li>tuple：元组，也是一种有序列表，但是 tuple 一旦初始化就不能修改，他没有 append() 也没有 insert()，这样的方法，其他获取元素的方式和 list 一样，也不能赋值成为另外的元素：
<ol>
<li>classmates = (‘Michael’,’Bob’,’Tracy’) 注意 list 用的是’[]’，而tuple用的是’()’</li>
<li>tuple 有个问题，当你定义 1 个元素的时候，tuple 的 () 和数学公式中的小括号混淆，因此 python 规定，这种情况下面，当定义只有 1 个 tuple 时必须增加一个逗号’,’来消除歧义。</li>
<li>tuple 的元素也可以为 list 或者 tuple，tuple 的元素不会改变，但是 list 是一个可以改变的有序数列，所以当 tuple 中包含 list 时，这个 tuple 是’可变的'</li>
</ol>
</li>
<li>取出特定元素：L[[‘Apple’,’Google’,’Microsoft’],[‘Java’,’Python’,’C’]] ; L[1][1] = ‘Python'</li>
</ol>
</li>
<li>条件判断
<ol>
<li>if：根据 python 的缩进规则，如果 if 语句的判断是 True，就会执行下面的语句，否则什么都不做</li>
<li>else：也可以个 if 添加 else，意思就是，如果 if 的判断是 false，不要执行 if 的内容，执行 else 的内容</li>
<li>elif：如果要嵌套多级判断条件的话，使用 elif，elif 是 else if 的缩写</li>
<li>if 语句执行有个特点，它是自上而下的判断，如果某个判断的结果是 True，那么执行该判断对应的语句，就会忽略掉剩下的所有 elif 和 else，if 判断条件还可以简写：if x: 只要 x 是非零数值、非空字符串、非空 list 等，就判断为 True，</li>
</ol>
</li>
<li>iput(): 需要注意的地方，默认input的返回类型是str，由于str不能直接整数比较，所以在碰到明明输入200，但是不能和201对比时，记住先要把str转化为整数，python提供了int()函数, 转化数据类型为int类型，但是如果输入’abc’则会得到1个ValueError的错误</li>
<li>循环
<ol>
<li>for…in：依次把 list 或者 tuple 的每个元素迭代出来，for x in … ：循环就是把每个元素带入变量 x，然后执行缩进的语句：</li>
<li>range() 函数：用来生成一个整数序列，再通过 list() 函数转换为 list，例如 range(5) 生成：0,1,2,3,4
<ol>
<li>list(range(5)) = [0,1,2,3,4]</li>
<li>计算 1+...+100 的结果：for x in range(101): sum = sum +x</li>
</ol>
</li>
<li>while 循环：只要条件满足，就不断循环，条件不足时退出循环：
<ol>
<li>计算 100 以内所有奇数之和：sum = 0,n = 99, while n &gt; 0: sum =sum +n; n = n-2</li>
</ol>
</li>
<li>break: 在循环中，break 语句可以提前退出循环，当程序执行满足 break 条件的时候，就会退出循环</li>
<li>continue: 在循环过程中，也可以通过 continue 语句，跳过当前的这次循环。</li>
<li>注意：循环是让计算机做重复任务的有效方法，break 语句可以在循环过程总直接退出循环，continue 语句可以提前结束本轮循环，并直接进入下一轮循环，这两个语句通常必须配合 if 语句使用，但是尽量不要滥用这两个语句，因为当 break 和 continue 使用过多会导致代码执行逻辑分支过多，容易出错。</li>
</ol>
</li>
<li>dict 和 set
<ol>
<li>dict：python 内置了字典：dict 的支持，全称：dictionary，在其他语言中也称之为 map，使用键值存储，具有极快的查找速度。</li>
<li>对比 list 处理方式：会过滤整个 list 的元素，这导致 list 越长，耗时越长；dict 实现时，只需要创建 key-values 对应表，直接根据名字查找，无论这个表有多大，查找速度都不会变慢，但是内存消耗会大，典型用性能 (内存空间) 换时间。</li>
<li>dict的初始化: d {‘Michael’:95,’Bob’:75,’Tracy’:85}  # 注意dict使用的是大括号’{}‘</li>
<li>dict 的数据插入：d [‘Adam’] = 67 </li>
<li>由于 dict 是根据 key 检索，所以 key 是固定的，一个 key 只能对应 1 个 value，所以当对 1 个 key 多次放入 value 时，后面的值会把前面的值冲掉： （类似变量）</li>
<li>但是如果查询的 key 不存在，dict 会报错，KeyError，可以用 in 判断 key 是否存在：‘key’in d  : True/False</li>
<li>通过 dict 的 get 方法，如果 key 不存在，可以返回 None，或者自己指定的值，d.get(‘Key’) , d.get(‘key’,-1)</li>
<li>d.pop('key’): 删除 1 个 key，注意当 key 被删除是，相应的 value 也会被删除。</li>
<li>另外注意：dict 内部存放的顺序和 key 放入的顺序是没有关系的：</li>
<li>dict 应在需要高速查找的地方，正确使用 dict 非常重要，要牢记 1 点，dict 的 key 必须是不可变的对象，因为 dict 是根据 key 来计算 value 的位置，如果每次计算相同的 key 得到的结果不一样，那么 dict 内部就完全混乱了，这个通过 key 计算位置的算法称之为 Hash 算法。</li>
<li>要保证 hash 的准确性，作为 key 的对象就不能改变，在 python 中，字符串·整数等都是不可变的，但是 list 是可以变的所以不能作为 key</li>
<li>set：set 和 dict 类似，也是一组 key 的集合，但是不存储 value，由于 key 不能重复，所以，在 set 中，没有重复的 key 值。</li>
<li>要创建一个set，需要提供一个list作为输入集合。 s = set([1,2,3])   : s = {1,2,3}</li>
<li>注意 set 也不是有序的，而且重复在 set 存在的元素会被自动过滤：s = set([1,2,3,1,2,3,1,2,3])  s = {1,2,3}</li>
<li>通过 s.add(key) 可以增加元素到 set 中，可以重复添加，但是不会有效果</li>
<li>通过 s.remove(key) 可以删除元素</li>
<li>set 可以看成数学意义上的无序和无重复元素的集合，因此两个 set 可以做数学意义上的交集、并集能操作：
<ol>
<li>s1 = set([1,2,3]), s2 = set([2,3,4]) ,交集：s1 &amp; s2 = {2,3} ; s1 | s2 = {1,2,3,4}</li>
</ol>
</li>
<li>set 和 dict 的区别仅在于有没有存储对应的 value，但是 set 和 dict 的原理是一样的，所以，同样不可以放置可变对象，因为无法判断两个对象是否相等，也就无法保证 set 内部的不会重复元素</li>
<li>不可变对象：str 是不变对象，list 是可变对象；对于可变对象，例如 list，对 list 进行操作，list 的内部会发生变化</li>
<li>a = ‘abc’ , a.replace(‘a’,’A’) # 这个操作是把所有小写的 a 替换成大写的 A，但是注意 a 的值并没有发生改变，要牢记 a 是变量，’abc'才是字符对象。</li>
</ol>
</li>
</ol>
</body>
</html>

      
    </div>
    <br/>
    <div>
      <cite>2016-11-10</cite> <i class="icon-tag"></i>
      <a href="/tags.html#Python">Python</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    
    
    <h1><a class="title" href="/post/2016/11/MySQL-5-%E6%B8%85%E7%A9%BA%E8%A1%A8%E5%91%BD%E4%BB%A4%E4%B9%8B-truncate%E4%B8%8Edelete%E5%8C%BA%E5%88%AB.html">MySQL 清空表命令之：truncate 与 delete 区别</a></h1>
    <div class="post_at_index">
      <p>在实际工作中，有时我们会想要去清空一张表的所有数据，常用的命令有 delete 和 truncate 这两个命令。</p>

<h3 id="1-delete">1. delete</h3>

<p>在很多情况，我们对于 delete 的应用更多，因为它支持更多的匹配模式，我们可以使用 where 条件语句，清理一些特定的数据，关于 delete 的操作，这里不做过多解释，有空就专门写写 delete 的使用和原理。delete 在清空表时，如果表内有自增 ID 的设定，那么在 delete 清空之后，再插入数据时，自增 ID 不会从 1 开始，默认会继续增加; 除非我们使用 OPTIMIZE TABLE，重置表属性；</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">delete</span> <span class="k">from</span> <span class="n">piwik_tmp</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="2-truncate">2. truncate</h3>

<p>truncate 在清空表时，会同时将自增 ID 重置，再插入新数据时会从 1 开始，而且 truncate 在清空表时，不关心表的行数，所以执行效率会高于 delete；</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">truncate</span> <span class="k">table</span> <span class="n">piwik_tmp</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span> <span class="n">sec</span><span class="p">)</span>

</code></pre></div></div>

<h3 id="3-释放表空间">3. 释放表空间</h3>

<p>但是在 truncate 清空表数据时，myisam 的表和 innodb 的表在使用上有一定的区别；myisam 表会清空所有数据，并释放表空间，即硬盘空间会得到释放。innodb 表也会清空所有数据，但不释放表空间。Innodb 数据库对于已经删除的数据只是标记为删除，并不真正释放所占用的磁盘空间，这就导致 InnoDB 数据库文件不断增长。如果想彻底释放这些已经删除的数据，需要把数据库导出，删除 InnoDB 数据库文件，然后再导入。</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="err">备份数据库：</span>
<span class="n">mysqldump</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">p</span> <span class="c1">--quick --force --all-databases &gt; mysqldump.sql</span>

<span class="o">#</span> <span class="err">停止数据库</span>
<span class="n">service</span> <span class="n">mysqld</span> <span class="n">stop</span>

<span class="o">#</span> <span class="err">删除这些大文件</span>
<span class="n">rm</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">ibdata1</span>
<span class="n">rm</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">ib_logfile</span><span class="o">*</span>

<span class="o">#</span> <span class="err">手动删除除</span><span class="n">Mysql</span><span class="err">之外所有数据库文件夹，然后启动数据库</span>
<span class="n">service</span> <span class="n">mysqld</span> <span class="k">start</span>

<span class="o">#</span> <span class="err">还原数据</span>
<span class="n">mysql</span> <span class="o">-</span><span class="n">uroot</span> <span class="o">-</span><span class="n">proot</span> <span class="o">&lt;</span> <span class="n">mysqldump</span><span class="p">.</span><span class="k">sql</span>
</code></pre></div></div>

<h3 id="4-innodb_file_per_table">4. innodb_file_per_table</h3>

<p>还有一种方式是在创建数据库的时候设置 innodb_file_per_table，这样 InnoDB 会对每个表创建一个数据文件，然后只需要运行 OPTIMIZE TABLE 命令就可以释放所有已经删除的磁盘空间。</p>

<h4 id="41-修改-mysql-默认配置文件">4.1 修改 mysql 默认配置文件</h4>

<p>编辑 my.ini 或 my.cnf 在 innodb 段中加入 innodb_file_per_table=1 # 1 为启用，0 为禁用</p>

<h4 id="42-查看修改结果">4.2 查看修改结果</h4>

<p>通过 mysql 语句可以查看该变量的值：</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">show</span> <span class="n">variables</span> <span class="k">like</span> <span class="s1">'%per_table%'</span><span class="p">;</span>
</code></pre></div></div>

      
    </div>
    <br/>
    <div>
      <cite>2016-11-09</cite> <i class="icon-tag"></i>
      <a href="/tags.html#MySQL">MySQL</a>
      
      
      
    </div>
    <div style="clear: both;"></div>
    <hr/>
    

    <!-- Pagination links -->
    <nav>
      <ul class="pagination hidden-xs">
        
        
        <li>
          <a href="/page16">&laquo; Previous</a>
        </li>
        
        

        
        <li>
          <a href="/">1</a>
        </li>
        

        
          
            
            <li>
              <a href="/page2">2</a>
            </li>
            
            <li>
              <a href="/page3">3</a>
            </li>
            
            <li>
              <a href="/page4">4</a>
            </li>
            
            <li>
              <a href="/page5">5</a>
            </li>
            
            <li class="disabled"><span>...</span></li>
            <li class="active"><a>17</a></li>
          
          <li class="disabled"><span>...</span></li>
          <li><a href="/page24">24</a></li>
        

        
        

        
        <li>
          <a href="/page18">Next &raquo;</a>
        </li>
        
      </ul>
    </nav>
  </div>
  <div class="col-xs-12 col-md-4">
		<!-- <div>
			<a class="twitter-timeline" data-width="390" data-height="640" data-theme="light" href="https://twitter.com/samzong_lu?ref_src=twsrc%5Etfw">Tweets by SAMZONG</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
		</div> -->
    <div>
      <h2>传送门</h2>
      <ul>
        <li><a href="https://yuque.com/samzong">语雀-花园</a></li>
        <li><a href="https://github.com/samzong">Github</a></li>
      </ul>
    </div>
    <div class="categories">
      <h2>文章分类</h2>
      <ul class="tag_box">
        
        


  
     
    	
      <li><a href="/categories.html#故事汇">
    		故事汇 <span>23</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Linux">
    		Linux <span>22</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#前端">
    		前端 <span>5</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#数据库">
    		数据库 <span>30</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Git">
    		Git <span>6</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Mac">
    		Mac <span>16</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Tools">
    		Tools <span>7</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#OpenSource">
    		OpenSource <span>11</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Python">
    		Python <span>45</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#云平台">
    		云平台 <span>8</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#虚拟化">
    		虚拟化 <span>3</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Java">
    		Java <span>6</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Docker">
    		Docker <span>6</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Blog">
    		Blog <span>7</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#安全">
    		安全 <span>2</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#读书笔记">
    		读书笔记 <span>16</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#微服务">
    		微服务 <span>2</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#Kubernetes">
    		Kubernetes <span>14</span>
    	</a></li>
     
    	
      <li><a href="/categories.html#DaoCloud Enterprise">
    		DaoCloud Enterprise <span>2</span>
    	</a></li>
    
  



      </ul>
    </div>
    <div>
      <h2>最近文章</h2>
      <ul>
        
        <li>
          <a href="/post/2022/11/what-is-hukou.html">What is Hukou</a>
          背景


        </li>
        
        <li>
          <a href="/post/2022/11/Copy-To-Markdwon.html">Copy to Markdown</a>
          背景


        </li>
        
        <li>
          <a href="/post/2022/11/Dubbo-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html">Dubbo 基础知识梳理</a>
          
  参考资料：



        </li>
        
        <li>
          <a href="/post/2022/11/Panads-fill-NaN-value-to-Zero.html">Panads fill NaN value to Zero</a>
          ```python
df = pandas.read_csv(‘somefile.txt’)


        </li>
        
        <li>
          <a href="/post/2022/10/Redash-for-Docker-%E9%83%A8%E7%BD%B2.html">Redash for Docker 部署</a>
          
  暗坑很多



        </li>
        
      </ul>
    </div>
  </div>
</div>

			</div>

		</div>

    <footer>
      <div class="container">
        <div class="row mobilepadding">
          			<hr>
      &copy; 2022 船长. Powered by <a href="http://jekyllrb.com" target="_blank" title="The simple, blog-aware, static site generator.">Jekyll</a>. Theme Creator <a href="https://github.com/einverne" target="_blank" title="Ein Verne's GitHub Repos">Ein Verne</a> . Host on <a href="https://github.com/samzong/samzong.me" target="_blank" title="Samzong's GitHub Repos">Github</a> .
      <br><br>
      </div>
    </div>
    </footer>

    




	<script async type="text/javascript" src="/assets/themes/evjekylltheme/bootstrap-3.3.5/js/bootstrap.min.js"></script>
	<script async type="text/javascript" src="/assets/themes/evjekylltheme/webcore.js"></script>

 </body>
</html>

