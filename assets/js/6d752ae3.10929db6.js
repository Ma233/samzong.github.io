"use strict";(self.webpackChunksamzong_me=self.webpackChunksamzong_me||[]).push([[36765],{3905:(t,e,a)=>{a.d(e,{Zo:()=>u,kt:()=>d});var l=a(67294);function i(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function n(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);e&&(l=l.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,l)}return a}function r(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?n(Object(a),!0).forEach((function(e){i(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function s(t,e){if(null==t)return{};var a,l,i=function(t,e){if(null==t)return{};var a,l,i={},n=Object.keys(t);for(l=0;l<n.length;l++)a=n[l],e.indexOf(a)>=0||(i[a]=t[a]);return i}(t,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);for(l=0;l<n.length;l++)a=n[l],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}var o=l.createContext({}),p=function(t){var e=l.useContext(o),a=e;return t&&(a="function"==typeof t?t(e):r(r({},e),t)),a},u=function(t){var e=p(t.components);return l.createElement(o.Provider,{value:e},t.children)},b="mdxType",g={inlineCode:"code",wrapper:function(t){var e=t.children;return l.createElement(l.Fragment,{},e)}},c=l.forwardRef((function(t,e){var a=t.components,i=t.mdxType,n=t.originalType,o=t.parentName,u=s(t,["components","mdxType","originalType","parentName"]),b=p(a),c=i,d=b["".concat(o,".").concat(c)]||b[c]||g[c]||n;return a?l.createElement(d,r(r({ref:e},u),{},{components:a})):l.createElement(d,r({ref:e},u))}));function d(t,e){var a=arguments,i=e&&e.mdxType;if("string"==typeof t||i){var n=a.length,r=new Array(n);r[0]=c;var s={};for(var o in e)hasOwnProperty.call(e,o)&&(s[o]=e[o]);s.originalType=t,s[b]="string"==typeof t?t:i,r[1]=s;for(var p=2;p<n;p++)r[p]=a[p];return l.createElement.apply(null,r)}return l.createElement.apply(null,a)}c.displayName="MDXCreateElement"},73803:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>o,contentTitle:()=>r,default:()=>g,frontMatter:()=>n,metadata:()=>s,toc:()=>p});var l=a(87462),i=(a(67294),a(3905));const n={title:"HowTo Install GitLab",tags:["Gitlab"],date:new Date("2017-04-13T11:18:17.000Z")},r=void 0,s={permalink:"/2017/04/13/HowTo-Install-GitLab",source:"@site/blog/2017-04-13-HowTo-Install-GitLab.md",title:"HowTo Install GitLab",description:"\u76ee\u524d\u6700\u4e3a\u4e3b\u6d41\u7684\u5728\u7ebf Git \u7248\u672c\u63a7\u5236\u7cfb\u7edf\u53ef\u4ee5\u8bf4\u662f\u975e GitHub \u83ab\u5c5e\uff0c\u5bf9\u4e8e\u4e2a\u4eba\u5f00\u53d1\u8005\u548c\u5f00\u6e90\u9879\u76ee\u53ef\u4ee5\u76f4\u63a5\u9009\u62e9 GitHub \u4f5c\u4e3a Git \u7248\u672c\u63a7\u5236\u7cfb\u7edf\u5373\u53ef\uff0c\u4f46\u662f\uff0c\u5bf9\u4e8e\u4f01\u4e1a\u5185\u90e8\u5f00\u53d1\u7ba1\u7406\u7684 Git \u7248\u672c\u63a7\u5236\u7cfb\u7edf\uff0c\u5728\u5bf9\u4fdd\u5bc6\u6027\u6709\u9ad8\u8981\u6c42\u65f6 GitHub \u5c31\u4e0d\u5408\u9002\u4e86\uff0c\u8fd9\u65f6 GitLab \u4f5c\u4e3a\u4e00\u4e2a\u53ef\u4ee5\u5b8c\u5168\u642d\u5efa\u5728\u4f01\u4e1a\u5185\u90e8\u7684 Git \u7248\u672c\u63a7\u5236\u7cfb\u7edf\uff0c\u800c\u4e14\u57fa\u672c\u56ca\u62ec\u4e86 GitHub \u7684\u6240\u6709\u529f\u80fd\u3002",date:"2017-04-13T11:18:17.000Z",formattedDate:"2017\u5e744\u670813\u65e5",tags:[{label:"Gitlab",permalink:"/tags/gitlab"}],readingTime:4.826666666666667,hasTruncateMarker:!1,authors:[],frontMatter:{title:"HowTo Install GitLab",tags:["Gitlab"],date:"2017-04-13T11:18:17.000Z"},prevItem:{title:"CentOS \u589e\u52a0\u65b0\u786c\u76d8\u7ed9\u6839\u6587\u4ef6\u7cfb\u7edf\u6269\u5bb9",permalink:"/2017/04/18/CentOS\u589e\u52a0\u65b0\u786c\u76d8\u7ed9\u6839\u6587\u4ef6\u7cfb\u7edf\u6269\u5bb9"},nextItem:{title:"\u5173\u4e8e\u8003\u8bd5",permalink:"/2017/04/11/\u5173\u4e8e\u8003\u8bd5"}},o={authorsImageUrls:[]},p=[{value:"\u76ee\u524d GitLab \u5df2\u7ecf\u6574\u5408\u7684\u529f\u80fd",id:"\u76ee\u524d-gitlab-\u5df2\u7ecf\u6574\u5408\u7684\u529f\u80fd",level:2},{value:"\u6d4b\u8bd5\u73af\u5883",id:"\u6d4b\u8bd5\u73af\u5883",level:2},{value:"\u5b89\u88c5\u9700\u6c42",id:"\u5b89\u88c5\u9700\u6c42",level:2},{value:"GitLab \u5b89\u88c5",id:"gitlab-\u5b89\u88c5",level:3},{value:"\u5b89\u88c5\u914d\u7f6e\u4f9d\u8d56\u9879",id:"\u5b89\u88c5\u914d\u7f6e\u4f9d\u8d56\u9879",level:2},{value:"\u6dfb\u52a0 GitLab \u4ed3\u5e93\uff0c\u5e76\u5b89\u88c5\u5230\u670d\u52a1\u5668\u4e0a",id:"\u6dfb\u52a0-gitlab-\u4ed3\u5e93\u5e76\u5b89\u88c5\u5230\u670d\u52a1\u5668\u4e0a",level:2},{value:"\u542f\u52a8 GitLab \u5e76\u521d\u59cb\u5316",id:"\u542f\u52a8-gitlab-\u5e76\u521d\u59cb\u5316",level:2},{value:"GitLab \u521d\u59cb\u5316",id:"gitlab-\u521d\u59cb\u5316",level:3},{value:"\u5f00\u673a\u81ea\u542f\u52a8",id:"\u5f00\u673a\u81ea\u542f\u52a8",level:2},{value:"GitLab \u914d\u7f6e\u6587\u4ef6",id:"gitlab-\u914d\u7f6e\u6587\u4ef6",level:2},{value:"SMTP \u90ae\u7bb1\u914d\u7f6e",id:"smtp-\u90ae\u7bb1\u914d\u7f6e",level:2},{value:"QQ \u4f01\u4e1a\u90ae\u7bb1\u914d\u7f6e\u793a\u4f8b",id:"qq-\u4f01\u4e1a\u90ae\u7bb1\u914d\u7f6e\u793a\u4f8b",level:3},{value:"Gmail \u90ae\u7bb1\u914d\u7f6e\u793a\u4f8b",id:"gmail-\u90ae\u7bb1\u914d\u7f6e\u793a\u4f8b",level:3},{value:"Outlook \u90ae\u7bb1\u914d\u7f6e\u793a\u4f8b",id:"outlook-\u90ae\u7bb1\u914d\u7f6e\u793a\u4f8b",level:3},{value:"GitLab \u65e5\u5e38\u7ef4\u62a4",id:"gitlab-\u65e5\u5e38\u7ef4\u62a4",level:2},{value:"1. \u67e5\u770b\u670d\u52a1\u72b6\u6001",id:"1-\u67e5\u770b\u670d\u52a1\u72b6\u6001",level:3},{value:"2. \u542f\u52a8\u3001\u5173\u95ed\u3001\u91cd\u542f",id:"2-\u542f\u52a8\u5173\u95ed\u91cd\u542f",level:3},{value:"3. \u63a7\u5236\u53f0\u5b9e\u65f6\u67e5\u770b\u65e5\u5fd7",id:"3-\u63a7\u5236\u53f0\u5b9e\u65f6\u67e5\u770b\u65e5\u5fd7",level:3},{value:"GitLab \u5b89\u88c5\u540e\u4f18\u5316",id:"gitlab-\u5b89\u88c5\u540e\u4f18\u5316",level:3},{value:"\u542f\u7528 HTTPS",id:"\u542f\u7528-https",level:2},{value:"\u8bbe\u7f6e\u5ef6\u8fdf\u542f\u52a8",id:"\u8bbe\u7f6e\u5ef6\u8fdf\u542f\u52a8",level:2},{value:"Backups \u5907\u4efd\u8fd8\u539f",id:"backups-\u5907\u4efd\u8fd8\u539f",level:2},{value:"\u5907\u4efd",id:"\u5907\u4efd",level:3},{value:"\u4fee\u6539\u9ed8\u8ba4\u5907\u4efd\u8def\u5f84",id:"\u4fee\u6539\u9ed8\u8ba4\u5907\u4efd\u8def\u5f84",level:3},{value:"\u4f7f\u7528 crontab \u6dfb\u52a0\u81ea\u52a8\u5907\u4efd",id:"\u4f7f\u7528-crontab-\u6dfb\u52a0\u81ea\u52a8\u5907\u4efd",level:3},{value:"\u5907\u4efd\u6062\u590d",id:"\u5907\u4efd\u6062\u590d",level:3},{value:"GitLab \u8fc1\u79fb",id:"gitlab-\u8fc1\u79fb",level:3}],u={toc:p},b="wrapper";function g(t){let{components:e,...a}=t;return(0,i.kt)(b,(0,l.Z)({},u,a,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"\u76ee\u524d\u6700\u4e3a\u4e3b\u6d41\u7684\u5728\u7ebf Git \u7248\u672c\u63a7\u5236\u7cfb\u7edf\u53ef\u4ee5\u8bf4\u662f\u975e GitHub \u83ab\u5c5e\uff0c\u5bf9\u4e8e\u4e2a\u4eba\u5f00\u53d1\u8005\u548c\u5f00\u6e90\u9879\u76ee\u53ef\u4ee5\u76f4\u63a5\u9009\u62e9 GitHub \u4f5c\u4e3a Git \u7248\u672c\u63a7\u5236\u7cfb\u7edf\u5373\u53ef\uff0c\u4f46\u662f\uff0c\u5bf9\u4e8e\u4f01\u4e1a\u5185\u90e8\u5f00\u53d1\u7ba1\u7406\u7684 Git \u7248\u672c\u63a7\u5236\u7cfb\u7edf\uff0c\u5728\u5bf9\u4fdd\u5bc6\u6027\u6709\u9ad8\u8981\u6c42\u65f6 GitHub \u5c31\u4e0d\u5408\u9002\u4e86\uff0c\u8fd9\u65f6 GitLab \u4f5c\u4e3a\u4e00\u4e2a\u53ef\u4ee5\u5b8c\u5168\u642d\u5efa\u5728\u4f01\u4e1a\u5185\u90e8\u7684 Git \u7248\u672c\u63a7\u5236\u7cfb\u7edf\uff0c\u800c\u4e14\u57fa\u672c\u56ca\u62ec\u4e86 GitHub \u7684\u6240\u6709\u529f\u80fd\u3002"),(0,i.kt)("h2",{id:"\u76ee\u524d-gitlab-\u5df2\u7ecf\u6574\u5408\u7684\u529f\u80fd"},"\u76ee\u524d GitLab \u5df2\u7ecf\u6574\u5408\u7684\u529f\u80fd"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Repository access"),(0,i.kt)("li",{parentName:"ol"},"Administration"),(0,i.kt)("li",{parentName:"ol"},"Issues"),(0,i.kt)("li",{parentName:"ol"},"Forks"),(0,i.kt)("li",{parentName:"ol"},"Code review"),(0,i.kt)("li",{parentName:"ol"},"Wiki"),(0,i.kt)("li",{parentName:"ol"},"Merge Requests"),(0,i.kt)("li",{parentName:"ol"},"Web Editor")),(0,i.kt)("h2",{id:"\u6d4b\u8bd5\u73af\u5883"},"\u6d4b\u8bd5\u73af\u5883"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"2 core 4GB"),(0,i.kt)("li",{parentName:"ul"},"50GB HDD"),(0,i.kt)("li",{parentName:"ul"},"CentOS 6.8"),(0,i.kt)("li",{parentName:"ul"},"Gitlab")),(0,i.kt)("h2",{id:"\u5b89\u88c5\u9700\u6c42"},"\u5b89\u88c5\u9700\u6c42"),(0,i.kt)("p",null,"\u5173\u4e8e GitLab \u7684\u5b89\u88c5\u9700\u6c42\uff0c\u4e3b\u8981\u662f\u9488\u5bf9\u7528\u6237\u91cf\u7136\u540e\u8bc4\u4f30\u51fa\u670d\u52a1\u5668\u53ca\u76f8\u5173\u8d44\u6e90\u7684\u914d\u7f6e\uff0c",(0,i.kt)("a",{parentName:"p",href:"https://docs.gitlab.com.cn/ce/install/requirements.html"},"\u67e5\u770b")),(0,i.kt)("h3",{id:"gitlab-\u5b89\u88c5"},"GitLab \u5b89\u88c5"),(0,i.kt)("h2",{id:"\u5b89\u88c5\u914d\u7f6e\u4f9d\u8d56\u9879"},"\u5b89\u88c5\u914d\u7f6e\u4f9d\u8d56\u9879"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo yum install curl openssh-server openssh-clients postfix cronie\nsudo service postfix start\nsudo chkconfig postfix on\nsudo lokkit -s http -s ssh\n")),(0,i.kt)("h2",{id:"\u6dfb\u52a0-gitlab-\u4ed3\u5e93\u5e76\u5b89\u88c5\u5230\u670d\u52a1\u5668\u4e0a"},"\u6dfb\u52a0 GitLab \u4ed3\u5e93\uff0c\u5e76\u5b89\u88c5\u5230\u670d\u52a1\u5668\u4e0a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl -sS http://packages.gitlab.cc/install/gitlab-ce/script.rpm.sh | sudo bash\nsudo yum install gitlab-ce\n")),(0,i.kt)("h2",{id:"\u542f\u52a8-gitlab-\u5e76\u521d\u59cb\u5316"},"\u542f\u52a8 GitLab \u5e76\u521d\u59cb\u5316"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo gitlab-ctl reconfigure\n")),(0,i.kt)("p",null,"\u9ed8\u8ba4\u767b\u5f55\u8d26\u53f7\u662f\uff1aroot\uff0c\u4f60\u53ef\u4ee5\u5728\u9996\u6b21\u6253\u5f00\u65f6\u8bbe\u7f6e\u5bc6\u7801\u3002"),(0,i.kt)("h3",{id:"gitlab-\u521d\u59cb\u5316"},"GitLab \u521d\u59cb\u5316"),(0,i.kt)("h2",{id:"\u5f00\u673a\u81ea\u542f\u52a8"},"\u5f00\u673a\u81ea\u542f\u52a8"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"}," vi /etc/rc.local\n /opt/gitlab/bin/gitlab-ctl start\n")),(0,i.kt)("h2",{id:"gitlab-\u914d\u7f6e\u6587\u4ef6"},"GitLab \u914d\u7f6e\u6587\u4ef6"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"/etc/gitlab/gitlab.rb\n")),(0,i.kt)("h2",{id:"smtp-\u90ae\u7bb1\u914d\u7f6e"},"SMTP \u90ae\u7bb1\u914d\u7f6e"),(0,i.kt)("p",null,"\u5982\u679c\u60f3\u4f7f\u7528 SMTP \u4ee3\u66ff sendmail \u6765\u53d1\u9001\u90ae\u4ef6\uff0c\u5e94\u8be5\u5728 gitlab.rb \u4e2d\u542f\u7528\u5bf9\u5e94\u7684\u914d\u7f6e\uff0c\u7136\u540e\u8fd0\u884c",(0,i.kt)("inlineCode",{parentName:"p"},"gitlab-ctl reconfigure"),"\u4f7f\u4fee\u6539\u751f\u6548\u3002"),(0,i.kt)("h3",{id:"qq-\u4f01\u4e1a\u90ae\u7bb1\u914d\u7f6e\u793a\u4f8b"},"QQ \u4f01\u4e1a\u90ae\u7bb1\u914d\u7f6e\u793a\u4f8b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"gitlab_rails['smtp_enable'] = true\ngitlab_rails['smtp_address'] = \"smtp.exmail.qq.com\"\ngitlab_rails['smtp_port'] = 465\ngitlab_rails['smtp_user_name'] = \"xxxx@xx.com\"\ngitlab_rails['smtp_password'] = \"password\"\ngitlab_rails['smtp_authentication'] = \"login\"\ngitlab_rails['smtp_enable_starttls_auto'] = true\ngitlab_rails['smtp_tls'] = true\ngitlab_rails['gitlab_email_from'] = 'xxxx@xx.com'\n")),(0,i.kt)("h3",{id:"gmail-\u90ae\u7bb1\u914d\u7f6e\u793a\u4f8b"},"Gmail \u90ae\u7bb1\u914d\u7f6e\u793a\u4f8b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"gitlab_rails['smtp_enable'] = true\ngitlab_rails['smtp_address'] = \"smtp.gmail.com\"\ngitlab_rails['smtp_port'] = 587\ngitlab_rails['smtp_user_name'] = \"my.email@gmail.com\"\ngitlab_rails['smtp_password'] = \"my-gmail-password\"\ngitlab_rails['smtp_domain'] = \"smtp.gmail.com\"\ngitlab_rails['smtp_authentication'] = \"login\"\ngitlab_rails['smtp_enable_starttls_auto'] = true\ngitlab_rails['smtp_tls'] = false\ngitlab_rails['smtp_openssl_verify_mode'] = 'peer'\n")),(0,i.kt)("h3",{id:"outlook-\u90ae\u7bb1\u914d\u7f6e\u793a\u4f8b"},"Outlook \u90ae\u7bb1\u914d\u7f6e\u793a\u4f8b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"gitlab_rails['smtp_enable'] = true\ngitlab_rails['smtp_address'] = \"smtp-mail.outlook.com\"\ngitlab_rails['smtp_port'] = 587\ngitlab_rails['smtp_user_name'] = \"username@outlook.com\"\ngitlab_rails['smtp_password'] = \"password\"\ngitlab_rails['smtp_domain'] = \"smtp-mail.outlook.com\"\ngitlab_rails['smtp_authentication'] = \"login\"\ngitlab_rails['smtp_enable_starttls_auto'] = true\ngitlab_rails['smtp_openssl_verify_mode'] = 'peer'\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u200b\u26a0\ufe0f 'smtp_password'\u5b57\u6bb5\u4e0d\u5e94\u5305\u542b\u4efb\u4f55 Ruby\u6216\u8005YAML\u8bed\u6cd5\u4e2d\u7684\u5206\u9694\u7b26 (\u5982",(0,i.kt)("inlineCode",{parentName:"p"},"'"),"),\u4ee5\u907f\u514d\u5904\u7406\u914d\u7f6e\u6587\u4ef6\u7684\u8fc7\u7a0b\u4e2d\u53d1\u751f\u4e0d\u5fc5\u8981\u7684\u610f\u5916\u3002")),(0,i.kt)("h2",{id:"gitlab-\u65e5\u5e38\u7ef4\u62a4"},"GitLab \u65e5\u5e38\u7ef4\u62a4"),(0,i.kt)("h3",{id:"1-\u67e5\u770b\u670d\u52a1\u72b6\u6001"},"1. \u67e5\u770b\u670d\u52a1\u72b6\u6001"),(0,i.kt)("p",null,"\u4f7f\u7528 gitlab-ctl status \u67e5\u770b\u670d\u52a1\u72b6\u6001"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"[root@6 ~]# sudo gitlab-ctl status\nrun: gitaly: (pid 15055) 23089s; run: log: (pid 3142) 55379s\nrun: gitlab-monitor: (pid 15060) 23088s; run: log: (pid 3325) 55357s\nrun: gitlab-workhorse: (pid 15063) 23088s; run: log: (pid 3156) 55377s\nrun: logrotate: (pid 17867) 1487s; run: log: (pid 3197) 55369s\nrun: nginx: (pid 15077) 23087s; run: log: (pid 3169) 55375s\nrun: node-exporter: (pid 15083) 23087s; run: log: (pid 3247) 55366s\nrun: postgres-exporter: (pid 15088) 23086s; run: log: (pid 3311) 55358s\nrun: postgresql: (pid 15093) 23086s; run: log: (pid 2988) 55412s\nrun: prometheus: (pid 15101) 23085s; run: log: (pid 3230) 55368s\nrun: redis: (pid 15109) 23085s; run: log: (pid 2931) 55419s\nrun: redis-exporter: (pid 15113) 23085s; run: log: (pid 3290) 55364s\nrun: sidekiq: (pid 17029) 22450s; run: log: (pid 3131) 55380s\nrun: unicorn: (pid 17001) 22460s; run: log: (pid 3100) 55386s\n")),(0,i.kt)("h3",{id:"2-\u542f\u52a8\u5173\u95ed\u91cd\u542f"},"2. \u542f\u52a8\u3001\u5173\u95ed\u3001\u91cd\u542f"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# \u542f\u52a8Gitlab\u6240\u6709\u7ec4\u4ef6\nsudo gitlab-ctl start\n\n# \u505c\u6b62Gitlab\u6240\u6709\u7ec4\u4ef6\nsudo gitlab-ctl stop\n\n# \u91cd\u542fGitlab\u6240\u6709\u7ec4\u4ef6\nsudo gitlab-ctl restart\n\n# \u91cd\u542f\u5355\u4e2a\u7ec4\u4ef6\nsudo gitlab-ctl restart sidekiq\n")),(0,i.kt)("h3",{id:"3-\u63a7\u5236\u53f0\u5b9e\u65f6\u67e5\u770b\u65e5\u5fd7"},"3. \u63a7\u5236\u53f0\u5b9e\u65f6\u67e5\u770b\u65e5\u5fd7"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# \u67e5\u770b\u6240\u6709\u7684logs; \u6309 Ctrl-C \u9000\u51fa\nsudo gitlab-ctl tail\n\n# \u62c9\u53d6/var/log/gitlab\u4e0b\u5b50\u76ee\u5f55\u7684\u65e5\u5fd7\nsudo gitlab-ctl tail gitlab-rails\n\n# \u62c9\u53d6\u67d0\u4e2a\u6307\u5b9a\u7684\u65e5\u5fd7\u6587\u4ef6\nsudo gitlab-ctl tail nginx/gitlab_error.log\n")),(0,i.kt)("h3",{id:"gitlab-\u5b89\u88c5\u540e\u4f18\u5316"},"GitLab \u5b89\u88c5\u540e\u4f18\u5316"),(0,i.kt)("h2",{id:"\u542f\u7528-https"},"\u542f\u7528 HTTPS"),(0,i.kt)("p",null,"\u9996\u5148\uff0c\u4f60\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u6709\u53ef\u4fe1\u4efb CA \u8bc1\u4e66\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b GitLab \u662f\u6ca1\u6709\u542f\u7528 HTTPS \u7684\uff0c\u5982\u679c\u8981\u542f\u7528 HTTPS \u65f6\uff0c\u9996\u5148\u8981\u4fee\u6539",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/gitlab/gitlab.rb"),"\u4e2d\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"external_url"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# \u4fee\u6539\u4e3ahttps\nexternal_url \"https://git.ultraera.org\"\n\n# \u8bbe\u7f6e\u9ed8\u8ba4\u5c06http\u91cd\u5b9a\u5411\u5230https\nnginx['redirect_http_to_https'] = true\n")),(0,i.kt)("p",null,"\u5982\u679c\u4f60\u6682\u65f6\u6ca1\u6709 https \u8bc1\u4e66\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5\u4e34\u65f6\u81ea\u5df1\u9881\u53d1\u4e00\u4e2a\u8bc1\u4e66\uff0c\u6ce8\u610f\u8fd9\u4e2a\u8bc1\u4e66\u662f\u4e0d\u53d7\u4fe1\u4efb\u7684\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir -p /etc/nginx/ssl/\ncd /etc/nginx/ssl/\nsudo openssl req -newkey rsa:2048 -x509 -nodes -days 3560 -out gitlab.crt -keyout gitlab.key\nsudo chmod o-r gitlab.key\nsudo mv gitlab.key gitlab.crt /etc/ssl/\n")),(0,i.kt)("p",null,"\u53e6\u5916\uff0c\u8fd8\u9700\u8981\u5728 gitlab-shell \u4e2d\u7684 config.yml \u4e2d\u5c06 self_signed_cert \u4fee\u6539\u4e3a\u542f\u7528\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"self_signed_cert = true\n")),(0,i.kt)("h2",{id:"\u8bbe\u7f6e\u5ef6\u8fdf\u542f\u52a8"},"\u8bbe\u7f6e\u5ef6\u8fdf\u542f\u52a8"),(0,i.kt)("p",null,"\u4e3a\u4fdd\u8bc1\u670d\u52a1\u8d28\u91cf\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e\u8ba9 omnibus-gitlab \u7684\u670d\u52a1 (Nginx, Redis, Unicorn \u7b49) \u5728\u6307\u5b9a\u7684\u6587\u4ef6\u7cfb\u7edf\u6302\u8f7d\u6210\u529f\u540e\u518d\u542f\u52a8\uff0c\u5728",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/gitlab/gitlab.rb")," \u6587\u4ef6\u4e2d\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# \u7b49\u5f85/var/opt/gitlab \u5148\u88ab\u6302\u8f7d\nhigh_availability['mountpoint'] = '/var/opt/gitlab'\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u6ce8\u610f\u5728\u4fee\u6539\u914d\u7f6e\u4e4b\u540e\uff0c\u8981\u4f7f\u7528\u91cd\u65b0 reconfigure \u914d\u7f6e")),(0,i.kt)("h2",{id:"backups-\u5907\u4efd\u8fd8\u539f"},"Backups \u5907\u4efd\u8fd8\u539f"),(0,i.kt)("h3",{id:"\u5907\u4efd"},"\u5907\u4efd"),(0,i.kt)("p",null,"Gitlab \u7684\u914d\u7f6e\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u4f7f\u7528\u4e00\u6761\u547d\u4ee4\u5373\u53ef\u521b\u5efa\u5b8c\u6574\u7684 Gitlab \u5907\u4efd\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"gitlab-rake gitlab:backup:create\n")),(0,i.kt)("p",null,"\u8be5\u547d\u4ee4\u4f1a\u5728",(0,i.kt)("inlineCode",{parentName:"p"},"/var/opt/gitlab/backups"),"\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u540d\u79f0\u7c7b\u4f3c\u4e3a",(0,i.kt)("inlineCode",{parentName:"p"},"1491989249_2017_04_12_gitlab_backup.tar"),"\u7684\u538b\u7f29\u5305\uff0c\u8fd9\u4e2a\u538b\u7f29\u5305\u5c31\u662f Gitlab \u6574\u4e2a\u7684\u5b8c\u6574\u90e8\u5206\uff0c\u5176\u4e2d\u5f00\u5934\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"1491989249_2017_04_12"),"\u662f\u5907\u4efd\u521b\u5efa\u7684\u65e5\u671f\uff0c\u8fd9\u4e5f\u662f\u6211\u4eec\u7b49\u4e0b\u6062\u590d\u662f\u8981\u7528\u7684\u5b57\u6bb5\u3002"),(0,i.kt)("h3",{id:"\u4fee\u6539\u9ed8\u8ba4\u5907\u4efd\u8def\u5f84"},"\u4fee\u6539\u9ed8\u8ba4\u5907\u4efd\u8def\u5f84"),(0,i.kt)("p",null,"\u5982\u679c\u4f60\u50cf\u6211\u4e00\u6837\uff0c\u662f\u4f7f\u7528 yum \u5b89\u88c5\u7684\uff0c\u90a3\u4e48 GitLab \u9ed8\u8ba4\u7684\u5907\u4efd\u76ee\u5f55\u5e94\u8be5\u5728",(0,i.kt)("inlineCode",{parentName:"p"},"/var/opt/gitlab/backups"),"\uff0c\u6211\u5efa\u8bae\u5c06\u5907\u4efd\u76ee\u5f55\u4fee\u6539\u4e3a\u5176\u4ed6\u4f4d\u7f6e\uff0c\u5e76\u6dfb\u52a0\u5b9a\u65f6\u81ea\u52a8\u5907\u4efd\u811a\u672c\uff0c\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/gitlab/gitlab.rb"),"\u6765\u4fee\u6539\u9ed8\u8ba4\u4f4d\u7f6e\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"gitlab_rails['backup_path'] = '/mnt/backups'\n")),(0,i.kt)("h3",{id:"\u4f7f\u7528-crontab-\u6dfb\u52a0\u81ea\u52a8\u5907\u4efd"},"\u4f7f\u7528 crontab \u6dfb\u52a0\u81ea\u52a8\u5907\u4efd"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# \u6bcf\u5929\u51cc\u666800:00 \u81ea\u52a8\u5907\u4efd\n00 00 * * * /opt/gitlab/bin/gitlab-rake gitlab:backup:create\n")),(0,i.kt)("h3",{id:"\u5907\u4efd\u6062\u590d"},"\u5907\u4efd\u6062\u590d"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# \u505c\u6b62\u76f8\u5173\u6570\u636e\u8fde\u63a5\u670d\u52a1\ngitlab-ctl stop unicorn\ngitlab-ctl stop sidekiq\n\n# \u4ece1491989249_2017_04_12\u7f16\u53f7\u5907\u4efd\u4e2d\u6062\u590d\ngitlab-rake gitlab:backup:restore BACKUP=1491989249_2017_04_12\n\n# \u542f\u52a8Gitlab\nsudo gitlab-ctl start unicorn\nsudo gitlab-ctl start sidekiq\n")),(0,i.kt)("h3",{id:"gitlab-\u8fc1\u79fb"},"GitLab \u8fc1\u79fb"),(0,i.kt)("p",null,"\u53ea\u9700\u5c06\u539f\u670d\u52a1\u5668",(0,i.kt)("inlineCode",{parentName:"p"},"/var/opt/gitlab/backups"),"\u76ee\u5f55\u4e0b\u7684\u5907\u4efd\u6587\u4ef6\u62f7\u8d1d\u5230\u65b0\u670d\u52a1\u5668\u4e0a\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"/var/opt/gitlab/backups"),"\u4e0a\u5373\u53ef (\u5982\u679c\u4f60\u6ca1\u4fee\u6539\u8fc7\u9ed8\u8ba4\u5907\u4efd\u76ee\u5f55\u7684\u8bdd)\uff0c\u4f46\u662f\u9700\u8981\u6ce8\u610f\u7684\u662f\u65b0\u670d\u52a1\u5668\u4e0a\u7684 Gitlab \u7684\u7248\u672c\u5fc5\u987b\u4e0e\u521b\u5efa\u5907\u4efd\u65f6\u7684 Gitlab \u7248\u672c\u53f7\u76f8\u540c\uff0c\u6bd4\u5982\u65b0\u670d\u52a1\u5668\u5b89\u88c5\u7684\u662f\u6700\u65b0\u7684 9.0.5 \u7248\u672c\u7684 Gitlab, \u90a3\u4e48\u8fc1\u79fb\u4e4b\u524d\uff0c\u6700\u597d\u5c06\u8001\u670d\u52a1\u5668\u7684 Gitlab \u5347\u7ea7\u4e3a 9.0.5 \u5728\u8fdb\u884c\u5907\u4efd\u3002"),(0,i.kt)("p",null,"/Users/Alex/Documents/Hexo/source/_posts/"))}g.isMDXComponent=!0}}]);